{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ACER/Documents/code/streamify/Streaming_Platform/frontend/lib/axios.ts"],"sourcesContent":["// lib/axiosInstance.ts\r\nimport axios from \"axios\";\r\n\r\nconst BASE_URL = process.env.NEXT_PUBLIC_API_URL || \"http://localhost:5001/api\";\r\n\r\nexport const axiosInstance = axios.create({\r\n  baseURL: BASE_URL,  // Đây là URL của backend của bạn\r\n  withCredentials: true,  // Cho phép gửi cookies (cần thiết cho authentication)\r\n});\r\n\r\naxiosInstance.interceptors.response.use(\r\n  (response) => response,\r\n  (error) => {\r\n    // Xử lý lỗi globally, ví dụ: refresh token, redirect to login, v.v.\r\n    return Promise.reject(error);\r\n  }\r\n);"],"names":[],"mappings":"AAAA,uBAAuB;;;;AAGN;AAFjB;;AAEA,MAAM,WAAW,iEAAmC;AAE7C,MAAM,gBAAgB,wIAAA,CAAA,UAAK,CAAC,MAAM,CAAC;IACxC,SAAS;IACT,iBAAiB;AACnB;AAEA,cAAc,YAAY,CAAC,QAAQ,CAAC,GAAG,CACrC,CAAC,WAAa,UACd,CAAC;IACC,oEAAoE;IACpE,OAAO,QAAQ,MAAM,CAAC;AACxB","debugId":null}},
    {"offset": {"line": 32, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ACER/Documents/code/streamify/Streaming_Platform/frontend/components/ui/PageLoader.tsx"],"sourcesContent":["import { LoaderIcon } from \"lucide-react\";\r\n\r\nconst PageLoader = () => {\r\n    return (\r\n        <div className=\"min-h-screen flex items-center justify-center\">\r\n            <LoaderIcon className=\"animate-spin size-10 text-primary\" />\r\n        </div>\r\n    );\r\n};\r\nexport default PageLoader;"],"names":[],"mappings":";;;;AAAA;;;AAEA,MAAM,aAAa;IACf,qBACI,6LAAC;QAAI,WAAU;kBACX,cAAA,6LAAC,6MAAA,CAAA,aAAU;YAAC,WAAU;;;;;;;;;;;AAGlC;KANM;uCAOS","debugId":null}},
    {"offset": {"line": 68, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ACER/Documents/code/streamify/Streaming_Platform/frontend/app/%28protected%29/layout.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useQuery } from \"@tanstack/react-query\";\r\nimport { axiosInstance } from \"@/lib/axios\";\r\nimport { useEffect, ReactNode } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport PageLoader from \"@/components/ui/PageLoader\";\r\nimport { usePathname } from \"next/navigation\";\r\n\r\nexport default function ProtectedLayout({ children }: { children: ReactNode }) {\r\n    const router = useRouter();\r\n    const pathname = usePathname();\r\n    \r\n    // Kiểm tra nếu người dùng vừa đăng ký\r\n    const justSignedUp = typeof window !== 'undefined' && \r\n        sessionStorage.getItem('justSignedUp') === 'true';\r\n\r\n    const { data: authData, isLoading } = useQuery({\r\n        queryKey: [\"authUser\"],\r\n        queryFn: async () => {\r\n            try {\r\n                const res = await axiosInstance.get(\"/auth/me\");\r\n                return res.data;\r\n            } catch (error) {\r\n                console.error(\"Auth check failed:\", error);\r\n                return null;\r\n            }\r\n        },\r\n        retry: false,\r\n    });\r\n\r\n    const authUser = authData?.user;\r\n    const isAuthenticated = Boolean(authUser) || justSignedUp;\r\n    const isOnboarded = authUser?.isOnboarded || justSignedUp;\r\n\r\n    console.log('Protected layout - Auth data:', authData);\r\n    console.log('Protected layout - isAuthenticated:', isAuthenticated);\r\n    console.log('Protected layout - isOnboarded:', isOnboarded);\r\n    console.log('Protected layout - justSignedUp:', justSignedUp);\r\n\r\n    useEffect(() => {\r\n        if (!isLoading) {\r\n            if (!isAuthenticated) {\r\n                console.log(\"Redirecting to sign-up due to not authenticated\");\r\n                router.push(\"/sign-up\");\r\n            } else if (!isOnboarded && pathname !== \"/onboarding\") {\r\n                console.log(\"Redirecting to onboarding due to not onboarded\");\r\n                router.push(\"/onboarding\");\r\n            }\r\n        }\r\n        \r\n        // Xóa flag sau khi đã sử dụng\r\n        if (justSignedUp && authUser) {\r\n            sessionStorage.removeItem('justSignedUp');\r\n        }\r\n    }, [isLoading, isAuthenticated, isOnboarded, router, pathname, authUser, justSignedUp]);\r\n\r\n    if (isLoading) return <PageLoader />;\r\n    \r\n    // Nếu không xác thực hoặc không onboarded (trừ trang onboarding),\r\n    // không hiển thị nội dung nhưng không chuyển hướng ở đây\r\n    if (!isAuthenticated || (!isOnboarded && pathname !== \"/onboarding\")) {\r\n        return <PageLoader />;\r\n    }\r\n\r\n    return <>{children}</>;\r\n}"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AACA;AACA;;;AANA;;;;;;;AASe,SAAS,gBAAgB,EAAE,QAAQ,EAA2B;;IACzE,MAAM,SAAS,CAAA,GAAA,qIAAA,CAAA,YAAS,AAAD;IACvB,MAAM,WAAW,CAAA,GAAA,qIAAA,CAAA,cAAW,AAAD;IAE3B,sCAAsC;IACtC,MAAM,eAAe,aAAkB,eACnC,eAAe,OAAO,CAAC,oBAAoB;IAE/C,MAAM,EAAE,MAAM,QAAQ,EAAE,SAAS,EAAE,GAAG,CAAA,GAAA,8KAAA,CAAA,WAAQ,AAAD,EAAE;QAC3C,UAAU;YAAC;SAAW;QACtB,OAAO;wCAAE;gBACL,IAAI;oBACA,MAAM,MAAM,MAAM,+GAAA,CAAA,gBAAa,CAAC,GAAG,CAAC;oBACpC,OAAO,IAAI,IAAI;gBACnB,EAAE,OAAO,OAAO;oBACZ,QAAQ,KAAK,CAAC,sBAAsB;oBACpC,OAAO;gBACX;YACJ;;QACA,OAAO;IACX;IAEA,MAAM,WAAW,UAAU;IAC3B,MAAM,kBAAkB,QAAQ,aAAa;IAC7C,MAAM,cAAc,UAAU,eAAe;IAE7C,QAAQ,GAAG,CAAC,iCAAiC;IAC7C,QAAQ,GAAG,CAAC,uCAAuC;IACnD,QAAQ,GAAG,CAAC,mCAAmC;IAC/C,QAAQ,GAAG,CAAC,oCAAoC;IAEhD,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;qCAAE;YACN,IAAI,CAAC,WAAW;gBACZ,IAAI,CAAC,iBAAiB;oBAClB,QAAQ,GAAG,CAAC;oBACZ,OAAO,IAAI,CAAC;gBAChB,OAAO,IAAI,CAAC,eAAe,aAAa,eAAe;oBACnD,QAAQ,GAAG,CAAC;oBACZ,OAAO,IAAI,CAAC;gBAChB;YACJ;YAEA,8BAA8B;YAC9B,IAAI,gBAAgB,UAAU;gBAC1B,eAAe,UAAU,CAAC;YAC9B;QACJ;oCAAG;QAAC;QAAW;QAAiB;QAAa;QAAQ;QAAU;QAAU;KAAa;IAEtF,IAAI,WAAW,qBAAO,6LAAC,kIAAA,CAAA,UAAU;;;;;IAEjC,kEAAkE;IAClE,yDAAyD;IACzD,IAAI,CAAC,mBAAoB,CAAC,eAAe,aAAa,eAAgB;QAClE,qBAAO,6LAAC,kIAAA,CAAA,UAAU;;;;;IACtB;IAEA,qBAAO;kBAAG;;AACd;GAzDwB;;QACL,qIAAA,CAAA,YAAS;QACP,qIAAA,CAAA,cAAW;QAMU,8KAAA,CAAA,WAAQ;;;KAR1B","debugId":null}}]
}