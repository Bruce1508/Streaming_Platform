(()=>{var e={};e.id=545,e.ids=[545],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5190:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>n});let n=(0,i(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"C:\\\\Users\\\\Bruce Vo\\\\Documents\\\\project\\\\linguex\\\\Streaming_Platform\\\\frontend\\\\app\\\\(protected)\\\\call\\\\[id]\\\\page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\Bruce Vo\\Documents\\project\\linguex\\Streaming_Platform\\frontend\\app\\(protected)\\call\\[id]\\page.tsx","default")},5765:(e,t,i)=>{"use strict";let n,r,s,a,o;i.r(t),i.d(t,{default:()=>fC});var l,c,u,d,h,p,f,m,g,v,b,y,S,w,k,C,T,E,_,R,I,x,P,N,O,D={};i.r(D),i.d(D,{fixNegotiationNeeded:()=>el,shimAddTrackRemoveTrack:()=>ea,shimAddTrackRemoveTrackWithNative:()=>es,shimGetDisplayMedia:()=>Q,shimGetSendersWithDtmf:()=>ei,shimGetStats:()=>en,shimGetUserMedia:()=>Z,shimMediaStream:()=>ee,shimOnTrack:()=>et,shimPeerConnection:()=>eo,shimSenderReceiverGetStats:()=>er});var A={};i.r(A),i.d(A,{shimAddTransceiver:()=>ev,shimCreateAnswer:()=>eS,shimCreateOffer:()=>ey,shimGetDisplayMedia:()=>eu,shimGetParameters:()=>eb,shimGetUserMedia:()=>ec,shimOnTrack:()=>ed,shimPeerConnection:()=>eh,shimRTCDataChannel:()=>eg,shimReceiverGetStats:()=>ef,shimRemoveStream:()=>em,shimSenderGetStats:()=>ep});var j={};i.r(j),i.d(j,{shimAudioContext:()=>ex,shimCallbacksAPI:()=>eC,shimConstraints:()=>eE,shimCreateOfferLegacy:()=>eI,shimGetUserMedia:()=>eT,shimLocalStreamsAPI:()=>ew,shimRTCIceServerUrls:()=>e_,shimRemoteStreamsAPI:()=>ek,shimTrackEventTransceiver:()=>eR});var L={};i.r(L),i.d(L,{removeExtmapAllowMixed:()=>eU,shimAddIceCandidateNullOrEmpty:()=>eM,shimConnectionState:()=>eL,shimMaxMessageSize:()=>eA,shimParameterlessSetLocalDescription:()=>eF,shimRTCIceCandidate:()=>eO,shimRTCIceCandidateRelayProtocol:()=>eD,shimSendThrowTypeError:()=>ej});var U=i(60687),M=i(43210),F=i.t(M,2),$=i(16189),V=i(82136);i(59556);let B=!0,H=!0;function q(e,t,i){let n=e.match(t);return n&&n.length>=i&&parseFloat(n[i],10)}function W(e,t,i){if(!e.RTCPeerConnection)return;let n=e.RTCPeerConnection.prototype,r=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return r.apply(this,arguments);let s=e=>{let t=i(e);t&&(n.handleEvent?n.handleEvent(t):n(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(n,s),r.apply(this,[e,s])};let s=n.removeEventListener;n.removeEventListener=function(e,i){if(e!==t||!this._eventMap||!this._eventMap[t]||!this._eventMap[t].has(i))return s.apply(this,arguments);let n=this._eventMap[t].get(i);return this._eventMap[t].delete(i),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,s.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function G(e){return"boolean"!=typeof e?Error("Argument type: "+typeof e+". Please use a boolean."):(B=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function J(e){return"boolean"!=typeof e?Error("Argument type: "+typeof e+". Please use a boolean."):(H=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function K(){"object"==typeof window&&(B||"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments))}function z(e,t){H&&console.warn(e+" is deprecated, please use "+t+" instead.")}function Y(e){return"[object Object]"===Object.prototype.toString.call(e)}function X(e,t,i){let n=i?"outbound-rtp":"inbound-rtp",r=new Map;if(null===t)return r;let s=[];return e.forEach(e=>{"track"===e.type&&e.trackIdentifier===t.id&&s.push(e)}),s.forEach(t=>{e.forEach(i=>{i.type===n&&i.trackId===t.id&&function e(t,i,n){!i||n.has(i.id)||(n.set(i.id,i),Object.keys(i).forEach(r=>{r.endsWith("Id")?e(t,t.get(i[r]),n):r.endsWith("Ids")&&i[r].forEach(i=>{e(t,t.get(i),n)})}))}(e,i,r)})}),r}function Z(e,t){let i=e&&e.navigator;if(!i.mediaDevices)return;let n=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;let t={};return Object.keys(e).forEach(i=>{if("require"===i||"advanced"===i||"mediaSource"===i)return;let n="object"==typeof e[i]?e[i]:{ideal:e[i]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);let r=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){t.optional=t.optional||[];let e={};"number"==typeof n.ideal?(e[r("min",i)]=n.ideal,t.optional.push(e),(e={})[r("max",i)]=n.ideal):e[r("",i)]=n.ideal,t.optional.push(e)}void 0!==n.exact&&"number"!=typeof n.exact?(t.mandatory=t.mandatory||{},t.mandatory[r("",i)]=n.exact):["min","max"].forEach(e=>{void 0!==n[e]&&(t.mandatory=t.mandatory||{},t.mandatory[r(e,i)]=n[e])})}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},r=function(e,r){if(t.version>=61)return r(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){let t=function(e,t,i){t in e&&!(i in e)&&(e[i]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=n(e.audio)}if(e&&"object"==typeof e.video){let s=e.video.facingMode;s=s&&("object"==typeof s?s:{ideal:s});let a=t.version<66;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&!(i.mediaDevices.getSupportedConstraints&&i.mediaDevices.getSupportedConstraints().facingMode&&!a)){let t;if(delete e.video.facingMode,"environment"===s.exact||"environment"===s.ideal?t=["back","rear"]:("user"===s.exact||"user"===s.ideal)&&(t=["front"]),t)return i.mediaDevices.enumerateDevices().then(i=>{let a=(i=i.filter(e=>"videoinput"===e.kind)).find(e=>t.some(t=>e.label.toLowerCase().includes(t)));return!a&&i.length&&t.includes("back")&&(a=i[i.length-1]),a&&(e.video.deviceId=s.exact?{exact:a.deviceId}:{ideal:a.deviceId}),e.video=n(e.video),K("chrome: "+JSON.stringify(e)),r(e)})}e.video=n(e.video)}return K("chrome: "+JSON.stringify(e)),r(e)},s=function(e){return t.version>=64?e:{name:({PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"})[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(i.getUserMedia=(function(e,t,n){r(e,e=>{i.webkitGetUserMedia(e,t,e=>{n&&n(s(e))})})}).bind(i),i.mediaDevices.getUserMedia){let e=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(t){return r(t,t=>e(t).then(e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(e=>{e.stop()}),new DOMException("","NotFoundError");return e},e=>Promise.reject(s(e))))}}}function Q(e,t){if((!e.navigator.mediaDevices||!("getDisplayMedia"in e.navigator.mediaDevices))&&e.navigator.mediaDevices){if("function"!=typeof t)return void console.error("shimGetDisplayMedia: getSourceId argument is not a function");e.navigator.mediaDevices.getDisplayMedia=function(i){return t(i).then(t=>{let n=i.video&&i.video.width,r=i.video&&i.video.height,s=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:s||3}},n&&(i.video.mandatory.maxWidth=n),r&&(i.video.mandatory.maxHeight=r),e.navigator.mediaDevices.getUserMedia(i)})}}}function ee(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function et(e){if("object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)W(e,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e));else{Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",i=>{let n;n=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===i.track.id):{track:i.track};let r=new Event("track");r.track=i.track,r.receiver=n,r.transceiver={receiver:n},r.streams=[t.stream],this.dispatchEvent(r)}),t.stream.getTracks().forEach(i=>{let n;n=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===i.id):{track:i};let r=new Event("track");r.track=i,r.receiver=n,r.transceiver={receiver:n},r.streams=[t.stream],this.dispatchEvent(r)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}}function ei(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){let t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){let r=i.apply(this,arguments);return r||(r=t(this,e),this._senders.push(r)),r};let n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){n.apply(this,arguments);let t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}let i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach(e=>{this._senders.push(t(this,e))})};let n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach(e=>{let t=this._senders.find(t=>t.track===e);t&&this._senders.splice(this._senders.indexOf(t),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function en(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[e,i,n]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0==arguments.length||"function"!=typeof e))return t.apply(this,[]);let r=function(e){let t={};return e.result().forEach(e=>{let i={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(t=>{i[t]=e.stat(t)}),t[i.id]=i}),t},s=function(e){return new Map(Object.keys(e).map(t=>[t,e[t]]))};return arguments.length>=2?t.apply(this,[function(e){i(s(r(e)))},e]):new Promise((e,i)=>{t.apply(this,[function(t){e(s(r(t)))},i])}).then(i,n)}}function er(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});let i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){let e=i.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){let e=this;return this._pc.getStats().then(t=>X(t,e.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),W(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){let e=this;return this._pc.getStats().then(t=>X(t,e.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype))return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){let e,t,i,n=arguments[0];return(this.getSenders().forEach(t=>{t.track===n&&(e?i=!0:e=t)}),this.getReceivers().forEach(e=>(e.track===n&&(t?i=!0:t=e),e.track===n)),i||e&&t)?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):e?e.getStats():t?t.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function es(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(e=>this._shimmedLocalStreams[e][0])};let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){if(!i)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let n=t.apply(this,arguments);return this._shimmedLocalStreams[i.id]?-1===this._shimmedLocalStreams[i.id].indexOf(n)&&this._shimmedLocalStreams[i.id].push(n):this._shimmedLocalStreams[i.id]=[i,n],n};let i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")});let t=this.getSenders();i.apply(this,arguments);let n=this.getSenders().filter(e=>-1===t.indexOf(e));this._shimmedLocalStreams[e.id]=[e].concat(n)};let n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};let r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(t=>{let i=this._shimmedLocalStreams[t].indexOf(e);-1!==i&&this._shimmedLocalStreams[t].splice(i,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]}),r.apply(this,arguments)}}function ea(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return es(e);let i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){let e=i.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map(e=>this._reverseStreams[e.id])};let n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){let i=new e.MediaStream(t.getTracks());this._streams[t.id]=i,this._reverseStreams[i.id]=t,t=i}n.apply(this,[t])};let r=e.RTCPeerConnection.prototype.removeStream;function s(e,t){let i=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{let n=e._reverseStreams[t],r=e._streams[n.id];i=i.replace(RegExp(r.id,"g"),n.id)}),new RTCSessionDescription({type:t.type,sdp:i})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,i){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let n=[].slice.call(arguments,1);if(1!==n.length||!n[0].getTracks().find(e=>e===t))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(e=>e.track===t))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let r=this._streams[i.id];if(r)r.addTrack(t),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{let n=new e.MediaStream([t]);this._streams[i.id]=n,this._reverseStreams[n.id]=i,this.addStream(n)}return this.getSenders().find(e=>e.track===t)},["createOffer","createAnswer"].forEach(function(t){let i=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=({[t](){let e=arguments,t=arguments.length&&"function"==typeof arguments[0];return t?i.apply(this,[t=>{let i=s(this,t);e[0].apply(null,[i])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):i.apply(this,arguments).then(e=>s(this,e))}})[t]});let a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){var e,t;let i;return arguments.length&&arguments[0].type?(arguments[0]=(e=this,t=arguments[0],i=t.sdp,Object.keys(e._reverseStreams||[]).forEach(t=>{let n=e._reverseStreams[t],r=e._streams[n.id];i=i.replace(RegExp(n.id,"g"),r.id)}),new RTCSessionDescription({type:t.type,sdp:i})),a.apply(this,arguments)):a.apply(this,arguments)};let o=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){let e=o.get.apply(this);return""===e.type?e:s(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){let t;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},Object.keys(this._streams).forEach(i=>{this._streams[i].getTracks().find(t=>e.track===t)&&(t=this._streams[i])}),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function eo(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){let i=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=({[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}})[t]})}function el(e,t){W(e,"negotiationneeded",e=>{let i=e.target;if(!(t.version<72)&&(!i.getConfiguration||"plan-b"!==i.getConfiguration().sdpSemantics)||"stable"===i.signalingState)return e})}function ec(e,t){let i=e&&e.navigator,n=e&&e.MediaStreamTrack;if(i.getUserMedia=function(e,t,n){z("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(e).then(t,n)},!(t.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){let e=function(e,t,i){t in e&&!(i in e)&&(e[i]=e[t],delete e[t])},t=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(i){return"object"==typeof i&&"object"==typeof i.audio&&(e((i=JSON.parse(JSON.stringify(i))).audio,"autoGainControl","mozAutoGainControl"),e(i.audio,"noiseSuppression","mozNoiseSuppression")),t(i)},n&&n.prototype.getSettings){let t=n.prototype.getSettings;n.prototype.getSettings=function(){let i=t.apply(this,arguments);return e(i,"mozAutoGainControl","autoGainControl"),e(i,"mozNoiseSuppression","noiseSuppression"),i}}if(n&&n.prototype.applyConstraints){let t=n.prototype.applyConstraints;n.prototype.applyConstraints=function(i){return"audio"===this.kind&&"object"==typeof i&&(e(i=JSON.parse(JSON.stringify(i)),"autoGainControl","mozAutoGainControl"),e(i,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[i])}}}}function eu(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){let e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===i.video?i.video={mediaSource:t}:i.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(i)})}function ed(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function eh(e,t){if("object"!=typeof e||!(e.RTCPeerConnection||e.mozRTCPeerConnection))return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){let i=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=({[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}})[t]});let i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[e,r,s]=arguments;return n.apply(this,[e||null]).then(e=>{if(t.version<53&&!r)try{e.forEach(e=>{e.type=i[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach((t,n)=>{e.set(n,Object.assign({},t,{type:i[t.type]||t.type}))})}return e}).then(r,s)}}function ep(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});let i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){let e=i.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function ef(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),W(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function em(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){z("removeStream","removeTrack"),this.getSenders().forEach(t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)})})}function eg(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function ev(e){if(!("object"==typeof e&&e.RTCPeerConnection))return;let t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]);let i=(e=[...e]).length>0;i&&e.forEach(e=>{if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw RangeError("max_framerate must be >= 0.0")});let n=t.apply(this,arguments);if(i){let{sender:t}=n,i=t.getParameters();"encodings"in i&&(1!==i.encodings.length||0!==Object.keys(i.encodings[0]).length)||(i.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(i).then(()=>{delete t.sendEncodings}).catch(()=>{delete t.sendEncodings})))}return n})}function eb(e){if(!("object"==typeof e&&e.RTCRtpSender))return;let t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){let e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function ey(e){if(!("object"==typeof e&&e.RTCPeerConnection))return;let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function eS(e){if(!("object"==typeof e&&e.RTCPeerConnection))return;let t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function ew(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(i=>t.call(this,i,e)),e.getVideoTracks().forEach(i=>t.call(this,i,e))},e.RTCPeerConnection.prototype.addTrack=function(e,...i){return i&&i.forEach(e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);let t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);let i=e.getTracks();this.getSenders().forEach(e=>{i.includes(e.track)&&this.removeTrack(e)})})}}function ek(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach(e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);let t=new Event("addstream");t.stream=e,this.dispatchEvent(t)})})}});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){let e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);let i=new Event("addstream");i.stream=t,e.dispatchEvent(i)})}),t.apply(e,arguments)}}}function eC(e){if("object"!=typeof e||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype,i=t.createOffer,n=t.createAnswer,r=t.setLocalDescription,s=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){let n=arguments.length>=2?arguments[2]:arguments[0],r=i.apply(this,[n]);return t?(r.then(e,t),Promise.resolve()):r},t.createAnswer=function(e,t){let i=arguments.length>=2?arguments[2]:arguments[0],r=n.apply(this,[i]);return t?(r.then(e,t),Promise.resolve()):r};let o=function(e,t,i){let n=r.apply(this,[e]);return i?(n.then(t,i),Promise.resolve()):n};t.setLocalDescription=o,t.setRemoteDescription=o=function(e,t,i){let n=s.apply(this,[e]);return i?(n.then(t,i),Promise.resolve()):n},t.addIceCandidate=function(e,t,i){let n=a.apply(this,[e]);return i?(n.then(t,i),Promise.resolve()):n}}function eT(e){let t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){let e=t.mediaDevices,i=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>i(eE(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(e,i,n){t.mediaDevices.getUserMedia(e).then(i,n)}).bind(t))}function eE(e){return e&&void 0!==e.video?Object.assign({},e,{video:function e(t){return Y(t)?Object.keys(t).reduce(function(i,n){let r=Y(t[n]),s=r?e(t[n]):t[n],a=r&&!Object.keys(s).length;return void 0===s||a?i:Object.assign(i,{[n]:s})},{}):t}(e.video)}):e}function e_(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,i){if(e&&e.iceServers){let t=[];for(let i=0;i<e.iceServers.length;i++){let n=e.iceServers[i];void 0===n.urls&&n.url?(z("RTCIceServer.url","RTCIceServer.urls"),(n=JSON.parse(JSON.stringify(n))).urls=n.url,delete n.url,t.push(n)):t.push(e.iceServers[i])}e.iceServers=t}return new t(e,i)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function eR(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function eI(e){let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);let t=this.getTransceivers().find(e=>"audio"===e.receiver.track.kind);!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);let i=this.getTransceivers().find(e=>"video"===e.receiver.track.kind);!1===e.offerToReceiveVideo&&i?"sendrecv"===i.direction?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":"recvonly"===i.direction&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):!0!==e.offerToReceiveVideo||i||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function ex(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var eP=i(94082),eN=i.n(eP);function eO(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;let t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substring(2)),e.candidate&&e.candidate.length){let i=new t(e),n=eN().parseCandidate(e.candidate);for(let e in n)e in i||Object.defineProperty(i,e,{value:n[e]});return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,W(e,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t))}function eD(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||W(e,"icecandidate",e=>{if(e.candidate){let t=eN().parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol=({0:"tls",1:"tcp",2:"udp"})[t.priority>>24])}return e})}function eA(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});let i=function(e){if(!e||!e.sdp)return!1;let t=eN().splitSections(e.sdp);return t.shift(),t.some(e=>{let t=eN().parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})},n=function(e){let t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return -1;let i=parseInt(t[1],10);return i!=i?-1:i},r=function(e){let i=65536;return"firefox"===t.browser&&(i=t.version<57?-1===e?16384:0x7ffffff5:t.version<60?57===t.version?65535:65536:0x7ffffff5),i},s=function(e,i){let n=65536;"firefox"===t.browser&&57===t.version&&(n=65535);let r=eN().matchPrefix(e.sdp,"a=max-message-size:");return r.length>0?n=parseInt(r[0].substring(19),10):"firefox"===t.browser&&-1!==i&&(n=0x7ffffff5),n},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){let{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){let e,t=n(arguments[0]),i=r(t),a=s(arguments[0],t);e=0===i&&0===a?Number.POSITIVE_INFINITY:0===i||0===a?Math.max(i,a):Math.min(i,a);let o={};Object.defineProperty(o,"maxMessageSize",{get:()=>e}),this._sctp=o}return a.apply(this,arguments)}}function ej(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){let i=e.send;e.send=function(){let n=arguments[0],r=n.length||n.size||n.byteLength;if("open"===e.readyState&&t.sctp&&r>t.sctp.maxMessageSize)throw TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return i.apply(e,arguments)}}let i=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){let e=i.apply(this,arguments);return t(e,this),e},W(e,"datachannel",e=>(t(e.channel,e.target),e))}function eL(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;let t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return({completed:"connected",checking:"connecting"})[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{let i=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{let t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;let i=new Event("connectionstatechange",e);t.dispatchEvent(i)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function eU(e,t){if(!e.RTCPeerConnection||"chrome"===t.browser&&t.version>=71||"safari"===t.browser&&t._safariVersion>=13.1)return;let i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){let i=t.sdp.split("\n").filter(e=>"a=extmap-allow-mixed"!==e.trim()).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:i}):t.sdp=i}return i.apply(this,arguments)}}function eM(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;let i=e.RTCPeerConnection.prototype.addIceCandidate;i&&0!==i.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function eF(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;let i=e.RTCPeerConnection.prototype.setLocalDescription;i&&0!==i.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return i.apply(this,arguments);if(!(e={type:e.type,sdp:e.sdp}).type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}return e.sdp||"offer"!==e.type&&"answer"!==e.type?i.apply(this,[e]):("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then(e=>i.apply(this,[e]))})}!function({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){let i=function(e){let t={browser:null,version:null};if(void 0===e||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;let{navigator:i}=e;return i.mozGetUserMedia?(t.browser="firefox",t.version=parseInt(q(i.userAgent,/Firefox\/(\d+)\./,1))):i.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection?(t.browser="chrome",t.version=parseInt(q(i.userAgent,/Chrom(e|ium)\/(\d+)\./,2))):e.RTCPeerConnection&&i.userAgent.match(/AppleWebKit\/(\d+)\./)?(t.browser="safari",t.version=parseInt(q(i.userAgent,/AppleWebKit\/(\d+)\./,1)),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype,t._safariVersion=q(i.userAgent,/Version\/(\d+(\.?\d+))/,1)):t.browser="Not a supported browser.",t}(e),n={browserDetails:i,commonShim:L,extractVersion:q,disableLog:G,disableWarnings:J,sdp:eP};switch(i.browser){case"chrome":if(!D||!eo||!t.shimChrome){K("Chrome shim is not included in this adapter release.");break}if(null===i.version){K("Chrome shim can not determine version, not shimming.");break}K("adapter.js shimming chrome."),n.browserShim=D,eM(e,i),eF(e,i),Z(e,i),ee(e,i),eo(e,i),et(e,i),ea(e,i),ei(e,i),en(e,i),er(e,i),el(e,i),eO(e,i),eD(e,i),eL(e,i),eA(e,i),ej(e,i),eU(e,i);break;case"firefox":if(!A||!eh||!t.shimFirefox){K("Firefox shim is not included in this adapter release.");break}K("adapter.js shimming firefox."),n.browserShim=A,eM(e,i),eF(e,i),ec(e,i),eh(e,i),ed(e,i),em(e,i),ep(e,i),ef(e,i),eg(e,i),ev(e,i),eb(e,i),ey(e,i),eS(e,i),eO(e,i),eL(e,i),eA(e,i),ej(e,i);break;case"safari":if(!j||!t.shimSafari){K("Safari shim is not included in this adapter release.");break}K("adapter.js shimming safari."),n.browserShim=j,eM(e,i),eF(e,i),e_(e,i),eI(e,i),eC(e,i),ew(e,i),ek(e,i),eR(e,i),eT(e,i),ex(e,i),eO(e,i),eD(e,i),eA(e,i),ej(e,i),eU(e,i);break;default:K("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window});let e$=Symbol.for("protobuf-ts/message-type");function eV(e){let t=!1,i=[];for(let n=0;n<e.length;n++){let r=e.charAt(n);"_"==r?t=!0:/\d/.test(r)?(i.push(r),t=!0):t?(i.push(r.toUpperCase()),t=!1):0==n?i.push(r.toLowerCase()):i.push(r)}return i.join("")}function eB(e){var t,i,n,r;return e.localName=null!=(t=e.localName)?t:eV(e.name),e.jsonName=null!=(i=e.jsonName)?i:eV(e.name),e.repeat=null!=(n=e.repeat)?n:u.NO,e.opt=null!=(r=e.opt)?r:!e.repeat&&!e.oneof&&"message"==e.kind,e}!function(e){e[e.DOUBLE=1]="DOUBLE",e[e.FLOAT=2]="FLOAT",e[e.INT64=3]="INT64",e[e.UINT64=4]="UINT64",e[e.INT32=5]="INT32",e[e.FIXED64=6]="FIXED64",e[e.FIXED32=7]="FIXED32",e[e.BOOL=8]="BOOL",e[e.STRING=9]="STRING",e[e.BYTES=12]="BYTES",e[e.UINT32=13]="UINT32",e[e.SFIXED32=15]="SFIXED32",e[e.SFIXED64=16]="SFIXED64",e[e.SINT32=17]="SINT32",e[e.SINT64=18]="SINT64"}(l||(l={})),function(e){e[e.BIGINT=0]="BIGINT",e[e.STRING=1]="STRING",e[e.NUMBER=2]="NUMBER"}(c||(c={})),function(e){e[e.NO=0]="NO",e[e.PACKED=1]="PACKED",e[e.UNPACKED=2]="UNPACKED"}(u||(u={}));class eH{constructor(e){var t;this.fields=null!=(t=e.fields)?t:[]}prepare(){if(this.data)return;let e=[],t=[],i=[];for(let n of this.fields)if(n.oneof)i.includes(n.oneof)||(i.push(n.oneof),e.push(n.oneof),t.push(n.oneof));else switch(t.push(n.localName),n.kind){case"scalar":case"enum":(!n.opt||n.repeat)&&e.push(n.localName);break;case"message":n.repeat&&e.push(n.localName);break;case"map":e.push(n.localName)}this.data={req:e,known:t,oneofs:Object.values(i)}}is(e,t,i=!1){if(t<0)return!0;if(null==e||"object"!=typeof e)return!1;this.prepare();let n=Object.keys(e),r=this.data;if(n.length<r.req.length||r.req.some(e=>!n.includes(e))||!i&&n.some(e=>!r.known.includes(e)))return!1;if(t<1)return!0;for(let n of r.oneofs){let r=e[n];if(!function(e){if("object"!=typeof e||null===e||!e.hasOwnProperty("oneofKind"))return!1;switch(typeof e.oneofKind){case"string":if(void 0===e[e.oneofKind])return!1;return 2==Object.keys(e).length;case"undefined":return 1==Object.keys(e).length;default:return!1}}(r))return!1;if(void 0===r.oneofKind)continue;let s=this.fields.find(e=>e.localName===r.oneofKind);if(!s||!this.field(r[r.oneofKind],s,i,t))return!1}for(let n of this.fields)if(void 0===n.oneof&&!this.field(e[n.localName],n,i,t))return!1;return!0}field(e,t,i,n){let r=t.repeat;switch(t.kind){case"scalar":if(void 0===e)return t.opt;if(r)return this.scalars(e,t.T,n,t.L);return this.scalar(e,t.T,t.L);case"enum":if(void 0===e)return t.opt;if(r)return this.scalars(e,l.INT32,n);return this.scalar(e,l.INT32);case"message":if(void 0===e)break;if(r)return this.messages(e,t.T(),i,n);return this.message(e,t.T(),i,n);case"map":if("object"!=typeof e||null===e)return!1;if(n<2)break;if(!this.mapKeys(e,t.K,n))return!1;switch(t.V.kind){case"scalar":return this.scalars(Object.values(e),t.V.T,n,t.V.L);case"enum":return this.scalars(Object.values(e),l.INT32,n);case"message":return this.messages(Object.values(e),t.V.T(),i,n)}}return!0}message(e,t,i,n){return i?t.isAssignable(e,n):t.is(e,n)}messages(e,t,i,n){if(!Array.isArray(e))return!1;if(n<2)return!0;if(i){for(let i=0;i<e.length&&i<n;i++)if(!t.isAssignable(e[i],n-1))return!1}else for(let i=0;i<e.length&&i<n;i++)if(!t.is(e[i],n-1))return!1;return!0}scalar(e,t,i){let n=typeof e;switch(t){case l.UINT64:case l.FIXED64:case l.INT64:case l.SFIXED64:case l.SINT64:switch(i){case c.BIGINT:return"bigint"==n;case c.NUMBER:return"number"==n&&!isNaN(e);default:return"string"==n}case l.BOOL:return"boolean"==n;case l.STRING:return"string"==n;case l.BYTES:return e instanceof Uint8Array;case l.DOUBLE:case l.FLOAT:return"number"==n&&!isNaN(e);default:return"number"==n&&Number.isInteger(e)}}scalars(e,t,i,n){if(!Array.isArray(e))return!1;if(i<2)return!0;if(Array.isArray(e)){for(let r=0;r<e.length&&r<i;r++)if(!this.scalar(e[r],t,n))return!1}return!0}mapKeys(e,t,i){let n=Object.keys(e);switch(t){case l.INT32:case l.FIXED32:case l.SFIXED32:case l.SINT32:case l.UINT32:return this.scalars(n.slice(0,i).map(e=>parseInt(e)),t,i);case l.BOOL:return this.scalars(n.slice(0,i).map(e=>"true"==e||"false"!=e&&e),t,i);default:return this.scalars(n,t,i,c.STRING)}}}function eq(e){let t=typeof e;if("object"==t){if(Array.isArray(e))return"array";if(null===e)return"null"}return t}function eW(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)}let eG="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),eJ=[];for(let e=0;e<eG.length;e++)eJ[eG[e].charCodeAt(0)]=e;function eK(){let e=0,t=0;for(let i=0;i<28;i+=7){let n=this.buf[this.pos++];if(e|=(127&n)<<i,(128&n)==0)return this.assertBounds(),[e,t]}let i=this.buf[this.pos++];if(e|=(15&i)<<28,t=(112&i)>>4,(128&i)==0)return this.assertBounds(),[e,t];for(let i=3;i<=31;i+=7){let n=this.buf[this.pos++];if(t|=(127&n)<<i,(128&n)==0)return this.assertBounds(),[e,t]}throw Error("invalid varint")}function ez(e,t,i){for(let n=0;n<28;n+=7){let r=e>>>n,s=r>>>7!=0||0!=t,a=(s?128|r:r)&255;if(i.push(a),!s)return}let n=e>>>28&15|(7&t)<<4,r=t>>3!=0;if(i.push((r?128|n:n)&255),r){for(let e=3;e<31;e+=7){let n=t>>>e,r=n>>>7!=0,s=(r?128|n:n)&255;if(i.push(s),!r)return}i.push(t>>>31&1)}}function eY(e){let t="-"==e[0];t&&(e=e.slice(1));let i=0,n=0;function r(t,r){let s=Number(e.slice(t,r));n*=1e6,(i=1e6*i+s)>=0x100000000&&(n+=i/0x100000000|0,i%=0x100000000)}return r(-24,-18),r(-18,-12),r(-12,-6),r(-6),[t,i,n]}function eX(e,t){if(t>>>0<=2097151)return""+(0x100000000*t+(e>>>0));let i=(e>>>24|t<<8)>>>0&0xffffff,n=t>>16&65535,r=(0xffffff&e)+6777216*i+6710656*n,s=i+8147497*n,a=2*n;function o(e,t){let i=e?String(e):"";return t?"0000000".slice(i.length)+i:i}return r>=1e7&&(s+=Math.floor(r/1e7),r%=1e7),s>=1e7&&(a+=Math.floor(s/1e7),s%=1e7),o(a,0)+o(s,a)+o(r,1)}function eZ(e,t){if(e>=0){for(;e>127;)t.push(127&e|128),e>>>=7;t.push(e)}else{for(let i=0;i<9;i++)t.push(127&e|128),e>>=7;t.push(1)}}function eQ(){let e=this.buf[this.pos++],t=127&e;if((128&e)==0||(t|=(127&(e=this.buf[this.pos++]))<<7,(128&e)==0)||(t|=(127&(e=this.buf[this.pos++]))<<14,(128&e)==0)||(t|=(127&(e=this.buf[this.pos++]))<<21,(128&e)==0))return this.assertBounds(),t;t|=(15&(e=this.buf[this.pos++]))<<28;for(let t=5;(128&e)!=0&&t<10;t++)e=this.buf[this.pos++];if((128&e)!=0)throw Error("invalid varint");return this.assertBounds(),t>>>0}function e0(e){if(!e)throw Error("BigInt unavailable, see https://github.com/timostamm/protobuf-ts/blob/v1.0.8/MANUAL.md#bigint-support")}eJ[45]=eG.indexOf("+"),eJ[95]=eG.indexOf("/"),!function(){let e=new DataView(new ArrayBuffer(8));n=void 0!==globalThis.BigInt&&"function"==typeof e.getBigInt64&&"function"==typeof e.getBigUint64&&"function"==typeof e.setBigInt64&&"function"==typeof e.setBigUint64?{MIN:BigInt("-9223372036854775808"),MAX:BigInt("9223372036854775807"),UMIN:BigInt("0"),UMAX:BigInt("18446744073709551615"),C:BigInt,V:e}:void 0}();let e1=/^-?[0-9]+$/;class e2{constructor(e,t){this.lo=0|e,this.hi=0|t}isZero(){return 0==this.lo&&0==this.hi}toNumber(){let e=0x100000000*this.hi+(this.lo>>>0);if(!Number.isSafeInteger(e))throw Error("cannot convert to safe number");return e}}class e3 extends e2{static from(e){if(n)switch(typeof e){case"string":if("0"==e)return this.ZERO;if(""==e)throw Error("string is no integer");e=n.C(e);case"number":if(0===e)return this.ZERO;e=n.C(e);case"bigint":if(!e)return this.ZERO;if(e<n.UMIN)throw Error("signed value for ulong");if(e>n.UMAX)throw Error("ulong too large");return n.V.setBigUint64(0,e,!0),new e3(n.V.getInt32(0,!0),n.V.getInt32(4,!0))}else switch(typeof e){case"string":if("0"==e)return this.ZERO;if(e=e.trim(),!e1.test(e))throw Error("string is no integer");let[t,i,r]=eY(e);if(t)throw Error("signed value for ulong");return new e3(i,r);case"number":if(0==e)return this.ZERO;if(!Number.isSafeInteger(e))throw Error("number is no integer");if(e<0)throw Error("signed value for ulong");return new e3(e,e/0x100000000)}throw Error("unknown value "+typeof e)}toString(){return n?this.toBigInt().toString():eX(this.lo,this.hi)}toBigInt(){return e0(n),n.V.setInt32(0,this.lo,!0),n.V.setInt32(4,this.hi,!0),n.V.getBigUint64(0,!0)}}e3.ZERO=new e3(0,0);class e4 extends e2{static from(e){if(n)switch(typeof e){case"string":if("0"==e)return this.ZERO;if(""==e)throw Error("string is no integer");e=n.C(e);case"number":if(0===e)return this.ZERO;e=n.C(e);case"bigint":if(!e)return this.ZERO;if(e<n.MIN)throw Error("signed long too small");if(e>n.MAX)throw Error("signed long too large");return n.V.setBigInt64(0,e,!0),new e4(n.V.getInt32(0,!0),n.V.getInt32(4,!0))}else switch(typeof e){case"string":if("0"==e)return this.ZERO;if(e=e.trim(),!e1.test(e))throw Error("string is no integer");let[t,i,r]=eY(e);if(t){if(r>0x80000000||0x80000000==r&&0!=i)throw Error("signed long too small")}else if(r>=0x80000000)throw Error("signed long too large");let s=new e4(i,r);return t?s.negate():s;case"number":if(0==e)return this.ZERO;if(!Number.isSafeInteger(e))throw Error("number is no integer");return e>0?new e4(e,e/0x100000000):new e4(-e,-e/0x100000000).negate()}throw Error("unknown value "+typeof e)}isNegative(){return(0x80000000&this.hi)!=0}negate(){let e=~this.hi,t=this.lo;return t?t=~t+1:e+=1,new e4(t,e)}toString(){if(n)return this.toBigInt().toString();if(this.isNegative()){let e=this.negate();return"-"+eX(e.lo,e.hi)}return eX(this.lo,this.hi)}toBigInt(){return e0(n),n.V.setInt32(0,this.lo,!0),n.V.setInt32(4,this.hi,!0),n.V.getBigInt64(0,!0)}}function e6(e,t){if(!e)throw Error(t)}function e5(e){if("number"!=typeof e)throw Error("invalid int 32: "+typeof e);if(!Number.isInteger(e)||e>0x7fffffff||e<-0x80000000)throw Error("invalid int 32: "+e)}function e9(e){if("number"!=typeof e)throw Error("invalid uint 32: "+typeof e);if(!Number.isInteger(e)||e>0xffffffff||e<0)throw Error("invalid uint 32: "+e)}function e8(e){if("number"!=typeof e)throw Error("invalid float 32: "+typeof e);if(Number.isFinite(e)&&(e>34028234663852886e22||e<-34028234663852886e22))throw Error("invalid float 32: "+e)}function e7(e,t){switch(t){case c.BIGINT:return e.toBigInt();case c.NUMBER:return e.toNumber();default:return e.toString()}}e4.ZERO=new e4(0,0);class te{constructor(e){this.info=e}prepare(){var e;if(void 0===this.fMap)for(let t of(this.fMap={},null!=(e=this.info.fields)?e:[]))this.fMap[t.name]=t,this.fMap[t.jsonName]=t,this.fMap[t.localName]=t}assert(e,t,i){if(!e){let e=eq(i);throw("number"==e||"boolean"==e)&&(e=i.toString()),Error(`Cannot parse JSON ${e} for ${this.info.typeName}#${t}`)}}read(e,t,i){this.prepare();let n=[];for(let[r,s]of Object.entries(e)){let e,a=this.fMap[r];if(!a){if(!i.ignoreUnknownFields)throw Error(`Found unknown field while reading ${this.info.typeName} from JSON format. JSON key: ${r}`);continue}let o=a.localName;if(a.oneof){if(null===s&&("enum"!==a.kind||"google.protobuf.NullValue"!==a.T()[0]))continue;if(n.includes(a.oneof))throw Error(`Multiple members of the oneof group "${a.oneof}" of ${this.info.typeName} are present in JSON.`);n.push(a.oneof),e=t[a.oneof]={oneofKind:o}}else e=t;if("map"==a.kind){if(null===s)continue;this.assert(eW(s),a.name,s);let t=e[o];for(let[e,n]of Object.entries(s)){let r;switch(this.assert(null!==n,a.name+" map value",null),a.V.kind){case"message":r=a.V.T().internalJsonRead(n,i);break;case"enum":if(!1===(r=this.enum(a.V.T(),n,a.name,i.ignoreUnknownFields)))continue;break;case"scalar":r=this.scalar(n,a.V.T,a.V.L,a.name)}this.assert(void 0!==r,a.name+" map value",n);let s=e;a.K==l.BOOL&&(s="true"==s||"false"!=s&&s),t[s=this.scalar(s,a.K,c.STRING,a.name).toString()]=r}}else if(a.repeat){if(null===s)continue;this.assert(Array.isArray(s),a.name,s);let t=e[o];for(let e of s){let n;switch(this.assert(null!==e,a.name,null),a.kind){case"message":n=a.T().internalJsonRead(e,i);break;case"enum":if(!1===(n=this.enum(a.T(),e,a.name,i.ignoreUnknownFields)))continue;break;case"scalar":n=this.scalar(e,a.T,a.L,a.name)}this.assert(void 0!==n,a.name,s),t.push(n)}}else switch(a.kind){case"message":if(null===s&&"google.protobuf.Value"!=a.T().typeName){this.assert(void 0===a.oneof,a.name+" (oneof member)",null);continue}e[o]=a.T().internalJsonRead(s,i,e[o]);break;case"enum":if(null===s)continue;let u=this.enum(a.T(),s,a.name,i.ignoreUnknownFields);if(!1===u)continue;e[o]=u;break;case"scalar":if(null===s)continue;e[o]=this.scalar(s,a.T,a.L,a.name)}}}enum(e,t,i,n){if("google.protobuf.NullValue"==e[0]&&e6(null===t||"NULL_VALUE"===t,`Unable to parse field ${this.info.typeName}#${i}, enum ${e[0]} only accepts null.`),null===t)return 0;switch(typeof t){case"number":return e6(Number.isInteger(t),`Unable to parse field ${this.info.typeName}#${i}, enum can only be integral number, got ${t}.`),t;case"string":let r=t;e[2]&&t.substring(0,e[2].length)===e[2]&&(r=t.substring(e[2].length));let s=e[1][r];if(void 0===s&&n)return!1;return e6("number"==typeof s,`Unable to parse field ${this.info.typeName}#${i}, enum ${e[0]} has no value for "${t}".`),s}e6(!1,`Unable to parse field ${this.info.typeName}#${i}, cannot parse enum value from ${typeof t}".`)}scalar(e,t,i,n){let r;try{switch(t){case l.DOUBLE:case l.FLOAT:if(null===e)return 0;if("NaN"===e)return Number.NaN;if("Infinity"===e)return Number.POSITIVE_INFINITY;if("-Infinity"===e)return Number.NEGATIVE_INFINITY;if(""===e){r="empty string";break}if("string"==typeof e&&e.trim().length!==e.length){r="extra whitespace";break}if("string"!=typeof e&&"number"!=typeof e)break;let n=Number(e);if(Number.isNaN(n)){r="not a number";break}if(!Number.isFinite(n)){r="too large or small";break}return t==l.FLOAT&&e8(n),n;case l.INT32:case l.FIXED32:case l.SFIXED32:case l.SINT32:case l.UINT32:let s;if(null===e)return 0;if("number"==typeof e?s=e:""===e?r="empty string":"string"==typeof e&&(e.trim().length!==e.length?r="extra whitespace":s=Number(e)),void 0===s)break;return t==l.UINT32?e9(s):e5(s),s;case l.INT64:case l.SFIXED64:case l.SINT64:if(null===e)return e7(e4.ZERO,i);if("number"!=typeof e&&"string"!=typeof e)break;return e7(e4.from(e),i);case l.FIXED64:case l.UINT64:if(null===e)return e7(e3.ZERO,i);if("number"!=typeof e&&"string"!=typeof e)break;return e7(e3.from(e),i);case l.BOOL:if(null===e)return!1;if("boolean"!=typeof e)break;return e;case l.STRING:if(null===e)return"";if("string"!=typeof e){r="extra whitespace";break}try{encodeURIComponent(e)}catch(e){break}return e;case l.BYTES:if(null===e||""===e)return new Uint8Array(0);if("string"!=typeof e)break;return function(e){let t=3*e.length/4;"="==e[e.length-2]?t-=2:"="==e[e.length-1]&&(t-=1);let i=new Uint8Array(t),n=0,r=0,s,a=0;for(let t=0;t<e.length;t++){if(void 0===(s=eJ[e.charCodeAt(t)]))switch(e[t]){case"=":r=0;case"\n":case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(r){case 0:a=s,r=1;break;case 1:i[n++]=a<<2|(48&s)>>4,a=s,r=2;break;case 2:i[n++]=(15&a)<<4|(60&s)>>2,a=s,r=3;break;case 3:i[n++]=(3&a)<<6|s,r=0}}if(1==r)throw Error("invalid base64 string.");return i.subarray(0,n)}(e)}}catch(e){r=e.message}this.assert(!1,n+(r?" - "+r:""),e)}}class tt{constructor(e){var t;this.fields=null!=(t=e.fields)?t:[]}write(e,t){let i={};for(let n of this.fields){if(!n.oneof){let r=this.field(n,e[n.localName],t);void 0!==r&&(i[t.useProtoFieldName?n.name:n.jsonName]=r);continue}let r=e[n.oneof];if(r.oneofKind!==n.localName)continue;let s="scalar"==n.kind||"enum"==n.kind?Object.assign(Object.assign({},t),{emitDefaultValues:!0}):t,a=this.field(n,r[n.localName],s);e6(void 0!==a),i[t.useProtoFieldName?n.name:n.jsonName]=a}return i}field(e,t,i){let n;if("map"==e.kind){e6("object"==typeof t&&null!==t);let r={};switch(e.V.kind){case"scalar":for(let[i,n]of Object.entries(t)){let t=this.scalar(e.V.T,n,e.name,!1,!0);e6(void 0!==t),r[i.toString()]=t}break;case"message":let s=e.V.T();for(let[n,a]of Object.entries(t)){let t=this.message(s,a,e.name,i);e6(void 0!==t),r[n.toString()]=t}break;case"enum":let a=e.V.T();for(let[n,s]of Object.entries(t)){e6(void 0===s||"number"==typeof s);let t=this.enum(a,s,e.name,!1,!0,i.enumAsInteger);e6(void 0!==t),r[n.toString()]=t}}(i.emitDefaultValues||Object.keys(r).length>0)&&(n=r)}else if(e.repeat){e6(Array.isArray(t));let r=[];switch(e.kind){case"scalar":for(let i=0;i<t.length;i++){let n=this.scalar(e.T,t[i],e.name,e.opt,!0);e6(void 0!==n),r.push(n)}break;case"enum":let s=e.T();for(let n=0;n<t.length;n++){e6(void 0===t[n]||"number"==typeof t[n]);let a=this.enum(s,t[n],e.name,e.opt,!0,i.enumAsInteger);e6(void 0!==a),r.push(a)}break;case"message":let a=e.T();for(let n=0;n<t.length;n++){let s=this.message(a,t[n],e.name,i);e6(void 0!==s),r.push(s)}}(i.emitDefaultValues||r.length>0||i.emitDefaultValues)&&(n=r)}else switch(e.kind){case"scalar":n=this.scalar(e.T,t,e.name,e.opt,i.emitDefaultValues);break;case"enum":n=this.enum(e.T(),t,e.name,e.opt,i.emitDefaultValues,i.enumAsInteger);break;case"message":n=this.message(e.T(),t,e.name,i)}return n}enum(e,t,i,n,r,s){return"google.protobuf.NullValue"==e[0]?r||n?null:void 0:void 0===t?void e6(n):0!==t||r||n?(e6("number"==typeof t),e6(Number.isInteger(t)),s||!e[1].hasOwnProperty(t))?t:e[2]?e[2]+e[1][t]:e[1][t]:void 0}message(e,t,i,n){return void 0===t?n.emitDefaultValues?null:void 0:e.internalJsonWrite(t,n)}scalar(e,t,i,n,r){if(void 0===t)return void e6(n);let s=r||n;switch(e){case l.INT32:case l.SFIXED32:case l.SINT32:if(0===t)return s?0:void 0;return e5(t),t;case l.FIXED32:case l.UINT32:if(0===t)return s?0:void 0;return e9(t),t;case l.FLOAT:e8(t);case l.DOUBLE:if(0===t)return s?0:void 0;if(e6("number"==typeof t),Number.isNaN(t))return"NaN";if(t===Number.POSITIVE_INFINITY)return"Infinity";if(t===Number.NEGATIVE_INFINITY)return"-Infinity";return t;case l.STRING:if(""===t)return s?"":void 0;return e6("string"==typeof t),t;case l.BOOL:if(!1===t)return!s&&void 0;return e6("boolean"==typeof t),t;case l.UINT64:case l.FIXED64:e6("number"==typeof t||"string"==typeof t||"bigint"==typeof t);let a=e3.from(t);if(a.isZero()&&!s)return;return a.toString();case l.INT64:case l.SFIXED64:case l.SINT64:e6("number"==typeof t||"string"==typeof t||"bigint"==typeof t);let o=e4.from(t);if(o.isZero()&&!s)return;return o.toString();case l.BYTES:if(e6(t instanceof Uint8Array),!t.byteLength)return s?"":void 0;return function(e){let t="",i=0,n,r=0;for(let s=0;s<e.length;s++)switch(n=e[s],i){case 0:t+=eG[n>>2],r=(3&n)<<4,i=1;break;case 1:t+=eG[r|n>>4],r=(15&n)<<2,i=2;break;case 2:t+=eG[r|n>>6],t+=eG[63&n],i=0}return i&&(t+=eG[r],t+="=",1==i&&(t+="=")),t}(t)}}}function ti(e,t=c.STRING){switch(e){case l.BOOL:return!1;case l.UINT64:case l.FIXED64:return e7(e3.ZERO,t);case l.INT64:case l.SFIXED64:case l.SINT64:return e7(e4.ZERO,t);case l.DOUBLE:case l.FLOAT:return 0;case l.BYTES:return new Uint8Array(0);case l.STRING:return"";default:return 0}}!function(e){e.symbol=Symbol.for("protobuf-ts/unknown"),e.onRead=(i,n,r,s,a)=>{(t(n)?n[e.symbol]:n[e.symbol]=[]).push({no:r,wireType:s,data:a})},e.onWrite=(t,i,n)=>{for(let{no:t,wireType:r,data:s}of e.list(i))n.tag(t,r).raw(s)},e.list=(i,n)=>{if(t(i)){let t=i[e.symbol];return n?t.filter(e=>e.no==n):t}return[]},e.last=(t,i)=>e.list(t,i).slice(-1)[0];let t=t=>t&&Array.isArray(t[e.symbol])}(d||(d={})),!function(e){e[e.Varint=0]="Varint",e[e.Bit64=1]="Bit64",e[e.LengthDelimited=2]="LengthDelimited",e[e.StartGroup=3]="StartGroup",e[e.EndGroup=4]="EndGroup",e[e.Bit32=5]="Bit32"}(h||(h={}));class tn{constructor(e){this.info=e}prepare(){var e;if(!this.fieldNoToField){let t=null!=(e=this.info.fields)?e:[];this.fieldNoToField=new Map(t.map(e=>[e.no,e]))}}read(e,t,i,n){this.prepare();let r=void 0===n?e.len:e.pos+n;for(;e.pos<r;){let[n,r]=e.tag(),s=this.fieldNoToField.get(n);if(!s){let s=i.readUnknownField;if("throw"==s)throw Error(`Unknown field ${n} (wire type ${r}) for ${this.info.typeName}`);let a=e.skip(r);!1!==s&&(!0===s?d.onRead:s)(this.info.typeName,t,n,r,a);continue}let a=t,o=s.repeat,c=s.localName;switch(s.oneof&&(a=a[s.oneof]).oneofKind!==c&&(a=t[s.oneof]={oneofKind:c}),s.kind){case"scalar":case"enum":let u="enum"==s.kind?l.INT32:s.T,p="scalar"==s.kind?s.L:void 0;if(o){let t=a[c];if(r==h.LengthDelimited&&u!=l.STRING&&u!=l.BYTES){let i=e.uint32()+e.pos;for(;e.pos<i;)t.push(this.scalar(e,u,p))}else t.push(this.scalar(e,u,p))}else a[c]=this.scalar(e,u,p);break;case"message":if(o){let t=a[c],n=s.T().internalBinaryRead(e,e.uint32(),i);t.push(n)}else a[c]=s.T().internalBinaryRead(e,e.uint32(),i,a[c]);break;case"map":let[f,m]=this.mapEntry(s,e,i);a[c][f]=m}}}mapEntry(e,t,i){let n,r,s=t.uint32(),a=t.pos+s;for(;t.pos<a;){let[s,a]=t.tag();switch(s){case 1:n=e.K==l.BOOL?t.bool().toString():this.scalar(t,e.K,c.STRING);break;case 2:switch(e.V.kind){case"scalar":r=this.scalar(t,e.V.T,e.V.L);break;case"enum":r=t.int32();break;case"message":r=e.V.T().internalBinaryRead(t,t.uint32(),i)}break;default:throw Error(`Unknown field ${s} (wire type ${a}) in map entry for ${this.info.typeName}#${e.name}`)}}if(void 0===n){let t=ti(e.K);n=e.K==l.BOOL?t.toString():t}if(void 0===r)switch(e.V.kind){case"scalar":r=ti(e.V.T,e.V.L);break;case"enum":r=0;break;case"message":r=e.V.T().create()}return[n,r]}scalar(e,t,i){switch(t){case l.INT32:return e.int32();case l.STRING:return e.string();case l.BOOL:return e.bool();case l.DOUBLE:return e.double();case l.FLOAT:return e.float();case l.INT64:return e7(e.int64(),i);case l.UINT64:return e7(e.uint64(),i);case l.FIXED64:return e7(e.fixed64(),i);case l.FIXED32:return e.fixed32();case l.BYTES:return e.bytes();case l.UINT32:return e.uint32();case l.SFIXED32:return e.sfixed32();case l.SFIXED64:return e7(e.sfixed64(),i);case l.SINT32:return e.sint32();case l.SINT64:return e7(e.sint64(),i)}}}class tr{constructor(e){this.info=e}prepare(){if(!this.fields){let e=this.info.fields?this.info.fields.concat():[];this.fields=e.sort((e,t)=>e.no-t.no)}}write(e,t,i){for(let n of(this.prepare(),this.fields)){let r,s,a=n.repeat,o=n.localName;if(n.oneof){let t=e[n.oneof];if(t.oneofKind!==o)continue;r=t[o],s=!0}else r=e[o],s=!1;switch(n.kind){case"scalar":case"enum":let c="enum"==n.kind?l.INT32:n.T;if(a)if(e6(Array.isArray(r)),a==u.PACKED)this.packed(t,c,n.no,r);else for(let e of r)this.scalar(t,c,n.no,e,!0);else void 0===r?e6(n.opt):this.scalar(t,c,n.no,r,s||n.opt);break;case"message":if(a)for(let e of(e6(Array.isArray(r)),r))this.message(t,i,n.T(),n.no,e);else this.message(t,i,n.T(),n.no,r);break;case"map":for(let[e,s]of(e6("object"==typeof r&&null!==r),Object.entries(r)))this.mapEntry(t,i,n,e,s)}}let n=i.writeUnknownFields;!1!==n&&(!0===n?d.onWrite:n)(this.info.typeName,e,t)}mapEntry(e,t,i,n,r){e.tag(i.no,h.LengthDelimited),e.fork();let s=n;switch(i.K){case l.INT32:case l.FIXED32:case l.UINT32:case l.SFIXED32:case l.SINT32:s=Number.parseInt(n);break;case l.BOOL:e6("true"==n||"false"==n),s="true"==n}switch(this.scalar(e,i.K,1,s,!0),i.V.kind){case"scalar":this.scalar(e,i.V.T,2,r,!0);break;case"enum":this.scalar(e,l.INT32,2,r,!0);break;case"message":this.message(e,t,i.V.T(),2,r)}e.join()}message(e,t,i,n,r){void 0!==r&&(i.internalBinaryWrite(r,e.tag(n,h.LengthDelimited).fork(),t),e.join())}scalar(e,t,i,n,r){let[s,a,o]=this.scalarInfo(t,n);(!o||r)&&(e.tag(i,s),e[a](n))}packed(e,t,i,n){if(!n.length)return;e6(t!==l.BYTES&&t!==l.STRING),e.tag(i,h.LengthDelimited),e.fork();let[,r]=this.scalarInfo(t);for(let t=0;t<n.length;t++)e[r](n[t]);e.join()}scalarInfo(e,t){let i,n=h.Varint,r=void 0===t,s=0===t;switch(e){case l.INT32:i="int32";break;case l.STRING:s=r||!t.length,n=h.LengthDelimited,i="string";break;case l.BOOL:s=!1===t,i="bool";break;case l.UINT32:i="uint32";break;case l.DOUBLE:n=h.Bit64,i="double";break;case l.FLOAT:n=h.Bit32,i="float";break;case l.INT64:s=r||e4.from(t).isZero(),i="int64";break;case l.UINT64:s=r||e3.from(t).isZero(),i="uint64";break;case l.FIXED64:s=r||e3.from(t).isZero(),n=h.Bit64,i="fixed64";break;case l.BYTES:s=r||!t.byteLength,n=h.LengthDelimited,i="bytes";break;case l.FIXED32:n=h.Bit32,i="fixed32";break;case l.SFIXED32:n=h.Bit32,i="sfixed32";break;case l.SFIXED64:s=r||e4.from(t).isZero(),n=h.Bit64,i="sfixed64";break;case l.SINT32:i="sint32";break;case l.SINT64:s=r||e4.from(t).isZero(),i="sint64"}return[n,i,r||s]}}function ts(e,t,i){let n,r;for(let s of e.fields){let e=s.localName;if(s.oneof){let a=i[s.oneof];if((null==a?void 0:a.oneofKind)==void 0)continue;if(n=a[e],(r=t[s.oneof]).oneofKind=a.oneofKind,void 0==n){delete r[e];continue}}else if(n=i[e],r=t,void 0==n)continue;switch(s.repeat&&(r[e].length=n.length),s.kind){case"scalar":case"enum":if(s.repeat)for(let t=0;t<n.length;t++)r[e][t]=n[t];else r[e]=n;break;case"message":let a=s.T();if(s.repeat)for(let t=0;t<n.length;t++)r[e][t]=a.create(n[t]);else void 0===r[e]?r[e]=a.create(n):a.mergePartial(r[e],n);break;case"map":switch(s.V.kind){case"scalar":case"enum":Object.assign(r[e],n);break;case"message":let o=s.V.T();for(let t of Object.keys(n))r[e][t]=o.create(n[t])}}}}let ta={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0},to={ignoreUnknownFields:!1},tl=Object.values;function tc(e,t,i){if(t===i)return!0;if(e!==l.BYTES||t.length!==i.length)return!1;for(let e=0;e<t.length;e++)if(t[e]!=i[e])return!1;return!0}function tu(e,t,i){if(t.length!==i.length)return!1;for(let n=0;n<t.length;n++)if(!tc(e,t[n],i[n]))return!1;return!0}function td(e,t,i){if(t.length!==i.length)return!1;for(let n=0;n<t.length;n++)if(!e.equals(t[n],i[n]))return!1;return!0}let th={writeUnknownFields:!0,writerFactory:()=>new tp};class tp{constructor(e){this.stack=[],this.textEncoder=null!=e?e:new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let t=0;t<this.chunks.length;t++)e+=this.chunks[t].length;let t=new Uint8Array(e),i=0;for(let e=0;e<this.chunks.length;e++)t.set(this.chunks[e],i),i+=this.chunks[e].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(e9(e);e>127;)this.buf.push(127&e|128),e>>>=7;return this.buf.push(e),this}int32(e){return e5(e),eZ(e,this.buf),this}bool(e){return this.buf.push(+!!e),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){e8(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){e9(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){e5(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return e5(e),eZ(e=(e<<1^e>>31)>>>0,this.buf),this}sfixed64(e){let t=new Uint8Array(8),i=new DataView(t.buffer),n=e4.from(e);return i.setInt32(0,n.lo,!0),i.setInt32(4,n.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),i=new DataView(t.buffer),n=e3.from(e);return i.setInt32(0,n.lo,!0),i.setInt32(4,n.hi,!0),this.raw(t)}int64(e){let t=e4.from(e);return ez(t.lo,t.hi,this.buf),this}sint64(e){let t=e4.from(e),i=t.hi>>31;return ez(t.lo<<1^i,(t.hi<<1|t.lo>>>31)^i,this.buf),this}uint64(e){let t=e3.from(e);return ez(t.lo,t.hi,this.buf),this}}let tf={readUnknownField:!0,readerFactory:e=>new tm(e)};class tm{constructor(e,t){this.varint64=eK,this.uint32=eQ,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=null!=t?t:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0})}tag(){let e=this.uint32(),t=e>>>3,i=7&e;if(t<=0||i<0||i>5)throw Error("illegal tag: field no "+t+" wire type "+i);return[t,i]}skip(e){let t=this.pos;switch(e){case h.Varint:for(;128&this.buf[this.pos++];);break;case h.Bit64:this.pos+=4;case h.Bit32:this.pos+=4;break;case h.LengthDelimited:let i=this.uint32();this.pos+=i;break;case h.StartGroup:let n;for(;(n=this.tag()[1])!==h.EndGroup;)this.skip(n);break;default:throw Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(t,this.pos)}assertBounds(){if(this.pos>this.len)throw RangeError("premature EOF")}int32(){return 0|this.uint32()}sint32(){let e=this.uint32();return e>>>1^-(1&e)}int64(){return new e4(...this.varint64())}uint64(){return new e3(...this.varint64())}sint64(){let[e,t]=this.varint64(),i=-(1&e);return new e4(e=(e>>>1|(1&t)<<31)^i,t=t>>>1^i)}bool(){let[e,t]=this.varint64();return 0!==e||0!==t}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return new e3(this.sfixed32(),this.sfixed32())}sfixed64(){return new e4(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}let tg=Object.getOwnPropertyDescriptors(Object.getPrototypeOf({}));class tv{constructor(e,t,i){this.defaultCheckDepth=16,this.typeName=e,this.fields=t.map(eB),this.options=null!=i?i:{},this.messagePrototype=Object.create(null,Object.assign(Object.assign({},tg),{[e$]:{value:this}})),this.refTypeCheck=new eH(this),this.refJsonReader=new te(this),this.refJsonWriter=new tt(this),this.refBinReader=new tn(this),this.refBinWriter=new tr(this)}create(e){let t=function(e){let t=e.messagePrototype?Object.create(e.messagePrototype):Object.defineProperty({},e$,{value:e});for(let i of e.fields){let e=i.localName;if(!i.opt)if(i.oneof)t[i.oneof]={oneofKind:void 0};else if(i.repeat)t[e]=[];else switch(i.kind){case"scalar":t[e]=ti(i.T,i.L);break;case"enum":t[e]=0;break;case"map":t[e]={}}}return t}(this);return void 0!==e&&ts(this,t,e),t}clone(e){let t=this.create();return ts(this,t,e),t}equals(e,t){return function(e,t,i){if(t===i)return!0;if(!t||!i)return!1;for(let n of e.fields){let e=n.localName,r=n.oneof?t[n.oneof][e]:t[e],s=n.oneof?i[n.oneof][e]:i[e];switch(n.kind){case"enum":case"scalar":let a="enum"==n.kind?l.INT32:n.T;if(!(n.repeat?tu(a,r,s):tc(a,r,s)))return!1;break;case"map":if(!("message"==n.V.kind?td(n.V.T(),tl(r),tl(s)):tu("enum"==n.V.kind?l.INT32:n.V.T,tl(r),tl(s))))return!1;break;case"message":let o=n.T();if(!(n.repeat?td(o,r,s):o.equals(r,s)))return!1}}return!0}(this,e,t)}is(e,t=this.defaultCheckDepth){return this.refTypeCheck.is(e,t,!1)}isAssignable(e,t=this.defaultCheckDepth){return this.refTypeCheck.is(e,t,!0)}mergePartial(e,t){ts(this,e,t)}fromBinary(e,t){let i=t?Object.assign(Object.assign({},tf),t):tf;return this.internalBinaryRead(i.readerFactory(e),e.byteLength,i)}fromJson(e,t){return this.internalJsonRead(e,t?Object.assign(Object.assign({},to),t):to)}fromJsonString(e,t){let i=JSON.parse(e);return this.fromJson(i,t)}toJson(e,t){return this.internalJsonWrite(e,t?Object.assign(Object.assign({},ta),t):ta)}toJsonString(e,t){var i;return JSON.stringify(this.toJson(e,t),null,null!=(i=null==t?void 0:t.prettySpaces)?i:0)}toBinary(e,t){let i=t?Object.assign(Object.assign({},th),t):th;return this.internalBinaryWrite(e,i.writerFactory(),i).finish()}internalJsonRead(e,t,i){if(null!==e&&"object"==typeof e&&!Array.isArray(e)){let n=null!=i?i:this.create();return this.refJsonReader.read(e,n,t),n}throw Error(`Unable to parse message ${this.typeName} from JSON ${eq(e)}.`)}internalJsonWrite(e,t){return this.refJsonWriter.write(e,t)}internalBinaryWrite(e,t,i){return this.refBinWriter.write(e,t,i),t}internalBinaryRead(e,t,i,n){let r=null!=n?n:this.create();return this.refBinReader.read(e,r,i,t),r}}class tb{constructor(e,t,i){this.typeName=e,this.methods=t.map(e=>(function(e,t){var i,n,r;return e.service=t,e.localName=null!=(i=e.localName)?i:eV(e.name),e.serverStreaming=!!e.serverStreaming,e.clientStreaming=!!e.clientStreaming,e.options=null!=(n=e.options)?n:{},e.idempotency=null!=(r=e.idempotency)?r:void 0,e})(e,this)),this.options=null!=i?i:{}}}function ty(e,t,i,n,r){var s,a,o,l;if("unary"==e){let e=(e,i,n)=>t.unary(e,i,n);for(let t of(null!=(s=n.interceptors)?s:[]).filter(e=>e.interceptUnary).reverse()){let i=e;e=(e,n,r)=>t.interceptUnary(i,e,n,r)}return e(i,r,n)}if("serverStreaming"==e){let e=(e,i,n)=>t.serverStreaming(e,i,n);for(let t of(null!=(a=n.interceptors)?a:[]).filter(e=>e.interceptServerStreaming).reverse()){let i=e;e=(e,n,r)=>t.interceptServerStreaming(i,e,n,r)}return e(i,r,n)}if("clientStreaming"==e){let e=(e,i)=>t.clientStreaming(e,i);for(let t of(null!=(o=n.interceptors)?o:[]).filter(e=>e.interceptClientStreaming).reverse()){let i=e;e=(e,n)=>t.interceptClientStreaming(i,e,n)}return e(i,n)}if("duplex"==e){let e=(e,i)=>t.duplex(e,i);for(let t of(null!=(l=n.interceptors)?l:[]).filter(e=>e.interceptDuplex).reverse()){let i=e;e=(e,n)=>t.interceptDuplex(i,e,n)}return e(i,n)}throw Error("Unexpected object: "+e)}class tS extends Error{constructor(e,t="UNKNOWN",i){super(e),this.name="RpcError",Object.setPrototypeOf(this,new.target.prototype),this.code=t,this.meta=null!=i?i:{}}toString(){let e=[this.name+": "+this.message];this.code&&(e.push(""),e.push("Code: "+this.code)),this.serviceName&&this.methodName&&e.push("Method: "+this.serviceName+"/"+this.methodName);let t=Object.entries(this.meta);if(t.length)for(let[i,n]of(e.push(""),e.push("Meta:"),t))e.push(`  ${i}: ${n}`);return e.join("\n")}}var tw=i(51060);function tk(e,t){if(e)for(let[i,n]of Object.entries(e))n instanceof Date?t[i]=new Date(n.getTime()):Array.isArray(n)?t[i]=n.concat():t[i]=n}!function(e){e[e.cancelled=0]="cancelled",e[e.unknown=1]="unknown",e[e.invalid_argument=2]="invalid_argument",e[e.malformed=3]="malformed",e[e.deadline_exceeded=4]="deadline_exceeded",e[e.not_found=5]="not_found",e[e.bad_route=6]="bad_route",e[e.already_exists=7]="already_exists",e[e.permission_denied=8]="permission_denied",e[e.unauthenticated=9]="unauthenticated",e[e.resource_exhausted=10]="resource_exhausted",e[e.failed_precondition=11]="failed_precondition",e[e.aborted=12]="aborted",e[e.out_of_range=13]="out_of_range",e[e.unimplemented=14]="unimplemented",e[e.internal=15]="internal",e[e.unavailable=16]="unavailable",e[e.dataloss=17]="dataloss"}(p||(p={})),!function(e){e[e.PENDING=0]="PENDING",e[e.REJECTED=1]="REJECTED",e[e.RESOLVED=2]="RESOLVED"}(f||(f={}));class tC{constructor(e=!0){this._state=f.PENDING,this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t}),e&&this._promise.catch(e=>{})}get state(){return this._state}get promise(){return this._promise}resolve(e){if(this.state!==f.PENDING)throw Error(`cannot resolve ${f[this.state].toLowerCase()}`);this._resolve(e),this._state=f.RESOLVED}reject(e){if(this.state!==f.PENDING)throw Error(`cannot reject ${f[this.state].toLowerCase()}`);this._reject(e),this._state=f.REJECTED}resolvePending(e){this._state===f.PENDING&&this.resolve(e)}rejectPending(e){this._state===f.PENDING&&this.reject(e)}}class tT{constructor(e,t,i,n,r,s,a){this.method=e,this.requestHeaders=t,this.request=i,this.headers=n,this.response=r,this.status=s,this.trailers=a}then(e,t){return this.promiseFinished().then(t=>e?Promise.resolve(e(t)):t,e=>t?Promise.resolve(t(e)):Promise.reject(e))}promiseFinished(){var e,t,i,n;return e=this,t=void 0,i=void 0,n=function*(){let[e,t,i,n]=yield Promise.all([this.headers,this.response,this.status,this.trailers]);return{method:this.method,requestHeaders:this.requestHeaders,request:this.request,headers:e,response:t,status:i,trailers:n}},new(i||(i=Promise))(function(r,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function o(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(a,o)}l((n=n.apply(e,t||[])).next())})}}class tE{constructor(e){this.defaultOptions=e}mergeOptions(e){return function(e,t){if(!t)return e;let i={};for(let s of(tk(e,i),tk(t,i),Object.keys(t))){let a=t[s];switch(s){case"jsonOptions":i.jsonOptions=function(e,t){var i,n;let r=Object.assign(Object.assign({},e),t);return r.typeRegistry=[...null!=(i=null==e?void 0:e.typeRegistry)?i:[],...null!=(n=null==t?void 0:t.typeRegistry)?n:[]],r}(e.jsonOptions,i.jsonOptions);break;case"binaryOptions":var n,r;n=e.binaryOptions,r=i.binaryOptions,i.binaryOptions=Object.assign(Object.assign({},n),r);break;case"meta":i.meta={},tk(e.meta,i.meta),tk(t.meta,i.meta);break;case"interceptors":i.interceptors=e.interceptors?e.interceptors.concat(a):a.concat()}}return i}(this.defaultOptions,e)}unary(e,t,i){var n,r,s;let a=this.makeUrl(e,i),o=null!=(n=i.fetchInit)?n:{},l=i.sendJson?e.I.toJsonString(t,i.jsonOptions):e.I.toBinary(t,i.binaryOptions),c=new tC,u=new tC,d=new tC,h=new tC;return globalThis.fetch(a,Object.assign(Object.assign({},o),{method:"POST",headers:function(e,t,i){if(i)for(let[t,n]of Object.entries(i))if("string"==typeof n)e.append(t,n);else for(let i of n)e.append(t,i);return e.set("Content-Type",t?"application/json":"application/protobuf"),e.set("Accept",t?"application/json":"application/protobuf, application/json"),e}(new globalThis.Headers,!!i.sendJson,i.meta),body:l,signal:null!=(r=i.abort)?r:null})).then(t=>{var n;let r,s;c.resolve((n=t.headers,s={},n.forEach((e,t)=>{"content-type"!==t.toLowerCase()&&"content-length"!==t.toLowerCase()&&(s.hasOwnProperty(t)?s[t].push(e):s[t]=e)}),s));try{r=t.type}catch(e){}switch(r){case"error":case"opaque":case"opaqueredirect":throw new tS(`fetch response type ${t.type}`,p[p.unknown])}return t.ok?i.sendJson?t.json().then(t=>e.O.fromJson(t,i.jsonOptions),()=>{throw new tS("unable to read response body as json",p[p.dataloss])}):t.arrayBuffer().then(t=>e.O.fromBinary(new Uint8Array(t),i.binaryOptions),()=>{throw new tS("unable to read response body",p[p.dataloss])}):t.json().then(e=>{throw function(e){if(!eW(e)||"string"!=typeof e.code||"string"!=typeof e.msg)return new tS("cannot read twirp error response",p[p.internal]);let t={};if(eW(e.meta))for(let[i,n]of Object.entries(e.meta))"string"==typeof n&&(t[i]=n);return new tS(e.msg,e.code,t)}(e)},()=>{throw new tS("received HTTP "+t.status+", unable to read response body as json",p[p.internal])})},e=>{if(e instanceof Error&&"AbortError"===e.name)throw new tS(e.message,p[p.cancelled]);throw new tS(e instanceof Error?e.message:e)}).then(e=>{u.resolve(e),d.resolve({code:"OK",detail:""}),h.resolve({})}).catch(t=>{let i=t instanceof tS?t:new tS(t instanceof Error?t.message:t,p[p.internal]);i.methodName=e.name,i.serviceName=e.service.typeName,c.rejectPending(i),u.rejectPending(i),d.rejectPending(i),h.rejectPending(i)}),new tT(e,null!=(s=i.meta)?s:{},t,c.promise,u.promise,d.promise,h.promise)}makeUrl(e,t){let i=t.baseUrl;i.endsWith("/")&&(i=i.substring(0,i.length-1));let n=e.name;return!0!==t.useProtoMethodName&&(n=(n=eV(n)).substring(0,1).toUpperCase()+n.substring(1)),`${i}/${e.service.typeName}/${n}`}clientStreaming(e){let t=new tS("Client streaming is not supported by Twirp",p[p.unimplemented]);throw t.methodName=e.name,t.serviceName=e.service.typeName,t}duplex(e){let t=new tS("Duplex streaming is not supported by Twirp",p[p.unimplemented]);throw t.methodName=e.name,t.serviceName=e.service.typeName,t}serverStreaming(e){let t=new tS("Server streaming is not supported by Twirp",p[p.unimplemented]);throw t.methodName=e.name,t.serviceName=e.service.typeName,t}}var t_=i(4363);function tR(e){return"function"==typeof e}function tI(e){var t=e(function(e){Error.call(e),e.stack=Error().stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var tx=tI(function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}});function tP(e,t){if(e){var i=e.indexOf(t);0<=i&&e.splice(i,1)}}var tN=function(){var e;function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e,t,i,n,r,s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var a=(0,t_.Ju)(s),o=a.next();!o.done;o=a.next())o.value.remove(this)}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}else s.remove(this);var l=this.initialTeardown;if(tR(l))try{l()}catch(e){r=e instanceof tx?e.errors:[e]}var c=this._finalizers;if(c){this._finalizers=null;try{for(var u=(0,t_.Ju)(c),d=u.next();!d.done;d=u.next()){var h=d.value;try{tA(h)}catch(e){r=null!=r?r:[],e instanceof tx?r=(0,t_.fX)((0,t_.fX)([],(0,t_.zs)(r)),(0,t_.zs)(e.errors)):r.push(e)}}}catch(e){i={error:e}}finally{try{d&&!d.done&&(n=u.return)&&n.call(u)}finally{if(i)throw i.error}}}if(r)throw new tx(r)}},t.prototype.add=function(e){var i;if(e&&e!==this)if(this.closed)tA(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!=(i=this._finalizers)?i:[]).push(e)}},t.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},t.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},t.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&tP(t,e)},t.prototype.remove=function(e){var i=this._finalizers;i&&tP(i,e),e instanceof t&&e._removeParent(this)},(e=new t).closed=!0,t.EMPTY=e,t}(),tO=tN.EMPTY;function tD(e){return e instanceof tN||e&&"closed"in e&&tR(e.remove)&&tR(e.add)&&tR(e.unsubscribe)}function tA(e){tR(e)?e():e.unsubscribe()}var tj={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},tL={setTimeout:function(e,t){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];var r=tL.delegate;return(null==r?void 0:r.setTimeout)?r.setTimeout.apply(r,(0,t_.fX)([e,t],(0,t_.zs)(i))):setTimeout.apply(void 0,(0,t_.fX)([e,t],(0,t_.zs)(i)))},clearTimeout:function(e){var t=tL.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function tU(e){tL.setTimeout(function(){var t=tj.onUnhandledError;if(t)t(e);else throw e})}function tM(){}var tF=t$("C",void 0,void 0);function t$(e,t,i){return{kind:e,value:t,error:i}}var tV=null;function tB(e){if(tj.useDeprecatedSynchronousErrorHandling){var t=!tV;if(t&&(tV={errorThrown:!1,error:null}),e(),t){var i=tV,n=i.errorThrown,r=i.error;if(tV=null,n)throw r}}else e()}var tH=function(e){function t(t){var i=e.call(this)||this;return i.isStopped=!1,t?(i.destination=t,tD(t)&&t.add(i)):i.destination=tY,i}return(0,t_.C6)(t,e),t.create=function(e,t,i){return new tJ(e,t,i)},t.prototype.next=function(e){this.isStopped?tz(t$("N",e,void 0),this):this._next(e)},t.prototype.error=function(e){this.isStopped?tz(t$("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?tz(tF,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(tN),tq=Function.prototype.bind;function tW(e,t){return tq.call(e,t)}var tG=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){tK(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){tK(e)}else tK(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){tK(e)}},e}(),tJ=function(e){function t(t,i,n){var r,s,a=e.call(this)||this;return tR(t)||!t?r={next:null!=t?t:void 0,error:null!=i?i:void 0,complete:null!=n?n:void 0}:a&&tj.useDeprecatedNextContext?((s=Object.create(t)).unsubscribe=function(){return a.unsubscribe()},r={next:t.next&&tW(t.next,s),error:t.error&&tW(t.error,s),complete:t.complete&&tW(t.complete,s)}):r=t,a.destination=new tG(r),a}return(0,t_.C6)(t,e),t}(tH);function tK(e){if(tj.useDeprecatedSynchronousErrorHandling)tj.useDeprecatedSynchronousErrorHandling&&tV&&(tV.errorThrown=!0,tV.error=e);else tU(e)}function tz(e,t){var i=tj.onStoppedNotification;i&&tL.setTimeout(function(){return i(e,t)})}var tY={closed:!0,next:tM,error:function(e){throw e},complete:tM},tX="function"==typeof Symbol&&Symbol.observable||"@@observable";function tZ(e){return e}var tQ=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var i=new e;return i.source=this,i.operator=t,i},e.prototype.subscribe=function(e,t,i){var n=this,r=!function(e){return e&&e instanceof tH||e&&tR(e.next)&&tR(e.error)&&tR(e.complete)&&tD(e)}(e)?new tJ(e,t,i):e;return tB(function(){var e=n.operator,t=n.source;r.add(e?e.call(r,t):t?n._subscribe(r):n._trySubscribe(r))}),r},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var i=this;return new(t=t0(t))(function(t,n){var r=new tJ({next:function(t){try{e(t)}catch(e){n(e),r.unsubscribe()}},error:n,complete:t});i.subscribe(r)})},e.prototype._subscribe=function(e){var t;return null==(t=this.source)?void 0:t.subscribe(e)},e.prototype[tX]=function(){return this},e.prototype.pipe=function(){for(var e,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return(0===(e=t).length?tZ:1===e.length?e[0]:function(t){return e.reduce(function(e,t){return t(e)},t)})(this)},e.prototype.toPromise=function(e){var t=this;return new(e=t0(e))(function(e,i){var n;t.subscribe(function(e){return n=e},function(e){return i(e)},function(){return e(n)})})},e.create=function(t){return new e(t)},e}();function t0(e){var t;return null!=(t=null!=e?e:tj.Promise)?t:Promise}var t1=tI(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),t2=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return(0,t_.C6)(t,e),t.prototype.lift=function(e){var t=new t3(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new t1},t.prototype.next=function(e){var t=this;tB(function(){var i,n;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var r=(0,t_.Ju)(t.currentObservers),s=r.next();!s.done;s=r.next())s.value.next(e)}catch(e){i={error:e}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(i)throw i.error}}}})},t.prototype.error=function(e){var t=this;tB(function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var i=t.observers;i.length;)i.shift().error(e)}})},t.prototype.complete=function(){var e=this;tB(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null==(e=this.observers)?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,i=this.hasError,n=this.isStopped,r=this.observers;return i||n?tO:(this.currentObservers=null,r.push(e),new tN(function(){t.currentObservers=null,tP(r,e)}))},t.prototype._checkFinalizedStatuses=function(e){var t=this.hasError,i=this.thrownError,n=this.isStopped;t?e.error(i):n&&e.complete()},t.prototype.asObservable=function(){var e=new tQ;return e.source=this,e},t.create=function(e,t){return new t3(e,t)},t}(tQ),t3=function(e){function t(t,i){var n=e.call(this)||this;return n.destination=t,n.source=i,n}return(0,t_.C6)(t,e),t.prototype.next=function(e){var t,i;null==(i=null==(t=this.destination)?void 0:t.next)||i.call(t,e)},t.prototype.error=function(e){var t,i;null==(i=null==(t=this.destination)?void 0:t.error)||i.call(t,e)},t.prototype.complete=function(){var e,t;null==(t=null==(e=this.destination)?void 0:e.complete)||t.call(e)},t.prototype._subscribe=function(e){var t,i;return null!=(i=null==(t=this.source)?void 0:t.subscribe(e))?i:tO},t}(t2),t4={now:function(){return(t4.delegate||Date).now()},delegate:void 0},t6=function(e){function t(t,i,n){void 0===t&&(t=1/0),void 0===i&&(i=1/0),void 0===n&&(n=t4);var r=e.call(this)||this;return r._bufferSize=t,r._windowTime=i,r._timestampProvider=n,r._buffer=[],r._infiniteTimeWindow=!0,r._infiniteTimeWindow=i===1/0,r._bufferSize=Math.max(1,t),r._windowTime=Math.max(1,i),r}return(0,t_.C6)(t,e),t.prototype.next=function(t){var i=this.isStopped,n=this._buffer,r=this._infiniteTimeWindow,s=this._timestampProvider,a=this._windowTime;!i&&(n.push(t),r||n.push(s.now()+a)),this._trimBuffer(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var t=this._innerSubscribe(e),i=this._infiniteTimeWindow,n=this._buffer.slice(),r=0;r<n.length&&!e.closed;r+=i?1:2)e.next(n[r]);return this._checkFinalizedStatuses(e),t},t.prototype._trimBuffer=function(){var e=this._bufferSize,t=this._timestampProvider,i=this._buffer,n=this._infiniteTimeWindow,r=(n?1:2)*e;if(e<1/0&&r<i.length&&i.splice(0,i.length-r),!n){for(var s=t.now(),a=0,o=1;o<i.length&&i[o]<=s;o+=2)a=o;a&&i.splice(0,a+1)}},t}(t2),t5=Array.isArray,t9=Object.getPrototypeOf,t8=Object.prototype,t7=Object.keys,ie=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function it(e){return tR(null==e?void 0:e.then)}function ii(e){return Symbol.asyncIterator&&tR(null==e?void 0:e[Symbol.asyncIterator])}function ir(e){return TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var is="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function ia(e){return tR(null==e?void 0:e[is])}function io(e){return(0,t_.AQ)(this,arguments,function(){var t,i,n;return(0,t_.YH)(this,function(r){switch(r.label){case 0:t=e.getReader(),r.label=1;case 1:r.trys.push([1,,9,10]),r.label=2;case 2:return[4,(0,t_.N3)(t.read())];case 3:if(n=(i=r.sent()).value,!i.done)return[3,5];return[4,(0,t_.N3)(void 0)];case 4:return[2,r.sent()];case 5:return[4,(0,t_.N3)(n)];case 6:return[4,r.sent()];case 7:return r.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function il(e){return tR(null==e?void 0:e.getReader)}function ic(e){if(e instanceof tQ)return e;if(null!=e){var t,i,n,r;if(tR(e[tX])){return t=e,new tQ(function(e){var i=t[tX]();if(tR(i.subscribe))return i.subscribe(e);throw TypeError("Provided object does not correctly implement Symbol.observable")})}if(ie(e)){return i=e,new tQ(function(e){for(var t=0;t<i.length&&!e.closed;t++)e.next(i[t]);e.complete()})}if(it(e)){return n=e,new tQ(function(e){n.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,tU)})}if(ii(e))return iu(e);if(ia(e)){return r=e,new tQ(function(e){var t,i;try{for(var n=(0,t_.Ju)(r),s=n.next();!s.done;s=n.next()){var a=s.value;if(e.next(a),e.closed)return}}catch(e){t={error:e}}finally{try{s&&!s.done&&(i=n.return)&&i.call(n)}finally{if(t)throw t.error}}e.complete()})}if(il(e))return iu(io(e))}throw ir(e)}function iu(e){return new tQ(function(t){(function(e,t){var i,n,r,s;return(0,t_.sH)(this,void 0,void 0,function(){var a;return(0,t_.YH)(this,function(o){switch(o.label){case 0:o.trys.push([0,5,6,11]),i=(0,t_.xN)(e),o.label=1;case 1:return[4,i.next()];case 2:if((n=o.sent()).done)return[3,4];if(a=n.value,t.next(a),t.closed)return[2];o.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return r={error:o.sent()},[3,11];case 6:if(o.trys.push([6,,9,10]),!(n&&!n.done&&(s=i.return)))return[3,8];return[4,s.call(i)];case 7:o.sent(),o.label=8;case 8:return[3,10];case 9:if(r)throw r.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})})(e,t).catch(function(e){return t.error(e)})})}function id(e,t,i,n,r){void 0===n&&(n=0),void 0===r&&(r=!1);var s=t.schedule(function(){i(),r?e.add(this.schedule(null,n)):this.unsubscribe()},n);if(e.add(s),!r)return s}function ih(e){return function(t){if(tR(null==t?void 0:t.lift))return t.lift(function(t){try{return e(t,this)}catch(e){this.error(e)}});throw TypeError("Unable to lift unknown Observable type")}}function ip(e,t,i,n,r){return new im(e,t,i,n,r)}var im=function(e){function t(t,i,n,r,s,a){var o=e.call(this,t)||this;return o.onFinalize=s,o.shouldUnsubscribe=a,o._next=i?function(e){try{i(e)}catch(e){t.error(e)}}:e.prototype._next,o._error=r?function(e){try{r(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,o._complete=n?function(){try{n()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,o}return(0,t_.C6)(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var i=this.closed;e.prototype.unsubscribe.call(this),i||null==(t=this.onFinalize)||t.call(this)}},t}(tH);function ig(e,t){return void 0===t&&(t=0),ih(function(i,n){i.subscribe(ip(n,function(i){return id(n,e,function(){return n.next(i)},t)},function(){return id(n,e,function(){return n.complete()},t)},function(i){return id(n,e,function(){return n.error(i)},t)}))})}function iv(e,t){return void 0===t&&(t=0),ih(function(i,n){n.add(e.schedule(function(){return i.subscribe(n)},t))})}function ib(e,t){if(!e)throw Error("Iterable cannot be null");return new tQ(function(i){id(i,t,function(){var n=e[Symbol.asyncIterator]();id(i,t,function(){n.next().then(function(e){e.done?i.complete():i.next(e.value)})},0,!0)})})}function iy(e,t){return t?function(e,t){if(null!=e){if(tR(e[tX]))return ic(e).pipe(iv(t),ig(t));if(ie(e))return new tQ(function(i){var n=0;return t.schedule(function(){n===e.length?i.complete():(i.next(e[n++]),i.closed||this.schedule())})});if(it(e))return ic(e).pipe(iv(t),ig(t));if(ii(e))return ib(e,t);if(ia(e))return new tQ(function(i){var n;return id(i,t,function(){n=e[is](),id(i,t,function(){var e,t,r;try{t=(e=n.next()).value,r=e.done}catch(e){i.error(e);return}r?i.complete():i.next(t)},0,!0)}),function(){return tR(null==n?void 0:n.return)&&n.return()}});if(il(e))return ib(io(e),t)}throw ir(e)}(e,t):ic(e)}function iS(e,t){return ih(function(i,n){var r=0;i.subscribe(ip(n,function(i){n.next(e.call(t,i,r++))}))})}var iw=Array.isArray;function ik(e){return iS(function(t){return iw(t)?e.apply(void 0,(0,t_.fX)([],(0,t_.zs)(t))):e(t)})}function iC(e){return e[e.length-1]}function iT(e){var t;return(t=iC(e))&&tR(t.schedule)?e.pop():void 0}function iE(){for(var e,t,i,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var s=iT(n),a=tR(iC(n))?n.pop():void 0,o=function(e){if(1===e.length){var t,i=e[0];if(t5(i))return{args:i,keys:null};if((t=i)&&"object"==typeof t&&t9(t)===t8){var n=t7(i);return{args:n.map(function(e){return i[e]}),keys:n}}}return{args:e,keys:null}}(n),l=o.args,c=o.keys;if(0===l.length)return iy([],s);var u=new tQ((e=l,t=s,void 0===(i=c?function(e){return c.reduce(function(t,i,n){return t[i]=e[n],t},{})}:tZ)&&(i=tZ),function(n){(function(e,t,i){e?id(i,e,t):t()})(t,function(){for(var r=e.length,s=Array(r),a=r,o=r,l=function(r){(function(e,t,i){e?id(i,e,t):t()})(t,function(){var l=iy(e[r],t),c=!1;l.subscribe(ip(n,function(e){s[r]=e,!c&&(c=!0,o--),o||n.next(i(s.slice()))},function(){--a||n.complete()}))},n)},c=0;c<r;c++)l(c)},n)}));return a?u.pipe(ik(a)):u}function i_(e,t,i){e?id(i,e,t):t()}var iR=function(e){function t(t){var i=e.call(this)||this;return i._value=t,i}return(0,t_.C6)(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var i=e.prototype._subscribe.call(this,t);return i.closed||t.next(this._value),i},t.prototype.getValue=function(){var e=this.hasError,t=this.thrownError,i=this._value;if(e)throw t;return this._throwIfClosed(),i},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(t2);function iI(e,t){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];if(!0===t)return void e();if(!1!==t){var r=new tJ({next:function(){r.unsubscribe(),e()}});return ic(t.apply(void 0,(0,t_.fX)([],(0,t_.zs)(i)))).subscribe(r)}}function ix(e,t,i){var n,r,s,a,o,l,c,u,d,h,p,f,m,g=!1;return e&&"object"==typeof e?(m=void 0===(h=e.bufferSize)?1/0:h,t=void 0===(p=e.windowTime)?1/0:p,g=void 0!==(f=e.refCount)&&f,i=e.scheduler):m=null!=e?e:1/0,s=void 0===(r=(n={connector:function(){return new t6(m,t,i)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:g}).connector)?function(){return new t2}:r,o=void 0===(a=n.resetOnError)||a,c=void 0===(l=n.resetOnComplete)||l,d=void 0===(u=n.resetOnRefCountZero)||u,function(e){var t,i,n,r=0,a=!1,l=!1,u=function(){null==i||i.unsubscribe(),i=void 0},h=function(){u(),t=n=void 0,a=l=!1},p=function(){var e=t;h(),null==e||e.unsubscribe()};return ih(function(e,f){r++,l||a||u();var m=n=null!=n?n:s();f.add(function(){0!=--r||l||a||(i=iI(p,d))}),m.subscribe(f),!t&&r>0&&(t=new tJ({next:function(e){return m.next(e)},error:function(e){l=!0,u(),i=iI(h,o,e),m.error(e)},complete:function(){a=!0,u(),i=iI(h,c),m.complete()}}),ic(e).subscribe(t))})(e)}}function iP(e,t){return void 0===t&&(t=tZ),e=null!=e?e:iN,ih(function(i,n){var r,s=!0;i.subscribe(ip(n,function(i){var a=t(i);(s||!e(r,a))&&(s=!1,r=a,n.next(i))}))})}function iN(e,t){return e===t}function iO(e,t){return void 0===t&&(t=!1),ih(function(i,n){var r=0;i.subscribe(ip(n,function(i){var s=e(i,r++);(s||t)&&n.next(i),s||n.complete()}))})}function iD(e,t){return iP(function(i,n){return t?t(i[e],n[e]):i[e]===n[e]})}function iA(e,t,i){return(void 0===i&&(i=1/0),tR(t))?iA(function(i,n){return iS(function(e,r){return t(i,e,n,r)})(ic(e(i,n)))},i):("number"==typeof t&&(i=t),ih(function(t,n){var r,s,a,o,l,c,u,d,h;return r=i,a=[],o=0,l=0,c=!1,u=function(){!c||a.length||o||n.complete()},d=function(e){return o<r?h(e):a.push(e)},h=function(t){o++;var i=!1;ic(e(t,l++)).subscribe(ip(n,function(e){s?d(e):n.next(e)},function(){i=!0},void 0,function(){if(i)try{for(o--;a.length&&o<r;)!function(){var e=a.shift();h(e)}();u()}catch(e){n.error(e)}}))},t.subscribe(ip(n,d,function(){c=!0,u()})),function(){}}))}var ij=["addListener","removeListener"],iL=["addEventListener","removeEventListener"],iU=["on","off"];function iM(e,t){return function(i){return function(n){return e[i](t,n)}}}var iF=function(e){function t(t,i){return e.call(this)||this}return(0,t_.C6)(t,e),t.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},t}(tN),i$={setInterval:function(e,t){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];var r=i$.delegate;return(null==r?void 0:r.setInterval)?r.setInterval.apply(r,(0,t_.fX)([e,t],(0,t_.zs)(i))):setInterval.apply(void 0,(0,t_.fX)([e,t],(0,t_.zs)(i)))},clearInterval:function(e){var t=i$.delegate;return((null==t?void 0:t.clearInterval)||clearInterval)(e)},delegate:void 0},iV=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n.scheduler=t,n.work=i,n.pending=!1,n}return(0,t_.C6)(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e;var i,n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,t)),this.pending=!0,this.delay=t,this.id=null!=(i=this.id)?i:this.requestAsyncId(r,this.id,t),this},t.prototype.requestAsyncId=function(e,t,i){return void 0===i&&(i=0),i$.setInterval(e.flush.bind(e,this),i)},t.prototype.recycleAsyncId=function(e,t,i){if(void 0===i&&(i=0),null!=i&&this.delay===i&&!1===this.pending)return t;null!=t&&i$.clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return Error("executing a cancelled action");this.pending=!1;var i=this._execute(e,t);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var i,n=!1;try{this.work(e)}catch(e){n=!0,i=e||Error("Scheduled action threw falsy error")}if(n)return this.unsubscribe(),i},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,i=this.scheduler,n=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,tP(n,this),null!=t&&(this.id=this.recycleAsyncId(i,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(iF),iB=function(){function e(t,i){void 0===i&&(i=e.now),this.schedulerActionCtor=t,this.now=i}return e.prototype.schedule=function(e,t,i){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(i,t)},e.now=t4.now,e}(),iH=new(function(e){function t(t,i){void 0===i&&(i=iB.now);var n=e.call(this,t,i)||this;return n.actions=[],n._active=!1,n}return(0,t_.C6)(t,e),t.prototype.flush=function(e){var t,i=this.actions;if(this._active)return void i.push(e);this._active=!0;do if(t=e.execute(e.state,e.delay))break;while(e=i.shift());if(this._active=!1,t){for(;e=i.shift();)e.unsubscribe();throw t}},t}(iB))(iV);function iq(e){return void 0===e&&(e=1/0),iA(tZ,e)}var iW=new tQ(function(e){return e.complete()});function iG(){for(var e,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=iT(t),r=(e=1/0,"number"==typeof iC(t)?t.pop():e);return t.length?1===t.length?ic(t[0]):iq(r)(iy(t,n)):iW}function iJ(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return iq(1)(iy(e,iT(e)))}function iK(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=iT(e);return ih(function(t,n){(i?iJ(e,t,i):iJ(e,t)).subscribe(n)})}function iz(e,t){return tR(t)?iA(e,t,1):iA(e,1)}function iY(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=iT(e);return iy(e,i)}var iX=i(18567),iZ=i(34514),iQ=i(55591),i0=i.n(iQ);let i1={DISABLED:"disabled",AUTO_ON:"auto-on"},i2={BLOCK_USERS:"block-users",CREATE_REACTION:"create-reaction",ENABLE_NOISE_CANCELLATION:"enable-noise-cancellation",JOIN_BACKSTAGE:"join-backstage",MUTE_USERS:"mute-users",PIN_FOR_EVERYONE:"pin-for-everyone",SCREENSHARE:"screenshare",SEND_AUDIO:"send-audio",SEND_VIDEO:"send-video",START_RECORD_CALL:"start-record-call",STOP_RECORD_CALL:"stop-record-call",UPDATE_CALL_PERMISSIONS:"update-call-permissions"};class i3 extends Error{constructor({message:e,code:t,status:i,response:n,unrecoverable:r}){super(e),this.name="ErrorFromResponse",this.code=t,this.response=n,this.status=i,this.unrecoverable=r}toJSON(){let e=[["status",this.status],["code",this.code],["unrecoverable",this.unrecoverable]],t=[];for(let[i,n]of e)null!=n&&t.push(`${i}: ${n}`);return{message:`(${t.join(", ")}) - ${this.message}`,stack:this.stack,name:this.name}}}!function(e){e[e.NULL_VALUE=0]="NULL_VALUE"}(m||(m={}));class i4 extends tv{constructor(){super("google.protobuf.Struct",[{no:1,name:"fields",kind:"map",K:9,V:{kind:"message",T:()=>i9}}])}internalJsonWrite(e,t){let i={};for(let[t,n]of Object.entries(e.fields))i[t]=i9.toJson(n);return i}internalJsonRead(e,t,i){if(!eW(e))throw new globalThis.Error("Unable to parse message "+this.typeName+" from JSON "+eq(e)+".");for(let[t,n]of(i||(i=this.create()),globalThis.Object.entries(e)))i.fields[t]=i9.fromJson(n);return i}}let i6=new i4;class i5 extends tv{constructor(){super("google.protobuf.Value",[{no:1,name:"null_value",kind:"enum",oneof:"kind",T:()=>["google.protobuf.NullValue",m]},{no:2,name:"number_value",kind:"scalar",oneof:"kind",T:1},{no:3,name:"string_value",kind:"scalar",oneof:"kind",T:9},{no:4,name:"bool_value",kind:"scalar",oneof:"kind",T:8},{no:5,name:"struct_value",kind:"message",oneof:"kind",T:()=>i6},{no:6,name:"list_value",kind:"message",oneof:"kind",T:()=>i7}])}internalJsonWrite(e,t){if(void 0===e.kind.oneofKind)throw new globalThis.Error;switch(e.kind.oneofKind){case void 0:throw new globalThis.Error;case"boolValue":return e.kind.boolValue;case"nullValue":return null;case"numberValue":let i=e.kind.numberValue;if("number"==typeof i&&!Number.isFinite(i))throw new globalThis.Error;return i;case"stringValue":return e.kind.stringValue;case"listValue":let n=this.fields.find(e=>6===e.no);if(n?.kind!=="message")throw new globalThis.Error;return n.T().toJson(e.kind.listValue);case"structValue":let r=this.fields.find(e=>5===e.no);if(r?.kind!=="message")throw new globalThis.Error;return r.T().toJson(e.kind.structValue)}}internalJsonRead(e,t,i){switch(!i&&(i=this.create()),typeof e){case"number":i.kind={oneofKind:"numberValue",numberValue:e};break;case"string":i.kind={oneofKind:"stringValue",stringValue:e};break;case"boolean":i.kind={oneofKind:"boolValue",boolValue:e};break;case"object":null===e?i.kind={oneofKind:"nullValue",nullValue:m.NULL_VALUE}:globalThis.Array.isArray(e)?i.kind={oneofKind:"listValue",listValue:i7.fromJson(e)}:i.kind={oneofKind:"structValue",structValue:i6.fromJson(e)};break;default:throw new globalThis.Error("Unable to parse "+this.typeName+" from JSON "+eq(e))}return i}}let i9=new i5;class i8 extends tv{constructor(){super("google.protobuf.ListValue",[{no:1,name:"values",kind:"message",repeat:1,T:()=>i9}])}internalJsonWrite(e,t){return e.values.map(e=>i9.toJson(e))}internalJsonRead(e,t,i){if(!globalThis.Array.isArray(e))throw new globalThis.Error("Unable to parse "+this.typeName+" from JSON "+eq(e));i||(i=this.create());let n=e.map(e=>i9.fromJson(e));return i.values.push(...n),i}}let i7=new i8;class ne extends tv{constructor(){super("google.protobuf.Timestamp",[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}])}now(){let e=this.create(),t=Date.now();return e.seconds=e4.from(Math.floor(t/1e3)).toString(),e.nanos=t%1e3*1e6,e}toDate(e){return new Date(1e3*e4.from(e.seconds).toNumber()+Math.ceil(e.nanos/1e6))}fromDate(e){let t=this.create(),i=e.getTime();return t.seconds=e4.from(Math.floor(i/1e3)).toString(),t.nanos=(i%1e3+1e3*(i<0&&i%1e3!=0))*1e6,t}internalJsonWrite(e,t){let i=1e3*e4.from(e.seconds).toNumber();if(i<Date.parse("0001-01-01T00:00:00Z")||i>Date.parse("9999-12-31T23:59:59Z"))throw Error("Unable to encode Timestamp to JSON. Must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive.");if(e.nanos<0)throw Error("Unable to encode invalid Timestamp to JSON. Nanos must not be negative.");let n="Z";if(e.nanos>0){let t=(e.nanos+1e9).toString().substring(1);n="000000"===t.substring(3)?"."+t.substring(0,3)+"Z":"000"===t.substring(6)?"."+t.substring(0,6)+"Z":"."+t+"Z"}return new Date(i).toISOString().replace(".000Z",n)}internalJsonRead(e,t,i){if("string"!=typeof e)throw Error("Unable to parse Timestamp from JSON "+eq(e)+".");let n=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!n)throw Error("Unable to parse Timestamp from JSON. Invalid format.");let r=Date.parse(n[1]+"-"+n[2]+"-"+n[3]+"T"+n[4]+":"+n[5]+":"+n[6]+(n[8]?n[8]:"Z"));if(Number.isNaN(r))throw Error("Unable to parse Timestamp from JSON. Invalid value.");if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new globalThis.Error("Unable to parse Timestamp from JSON. Must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive.");return i||(i=this.create()),i.seconds=e4.from(r/1e3).toString(),i.nanos=0,n[7]&&(i.nanos=parseInt("1"+n[7]+"0".repeat(9-n[7].length))-1e9),i}}let nt=new ne;!function(e){e[e.PUBLISHER_UNSPECIFIED=0]="PUBLISHER_UNSPECIFIED",e[e.SUBSCRIBER=1]="SUBSCRIBER"}(g||(g={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.POOR=1]="POOR",e[e.GOOD=2]="GOOD",e[e.EXCELLENT=3]="EXCELLENT"}(v||(v={})),function(e){e[e.LOW_UNSPECIFIED=0]="LOW_UNSPECIFIED",e[e.MID=1]="MID",e[e.HIGH=2]="HIGH",e[e.OFF=3]="OFF"}(b||(b={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.AUDIO=1]="AUDIO",e[e.VIDEO=2]="VIDEO",e[e.SCREEN_SHARE=3]="SCREEN_SHARE",e[e.SCREEN_SHARE_AUDIO=4]="SCREEN_SHARE_AUDIO"}(y||(y={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.PUBLISH_TRACK_NOT_FOUND=100]="PUBLISH_TRACK_NOT_FOUND",e[e.PUBLISH_TRACKS_MISMATCH=101]="PUBLISH_TRACKS_MISMATCH",e[e.PUBLISH_TRACK_OUT_OF_ORDER=102]="PUBLISH_TRACK_OUT_OF_ORDER",e[e.PUBLISH_TRACK_VIDEO_LAYER_NOT_FOUND=103]="PUBLISH_TRACK_VIDEO_LAYER_NOT_FOUND",e[e.LIVE_ENDED=104]="LIVE_ENDED",e[e.PARTICIPANT_NOT_FOUND=200]="PARTICIPANT_NOT_FOUND",e[e.PARTICIPANT_MIGRATING_OUT=201]="PARTICIPANT_MIGRATING_OUT",e[e.PARTICIPANT_MIGRATION_FAILED=202]="PARTICIPANT_MIGRATION_FAILED",e[e.PARTICIPANT_MIGRATING=203]="PARTICIPANT_MIGRATING",e[e.PARTICIPANT_RECONNECT_FAILED=204]="PARTICIPANT_RECONNECT_FAILED",e[e.PARTICIPANT_MEDIA_TRANSPORT_FAILURE=205]="PARTICIPANT_MEDIA_TRANSPORT_FAILURE",e[e.CALL_NOT_FOUND=300]="CALL_NOT_FOUND",e[e.REQUEST_VALIDATION_FAILED=400]="REQUEST_VALIDATION_FAILED",e[e.UNAUTHENTICATED=401]="UNAUTHENTICATED",e[e.PERMISSION_DENIED=403]="PERMISSION_DENIED",e[e.TOO_MANY_REQUESTS=429]="TOO_MANY_REQUESTS",e[e.INTERNAL_SERVER_ERROR=500]="INTERNAL_SERVER_ERROR",e[e.SFU_SHUTTING_DOWN=600]="SFU_SHUTTING_DOWN",e[e.SFU_FULL=700]="SFU_FULL"}(S||(S={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.REACT=1]="REACT",e[e.ANGULAR=2]="ANGULAR",e[e.ANDROID=3]="ANDROID",e[e.IOS=4]="IOS",e[e.FLUTTER=5]="FLUTTER",e[e.REACT_NATIVE=6]="REACT_NATIVE",e[e.UNITY=7]="UNITY",e[e.GO=8]="GO",e[e.PLAIN_JAVASCRIPT=9]="PLAIN_JAVASCRIPT"}(w||(w={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.USER_MUTED=1]="USER_MUTED",e[e.PERMISSION_REVOKED=2]="PERMISSION_REVOKED",e[e.MODERATION=3]="MODERATION"}(k||(k={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.SHUTTING_DOWN=1]="SHUTTING_DOWN",e[e.REBALANCE=2]="REBALANCE"}(C||(C={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.ENDED=1]="ENDED",e[e.LIVE_ENDED=2]="LIVE_ENDED",e[e.KICKED=3]="KICKED",e[e.SESSION_ENDED=4]="SESSION_ENDED"}(T||(T={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.DISCONNECT=1]="DISCONNECT",e[e.FAST=2]="FAST",e[e.REJOIN=3]="REJOIN",e[e.MIGRATE=4]="MIGRATE"}(E||(E={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.NONE=1]="NONE",e[e.LIGHT=2]="LIGHT",e[e.MODERATE=3]="MODERATE",e[e.SEVERE=4]="SEVERE",e[e.CRITICAL=5]="CRITICAL",e[e.EMERGENCY=6]="EMERGENCY",e[e.SHUTDOWN=7]="SHUTDOWN"}(_||(_={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.NOMINAL=1]="NOMINAL",e[e.FAIR=2]="FAIR",e[e.SERIOUS=3]="SERIOUS",e[e.CRITICAL=4]="CRITICAL"}(R||(R={}));class ni extends tv{constructor(){super("stream.video.sfu.models.CallState",[{no:1,name:"participants",kind:"message",repeat:1,T:()=>nc},{no:2,name:"started_at",kind:"message",T:()=>nt},{no:3,name:"participant_count",kind:"message",T:()=>ns},{no:4,name:"pins",kind:"message",repeat:1,T:()=>no}])}}let nn=new ni;class nr extends tv{constructor(){super("stream.video.sfu.models.ParticipantCount",[{no:1,name:"total",kind:"scalar",T:13},{no:2,name:"anonymous",kind:"scalar",T:13}])}}let ns=new nr;class na extends tv{constructor(){super("stream.video.sfu.models.Pin",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9}])}}let no=new na;class nl extends tv{constructor(){super("stream.video.sfu.models.Participant",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"published_tracks",kind:"enum",repeat:1,T:()=>["stream.video.sfu.models.TrackType",y,"TRACK_TYPE_"]},{no:4,name:"joined_at",kind:"message",T:()=>nt},{no:5,name:"track_lookup_prefix",kind:"scalar",T:9},{no:6,name:"connection_quality",kind:"enum",T:()=>["stream.video.sfu.models.ConnectionQuality",v,"CONNECTION_QUALITY_"]},{no:7,name:"is_speaking",kind:"scalar",T:8},{no:8,name:"is_dominant_speaker",kind:"scalar",T:8},{no:9,name:"audio_level",kind:"scalar",T:2},{no:10,name:"name",kind:"scalar",T:9},{no:11,name:"image",kind:"scalar",T:9},{no:12,name:"custom",kind:"message",T:()=>i6},{no:13,name:"roles",kind:"scalar",repeat:2,T:9}])}}let nc=new nl;class nu extends tv{constructor(){super("stream.video.sfu.models.StreamQuality",[{no:1,name:"video_quality",kind:"enum",T:()=>["stream.video.sfu.models.VideoQuality",b,"VIDEO_QUALITY_"]},{no:2,name:"user_id",kind:"scalar",T:9}])}}let nd=new nu;class nh extends tv{constructor(){super("stream.video.sfu.models.VideoDimension",[{no:1,name:"width",kind:"scalar",T:13},{no:2,name:"height",kind:"scalar",T:13}])}}let np=new nh;class nf extends tv{constructor(){super("stream.video.sfu.models.VideoLayer",[{no:1,name:"rid",kind:"scalar",T:9},{no:2,name:"video_dimension",kind:"message",T:()=>np},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"fps",kind:"scalar",T:13},{no:6,name:"quality",kind:"enum",T:()=>["stream.video.sfu.models.VideoQuality",b,"VIDEO_QUALITY_"]}])}}let nm=new nf;class ng extends tv{constructor(){super("stream.video.sfu.models.SubscribeOption",[{no:1,name:"track_type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",y,"TRACK_TYPE_"]},{no:2,name:"codecs",kind:"message",repeat:1,T:()=>nw}])}}let nv=new ng;class nb extends tv{constructor(){super("stream.video.sfu.models.PublishOption",[{no:1,name:"track_type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",y,"TRACK_TYPE_"]},{no:2,name:"codec",kind:"message",T:()=>nw},{no:3,name:"bitrate",kind:"scalar",T:5},{no:4,name:"fps",kind:"scalar",T:5},{no:5,name:"max_spatial_layers",kind:"scalar",T:5},{no:6,name:"max_temporal_layers",kind:"scalar",T:5},{no:7,name:"video_dimension",kind:"message",T:()=>np},{no:8,name:"id",kind:"scalar",T:5},{no:9,name:"use_single_layer",kind:"scalar",T:8}])}}let ny=new nb;class nS extends tv{constructor(){super("stream.video.sfu.models.Codec",[{no:16,name:"payload_type",kind:"scalar",T:13},{no:10,name:"name",kind:"scalar",T:9},{no:14,name:"clock_rate",kind:"scalar",T:13},{no:15,name:"encoding_parameters",kind:"scalar",T:9},{no:12,name:"fmtp",kind:"scalar",T:9}])}}let nw=new nS,nk=new class extends tv{constructor(){super("stream.video.sfu.models.ICETrickle",[{no:1,name:"peer_type",kind:"enum",T:()=>["stream.video.sfu.models.PeerType",g,"PEER_TYPE_"]},{no:2,name:"ice_candidate",kind:"scalar",T:9},{no:3,name:"session_id",kind:"scalar",T:9}])}};class nC extends tv{constructor(){super("stream.video.sfu.models.TrackInfo",[{no:1,name:"track_id",kind:"scalar",T:9},{no:2,name:"track_type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",y,"TRACK_TYPE_"]},{no:5,name:"layers",kind:"message",repeat:1,T:()=>nm},{no:6,name:"mid",kind:"scalar",T:9},{no:7,name:"dtx",kind:"scalar",T:8},{no:8,name:"stereo",kind:"scalar",T:8},{no:9,name:"red",kind:"scalar",T:8},{no:10,name:"muted",kind:"scalar",T:8},{no:11,name:"codec",kind:"message",T:()=>nw},{no:12,name:"publish_option_id",kind:"scalar",T:5}])}}let nT=new nC,nE=new class extends tv{constructor(){super("stream.video.sfu.models.Error",[{no:1,name:"code",kind:"enum",T:()=>["stream.video.sfu.models.ErrorCode",S,"ERROR_CODE_"]},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"should_retry",kind:"scalar",T:8}])}};class n_ extends tv{constructor(){super("stream.video.sfu.models.ClientDetails",[{no:1,name:"sdk",kind:"message",T:()=>nx},{no:2,name:"os",kind:"message",T:()=>nN},{no:3,name:"browser",kind:"message",T:()=>nD},{no:4,name:"device",kind:"message",T:()=>nU}])}}let nR=new n_;class nI extends tv{constructor(){super("stream.video.sfu.models.Sdk",[{no:1,name:"type",kind:"enum",T:()=>["stream.video.sfu.models.SdkType",w,"SDK_TYPE_"]},{no:2,name:"major",kind:"scalar",T:9},{no:3,name:"minor",kind:"scalar",T:9},{no:4,name:"patch",kind:"scalar",T:9}])}}let nx=new nI;class nP extends tv{constructor(){super("stream.video.sfu.models.OS",[{no:1,name:"name",kind:"scalar",T:9},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"architecture",kind:"scalar",T:9}])}}let nN=new nP;class nO extends tv{constructor(){super("stream.video.sfu.models.Browser",[{no:1,name:"name",kind:"scalar",T:9},{no:2,name:"version",kind:"scalar",T:9}])}}let nD=new nO;class nA extends tv{constructor(){super("stream.video.sfu.models.RTMPIngress",[{no:1,name:"width",kind:"scalar",T:13},{no:2,name:"height",kind:"scalar",T:13},{no:3,name:"frame_rate",kind:"scalar",T:1},{no:4,name:"software",kind:"scalar",T:9},{no:5,name:"version",kind:"scalar",T:9},{no:6,name:"encoder",kind:"scalar",T:9},{no:7,name:"remote_addr",kind:"scalar",T:9}])}}let nj=new nA;class nL extends tv{constructor(){super("stream.video.sfu.models.Device",[{no:1,name:"name",kind:"scalar",T:9},{no:2,name:"version",kind:"scalar",T:9}])}}let nU=new nL;class nM extends tv{constructor(){super("stream.video.sfu.models.Call",[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:9},{no:3,name:"created_by_user_id",kind:"scalar",T:9},{no:4,name:"host_user_id",kind:"scalar",T:9},{no:5,name:"custom",kind:"message",T:()=>i6},{no:6,name:"created_at",kind:"message",T:()=>nt},{no:7,name:"updated_at",kind:"message",T:()=>nt}])}}let nF=new nM;class n$ extends tv{constructor(){super("stream.video.sfu.models.CallGrants",[{no:1,name:"can_publish_audio",kind:"scalar",T:8},{no:2,name:"can_publish_video",kind:"scalar",T:8},{no:3,name:"can_screenshare",kind:"scalar",T:8}])}}let nV=new n$;class nB extends tv{constructor(){super("stream.video.sfu.models.InputDevices",[{no:1,name:"available_devices",kind:"scalar",repeat:2,T:9},{no:2,name:"current_device",kind:"scalar",T:9},{no:3,name:"is_permitted",kind:"scalar",T:8}])}}let nH=new nB;class nq extends tv{constructor(){super("stream.video.sfu.models.AndroidState",[{no:1,name:"thermal_state",kind:"enum",T:()=>["stream.video.sfu.models.AndroidThermalState",_,"ANDROID_THERMAL_STATE_"]},{no:2,name:"is_power_saver_mode",kind:"scalar",T:8}])}}let nW=new nq;class nG extends tv{constructor(){super("stream.video.sfu.models.AppleState",[{no:1,name:"thermal_state",kind:"enum",T:()=>["stream.video.sfu.models.AppleThermalState",R,"APPLE_THERMAL_STATE_"]},{no:2,name:"is_low_power_mode_enabled",kind:"scalar",T:8}])}}let nJ=new nG;class nK extends tv{constructor(){super("stream.video.sfu.models.PerformanceStats",[{no:1,name:"track_type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",y,"TRACK_TYPE_"]},{no:2,name:"codec",kind:"message",T:()=>nw},{no:3,name:"avg_frame_time_ms",kind:"scalar",T:2},{no:4,name:"avg_fps",kind:"scalar",T:2},{no:5,name:"video_dimension",kind:"message",T:()=>np},{no:6,name:"target_bitrate",kind:"scalar",T:5}])}}let nz=new nK;var nY=Object.freeze({__proto__:null,AndroidState:nW,get AndroidThermalState(){return _},AppleState:nJ,get AppleThermalState(){return R},Browser:nD,Call:nF,get CallEndedReason(){return T},CallGrants:nV,CallState:nn,ClientDetails:nR,Codec:nw,get ConnectionQuality(){return v},Device:nU,Error:nE,get ErrorCode(){return S},get GoAwayReason(){return C},ICETrickle:nk,InputDevices:nH,OS:nN,Participant:nc,ParticipantCount:ns,get PeerType(){return g},PerformanceStats:nz,Pin:no,PublishOption:ny,RTMPIngress:nj,Sdk:nx,get SdkType(){return w},StreamQuality:nd,SubscribeOption:nv,TrackInfo:nT,get TrackType(){return y},get TrackUnpublishReason(){return k},VideoDimension:np,VideoLayer:nm,get VideoQuality(){return b},get WebsocketReconnectStrategy(){return E}});class nX extends tv{constructor(){super("stream.video.sfu.signal.StartNoiseCancellationRequest",[{no:1,name:"session_id",kind:"scalar",T:9}])}}let nZ=new nX;class nQ extends tv{constructor(){super("stream.video.sfu.signal.StartNoiseCancellationResponse",[{no:1,name:"error",kind:"message",T:()=>nE}])}}let n0=new nQ;class n1 extends tv{constructor(){super("stream.video.sfu.signal.StopNoiseCancellationRequest",[{no:1,name:"session_id",kind:"scalar",T:9}])}}let n2=new n1;class n3 extends tv{constructor(){super("stream.video.sfu.signal.StopNoiseCancellationResponse",[{no:1,name:"error",kind:"message",T:()=>nE}])}}let n4=new n3;class n6 extends tv{constructor(){super("stream.video.sfu.signal.Reconnection",[{no:1,name:"time_seconds",kind:"scalar",T:2},{no:2,name:"strategy",kind:"enum",T:()=>["stream.video.sfu.models.WebsocketReconnectStrategy",E,"WEBSOCKET_RECONNECT_STRATEGY_"]}])}}let n5=new n6;class n9 extends tv{constructor(){super("stream.video.sfu.signal.Telemetry",[{no:1,name:"connection_time_seconds",kind:"scalar",oneof:"data",T:2},{no:2,name:"reconnection",kind:"message",oneof:"data",T:()=>n5}])}}let n8=new n9;class n7 extends tv{constructor(){super("stream.video.sfu.signal.SendStatsRequest",[{no:1,name:"session_id",kind:"scalar",T:9},{no:2,name:"subscriber_stats",kind:"scalar",T:9},{no:3,name:"publisher_stats",kind:"scalar",T:9},{no:4,name:"webrtc_version",kind:"scalar",T:9},{no:5,name:"sdk",kind:"scalar",T:9},{no:6,name:"sdk_version",kind:"scalar",T:9},{no:7,name:"audio_devices",kind:"message",T:()=>nH},{no:8,name:"video_devices",kind:"message",T:()=>nH},{no:9,name:"android",kind:"message",oneof:"deviceState",T:()=>nW},{no:10,name:"apple",kind:"message",oneof:"deviceState",T:()=>nJ},{no:11,name:"telemetry",kind:"message",T:()=>n8},{no:12,name:"rtmp",kind:"message",T:()=>nj},{no:13,name:"subscriber_rtc_stats",kind:"scalar",T:9},{no:14,name:"publisher_rtc_stats",kind:"scalar",T:9},{no:15,name:"rtc_stats",kind:"scalar",T:9},{no:16,name:"encode_stats",kind:"message",repeat:1,T:()=>nz},{no:17,name:"decode_stats",kind:"message",repeat:1,T:()=>nz},{no:18,name:"unified_session_id",kind:"scalar",T:9}])}}let re=new n7;class rt extends tv{constructor(){super("stream.video.sfu.signal.SendStatsResponse",[{no:1,name:"error",kind:"message",T:()=>nE}])}}let ri=new rt;class rn extends tv{constructor(){super("stream.video.sfu.signal.ICERestartRequest",[{no:1,name:"session_id",kind:"scalar",T:9},{no:2,name:"peer_type",kind:"enum",T:()=>["stream.video.sfu.models.PeerType",g,"PEER_TYPE_"]}])}}let rr=new rn;class rs extends tv{constructor(){super("stream.video.sfu.signal.ICERestartResponse",[{no:1,name:"error",kind:"message",T:()=>nE}])}}let ra=new rs;class ro extends tv{constructor(){super("stream.video.sfu.signal.UpdateMuteStatesRequest",[{no:1,name:"session_id",kind:"scalar",T:9},{no:3,name:"mute_states",kind:"message",repeat:1,T:()=>rh}])}}let rl=new ro;class rc extends tv{constructor(){super("stream.video.sfu.signal.UpdateMuteStatesResponse",[{no:4,name:"error",kind:"message",T:()=>nE}])}}let ru=new rc;class rd extends tv{constructor(){super("stream.video.sfu.signal.TrackMuteState",[{no:1,name:"track_type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",y,"TRACK_TYPE_"]},{no:2,name:"muted",kind:"scalar",T:8}])}}let rh=new rd;class rp extends tv{constructor(){super("stream.video.sfu.signal.AudioMuteChanged",[{no:1,name:"muted",kind:"scalar",T:8}])}}new rp;class rf extends tv{constructor(){super("stream.video.sfu.signal.VideoMuteChanged",[{no:2,name:"muted",kind:"scalar",T:8}])}}new rf;class rm extends tv{constructor(){super("stream.video.sfu.signal.UpdateSubscriptionsRequest",[{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"tracks",kind:"message",repeat:1,T:()=>rS}])}}let rg=new rm;class rv extends tv{constructor(){super("stream.video.sfu.signal.UpdateSubscriptionsResponse",[{no:4,name:"error",kind:"message",T:()=>nE}])}}let rb=new rv;class ry extends tv{constructor(){super("stream.video.sfu.signal.TrackSubscriptionDetails",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"track_type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",y,"TRACK_TYPE_"]},{no:4,name:"dimension",kind:"message",T:()=>np}])}}let rS=new ry;class rw extends tv{constructor(){super("stream.video.sfu.signal.SendAnswerRequest",[{no:1,name:"peer_type",kind:"enum",T:()=>["stream.video.sfu.models.PeerType",g,"PEER_TYPE_"]},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"session_id",kind:"scalar",T:9}])}}let rk=new rw;class rC extends tv{constructor(){super("stream.video.sfu.signal.SendAnswerResponse",[{no:4,name:"error",kind:"message",T:()=>nE}])}}let rT=new rC;class rE extends tv{constructor(){super("stream.video.sfu.signal.ICETrickleResponse",[{no:4,name:"error",kind:"message",T:()=>nE}])}}let r_=new rE;class rR extends tv{constructor(){super("stream.video.sfu.signal.SetPublisherRequest",[{no:1,name:"sdp",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"tracks",kind:"message",repeat:1,T:()=>nT}])}}let rI=new rR;class rx extends tv{constructor(){super("stream.video.sfu.signal.SetPublisherResponse",[{no:1,name:"sdp",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"ice_restart",kind:"scalar",T:8},{no:4,name:"error",kind:"message",T:()=>nE}])}}let rP=new tb("stream.video.sfu.signal.SignalServer",[{name:"SetPublisher",options:{},I:rI,O:new rx},{name:"SendAnswer",options:{},I:rk,O:rT},{name:"IceTrickle",options:{},I:nk,O:r_},{name:"UpdateSubscriptions",options:{},I:rg,O:rb},{name:"UpdateMuteStates",options:{},I:rl,O:ru},{name:"IceRestart",options:{},I:rr,O:ra},{name:"SendStats",options:{},I:re,O:ri},{name:"StartNoiseCancellation",options:{},I:nZ,O:n0},{name:"StopNoiseCancellation",options:{},I:n2,O:n4}]);class rN extends tv{constructor(){super("stream.video.sfu.event.SfuEvent",[{no:1,name:"subscriber_offer",kind:"message",oneof:"eventPayload",T:()=>sl},{no:2,name:"publisher_answer",kind:"message",oneof:"eventPayload",T:()=>su},{no:3,name:"connection_quality_changed",kind:"message",oneof:"eventPayload",T:()=>sh},{no:4,name:"audio_level_changed",kind:"message",oneof:"eventPayload",T:()=>sS},{no:5,name:"ice_trickle",kind:"message",oneof:"eventPayload",T:()=>nk},{no:6,name:"change_publish_quality",kind:"message",oneof:"eventPayload",T:()=>sI},{no:10,name:"participant_joined",kind:"message",oneof:"eventPayload",T:()=>si},{no:11,name:"participant_left",kind:"message",oneof:"eventPayload",T:()=>sr},{no:12,name:"dominant_speaker_changed",kind:"message",oneof:"eventPayload",T:()=>sg},{no:13,name:"join_response",kind:"message",oneof:"eventPayload",T:()=>se},{no:14,name:"health_check_response",kind:"message",oneof:"eventPayload",T:()=>rZ},{no:16,name:"track_published",kind:"message",oneof:"eventPayload",T:()=>r0},{no:17,name:"track_unpublished",kind:"message",oneof:"eventPayload",T:()=>r2},{no:18,name:"error",kind:"message",oneof:"eventPayload",T:()=>rV},{no:19,name:"call_grants_updated",kind:"message",oneof:"eventPayload",T:()=>sP},{no:20,name:"go_away",kind:"message",oneof:"eventPayload",T:()=>sO},{no:21,name:"ice_restart",kind:"message",oneof:"eventPayload",T:()=>rq},{no:22,name:"pins_updated",kind:"message",oneof:"eventPayload",T:()=>rF},{no:23,name:"call_ended",kind:"message",oneof:"eventPayload",T:()=>sA},{no:24,name:"participant_updated",kind:"message",oneof:"eventPayload",T:()=>sa},{no:25,name:"participant_migration_complete",kind:"message",oneof:"eventPayload",T:()=>rU},{no:27,name:"change_publish_options",kind:"message",oneof:"eventPayload",T:()=>rA}])}}let rO=new rN;class rD extends tv{constructor(){super("stream.video.sfu.event.ChangePublishOptions",[{no:1,name:"publish_options",kind:"message",repeat:1,T:()=>ny},{no:2,name:"reason",kind:"scalar",T:9}])}}let rA=new rD;class rj extends tv{constructor(){super("stream.video.sfu.event.ChangePublishOptionsComplete",[])}}new rj;class rL extends tv{constructor(){super("stream.video.sfu.event.ParticipantMigrationComplete",[])}}let rU=new rL;class rM extends tv{constructor(){super("stream.video.sfu.event.PinsChanged",[{no:1,name:"pins",kind:"message",repeat:1,T:()=>no}])}}let rF=new rM;class r$ extends tv{constructor(){super("stream.video.sfu.event.Error",[{no:4,name:"error",kind:"message",T:()=>nE},{no:5,name:"reconnect_strategy",kind:"enum",T:()=>["stream.video.sfu.models.WebsocketReconnectStrategy",E,"WEBSOCKET_RECONNECT_STRATEGY_"]}])}}let rV=new r$;class rB extends tv{constructor(){super("stream.video.sfu.event.ICETrickle",[{no:1,name:"peer_type",kind:"enum",T:()=>["stream.video.sfu.models.PeerType",g,"PEER_TYPE_"]},{no:2,name:"ice_candidate",kind:"scalar",T:9}])}}new rB;class rH extends tv{constructor(){super("stream.video.sfu.event.ICERestart",[{no:1,name:"peer_type",kind:"enum",T:()=>["stream.video.sfu.models.PeerType",g,"PEER_TYPE_"]}])}}let rq=new rH;class rW extends tv{constructor(){super("stream.video.sfu.event.SfuRequest",[{no:1,name:"join_request",kind:"message",oneof:"requestPayload",T:()=>r4},{no:2,name:"health_check_request",kind:"message",oneof:"requestPayload",T:()=>rY},{no:3,name:"leave_call_request",kind:"message",oneof:"requestPayload",T:()=>rK}])}}let rG=new rW;class rJ extends tv{constructor(){super("stream.video.sfu.event.LeaveCallRequest",[{no:1,name:"session_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9}])}}let rK=new rJ;class rz extends tv{constructor(){super("stream.video.sfu.event.HealthCheckRequest",[])}}let rY=new rz;class rX extends tv{constructor(){super("stream.video.sfu.event.HealthCheckResponse",[{no:1,name:"participant_count",kind:"message",T:()=>ns}])}}let rZ=new rX;class rQ extends tv{constructor(){super("stream.video.sfu.event.TrackPublished",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",y,"TRACK_TYPE_"]},{no:4,name:"participant",kind:"message",T:()=>nc}])}}let r0=new rQ;class r1 extends tv{constructor(){super("stream.video.sfu.event.TrackUnpublished",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",y,"TRACK_TYPE_"]},{no:4,name:"cause",kind:"enum",T:()=>["stream.video.sfu.models.TrackUnpublishReason",k,"TRACK_UNPUBLISH_REASON_"]},{no:5,name:"participant",kind:"message",T:()=>nc}])}}let r2=new r1;class r3 extends tv{constructor(){super("stream.video.sfu.event.JoinRequest",[{no:1,name:"token",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"subscriber_sdp",kind:"scalar",T:9},{no:8,name:"publisher_sdp",kind:"scalar",T:9},{no:4,name:"client_details",kind:"message",T:()=>nR},{no:5,name:"migration",kind:"message",T:()=>r8},{no:6,name:"fast_reconnect",kind:"scalar",T:8},{no:7,name:"reconnect_details",kind:"message",T:()=>r5},{no:9,name:"preferred_publish_options",kind:"message",repeat:1,T:()=>ny},{no:10,name:"preferred_subscribe_options",kind:"message",repeat:1,T:()=>nv}])}}let r4=new r3;class r6 extends tv{constructor(){super("stream.video.sfu.event.ReconnectDetails",[{no:1,name:"strategy",kind:"enum",T:()=>["stream.video.sfu.models.WebsocketReconnectStrategy",E,"WEBSOCKET_RECONNECT_STRATEGY_"]},{no:3,name:"announced_tracks",kind:"message",repeat:1,T:()=>nT},{no:4,name:"subscriptions",kind:"message",repeat:1,T:()=>rS},{no:5,name:"reconnect_attempt",kind:"scalar",T:13},{no:6,name:"from_sfu_id",kind:"scalar",T:9},{no:7,name:"previous_session_id",kind:"scalar",T:9},{no:8,name:"reason",kind:"scalar",T:9}])}}let r5=new r6;class r9 extends tv{constructor(){super("stream.video.sfu.event.Migration",[{no:1,name:"from_sfu_id",kind:"scalar",T:9},{no:2,name:"announced_tracks",kind:"message",repeat:1,T:()=>nT},{no:3,name:"subscriptions",kind:"message",repeat:1,T:()=>rS}])}}let r8=new r9;class r7 extends tv{constructor(){super("stream.video.sfu.event.JoinResponse",[{no:1,name:"call_state",kind:"message",T:()=>nn},{no:2,name:"reconnected",kind:"scalar",T:8},{no:3,name:"fast_reconnect_deadline_seconds",kind:"scalar",T:5},{no:4,name:"publish_options",kind:"message",repeat:1,T:()=>ny}])}}let se=new r7;class st extends tv{constructor(){super("stream.video.sfu.event.ParticipantJoined",[{no:1,name:"call_cid",kind:"scalar",T:9},{no:2,name:"participant",kind:"message",T:()=>nc}])}}let si=new st;class sn extends tv{constructor(){super("stream.video.sfu.event.ParticipantLeft",[{no:1,name:"call_cid",kind:"scalar",T:9},{no:2,name:"participant",kind:"message",T:()=>nc}])}}let sr=new sn;class ss extends tv{constructor(){super("stream.video.sfu.event.ParticipantUpdated",[{no:1,name:"call_cid",kind:"scalar",T:9},{no:2,name:"participant",kind:"message",T:()=>nc}])}}let sa=new ss;class so extends tv{constructor(){super("stream.video.sfu.event.SubscriberOffer",[{no:1,name:"ice_restart",kind:"scalar",T:8},{no:2,name:"sdp",kind:"scalar",T:9}])}}let sl=new so;class sc extends tv{constructor(){super("stream.video.sfu.event.PublisherAnswer",[{no:1,name:"sdp",kind:"scalar",T:9}])}}let su=new sc;class sd extends tv{constructor(){super("stream.video.sfu.event.ConnectionQualityChanged",[{no:1,name:"connection_quality_updates",kind:"message",repeat:1,T:()=>sf}])}}let sh=new sd;class sp extends tv{constructor(){super("stream.video.sfu.event.ConnectionQualityInfo",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"connection_quality",kind:"enum",T:()=>["stream.video.sfu.models.ConnectionQuality",v,"CONNECTION_QUALITY_"]}])}}let sf=new sp;class sm extends tv{constructor(){super("stream.video.sfu.event.DominantSpeakerChanged",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9}])}}let sg=new sm;class sv extends tv{constructor(){super("stream.video.sfu.event.AudioLevel",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"level",kind:"scalar",T:2},{no:4,name:"is_speaking",kind:"scalar",T:8}])}}let sb=new sv;class sy extends tv{constructor(){super("stream.video.sfu.event.AudioLevelChanged",[{no:1,name:"audio_levels",kind:"message",repeat:1,T:()=>sb}])}}let sS=new sy;class sw extends tv{constructor(){super("stream.video.sfu.event.AudioSender",[{no:2,name:"codec",kind:"message",T:()=>nw},{no:3,name:"track_type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",y,"TRACK_TYPE_"]},{no:4,name:"publish_option_id",kind:"scalar",T:5}])}}let sk=new sw;class sC extends tv{constructor(){super("stream.video.sfu.event.VideoLayerSetting",[{no:1,name:"name",kind:"scalar",T:9},{no:2,name:"active",kind:"scalar",T:8},{no:3,name:"max_bitrate",kind:"scalar",T:5},{no:4,name:"scale_resolution_down_by",kind:"scalar",T:2},{no:6,name:"codec",kind:"message",T:()=>nw},{no:7,name:"max_framerate",kind:"scalar",T:13},{no:8,name:"scalability_mode",kind:"scalar",T:9}])}}let sT=new sC;class sE extends tv{constructor(){super("stream.video.sfu.event.VideoSender",[{no:2,name:"codec",kind:"message",T:()=>nw},{no:3,name:"layers",kind:"message",repeat:1,T:()=>sT},{no:4,name:"track_type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",y,"TRACK_TYPE_"]},{no:5,name:"publish_option_id",kind:"scalar",T:5}])}}let s_=new sE;class sR extends tv{constructor(){super("stream.video.sfu.event.ChangePublishQuality",[{no:1,name:"audio_senders",kind:"message",repeat:1,T:()=>sk},{no:2,name:"video_senders",kind:"message",repeat:1,T:()=>s_}])}}let sI=new sR;class sx extends tv{constructor(){super("stream.video.sfu.event.CallGrantsUpdated",[{no:1,name:"current_grants",kind:"message",T:()=>nV},{no:2,name:"message",kind:"scalar",T:9}])}}let sP=new sx;class sN extends tv{constructor(){super("stream.video.sfu.event.GoAway",[{no:1,name:"reason",kind:"enum",T:()=>["stream.video.sfu.models.GoAwayReason",C,"GO_AWAY_REASON_"]}])}}let sO=new sN;class sD extends tv{constructor(){super("stream.video.sfu.event.CallEnded",[{no:1,name:"reason",kind:"enum",T:()=>["stream.video.sfu.models.CallEndedReason",T,"CALL_ENDED_REASON_"]}])}}let sA=new sD;!function(e){e.UNKNOWN="UNKNOWN",e.VISIBLE="VISIBLE",e.INVISIBLE="INVISIBLE"}(I||(I={})),function(e){e[e.IMMEDIATE=20]="IMMEDIATE",e[e.FAST=100]="FAST",e[e.MEDIUM=600]="MEDIUM",e[e.SLOW=1200]="SLOW"}(x||(x={}));class sj{constructor(e){this._transport=e,this.typeName=rP.typeName,this.methods=rP.methods,this.options=rP.options}setPublisher(e,t){let i=this.methods[0],n=this._transport.mergeOptions(t);return ty("unary",this._transport,i,n,e)}sendAnswer(e,t){let i=this.methods[1],n=this._transport.mergeOptions(t);return ty("unary",this._transport,i,n,e)}iceTrickle(e,t){let i=this.methods[2],n=this._transport.mergeOptions(t);return ty("unary",this._transport,i,n,e)}updateSubscriptions(e,t){let i=this.methods[3],n=this._transport.mergeOptions(t);return ty("unary",this._transport,i,n,e)}updateMuteStates(e,t){let i=this.methods[4],n=this._transport.mergeOptions(t);return ty("unary",this._transport,i,n,e)}iceRestart(e,t){let i=this.methods[5],n=this._transport.mergeOptions(t);return ty("unary",this._transport,i,n,e)}sendStats(e,t){let i=this.methods[6],n=this._transport.mergeOptions(t);return ty("unary",this._transport,i,n,e)}startNoiseCancellation(e,t){let i=this.methods[7],n=this._transport.mergeOptions(t);return ty("unary",this._transport,i,n,e)}stopNoiseCancellation(e,t){let i=this.methods[8],n=this._transport.mergeOptions(t);return ty("unary",this._transport,i,n,e)}}let sL={baseUrl:"",sendJson:!0,timeout:5e3,jsonOptions:{ignoreUnknownFields:!0}},sU=e=>({interceptUnary:(t,i,n,r)=>(r.meta={...r.meta,...e},t(i,n,r))}),sM=(e,t)=>({interceptUnary:(i,n,r,s)=>{let a=i(n,r,s);return e(t,`Invoked SFU RPC method ${n.name}`,{request:a.request,headers:a.requestHeaders,response:a.response}),a}}),sF=e=>{let t=(t,i,n)=>e(`${t}OnFailure`,[n,i]),i={SendStats:!0};return{interceptUnary(n,r,s,a){if(i[r.name])return n(r,s,a);e(r.name,s);let o=n(r,s,a);return o.then(e=>{let i=e.response?.error;i&&t(r.name,s,i)},e=>t(r.name,s,e)),o}}},s$=e=>new sj(new tE({...sL,...e})),sV=e=>new Promise(t=>setTimeout(t,e));function sB(e){return e&&("[object Function]"===Object.prototype.toString.call(e)||"function"==typeof e||e instanceof Function)}let sH={TOKEN_EXPIRED:40,WS_CLOSED_SUCCESS:1e3};function sq(e){let t=Math.min(500+2e3*e,5e3),i=Math.min(Math.max(250,(e-1)*2e3),5e3);return Math.floor(Math.random()*(t-i)+i)}function sW(e){let t="";for(let i=0;i<e.length;i++)t+=e[i].toString(16).padStart(2,"0");return t}function sG(){let e=function(e){let t=new Uint8Array(16);return sJ(t),t}(16);return e[6]=15&e[6]|64,e[8]=191&e[8]|128,[sW(e.subarray(0,4)),sW(e.subarray(4,6)),sW(e.subarray(6,8)),sW(e.subarray(8,10)),sW(e.subarray(10,16))].join("-")}let sJ="undefined"!=typeof crypto&&crypto.getRandomValues?crypto.getRandomValues.bind(crypto):function(e){let t=Math.pow(2,8*e.byteLength/e.length);for(let i=0;i<e.length;i++)e[i]=Math.random()*t};function sK(e){}function sz(e){}let sY=()=>"undefined"!=typeof navigator&&navigator.product?.toLowerCase()==="reactnative",sX=Object.freeze({trace:0,debug:1,info:2,warn:3,error:4}),sZ="info",sQ=(e,t,...i)=>{let n;switch(e){case"error":if(sY()){t=`ERROR: ${t}`,n=console.info;break}n=console.error;break;case"warn":if(sY()){t=`WARN: ${t}`,n=console.info;break}n=console.warn;break;case"info":n=console.info;break;case"trace":n=console.trace;break;default:n=console.log}n(t,...i)},s0=(e,t)=>{r=e,t&&s1(t)},s1=e=>{sZ=e},s2=()=>sZ,s3=e=>{let t=r||sQ,i=(e||[]).filter(Boolean).join(":");return(e,n,...r)=>{sX[e]>=sX[sZ]&&t(e,`[${i}]: ${n}`,...r)}},s4=async(e,t)=>{let i,n=0;do{n>0&&await sV(sq(n));try{i=await e()}catch(r){let e=r instanceof tS&&r.code===p[p.cancelled],i=t?.aborted??!1;if(e||i)throw r;s3(["sfu-client","rpc"])("debug",`rpc failed (${n})`,r),n++}}while(!i||i.response.error?.shouldRetry);return i},s6=async e=>{let t=new RTCPeerConnection;t.addTransceiver("video",{direction:e}),t.addTransceiver("audio",{direction:e});let i=(await t.createOffer()).sdp??"";return t.getTransceivers().forEach(e=>{e.stop?.()}),t.close(),i},s5=e=>!!e&&("vp9"===(e=e.toLowerCase())||"av1"===e||"video/vp9"===e||"video/av1"===e),s9={subscriberOffer:void 0,publisherAnswer:void 0,connectionQualityChanged:void 0,audioLevelChanged:void 0,iceTrickle:void 0,changePublishQuality:void 0,participantJoined:void 0,participantLeft:void 0,dominantSpeakerChanged:void 0,joinResponse:void 0,healthCheckResponse:void 0,trackPublished:void 0,trackUnpublished:void 0,error:void 0,callGrantsUpdated:void 0,goAway:void 0,iceRestart:void 0,pinsUpdated:void 0,callEnded:void 0,participantUpdated:void 0,participantMigrationComplete:void 0,changePublishOptions:void 0},s8=e=>Object.prototype.hasOwnProperty.call(s9,e);class s7{constructor(){this.logger=s3(["Dispatcher"]),this.subscribers={},this.dispatch=(e,t="0")=>{let i=e.eventPayload.oneofKind;if(!i)return;let n=e.eventPayload[i];this.logger("debug",`Dispatching ${i}, tag=${t}`,n);let r=this.subscribers[i];if(r)for(let e of r)try{e(n)}catch(e){this.logger("warn","Listener failed with error",e)}},this.on=(e,t)=>{var i;return((i=this.subscribers)[e]??(i[e]=[])).push(t),()=>{this.off(e,t)}},this.off=(e,t)=>{this.subscribers[e]=(this.subscribers[e]||[]).filter(e=>e!==t)}}}class ae{constructor(){this.subscriberCandidates=new t6,this.publisherCandidates=new t6,this.push=e=>{let t=at(e);t&&(e.peerType===g.SUBSCRIBER?this.subscriberCandidates.next(t):e.peerType===g.PUBLISHER_UNSPECIFIED?this.publisherCandidates.next(t):s3(["sfu-client"])("warn","ICETrickle, Unknown peer type",e))},this.dispose=()=>{this.subscriberCandidates.complete(),this.publisherCandidates.complete()}}}let at=e=>{try{return JSON.parse(e.iceCandidate)}catch(t){s3(["sfu-client"])("error","Failed to parse ICE Trickle",t,e);return}},ai=aa(function(e,t){let i=!1;return{cb:()=>t().finally(()=>{i||ar.delete(e)}),onContinued:()=>i=!0}}),an=aa(function(e,t){let i=new AbortController;return{cb:()=>i.signal.aborted?Promise.resolve("canceled"):t(i.signal).finally(()=>{i.signal.aborted||ar.delete(e)}),onContinued:()=>i.abort()}}),ar=new Map;async function as(e){let t;for(;t=ar.get(e);)await t.promise}function aa(e){return function(t,i){let{cb:n,onContinued:r}=e(t,i),s=ar.get(t);s?.onContinued();let a=s?s.promise.then(n,n):n();return ar.set(t,{promise:a,onContinued:r}),a}}let ao=e=>"function"==typeof e,al=e=>{let t,i;if(iE([e]).subscribe({next:([e])=>{t=e},error:e=>{i=e}}).unsubscribe(),i)throw i;return t},ac=(e,t)=>{let i=ao(t)?t(al(e)):t;return e.next(i),i},au=(e,t)=>{let i=e.getValue();return{lastValue:i,value:ac(e,t),rollback:()=>ac(e,i)}},ad=(e,t,i=e=>s3(["RxUtils"])("warn","An observable emitted an error",e))=>{let n=e.subscribe({next:t,error:i});return()=>{n.unsubscribe()}},ah=(e,t)=>{let i=Symbol();return ad(e,e=>{ai(i,()=>t(e))})};var ap=Object.freeze({__proto__:null,createSafeAsyncSubscription:ah,createSubscription:ad,getCurrentValue:al,setCurrentValue:ac,updateValue:au});!function(e){e.UNKNOWN="unknown",e.IDLE="idle",e.RINGING="ringing",e.JOINING="joining",e.JOINED="joined",e.LEFT="left",e.RECONNECTING="reconnecting",e.MIGRATING="migrating",e.RECONNECTING_FAILED="reconnecting-failed",e.OFFLINE="offline"}(P||(P={}));class af{constructor(){this.connectedUserSubject=new iR(void 0),this.callsSubject=new iR([]),this.setConnectedUser=e=>ac(this.connectedUserSubject,e),this.setCalls=e=>ac(this.callsSubject,e),this.registerCall=e=>{this.calls.find(t=>t.cid===e.cid)||this.setCalls(t=>[...t,e])},this.unregisterCall=e=>(s3(["client-state"])("trace",`Unregistering call: ${e.cid}`),this.setCalls(t=>t.filter(t=>t!==e))),this.findCall=(e,t)=>this.calls.find(i=>i.type===e&&i.id===t),this.connectedUserSubject.subscribe(async e=>{if(!e){let e=s3(["client-state"]);for(let t of this.calls)t.state.callingState!==P.LEFT&&(e("info",`User disconnected, leaving call: ${t.cid}`),await t.leave({message:"client.disconnectUser() called"}).catch(i=>{e("error",`Error leaving call: ${t.cid}`,i)}))}})}get connectedUser(){return al(this.connectedUserSubject)}get calls(){return al(this.callsSubject)}}class am{constructor(e){this.getCurrentValue=al,this.connectedUser$=e.connectedUserSubject.asObservable(),this.calls$=e.callsSubject.asObservable()}get connectedUser(){return al(this.connectedUser$)}get calls(){return al(this.calls$)}}let ag=(...e)=>(t,i)=>{for(let n of e){let e=n(t,i);if(0!==e)return e}return 0},av=e=>t=>(i,n)=>e(i,n)?t(i,n):0,ab=e=>e.publishedTracks.includes(y.VIDEO),ay=e=>e.publishedTracks.includes(y.AUDIO),aS=e=>e.publishedTracks.includes(y.SCREEN_SHARE),aw=e=>e.publishedTracks.includes(y.SCREEN_SHARE_AUDIO),ak=e=>!!e.pin&&(e.pin.isLocalPin||e.pin.pinnedAt>0),aC=(e,t)=>e.isDominantSpeaker&&!t.isDominantSpeaker?-1:!e.isDominantSpeaker&&t.isDominantSpeaker?1:0,aT=(e,t)=>e.isSpeaking&&!t.isSpeaking?-1:!e.isSpeaking&&t.isSpeaking?1:0,aE=(e,t)=>aS(e)&&!aS(t)?-1:!aS(e)&&aS(t)?1:0,a_=(e,t)=>ab(e)&&!ab(t)?-1:!ab(e)&&ab(t)?1:0,aR=(e,t)=>ay(e)&&!ay(t)?-1:!ay(e)&&ay(t)?1:0,aI=(e,t)=>{if(e.pin&&t.pin){if(!e.pin.isLocalPin&&t.pin.isLocalPin)return -1;if(e.pin.isLocalPin&&!t.pin.isLocalPin)return 1;if(e.pin.pinnedAt>t.pin.pinnedAt)return -1;if(e.pin.pinnedAt<t.pin.pinnedAt)return 1}return e.pin&&!t.pin?-1:!e.pin&&t.pin?1:0},ax=e=>(t,i)=>t.reaction?.type===e&&i.reaction?.type!==e?-1:+(t.reaction?.type!==e&&i.reaction?.type===e),aP=(e,t)=>(e.roles||[]).some(e=>t.includes(e)),aN=av((e,t)=>e.viewportVisibilityState?.videoTrack===I.INVISIBLE||t.viewportVisibilityState?.videoTrack===I.INVISIBLE),aO=av((e,t)=>e.viewportVisibilityState?.videoTrack===I.INVISIBLE||e.viewportVisibilityState?.videoTrack===I.UNKNOWN||t.viewportVisibilityState?.videoTrack===I.INVISIBLE||t.viewportVisibilityState?.videoTrack===I.UNKNOWN),aD=ag(aI,aE,aN(ag(aC,aT,ax("raised-hand"),a_,aR))),aA=ag(aI,aE,aC,aN(ag(aT,ax("raised-hand"),a_,aR))),aj=ag(aI,aO(ag(aC,aT,ax("raised-hand"),a_,aR))),aL=ag(aN(ag(aC,aT,ax("raised-hand"),a_,aR)),((...e)=>(t,i)=>aP(t,e)&&!aP(i,e)?-1:!aP(t,e)&&aP(i,e)?1:0)("admin","host","speaker")),aU={broadcasting:!1,hls:{playlist_url:"",status:""},rtmps:[]};class aM{constructor(){this.backstageSubject=new iR(!0),this.blockedUserIdsSubject=new iR([]),this.createdAtSubject=new iR(new Date),this.endedAtSubject=new iR(void 0),this.startsAtSubject=new iR(void 0),this.updatedAtSubject=new iR(new Date),this.createdBySubject=new iR(void 0),this.customSubject=new iR({}),this.egressSubject=new iR(void 0),this.ingressSubject=new iR(void 0),this.recordingSubject=new iR(!1),this.sessionSubject=new iR(void 0),this.settingsSubject=new iR(void 0),this.transcribingSubject=new iR(!1),this.captioningSubject=new iR(!1),this.endedBySubject=new iR(void 0),this.thumbnailsSubject=new iR(void 0),this.membersSubject=new iR([]),this.ownCapabilitiesSubject=new iR([]),this.callingStateSubject=new iR(P.UNKNOWN),this.startedAtSubject=new iR(void 0),this.participantCountSubject=new iR(0),this.anonymousParticipantCountSubject=new iR(0),this.participantsSubject=new iR([]),this.callStatsReportSubject=new iR(void 0),this.closedCaptionsSubject=new iR([]),this.orphanedTracks=[],this.logger=s3(["CallState"]),this.sortParticipantsBy=aD,this.closedCaptionsTasks=new Map,this.dispose=()=>{for(let[e,t]of this.closedCaptionsTasks.entries())clearTimeout(t),this.closedCaptionsTasks.delete(e)},this.setSortParticipantsBy=e=>{this.sortParticipantsBy=e,this.setCurrentValue(this.participantsSubject,e=>e)},this.getCurrentValue=al,this.setCurrentValue=ac,this.setParticipantCount=e=>this.setCurrentValue(this.participantCountSubject,e),this.setStartedAt=e=>this.setCurrentValue(this.startedAtSubject,e),this.setCaptioning=e=>au(this.captioningSubject,e),this.setAnonymousParticipantCount=e=>this.setCurrentValue(this.anonymousParticipantCountSubject,e),this.setParticipants=e=>this.setCurrentValue(this.participantsSubject,e),this.setCallingState=e=>this.setCurrentValue(this.callingStateSubject,e),this.setCallStatsReport=e=>this.setCurrentValue(this.callStatsReportSubject,e),this.setMembers=e=>{this.setCurrentValue(this.membersSubject,e)},this.setOwnCapabilities=e=>this.setCurrentValue(this.ownCapabilitiesSubject,e),this.setBackstage=e=>this.setCurrentValue(this.backstageSubject,e),this.setEndedAt=e=>this.setCurrentValue(this.endedAtSubject,e),this.findParticipantBySessionId=e=>this.participants.find(t=>t.sessionId===e),this.getParticipantLookupBySessionId=()=>this.participants.reduce((e,t)=>(e[t.sessionId]=t,e),{}),this.updateParticipant=(e,t)=>{let i=this.findParticipantBySessionId(e);if(!i)return void this.logger("warn",`Participant with sessionId ${e} not found`);let n="function"==typeof t?t(i):t,r={...i,...n};return this.setParticipants(t=>t.map(t=>t.sessionId===e?r:t))},this.updateOrAddParticipant=(e,t)=>this.setParticipants(i=>{let n=!0,r=i.map(i=>i.sessionId===e?(n=!1,{...i,...t}):i);return n&&r.push(t),r}),this.updateParticipants=e=>0===Object.keys(e).length?this.participants:this.setParticipants(t=>t.map(t=>{let i=e[t.sessionId];return i?{...t,...i}:t})),this.updateParticipantTracks=(e,t)=>this.updateParticipants(Object.entries(t).reduce((t,[i,n])=>{n.dimension&&(n.dimension.height=Math.ceil(n.dimension.height),n.dimension.width=Math.ceil(n.dimension.width));let r="videoTrack"===e?"videoDimension":"screenShareTrack"===e?"screenShareDimension":void 0;return r&&(t[i]={[r]:n.dimension}),t},{})),this.updateFromEvent=e=>{let t=this.eventHandlers[e.type];t&&t(e)},this.setServerSidePins=e=>{let t=e.reduce((e,t)=>(e[t.sessionId]=Date.now(),e),{});return this.setParticipants(e=>e.map(e=>{let i=t[e.sessionId];return i?{...e,pin:{isLocalPin:!1,pinnedAt:i}}:e.pin&&!e.pin.isLocalPin?{...e,pin:void 0}:e}))},this.registerOrphanedTrack=e=>{this.orphanedTracks.push(e)},this.removeOrphanedTrack=e=>{this.orphanedTracks=this.orphanedTracks.filter(t=>t.id!==e)},this.takeOrphanedTracks=e=>{let t=this.orphanedTracks.filter(t=>t.trackLookupPrefix===e);return t.length>0&&(this.orphanedTracks=this.orphanedTracks.filter(t=>t.trackLookupPrefix!==e)),t},this.updateClosedCaptionSettings=e=>{this.closedCaptionsSettings={...this.closedCaptionsSettings,...e}},this.updateFromCallResponse=e=>{this.setBackstage(e.backstage),this.setCurrentValue(this.blockedUserIdsSubject,e.blocked_user_ids),this.setCurrentValue(this.createdAtSubject,new Date(e.created_at)),this.setCurrentValue(this.updatedAtSubject,new Date(e.updated_at)),this.setCurrentValue(this.startsAtSubject,e.starts_at?new Date(e.starts_at):void 0),this.setEndedAt(e.ended_at?new Date(e.ended_at):void 0),this.setCurrentValue(this.createdBySubject,e.created_by),this.setCurrentValue(this.customSubject,e.custom),this.setCurrentValue(this.egressSubject,e.egress),this.setCurrentValue(this.ingressSubject,e.ingress),this.setCurrentValue(this.recordingSubject,e.recording);let t=this.setCurrentValue(this.sessionSubject,e.session);this.updateParticipantCountFromSession(t),this.setCurrentValue(this.settingsSubject,e.settings),this.setCurrentValue(this.transcribingSubject,e.transcribing),this.setCurrentValue(this.captioningSubject,e.captioning),this.setCurrentValue(this.thumbnailsSubject,e.thumbnails)},this.updateFromSfuCallState=(e,t,i)=>{let{participants:n,participantCount:r,startedAt:s,pins:a}=e,o=i?.announcedTracks.map(e=>e.trackType)??[];this.setParticipants(()=>{let e=this.getParticipantLookupBySessionId();return n.map(i=>{let n=e[i.sessionId],r=i.sessionId===t;return Object.assign({},n,i,{isLocalParticipant:r,publishedTracks:r?o:i.publishedTracks,viewportVisibilityState:n?.viewportVisibilityState??{videoTrack:I.UNKNOWN,screenShareTrack:I.UNKNOWN}})})}),this.setParticipantCount(r?.total||0),this.setAnonymousParticipantCount(r?.anonymous||0),this.setStartedAt(s?nt.toDate(s):new Date),this.setServerSidePins(a)},this.updateFromMemberRemoved=e=>{this.updateFromCallResponse(e.call),this.setCurrentValue(this.membersSubject,t=>t.filter(t=>-1===e.members.indexOf(t.user_id)))},this.updateFromMemberAdded=e=>{this.updateFromCallResponse(e.call),this.setCurrentValue(this.membersSubject,t=>[...t,...e.members])},this.updateFromHLSBroadcastStopped=()=>{this.setCurrentValue(this.egressSubject,(e=aU)=>({...e,broadcasting:!1,hls:{...e.hls,status:""}}))},this.updateFromHLSBroadcastingFailed=()=>{this.setCurrentValue(this.egressSubject,(e=aU)=>({...e,broadcasting:!1,hls:{...e.hls,status:""}}))},this.updateParticipantCountFromSession=e=>{if(!e||this.callingState===P.JOINED)return;let t=Math.max(Object.values(e.participants_count_by_role).reduce((e,t)=>e+t,0),e.participants.length);this.setParticipantCount(t),this.setAnonymousParticipantCount(e.anonymous_participant_count||0)},this.updateFromSessionParticipantCountUpdate=e=>{let t=this.setCurrentValue(this.sessionSubject,t=>t?{...t,anonymous_participant_count:e.anonymous_participant_count,participants_count_by_role:e.participants_count_by_role}:t);this.updateParticipantCountFromSession(t)},this.updateFromSessionParticipantLeft=e=>{let t=this.setCurrentValue(this.sessionSubject,t=>{if(!t)return t;let{participants:i,participants_count_by_role:n}=t,{user:r,user_session_id:s}=e.participant;return{...t,participants:i.filter(e=>e.user_session_id!==s),participants_count_by_role:{...n,[r.role]:Math.max(0,(n[r.role]||0)-1)}}});this.updateParticipantCountFromSession(t)},this.updateFromSessionParticipantJoined=e=>{let t=this.setCurrentValue(this.sessionSubject,t=>{if(!t)return t;let{participants:i,participants_count_by_role:n}=t,{user:r,user_session_id:s}=e.participant,a=!0,o=i.map(t=>t.user_session_id===s?(a=!1,e.participant):t);a&&o.push(e.participant);let l=+!!a;return{...t,participants:o,participants_count_by_role:{...n,[r.role]:(n[r.role]||0)+l}}});this.updateParticipantCountFromSession(t)},this.updateMembers=e=>{this.updateFromCallResponse(e.call),this.setCurrentValue(this.membersSubject,t=>t.map(t=>e.members.find(e=>e.user_id===t.user_id)||t))},this.updateParticipantReaction=e=>{let{user:t,custom:i,type:n,emoji_code:r}=e.reaction;this.setParticipants(e=>e.map(e=>e.userId!==t.id?e:{...e,reaction:{type:n,emoji_code:r,custom:i}}))},this.unblockUser=e=>{this.setCurrentValue(this.blockedUserIdsSubject,t=>t?t.filter(t=>t!==e.user.id):t)},this.blockUser=e=>{this.setCurrentValue(this.blockedUserIdsSubject,t=>[...t||[],e.user.id])},this.updateOwnCapabilities=e=>{e.user.id===this.localParticipant?.userId&&this.setCurrentValue(this.ownCapabilitiesSubject,e.own_capabilities)},this.updateFromClosedCaptions=e=>{this.setCurrentValue(this.closedCaptionsSubject,t=>{let{closed_caption:i}=e,n=e=>`${e.speaker_id}/${e.start_time}`,r=n(i);if(t.some(e=>n(e)===r))return t;let s=[...t,i],{visibilityDurationMs:a=2700,maxVisibleCaptions:o=2}=this.closedCaptionsSettings||{};if(a>0){let e=setTimeout(()=>{this.setCurrentValue(this.closedCaptionsSubject,e=>e.filter(e=>e!==i)),this.closedCaptionsTasks.delete(r)},a);this.closedCaptionsTasks.set(r,e);for(let e=0;e<s.length-o;e++){let t=n(s[e]);clearTimeout(this.closedCaptionsTasks.get(t)),this.closedCaptionsTasks.delete(t)}}return s.slice(-o)})},this.participants$=this.participantsSubject.asObservable().pipe(iS(e=>e.sort(this.sortParticipantsBy)),ix({bufferSize:1,refCount:!0})),this.localParticipant$=this.participants$.pipe(iS(e=>e.find(e=>e.isLocalParticipant)),ix({bufferSize:1,refCount:!0})),this.remoteParticipants$=this.participants$.pipe(iS(e=>e.filter(e=>!e.isLocalParticipant)),ix({bufferSize:1,refCount:!0})),this.pinnedParticipants$=this.participants$.pipe(iS(e=>e.filter(e=>!!e.pin)),ix({bufferSize:1,refCount:!0})),this.dominantSpeaker$=this.participants$.pipe(iS(e=>e.find(e=>e.isDominantSpeaker)),ix({bufferSize:1,refCount:!0})),this.hasOngoingScreenShare$=this.participants$.pipe(iS(e=>e.some(e=>aS(e))),iP(),ix({bufferSize:1,refCount:!0})),this.createdAt$=this.createdAtSubject.asObservable(),this.endedAt$=this.endedAtSubject.asObservable(),this.startsAt$=this.startsAtSubject.asObservable(),this.startedAt$=this.startedAtSubject.asObservable(),this.updatedAt$=this.updatedAtSubject.asObservable(),this.callStatsReport$=this.callStatsReportSubject.asObservable(),this.members$=this.membersSubject.asObservable(),this.createdBy$=this.createdBySubject.asObservable(),this.custom$=this.customSubject.asObservable(),this.egress$=this.egressSubject.asObservable(),this.ingress$=this.ingressSubject.asObservable(),this.session$=this.sessionSubject.asObservable(),this.settings$=this.settingsSubject.asObservable(),this.endedBy$=this.endedBySubject.asObservable(),this.thumbnails$=this.thumbnailsSubject.asObservable(),this.closedCaptions$=this.closedCaptionsSubject.asObservable();let e=(e,t)=>{if(e.length!==t.length)return!1;for(let i of e)if(!t.includes(i))return!1;for(let i of t)if(!e.includes(i))return!1;return!0},t=(e,t)=>e.asObservable().pipe(iP(t));this.anonymousParticipantCount$=t(this.anonymousParticipantCountSubject),this.blockedUserIds$=t(this.blockedUserIdsSubject,e),this.backstage$=t(this.backstageSubject),this.callingState$=t(this.callingStateSubject),this.ownCapabilities$=t(this.ownCapabilitiesSubject,e),this.participantCount$=t(this.participantCountSubject),this.recording$=t(this.recordingSubject),this.transcribing$=t(this.transcribingSubject),this.captioning$=t(this.captioningSubject),this.eventHandlers={"call.frame_recording_ready":void 0,"call.permission_request":void 0,"call.recording_ready":void 0,"call.rtmp_broadcast_failed":void 0,"call.rtmp_broadcast_started":void 0,"call.rtmp_broadcast_stopped":void 0,"call.transcription_ready":void 0,"call.user_muted":void 0,"connection.error":void 0,"connection.ok":void 0,"health.check":void 0,"user.updated":void 0,custom:void 0,"call.accepted":e=>this.updateFromCallResponse(e.call),"call.blocked_user":this.blockUser,"call.closed_caption":this.updateFromClosedCaptions,"call.closed_captions_failed":()=>{this.setCurrentValue(this.captioningSubject,!1)},"call.closed_captions_started":()=>{this.setCurrentValue(this.captioningSubject,!0)},"call.closed_captions_stopped":()=>{this.setCurrentValue(this.captioningSubject,!1)},"call.created":e=>this.updateFromCallResponse(e.call),"call.deleted":e=>this.updateFromCallResponse(e.call),"call.ended":e=>{this.updateFromCallResponse(e.call),this.setCurrentValue(this.endedBySubject,e.user)},"call.frame_recording_failed":e=>{this.updateFromCallResponse(e.call)},"call.frame_recording_started":e=>{this.updateFromCallResponse(e.call)},"call.frame_recording_stopped":e=>{this.updateFromCallResponse(e.call)},"call.hls_broadcasting_failed":this.updateFromHLSBroadcastingFailed,"call.hls_broadcasting_started":e=>{this.updateFromCallResponse(e.call)},"call.hls_broadcasting_stopped":this.updateFromHLSBroadcastStopped,"call.live_started":e=>this.updateFromCallResponse(e.call),"call.member_added":this.updateFromMemberAdded,"call.member_removed":this.updateFromMemberRemoved,"call.member_updated_permission":this.updateMembers,"call.member_updated":this.updateMembers,"call.notification":e=>{this.updateFromCallResponse(e.call),this.setMembers(e.members)},"call.permissions_updated":this.updateOwnCapabilities,"call.reaction_new":this.updateParticipantReaction,"call.recording_started":()=>this.setCurrentValue(this.recordingSubject,!0),"call.recording_stopped":()=>this.setCurrentValue(this.recordingSubject,!1),"call.recording_failed":()=>this.setCurrentValue(this.recordingSubject,!1),"call.rejected":e=>this.updateFromCallResponse(e.call),"call.ring":e=>this.updateFromCallResponse(e.call),"call.missed":e=>this.updateFromCallResponse(e.call),"call.session_ended":e=>this.updateFromCallResponse(e.call),"call.session_participant_count_updated":this.updateFromSessionParticipantCountUpdate,"call.session_participant_joined":this.updateFromSessionParticipantJoined,"call.session_participant_left":this.updateFromSessionParticipantLeft,"call.session_started":e=>this.updateFromCallResponse(e.call),"call.transcription_started":()=>{this.setCurrentValue(this.transcribingSubject,!0)},"call.transcription_stopped":()=>{this.setCurrentValue(this.transcribingSubject,!1)},"call.transcription_failed":()=>{this.setCurrentValue(this.transcribingSubject,!1)},"call.unblocked_user":this.unblockUser,"call.updated":e=>this.updateFromCallResponse(e.call)}}get participantCount(){return this.getCurrentValue(this.participantCount$)}get startedAt(){return this.getCurrentValue(this.startedAt$)}get captioning(){return this.getCurrentValue(this.captioning$)}get anonymousParticipantCount(){return this.getCurrentValue(this.anonymousParticipantCount$)}get participants(){return this.getCurrentValue(this.participants$)}get localParticipant(){return this.getCurrentValue(this.localParticipant$)}get remoteParticipants(){return this.getCurrentValue(this.remoteParticipants$)}get dominantSpeaker(){return this.getCurrentValue(this.dominantSpeaker$)}get pinnedParticipants(){return this.getCurrentValue(this.pinnedParticipants$)}get hasOngoingScreenShare(){return this.getCurrentValue(this.hasOngoingScreenShare$)}get callingState(){return this.getCurrentValue(this.callingState$)}get callStatsReport(){return this.getCurrentValue(this.callStatsReport$)}get members(){return this.getCurrentValue(this.members$)}get ownCapabilities(){return this.getCurrentValue(this.ownCapabilities$)}get backstage(){return this.getCurrentValue(this.backstage$)}get blockedUserIds(){return this.getCurrentValue(this.blockedUserIds$)}get createdAt(){return this.getCurrentValue(this.createdAt$)}get endedAt(){return this.getCurrentValue(this.endedAt$)}get startsAt(){return this.getCurrentValue(this.startsAt$)}get updatedAt(){return this.getCurrentValue(this.updatedAt$)}get createdBy(){return this.getCurrentValue(this.createdBy$)}get custom(){return this.getCurrentValue(this.custom$)}get egress(){return this.getCurrentValue(this.egress$)}get ingress(){return this.getCurrentValue(this.ingress$)}get recording(){return this.getCurrentValue(this.recording$)}get session(){return this.getCurrentValue(this.session$)}get settings(){return this.getCurrentValue(this.settings$)}get transcribing(){return this.getCurrentValue(this.transcribing$)}get endedBy(){return this.getCurrentValue(this.endedBy$)}get thumbnails(){return this.getCurrentValue(this.thumbnails$)}get closedCaptions(){return this.getCurrentValue(this.closedCaptions$)}}let aF=e=>{let t=[];return e.forEach(e=>{t.push(e)}),t},a$=e=>({id:e.id,tracks:e.getTracks().map(e=>({id:e.id,kind:e.kind,label:e.label,enabled:e.enabled,muted:e.muted,readyState:e.readyState}))}),aV=e=>{let{sdk:t,...i}=e;return{sdkName:aB(t),sdkVersion:aH(t),...i}},aB=e=>e&&e.type===w.REACT?"stream-react":e&&e.type===w.REACT_NATIVE?"stream-react-native":"stream-js",aH=e=>e?`${e.major}.${e.minor}.${e.patch}`:"0.0.0-development",aq=()=>"undefined"!=typeof navigator&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent||""),aW=()=>"undefined"!=typeof navigator&&navigator.userAgent?.includes("Firefox");var aG=Object.freeze({__proto__:null,isChrome:()=>"undefined"!=typeof navigator&&navigator.userAgent?.includes("Chrome"),isFirefox:aW,isSafari:aq});let aJ=({subscriber:e,publisher:t,state:i,datacenter:n,pollingIntervalInMs:r=2e3})=>{let s,a=s3(["stats"]),o=async(i,n)=>"subscriber"===i&&e?e.getStats(n):"publisher"===i&&t?t.getStats(n):void 0,l=async(i,n)=>{let r="subscriber"===i?e:t;if(!r)return[];let s=[];for(let e of n){let t=aK(await r.getStats(e),{trackKind:e.kind,kind:i,publisher:void 0});s.push(t)}return s},c=new Set,u=async()=>{let e={};if(c.size>0){let n=new Set(c);for(let r of i.participants){if(!n.has(r.sessionId))continue;let{audioStream:i,isLocalParticipant:s,sessionId:o,userId:c,videoStream:u}=r,d=s?"publisher":"subscriber";try{let n=s?t?.getPublishedTracks()||[]:[...u?.getVideoTracks()||[],...i?.getAudioTracks()||[]];e[o]=await l(d,n)}catch(e){a("warn",`Failed to collect ${d} stats for ${c}`,e)}}}let[r,s]=await Promise.all([o("subscriber"),t?o("publisher"):void 0]),u=(e,i)=>aY(aK(e,{kind:i,trackKind:"video",publisher:t})),d=r?u(r,"subscriber"):az(),h=s?u(s,"publisher"):az();i.setCallStatsReport({datacenter:n,publisherStats:h,subscriberStats:d,subscriberRawStats:r,publisherRawStats:s,participants:e,timestamp:Date.now()})};if(r>0){let e=async()=>{await u().catch(e=>{a("debug","Failed to collect stats",e)}),s=setTimeout(e,r)};e()}return{getRawStatsForTrack:o,getStatsForStream:l,startReportingStatsFor:e=>{c.add(e),u()},stopReportingStatsFor:e=>{c.delete(e),u()},stop:()=>{s&&clearTimeout(s)}}},aK=(e,t)=>{let{trackKind:i,kind:n,publisher:r}=t,s="subscriber"===n?"inbound-rtp":"outbound-rtp",a=aF(e);return{rawStats:e,streams:a.filter(e=>e.type===s&&e.kind===i).map(e=>{let t,i,s=a.find(t=>"codec"===t.type&&t.id===e.codecId),o=a.find(t=>"transport"===t.type&&t.id===e.transportId);if(o&&"connected"===o.dtlsState){let e=a.find(e=>"candidate-pair"===e.type&&e.id===o.selectedCandidatePairId);t=e?.currentRoundTripTime}if("publisher"===n&&r){let t=aW(),n=a.find(i=>"media-source"===i.type&&(!!t||i.id===e.mediaSourceId));n&&(i=r.getTrackType(n.trackIdentifier))}return{bytesSent:e.bytesSent,bytesReceived:e.bytesReceived,codec:s?.mimeType,currentRoundTripTime:t,frameHeight:e.frameHeight,frameWidth:e.frameWidth,framesPerSecond:e.framesPerSecond,jitter:e.jitter,kind:e.kind,mediaSourceId:e.mediaSourceId,qualityLimitationReason:e.qualityLimitationReason,rid:e.rid,ssrc:e.ssrc,trackType:i}}),timestamp:Date.now()}},az=e=>({rawReport:e??{streams:[],timestamp:Date.now()},totalBytesSent:0,totalBytesReceived:0,averageJitterInMs:0,averageRoundTripTimeInMs:0,qualityLimitationReasons:"none",highestFrameWidth:0,highestFrameHeight:0,highestFramesPerSecond:0,codec:"",codecPerTrackType:{},timestamp:Date.now()}),aY=e=>{let t=az(e),i=-1,n=(e,t)=>e*t,r=new Set,s=e.streams,a=s.reduce((e,t)=>{e.totalBytesSent+=t.bytesSent||0,e.totalBytesReceived+=t.bytesReceived||0,e.averageJitterInMs+=t.jitter||0,e.averageRoundTripTimeInMs+=t.currentRoundTripTime||0;let s=n(t.frameWidth||0,t.frameHeight||0);return s>i&&(e.highestFrameWidth=t.frameWidth||0,e.highestFrameHeight=t.frameHeight||0,e.highestFramesPerSecond=t.framesPerSecond||0,i=s),r.add(t.qualityLimitationReason||""),e},t);s.length>0&&(a.averageJitterInMs=Math.round(a.averageJitterInMs/s.length*1e3),a.averageRoundTripTimeInMs=Math.round(a.averageRoundTripTimeInMs/s.length*1e3),a.codec=s[0].codec||"",a.codecPerTrackType=s.reduce((e,t)=>(t.trackType&&(e[t.trackType]=t.codec||""),e),{}));let o=[r.has("cpu")&&"cpu",r.has("bandwidth")&&"bandwidth",r.has("other")&&"other"].filter(Boolean).join(", ");return o&&(a.qualityLimitationReasons=o),a},[aX,aZ,aQ]="1.23.2".split("."),a0={type:w.PLAIN_JAVASCRIPT,major:aX,minor:aZ,patch:aQ},a1={oneofKind:void 0},a2=()=>a0,a3=()=>o,a4=()=>a1,a6=async()=>{let e;if(sY())return{sdk:a0,os:s,device:a};let t=navigator.userAgentData;if(t&&t.getHighEntropyValues)try{e=await t.getHighEntropyValues(["platform","platformVersion"])}catch{}let{browser:i,os:n,device:r,cpu:o}=new iX.UAParser(navigator.userAgent).getResult();return{sdk:a0,browser:{name:i.name||navigator.userAgent,version:i.version||""},os:{name:e?.platform||n.name||"",version:e?.platformVersion||n.version||"",architecture:o.architecture||""},device:{name:[r.vendor,r.model,r.type].filter(Boolean).join(" "),version:""}}};class a5{constructor(e,{options:t,clientDetails:i,subscriber:n,publisher:r,microphone:s,camera:a,state:o,tracer:l,unifiedSessionId:c}){this.logger=s3(["SfuStatsReporter"]),this.inputDevices=new Map,this.observeDevice=(e,t)=>{let{browserPermissionState$:i}=e.state;this.unsubscribeDevicePermissionsSubscription?.(),this.unsubscribeDevicePermissionsSubscription=ad(iE([i,this.state.ownCapabilities$]),([i,n])=>{this.unsubscribeListDevicesSubscription?.();let r="mic"===t?n.includes(i2.SEND_AUDIO):n.includes(i2.SEND_VIDEO);if("granted"!==i||!r)return void this.inputDevices.set(t,{currentDevice:"",availableDevices:[],isPermitted:!1});this.unsubscribeListDevicesSubscription=ad(iE([e.listDevices(),e.state.selectedDevice$]),([e,i])=>{let n=e.find(e=>e.deviceId===i);this.inputDevices.set(t,{currentDevice:n?.label||i||"",availableDevices:e.map(e=>e.label),isPermitted:!0})})})},this.sendConnectionTime=e=>{this.sendTelemetryData({data:{oneofKind:"connectionTimeSeconds",connectionTimeSeconds:e}})},this.sendReconnectionTime=(e,t)=>{this.sendTelemetryData({data:{oneofKind:"reconnection",reconnection:{strategy:e,timeSeconds:t}}})},this.sendTelemetryData=e=>{this.run(e).catch(e=>{this.logger("warn","Failed to send telemetry data",e)})},this.run=async e=>{let[t,i]=await Promise.all([this.subscriber.stats.get(),this.publisher?.stats.get()]);this.subscriber.tracer?.trace("getstats",t.delta),i&&this.publisher?.tracer?.trace("getstats",i.delta);let n=this.subscriber.tracer?.take(),r=this.publisher?.tracer?.take(),s=this.tracer.take(),a=this.sfuClient.getTrace(),o=[...s.snapshot,...a?.snapshot??[],...r?.snapshot??[],...n?.snapshot??[]];try{await this.sfuClient.sendStats({sdk:this.sdkName,sdkVersion:this.sdkVersion,webrtcVersion:this.webRTCVersion,subscriberStats:JSON.stringify(aF(t.stats)),publisherStats:i?JSON.stringify(aF(i.stats)):"[]",subscriberRtcStats:"",publisherRtcStats:"",rtcStats:JSON.stringify(o),encodeStats:i?.performanceStats??[],decodeStats:t.performanceStats,audioDevices:this.inputDevices.get("mic"),videoDevices:this.inputDevices.get("camera"),unifiedSessionId:this.unifiedSessionId,deviceState:a4(),telemetry:e})}catch(e){throw r?.rollback(),n?.rollback(),s.rollback(),a?.rollback(),e}},this.start=()=>{this.options.reporting_interval_ms<=0||(this.observeDevice(this.microphone,"mic"),this.observeDevice(this.camera,"camera"),clearInterval(this.intervalId),this.intervalId=setInterval(()=>{this.run().catch(e=>{this.logger("warn","Failed to report stats",e)})},this.options.reporting_interval_ms))},this.stop=()=>{this.unsubscribeDevicePermissionsSubscription?.(),this.unsubscribeDevicePermissionsSubscription=void 0,this.unsubscribeListDevicesSubscription?.(),this.unsubscribeListDevicesSubscription=void 0,this.inputDevices.clear(),clearInterval(this.intervalId),this.intervalId=void 0,clearTimeout(this.timeoutId),this.timeoutId=void 0},this.flush=()=>{this.run().catch(e=>{this.logger("warn","Failed to flush report stats",e)})},this.scheduleOne=e=>{clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>{this.run().catch(e=>{this.logger("warn","Failed to report stats",e)})},e)},this.sfuClient=e,this.options=t,this.subscriber=n,this.publisher=r,this.microphone=s,this.camera=a,this.state=o,this.tracer=l,this.unifiedSessionId=c;let{sdk:u,browser:d}=i;this.sdkName=aB(u),this.sdkVersion=aH(u);let h=a3();this.webRTCVersion=h?.version||`${d?.name||""}-${d?.version||""}`||"N/A"}}let a9=(e,t)=>{e.addEventListener("icecandidate",e=>{t("onicecandidate",e.candidate)}),e.addEventListener("track",e=>{let i=e.streams.map(e=>`stream:${e.id}`);t("ontrack",`${e.track.kind}:${e.track.id} ${i}`)}),e.addEventListener("signalingstatechange",()=>{t("signalingstatechange",e.signalingState)}),e.addEventListener("iceconnectionstatechange",()=>{t("iceconnectionstatechange",e.iceConnectionState)}),e.addEventListener("icegatheringstatechange",()=>{t("icegatheringstatechange",e.iceGatheringState)}),e.addEventListener("connectionstatechange",()=>{t("connectionstatechange",e.connectionState)}),e.addEventListener("negotiationneeded",()=>{t("negotiationneeded",void 0)}),e.addEventListener("datachannel",({channel:e})=>{t("datachannel",[e.id,e.label])});let i=e.close;for(let n of(e.close=function(){return t("close",void 0),i.call(this)},["createOffer","createAnswer","setLocalDescription","setRemoteDescription","addIceCandidate"])){let i=e[n];i&&(e[n]=async function(...e){try{t(n,e);let r=await i.apply(this,e);return t(`${n}OnSuccess`,r),r}catch(e){throw t(`${n}OnFailure`,e.toString()),e}})}};class a8{constructor(e,t,i){this.previousStats={},this.frameTimeHistory=[],this.fpsHistory=[],this.get=async()=>{let e=await this.pc.getStats(),t=a7(e),i=this.withOverrides(this.peerType===g.SUBSCRIBER?this.getDecodeStats(t):this.getEncodeStats(t)),n=oe(this.previousStats,t);return this.previousStats=t,this.frameTimeHistory=this.frameTimeHistory.slice(-2),this.fpsHistory=this.fpsHistory.slice(-2),{performanceStats:i,delta:n,stats:e}},this.getEncodeStats=e=>{let t=[];for(let i of Object.values(e)){if("outbound-rtp"!==i.type)continue;let{codecId:n,framesSent:r=0,kind:s,id:a,totalEncodeTime:o=0,framesPerSecond:l=0,frameHeight:c=0,frameWidth:u=0,targetBitrate:d=0,mediaSourceId:h}=i;if("audio"===s||!this.previousStats[a])continue;let p=this.previousStats[a],f=o-(p.totalEncodeTime||0),m=r-(p.framesSent||0),g=m>0?f/m*1e3:0;this.frameTimeHistory.push(g),this.fpsHistory.push(l);let v=y.VIDEO;if(h&&e[h]){let t=e[h];v=this.trackIdToTrackType.get(t.trackIdentifier)||v}t.push({trackType:v,codec:oi(e,n),avgFrameTimeMs:ot(this.frameTimeHistory),avgFps:ot(this.fpsHistory),targetBitrate:Math.round(d),videoDimension:{width:u,height:c}})}return t},this.getDecodeStats=e=>{let t,i=0;for(let n of Object.values(e)){if("inbound-rtp"!==n.type)continue;let{kind:e,frameWidth:r=0,frameHeight:s=0}=n,a=r*s;"video"===e&&a>i&&(t=n,i=a)}if(!t||!this.previousStats[t.id])return[];let n=this.previousStats[t.id],{framesDecoded:r=0,framesPerSecond:s=0,totalDecodeTime:a=0,trackIdentifier:o}=t,l=a-(n.totalDecodeTime||0),c=r-(n.framesDecoded||0);this.frameTimeHistory.push(c>0?l/c*1e3:0),this.fpsHistory.push(s);let u=this.trackIdToTrackType.get(o)||y.VIDEO;return[nz.create({trackType:u,codec:oi(e,t.codecId),avgFrameTimeMs:ot(this.frameTimeHistory),avgFps:ot(this.fpsHistory),videoDimension:{width:t.frameWidth,height:t.frameHeight}})]},this.withOverrides=e=>{if(this.costOverrides)for(let t of e){let e=this.costOverrides.get(t.trackType);void 0!==e&&(t.avgFrameTimeMs=e+(t.avgFrameTimeMs||0)/1e3)}return e},this.setCost=(e,t=y.VIDEO)=>{this.costOverrides||(this.costOverrides=new Map),this.costOverrides.set(t,e)},this.pc=e,this.peerType=t,this.trackIdToTrackType=i}}let a7=e=>{let t={};return e.forEach((e,i)=>{t[i]=e}),t},oe=(e,t)=>{for(let[i,n]of Object.entries(t=JSON.parse(JSON.stringify(t))))if(delete n.id,e[i])for(let[t,r]of Object.entries(n))r===e[i][t]&&delete n[t];let i=-1/0,n=Object.values(t);for(let e of n)e.timestamp>i&&(i=e.timestamp);for(let e of n)e.timestamp===i&&(e.timestamp=0);return t.timestamp=i,t},ot=e=>e.reduce((e,t)=>e+t,0)/e.length,oi=(e,t)=>{if(!t||!e[t])return;let i=e[t];return nw.create({name:i.mimeType.split("/").pop(),clockRate:i.clockRate,payloadType:i.payloadType,fmtp:i.sdpFmtpLine})};class on{constructor(e){this.buffer=[],this.enabled=!0,this.setEnabled=e=>{this.enabled!==e&&(this.enabled=e,this.buffer=[])},this.trace=(e,t)=>{this.enabled&&this.buffer.push([e,this.id,t,Date.now()])},this.take=()=>{let e=this.buffer;return this.buffer=[],{snapshot:e,rollback:()=>{this.buffer.unshift(...e)}}},this.dispose=()=>{this.buffer=[]},this.id=e}}class or{constructor(e,{sfuClient:t,connectionConfig:i,state:n,dispatcher:r,onUnrecoverableError:s,logTag:a,enableTracing:o}){if(this.isIceRestarting=!1,this.isDisposed=!1,this.trackIdToTrackType=new Map,this.subscriptions=[],this.lock=Math.random().toString(36).slice(2),this.on=(e,t)=>{this.subscriptions.push(this.dispatcher.on(e,i=>{ai(`pc.${this.lock}.${e}`,async()=>t(i)).catch(t=>{this.isDisposed||this.logger("warn",`Error handling ${e}`,t)})}))},this.addTrickledIceCandidates=()=>{let{iceTrickleBuffer:e}=this.sfuClient,t=this.peerType===g.SUBSCRIBER?e.subscriberCandidates:e.publisherCandidates;this.unsubscribeIceTrickle?.(),this.unsubscribeIceTrickle=ah(t,async e=>this.pc.addIceCandidate(e).catch(t=>{this.isDisposed||this.logger("warn","ICE candidate error",t,e)}))},this.setSfuClient=e=>{this.sfuClient=e},this.getStats=e=>this.pc.getStats(e),this.getTrackType=e=>this.trackIdToTrackType.get(e),this.onIceCandidate=e=>{let{candidate:t}=e;if(!t)return void this.logger("debug","null ice candidate");let i=this.asJSON(t);this.sfuClient.iceTrickle({peerType:this.peerType,iceCandidate:i}).catch(e=>{this.isDisposed||this.logger("warn","ICETrickle failed",e)})},this.asJSON=e=>{if(!e.usernameFragment){let t=e.candidate.split(" "),i=t.findIndex(e=>"ufrag"===e)+1,n=t[i];return JSON.stringify({...e,usernameFragment:n})}return JSON.stringify(e.toJSON())},this.onConnectionStateChange=async()=>{let e=this.pc.connectionState;if(this.logger("debug","Connection state changed",e),this.tracer&&("connected"===e||"failed"===e))try{let e=await this.stats.get();this.tracer.trace("getstats",e.delta)}catch(e){this.tracer.trace("getstatsOnFailure",e.toString())}},this.onIceConnectionStateChange=()=>{let e=this.pc.iceConnectionState;this.logger("debug","ICE connection state changed",e),this.state.callingState!==P.OFFLINE&&this.state.callingState!==P.RECONNECTING&&(this.isIceRestarting||("failed"===e?this.onUnrecoverableError?.("ICE connection failed"):"disconnected"===e&&(this.logger("debug","Attempting to restart ICE"),this.restartIce().catch(e=>{let t="ICE restart failed";this.logger("error",t,e),this.onUnrecoverableError?.(`${t}: ${e}`)}))))},this.onIceCandidateError=e=>{let t=e instanceof RTCPeerConnectionIceErrorEvent&&`${e.errorCode}: ${e.errorText}`,i=this.pc.iceConnectionState;this.logger("connected"===i||"checking"===i?"debug":"warn","ICE Candidate error",t)},this.onIceGatherChange=()=>{this.logger("debug","ICE Gathering State",this.pc.iceGatheringState)},this.onSignalingChange=()=>{this.logger("debug","Signaling state changed",this.pc.signalingState)},this.peerType=e,this.sfuClient=t,this.state=n,this.dispatcher=r,this.onUnrecoverableError=s,this.logger=s3([e===g.SUBSCRIBER?"Subscriber":"Publisher",a]),this.pc=new RTCPeerConnection(i),this.pc.addEventListener("icecandidate",this.onIceCandidate),this.pc.addEventListener("icecandidateerror",this.onIceCandidateError),this.pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.pc.addEventListener("icegatheringstatechange",this.onIceGatherChange),this.pc.addEventListener("signalingstatechange",this.onSignalingChange),this.pc.addEventListener("connectionstatechange",this.onConnectionStateChange),this.stats=new a8(this.pc,e,this.trackIdToTrackType),o){let n=`${a}-${e===g.SUBSCRIBER?"sub":"pub"}`;this.tracer=new on(n),this.tracer.trace("create",{url:t.edgeName,...i}),a9(this.pc,this.tracer.trace)}}dispose(){this.onUnrecoverableError=void 0,this.isDisposed=!0,this.detachEventHandlers(),this.pc.close(),this.tracer?.dispose()}detachEventHandlers(){this.pc.removeEventListener("icecandidate",this.onIceCandidate),this.pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this.pc.removeEventListener("signalingstatechange",this.onSignalingChange),this.pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.pc.removeEventListener("icegatheringstatechange",this.onIceGatherChange),this.unsubscribeIceTrickle?.(),this.subscriptions.forEach(e=>e())}}class os{constructor(){this.cache=[],this.layers=[],this.transceiverOrder=[],this.add=(e,t)=>{this.cache.push({publishOption:e,transceiver:t}),this.transceiverOrder.push(t)},this.get=e=>this.findTransceiver(e)?.transceiver,this.has=e=>!!this.get(e),this.find=e=>this.cache.find(e),this.items=()=>this.cache,this.indexOf=e=>this.transceiverOrder.indexOf(e),this.getLayers=e=>{let t=this.layers.find(t=>t.publishOption.id===e.id&&t.publishOption.trackType===e.trackType);return t?.layers},this.setLayers=(e,t=[])=>{let i=this.findLayer(e);i?i.layers=t:this.layers.push({publishOption:e,layers:t})},this.findTransceiver=e=>this.cache.find(t=>t.publishOption.id===e.id&&t.publishOption.trackType===e.trackType),this.findLayer=e=>this.layers.find(t=>t.publishOption.id===e.id&&t.publishOption.trackType===e.trackType)}}let oa=(e,t)=>{s3(["helpers"])("warn",t,e)},oo=e=>{switch(e){case y.SCREEN_SHARE:return"screenShareStream";case y.SCREEN_SHARE_AUDIO:return"screenShareAudioStream";case y.VIDEO:return"videoStream";case y.AUDIO:return"audioStream";case y.UNSPECIFIED:throw Error("Track type is unspecified");default:oa(e,"Unknown track type")}},ol=e=>{switch(e){case"audio":return y.AUDIO;case"video":return y.VIDEO;case"screenshare":return y.SCREEN_SHARE;case"screenshare_audio":return y.SCREEN_SHARE_AUDIO;default:oa(e,"Unknown mute type")}},oc=e=>{switch(e){case"TRACK_TYPE_AUDIO":return y.AUDIO;case"TRACK_TYPE_VIDEO":return y.VIDEO;case"TRACK_TYPE_SCREEN_SHARE":return y.SCREEN_SHARE;case"TRACK_TYPE_SCREEN_SHARE_AUDIO":return y.SCREEN_SHARE_AUDIO;default:return}},ou=e=>e===y.AUDIO||e===y.SCREEN_SHARE_AUDIO,od={q:3e5,h:75e4,f:125e4},oh=e=>{if(!e)return;let t=e=>t=>t.rid===e;return[{...e.find(t("f"))||e.find(t("h"))||e.find(t("q")),rid:"q"}]},op=e=>"q"===e?b.LOW_UNSPECIFIED:"h"===e?b.MID:b.HIGH,of=(e=[])=>e.map(e=>({rid:e.rid||"",bitrate:e.maxBitrate||0,fps:e.maxFramerate||0,quality:op(e.rid||""),videoDimension:{width:e.width,height:e.height}})),om=(e,t)=>`L${e}T${t}${e>1?"_KEY":""}`,og=(e,t)=>{if(ou(t.trackType))return;let i=[],n=e.getSettings(),{width:r=0,height:s=0}=n,{bitrate:a,codec:o,fps:l,maxSpatialLayers:c=3,maxTemporalLayers:u=3,videoDimension:d={width:1280,height:720},useSingleLayer:h}=t,p=ov(d,r,s,a),f=1,m=1,g=s5(o?.name);for(let e of["f","h","q"].slice(0,c)){let t={active:!0,rid:e,width:Math.round(r/f),height:Math.round(s/f),maxBitrate:Math.round(p/m)||od[e],maxFramerate:l};g?t.scalabilityMode=om(h?1:c,u):t.scaleResolutionDownBy=f,f*=2,m*=2,i.unshift(t)}return ob(n,i,h)},ov=(e,t,i,n)=>{let{width:r,height:s}=e;return t<r||i<s?Math.round(t*i/(r*s)*n):n},ob=(e,t,i)=>{let n,r=Math.max(e.width||0,e.height||0);n=r<=320?t.filter(e=>"f"===e.rid):r<=640?t.filter(e=>"h"!==e.rid):t;let s=["q","h","f"];return n.map((e,t,n)=>({...e,rid:s[t],active:(!i||!(t<n.length-1))&&e.active}))},oy=(e,t,i)=>{if(e.mid)return e.mid;if(!i)return String(t);let n=e.sender.track,r=(0,iZ.qg)(i).media.find(e=>e.type===n.kind&&(e.msid?.includes(n.id)??!0));return void 0!==r?.mid?String(r.mid):t<0?"":String(t)};class oS extends or{constructor({publishOptions:e,...t}){super(g.PUBLISHER_UNSPECIFIED,t),this.transceiverCache=new os,this.clonedTracks=new Set,this.publish=async(e,t)=>{if(!this.publishOptions.some(e=>e.trackType===t))throw Error(`No publish options found for ${y[t]}`);for(let i of this.publishOptions){if(i.trackType!==t)continue;let n=this.cloneTrack(e),r=this.transceiverCache.get(i);if(r){let e=r.sender.track;await this.updateTransceiver(r,n,t),sY()||this.stopTrack(e)}else await this.addTransceiver(n,i)}},this.addTransceiver=async(e,t)=>{let i=og(e,t),n=s5(t.codec?.name)?oh(i):i,r=this.pc.addTransceiver(e,{direction:"sendonly",sendEncodings:n}),s=r.sender.getParameters();s.degradationPreference="maintain-framerate",await r.sender.setParameters(s);let a=t.trackType;this.logger("debug",`Added ${y[a]} transceiver`),this.transceiverCache.add(t,r),this.trackIdToTrackType.set(e.id,a),await this.negotiate()},this.updateTransceiver=async(e,t,i)=>{let n=e.sender;n.track&&this.trackIdToTrackType.delete(n.track.id),await n.replaceTrack(t),t&&this.trackIdToTrackType.set(t.id,i)},this.syncPublishOptions=async()=>{for(let e of this.publishOptions){let{trackType:t}=e;if(!this.isPublishing(t)||this.transceiverCache.has(e))continue;let i=this.transceiverCache.find(e=>!!e.transceiver.sender.track&&e.publishOption.trackType===t);if(!i||!i.transceiver)continue;let n=this.cloneTrack(i.transceiver.sender.track);await this.addTransceiver(n,e)}for(let e of this.transceiverCache.items()){let{publishOption:t,transceiver:i}=e;this.publishOptions.some(e=>e.id===t.id&&e.trackType===t.trackType)||(this.stopTrack(i.sender.track),await this.updateTransceiver(i,null,t.trackType))}},this.isPublishing=e=>{for(let t of this.transceiverCache.items()){if(t.publishOption.trackType!==e)continue;let i=t.transceiver.sender.track;if(i&&"live"===i.readyState&&i.enabled)return!0}return!1},this.stopTracks=(...e)=>{for(let t of this.transceiverCache.items()){let{publishOption:i,transceiver:n}=t;e.includes(i.trackType)&&this.stopTrack(n.sender.track)}},this.stopAllTracks=()=>{for(let{transceiver:e}of this.transceiverCache.items())this.stopTrack(e.sender.track);for(let e of this.clonedTracks)this.stopTrack(e)},this.changePublishQuality=async e=>{let{trackType:t,layers:i,publishOptionId:n}=e,r=i.filter(e=>e.active),s="Update publish quality:";this.logger("info",`${s} requested layers by SFU:`,r);let a=this.transceiverCache.find(e=>e.publishOption.id===n&&e.publishOption.trackType===t),o=a?.transceiver.sender;if(!o)return this.logger("warn",`${s} no video sender found.`);let l=o.getParameters();if(0===l.encodings.length)return this.logger("warn",`${s} there are no encodings set.`);let c=a?.publishOption.codec?.name,u=c&&s5(c),d=!1;for(let e of l.encodings){let t=u?r[0]:r.find(t=>t.name===e.rid)??(1===l.encodings.length?r[0]:void 0),i=!!t?.active;if(i!==e.active&&(e.active=i,d=!0),!t)continue;let{maxFramerate:n,scaleResolutionDownBy:s,maxBitrate:a,scalabilityMode:o}=t;s>=1&&s!==e.scaleResolutionDownBy&&(e.scaleResolutionDownBy=s,d=!0),a>0&&a!==e.maxBitrate&&(e.maxBitrate=a,d=!0),n>0&&n!==e.maxFramerate&&(e.maxFramerate=n,d=!0),o&&o!==e.scalabilityMode&&(e.scalabilityMode=o,d=!0)}let h=l.encodings.filter(e=>e.active);if(!d)return this.logger("info",`${s} no change:`,h);await o.setParameters(l),this.logger("info",`${s} enabled rids:`,h)},this.restartIce=async()=>{this.logger("debug","Restarting ICE connection");let e=this.pc.signalingState;if(this.isIceRestarting||"have-local-offer"===e)return void this.logger("debug","ICE restart is already in progress");await this.negotiate({iceRestart:!0})},this.negotiate=async e=>ai(`publisher.negotiate.${this.lock}`,async()=>{let t=await this.pc.createOffer(e),i=this.getAnnouncedTracks(t.sdp);if(!i.length)throw Error("Can't negotiate without any tracks");try{this.isIceRestarting=e?.iceRestart??!1,await this.pc.setLocalDescription(t);let{sdp:n=""}=t,{response:r}=await this.sfuClient.setPublisher({sdp:n,tracks:i});if(r.error)throw Error(r.error.message);let{sdp:s}=r;await this.pc.setRemoteDescription({type:"answer",sdp:s})}finally{this.isIceRestarting=!1}this.addTrickledIceCandidates()}),this.getPublishedTracks=()=>{let e=[];for(let{transceiver:t}of this.transceiverCache.items()){let i=t.sender.track;i&&"live"===i.readyState&&e.push(i)}return e},this.getAnnouncedTracks=e=>{let t=[];for(let i of this.transceiverCache.items()){let{transceiver:n,publishOption:r}=i;n.sender.track&&t.push(this.toTrackInfo(n,r,e))}return t},this.getAnnouncedTracksForReconnect=()=>{let e=this.pc.localDescription?.sdp,t=[];for(let i of this.publishOptions){let n=this.transceiverCache.get(i);n&&n.sender.track&&t.push(this.toTrackInfo(n,i,e))}return t},this.toTrackInfo=(e,t,i)=>{let n=e.sender.track,r="live"===n.readyState,s=r?og(n,t):this.transceiverCache.getLayers(t);this.transceiverCache.setLayers(t,s);let a=ou(t.trackType),o=a&&2===n.getSettings().channelCount,l=this.transceiverCache.indexOf(e),c=this.state.settings?.audio;return{trackId:n.id,layers:of(s),trackType:t.trackType,mid:oy(e,l,i),stereo:o,dtx:a&&!!c?.opus_dtx_enabled,red:a&&!!c?.redundant_coding_enabled,muted:!r,codec:t.codec,publishOptionId:t.id}},this.cloneTrack=e=>{let t=e.clone();return this.clonedTracks.add(t),t},this.stopTrack=e=>{e&&(e.stop(),this.clonedTracks.delete(e))},this.publishOptions=e,this.on("iceRestart",e=>{e.peerType===g.PUBLISHER_UNSPECIFIED&&this.restartIce().catch(e=>{let t="ICE restart failed";this.logger("warn",t,e),this.onUnrecoverableError?.(`${t}: ${e}`)})}),this.on("changePublishQuality",async e=>{for(let t of e.videoSenders)await this.changePublishQuality(t)}),this.on("changePublishOptions",e=>(this.publishOptions=e.publishOptions,this.syncPublishOptions()))}dispose(){super.dispose(),this.stopAllTracks(),this.clonedTracks.clear()}}class ow extends or{constructor(e){super(g.SUBSCRIBER,e),this.restartIce=async()=>{if(this.logger("debug","Restarting ICE connection"),"have-remote-offer"===this.pc.signalingState)return void this.logger("debug","ICE restart is already in progress");if("new"===this.pc.connectionState)return void this.logger("debug","ICE connection is not yet established, skipping restart.");let e=this.isIceRestarting;try{this.isIceRestarting=!0,await this.sfuClient.iceRestart({peerType:g.SUBSCRIBER})}catch(t){throw this.isIceRestarting=e,t}},this.handleOnTrack=e=>{let[t]=e.streams,[i,n]=t.id.split(":"),r=this.state.participants.find(e=>e.trackLookupPrefix===i);this.logger("debug",`[onTrack]: Got remote ${n} track for userId: ${r?.userId}`,e.track.id,e.track);let s=`${r?.userId} ${n}:${i}`;e.track.addEventListener("mute",()=>{this.logger("info",`[onTrack]: Track muted: ${s}`)}),e.track.addEventListener("unmute",()=>{this.logger("info",`[onTrack]: Track unmuted: ${s}`)}),e.track.addEventListener("ended",()=>{this.logger("info",`[onTrack]: Track ended: ${s}`),this.state.removeOrphanedTrack(t.id)});let a=oc(n);if(!a)return this.logger("error",`Unknown track type: ${n}`);if(this.trackIdToTrackType.set(e.track.id,a),!r){this.logger("warn",`[onTrack]: Received track for unknown participant: ${i}`,e),this.state.registerOrphanedTrack({id:t.id,trackLookupPrefix:i,track:t,trackType:a});return}let o=oo(a);if(!o)return void this.logger("error",`Unknown track type: ${n}`);let l=r[o];this.state.updateParticipant(r.sessionId,{[o]:t}),l&&(this.logger("info",`[onTrack]: Cleaning up previous remote ${e.track.kind} tracks for userId: ${r.userId}`),l.getTracks().forEach(e=>{e.stop(),l.removeTrack(e)}))},this.negotiate=async e=>{await this.pc.setRemoteDescription({type:"offer",sdp:e.sdp}),this.addTrickledIceCandidates();let t=await this.pc.createAnswer();await this.pc.setLocalDescription(t),await this.sfuClient.sendAnswer({peerType:g.SUBSCRIBER,sdp:t.sdp||""}),this.isIceRestarting=!1},this.pc.addEventListener("track",this.handleOnTrack),this.on("subscriberOffer",async e=>this.negotiate(e).catch(e=>{this.logger("error","Negotiation failed.",e)}))}detachEventHandlers(){super.detachEventHandlers(),this.pc.removeEventListener("track",this.handleOnTrack)}}let ok=e=>{let{endpoint:t,onMessage:i,logTag:n}=e,r=s3(["SfuClientWS",n]);r("debug","Creating signaling WS channel:",t);let s=new WebSocket(t);return s.binaryType="arraybuffer",s.addEventListener("error",e=>{r("error","Signaling WS channel error",e)}),s.addEventListener("close",e=>{r("info","Signaling WS channel is closed",e)}),s.addEventListener("open",e=>{r("info","Signaling WS channel is open",e)}),s.addEventListener("message",e=>{try{let t=e.data instanceof ArrayBuffer?rO.fromBinary(new Uint8Array(e.data)):rO.fromJsonString(e.data.toString());i(t)}catch(t){r("error","Failed to decode a message. Check whether the Proto models match.",{event:e,error:t})}}),s},oC=e=>({bundlePolicy:"max-bundle",iceServers:e.map(e=>({urls:e.urls,username:e.username,credential:e.password}))});function oT(e){let t=!0,i=e.then(e=>({status:"resolved",result:e}),e=>({status:"rejected",error:e})).finally(()=>t=!1),n=()=>i.then(e=>{if("rejected"===e.status)throw e.error;return e.result});return n.checkPending=()=>t,n}let oE=()=>{let e,t,i=new Promise((i,n)=>{e=i,t=n}),n=!1,r=!1;return{promise:i,resolve:t=>{n=!0,e(t)},reject:e=>{r=!0,t(e)},isResolved:()=>n,isRejected:()=>r}},o_=Symbol("uninitialized");function oR(e){let t=o_;return()=>(t===o_&&(t=e()),t)}let oI={src:`const timerIdMapping = new Map();
self.addEventListener('message', (event) => {
    const request = event.data;
    switch (request.type) {
        case 'setTimeout':
        case 'setInterval':
            timerIdMapping.set(request.id, (request.type === 'setTimeout' ? setTimeout : setInterval)(() => {
                tick(request.id);
                if (request.type === 'setTimeout') {
                    timerIdMapping.delete(request.id);
                }
            }, request.timeout));
            break;
        case 'clearTimeout':
        case 'clearInterval':
            (request.type === 'clearTimeout' ? clearTimeout : clearInterval)(timerIdMapping.get(request.id));
            timerIdMapping.delete(request.id);
            break;
    }
});
function tick(id) {
    const message = { type: 'tick', id };
    self.postMessage(message);
}`};class ox{constructor(){this.currentTimerId=1,this.callbacks=new Map,this.fallback=!1}setup({useTimerWorker:e=!0}={}){if(!e){this.fallback=!0;return}try{let e=oI.src,t=new Blob([e],{type:"application/javascript; charset=utf-8"}),i=URL.createObjectURL(t);this.worker=new Worker(i,{name:"str-timer-worker"}),this.worker.addEventListener("message",e=>{let{type:t,id:i}=e.data;"tick"===t&&this.callbacks.get(i)?.()})}catch(e){s3(["timer-worker"])("error",e),this.fallback=!0}}destroy(){this.callbacks.clear(),this.worker?.terminate(),this.worker=void 0,this.fallback=!1}get ready(){return this.fallback||!!this.worker}setInterval(e,t){return this.setTimer("setInterval",e,t)}clearInterval(e){this.clearTimer("clearInterval",e)}setTimeout(e,t){return this.setTimer("setTimeout",e,t)}clearTimeout(e){this.clearTimer("clearTimeout",e)}setTimer(e,t,i){if(this.ready||this.setup(),this.fallback)return("setTimeout"===e?setTimeout:setInterval)(t,i);let n=this.getTimerId();return this.callbacks.set(n,()=>{t(),"setTimeout"===e&&this.callbacks.delete(n)}),this.sendMessage({type:e,id:n,timeout:i}),n}clearTimer(e,t){if(t){if(this.ready||this.setup(),this.fallback)return void("clearTimeout"===e?clearTimeout:clearInterval)(t);this.callbacks.delete(t),this.sendMessage({type:e,id:t})}}getTimerId(){return this.currentTimerId++}sendMessage(e){if(!this.worker)throw Error("Cannot use timer worker before it's set up");this.worker.postMessage(e)}}let oP=!1,oN=()=>{oP=!0},oO=oR(()=>{let e=new ox;return e.setup({useTimerWorker:oP}),e});class oD{constructor({dispatcher:e,credentials:t,sessionId:i,logTag:n,joinResponseTimeout:r=5e3,onSignalClose:s,streamClient:a,enableTracing:o}){this.iceTrickleBuffer=new ae,this.isLeaving=!1,this.isClosing=!1,this.pingIntervalInMs=1e4,this.unhealthyTimeoutInMs=this.pingIntervalInMs+5e3,this.joinResponseTask=oE(),this.abortController=new AbortController,this.createWebSocket=()=>{let e={callEnded:!0,changePublishQuality:!0,error:!0,goAway:!0};this.signalWs=ok({logTag:this.logTag,endpoint:`${this.credentials.server.ws_endpoint}?tag=${this.logTag}`,onMessage:t=>{this.lastMessageTimestamp=new Date,this.scheduleConnectionCheck();let i=t.eventPayload.oneofKind;e[i]&&this.tracer?.trace(i,t),this.dispatcher.dispatch(t,this.logTag)}}),this.signalReady=oT(Promise.race([new Promise((e,t)=>{let i=()=>{this.signalWs.removeEventListener("open",i),e(this.signalWs)};this.signalWs.addEventListener("open",i),this.signalWs.addEventListener("close",e=>{this.handleWebSocketClose(e),t(Error("SFU WS closed unexpectedly"))})}),new Promise((e,t)=>{setTimeout(()=>t(Error("SFU WS connection timed out")),this.joinResponseTimeout)})]))},this.cleanUpWebSocket=()=>{this.signalWs.removeEventListener("close",this.handleWebSocketClose)},this.handleWebSocketClose=e=>{this.signalWs.removeEventListener("close",this.handleWebSocketClose),oO().clearInterval(this.keepAliveInterval),clearTimeout(this.connectionCheckTimeout),this.onSignalClose?.(`${e.code} ${e.reason}`)},this.close=(e=oD.NORMAL_CLOSURE,t)=>{this.isClosing=!0,this.signalWs.readyState===WebSocket.OPEN&&(this.logger("debug",`Closing SFU WS connection: ${e} - ${t}`),this.signalWs.close(e,`js-client: ${t}`),this.cleanUpWebSocket()),this.dispose()},this.dispose=()=>{this.logger("debug","Disposing SFU client"),this.unsubscribeIceTrickle(),this.unsubscribeNetworkChanged(),clearInterval(this.keepAliveInterval),clearTimeout(this.connectionCheckTimeout),clearTimeout(this.migrateAwayTimeout),this.abortController.abort(),this.migrationTask?.resolve(),this.iceTrickleBuffer.dispose()},this.getTrace=()=>this.tracer?.take(),this.leaveAndClose=async e=>{await this.joinTask;try{this.isLeaving=!0,await this.notifyLeave(e)}catch(e){this.logger("debug","Error notifying SFU about leaving call",e)}this.close(oD.NORMAL_CLOSURE,e.substring(0,115))},this.updateSubscriptions=async e=>(await this.joinTask,s4(()=>this.rpc.updateSubscriptions({sessionId:this.sessionId,tracks:e}),this.abortController.signal)),this.setPublisher=async e=>(await this.joinTask,s4(()=>this.rpc.setPublisher({...e,sessionId:this.sessionId}),this.abortController.signal)),this.sendAnswer=async e=>(await this.joinTask,s4(()=>this.rpc.sendAnswer({...e,sessionId:this.sessionId}),this.abortController.signal)),this.iceTrickle=async e=>(await this.joinTask,s4(()=>this.rpc.iceTrickle({...e,sessionId:this.sessionId}),this.abortController.signal)),this.iceRestart=async e=>(await this.joinTask,s4(()=>this.rpc.iceRestart({...e,sessionId:this.sessionId}),this.abortController.signal)),this.updateMuteStates=async e=>(await this.joinTask,s4(()=>this.rpc.updateMuteStates({muteStates:e,sessionId:this.sessionId}),this.abortController.signal)),this.sendStats=async e=>(await this.joinTask,this.rpc.sendStats({...e,sessionId:this.sessionId})),this.startNoiseCancellation=async()=>(await this.joinTask,s4(()=>this.rpc.startNoiseCancellation({sessionId:this.sessionId}),this.abortController.signal)),this.stopNoiseCancellation=async()=>(await this.joinTask,s4(()=>this.rpc.stopNoiseCancellation({sessionId:this.sessionId}),this.abortController.signal)),this.enterMigration=async(e={})=>{this.isLeaving=!0;let{timeout:t=7e3}=e;this.migrationTask?.reject(Error("Cancelled previous migration"));let i=this.migrationTask=oE(),n=this.dispatcher.on("participantMigrationComplete",()=>{n(),clearTimeout(this.migrateAwayTimeout),i.resolve()});return this.migrateAwayTimeout=setTimeout(()=>{n(),i.reject(Error(`Migration (${this.logTag}) failed to complete in ${t}ms`))},t),i.promise},this.join=async e=>{let t;await this.signalReady(),(this.joinResponseTask.isResolved()||this.joinResponseTask.isRejected())&&(this.joinResponseTask=oE());let i=this.joinResponseTask,n=this.dispatcher.on("joinResponse",e=>{this.logger("debug","Received joinResponse",e),clearTimeout(t),n(),this.keepAlive(),i.resolve(e)});t=setTimeout(()=>{n(),i.reject(Error('Waiting for "joinResponse" has timed out'))},this.joinResponseTimeout);let r=rG.create({requestPayload:{oneofKind:"joinRequest",joinRequest:r4.create({...e,sessionId:this.sessionId,token:this.credentials.token})}});return this.tracer?.trace("joinRequest",r),await this.send(r),i.promise},this.ping=async()=>this.send(rG.create({requestPayload:{oneofKind:"healthCheckRequest",healthCheckRequest:{}}})),this.notifyLeave=async e=>this.send(rG.create({requestPayload:{oneofKind:"leaveCallRequest",leaveCallRequest:{sessionId:this.sessionId,reason:e}}})),this.send=async e=>{await this.signalReady();let t=rG.toJson(e);if(this.signalWs.readyState!==WebSocket.OPEN)return void this.logger("debug","Signal WS is not open. Skipping message",t);this.logger("debug",`Sending message to: ${this.edgeName}`,t),this.signalWs.send(rG.toBinary(e))},this.keepAlive=()=>{let e=oO();e.clearInterval(this.keepAliveInterval),this.keepAliveInterval=e.setInterval(()=>{this.ping().catch(e=>{this.logger("error","Error sending healthCheckRequest to SFU",e)})},this.pingIntervalInMs)},this.scheduleConnectionCheck=()=>{clearTimeout(this.connectionCheckTimeout),this.connectionCheckTimeout=setTimeout(()=>{this.lastMessageTimestamp&&new Date().getTime()-this.lastMessageTimestamp.getTime()>this.unhealthyTimeoutInMs&&this.close(oD.ERROR_CONNECTION_UNHEALTHY,`SFU connection unhealthy. Didn't receive any message for ${this.unhealthyTimeoutInMs}ms`)},this.unhealthyTimeoutInMs)},this.dispatcher=e,this.sessionId=i||sG(),this.onSignalClose=s,this.credentials=t;let{server:l,token:c}=t;this.edgeName=l.edge_name,this.joinResponseTimeout=r,this.logTag=n,this.logger=s3(["SfuClient",n]),this.tracer=o?new on(`${n}-${this.edgeName}`):void 0,this.rpc=s$({baseUrl:l.url,interceptors:[sU({Authorization:`Bearer ${c}`}),this.tracer&&sF(this.tracer.trace),"trace"===s2()&&sM(this.logger,"trace")].filter(e=>!!e)}),this.unsubscribeIceTrickle=e.on("iceTrickle",e=>{this.iceTrickleBuffer.push(e)}),this.unsubscribeNetworkChanged=a.on("network.changed",e=>{e.online?this.networkAvailableTask?.resolve():this.networkAvailableTask=oE()}),this.createWebSocket()}get isHealthy(){return this.signalWs.readyState===WebSocket.OPEN&&this.joinResponseTask.isResolved()}get joinTask(){return this.joinResponseTask.promise}}oD.NORMAL_CLOSURE=1e3,oD.ERROR_CONNECTION_UNHEALTHY=4001,oD.DISPOSE_OLD_SOCKET=4002;let oA=e=>async function(t){if(t.user.id===e.currentUserId)return;let{state:i}=e;t.call.created_by.id===e.currentUserId&&i.callingState===P.RINGING&&await e.join()},oj=e=>async function(t){if(t.user.id===e.currentUserId)return;let{call:i}=t,{session:n}=i;if(!n)return void e.logger("warn","No call session provided. Ignoring call.rejected event.",t);let r=n.rejected_by,{members:s,callingState:a}=e.state;if(a!==P.RINGING)return void e.logger("info","Call is not in ringing mode (it is either accepted or rejected already). Ignoring call.rejected event.",t);e.isCreatedByMe?s.filter(t=>t.user_id!==e.currentUserId).every(e=>r[e.user_id])&&(e.logger("info","everyone rejected, leaving the call"),await e.leave({reject:!0,reason:"cancel",message:"ring: everyone rejected"})):r[i.created_by.id]&&(e.logger("info","call creator rejected, leaving call"),await e.leave({message:"ring: creator rejected"}))},oL=e=>function(){let{callingState:t}=e.state;t!==P.IDLE&&t!==P.LEFT&&e.leave({message:"call.ended event received",reject:!1}).catch(t=>{e.logger("error","Failed to leave call after call.ended ",t)})},oU=e=>e.on("callEnded",async t=>{if(e.state.callingState!==P.LEFT)try{if(t.reason===T.LIVE_ENDED){e.state.setBackstage(!0);let{hasPermission:t}=e.permissionsContext;if(t(i2.JOIN_BACKSTAGE))return}e.state.setEndedAt(new Date);let i=T[t.reason];await e.leave({message:`callEnded received: ${i}`})}catch(t){e.logger("error","Failed to leave call after being ended by the SFU",t)}}),oM=e=>function(t){let{currentGrants:i}=t;if(i){let{canPublishAudio:t,canPublishVideo:n,canScreenshare:r}=i,s={[i2.SEND_AUDIO]:t,[i2.SEND_VIDEO]:n,[i2.SCREENSHARE]:r},a=e.ownCapabilities.filter(e=>!1!==s[e]);Object.entries(s).forEach(([e,t])=>{t&&!a.includes(e)&&a.push(e)}),e.setOwnCapabilities(a)}},oF=(e,t)=>e.on("connectionQualityChanged",e=>{let{connectionQualityUpdates:i}=e;i&&t.updateParticipants(i.reduce((e,t)=>{let{sessionId:i,connectionQuality:n}=t;return e[i]={connectionQuality:n},e},{}))}),o$=(e,t)=>e.on("healthCheckResponse",e=>{let{participantCount:i}=e;i&&(t.setParticipantCount(i.total),t.setAnonymousParticipantCount(i.anonymous))}),oV=(e,t)=>e.on("error",e=>{(!e.error||e.error.code===S.LIVE_ENDED)&&(t.state.setBackstage(!0),t.permissionsContext.hasPermission(i2.JOIN_BACKSTAGE)||t.leave({message:"live ended"}).catch(e=>{t.logger("error","Failed to leave call after live ended",e)}))}),oB=e=>e.on("error",e=>{if(!e.error)return;let t=s3(["SfuClient"]),{error:i,reconnectStrategy:n}=e;t("error","SFU reported error",{code:S[i.code],reconnectStrategy:E[n],message:i.message,shouldRetry:i.shouldRetry})}),oH=e=>function(t){let{pins:i}=t;e.setServerSidePins(i)},oq=e=>e.on("trackUnpublished",async t=>{let{cause:i,type:n,sessionId:r}=t,{localParticipant:s}=e.state;if(i===k.MODERATION&&r===s?.sessionId){let t=e.logger;t("info",`Local participant's ${y[n]} track is muted remotely`);try{n===y.VIDEO?await e.camera.disable():n===y.AUDIO?await e.microphone.disable():n===y.SCREEN_SHARE||n===y.SCREEN_SHARE_AUDIO?await e.screenShare.disable():t("warn","Unsupported track type to soft mute",y[n])}catch(e){t("error","Failed to stop publishing",e)}}}),oW=(e,...t)=>{for(let i of t)e.includes(i)||e.push(i);return e},oG=e=>function(t){let{participant:i}=t;if(!i)return;let n=oX(e,i);e.updateOrAddParticipant(i.sessionId,Object.assign(i,n,{viewportVisibilityState:{videoTrack:I.UNKNOWN,screenShareTrack:I.UNKNOWN}}))},oJ=e=>function(t){let{participant:i}=t;i&&e.setParticipants(e=>e.filter(e=>e.sessionId!==i.sessionId))},oK=e=>function(t){let{participant:i}=t;i&&e.updateParticipant(i.sessionId,i)},oz=e=>function(t){let{type:i,sessionId:n}=t;if(t.participant){let i=oX(e,t.participant),r=Object.assign(t.participant,i);e.updateOrAddParticipant(n,r)}else e.updateParticipant(n,e=>({publishedTracks:oW([...e.publishedTracks],i)}))},oY=e=>function(t){let{type:i,sessionId:n}=t;if(t.participant){let i=oX(e,t.participant),r=Object.assign(t.participant,i);e.updateOrAddParticipant(n,r)}else e.updateParticipant(n,e=>({publishedTracks:e.publishedTracks.filter(e=>e!==i)}))},oX=(e,t)=>{let i=e.takeOrphanedTracks(t.trackLookupPrefix);if(!i.length)return;let n={};for(let e of i){let t=oo(e.trackType);t&&(n[t]=e.track)}return n},oZ=(e,t)=>e.on("dominantSpeakerChanged",e=>{let{sessionId:i}=e;i!==t.dominantSpeaker?.sessionId&&t.setParticipants(e=>e.map(e=>e.sessionId===i?{...e,isDominantSpeaker:!0}:e.isDominantSpeaker?{...e,isDominantSpeaker:!1}:e))}),oQ=(e,t)=>e.on("audioLevelChanged",e=>{let{audioLevels:i}=e;t.updateParticipants(i.reduce((e,t)=>(e[t.sessionId]={audioLevel:t.level,isSpeaking:t.isSpeaking},e),{}))}),o0=(e,t)=>{let i=e.state,n=[e.on("call.ended",oL(e)),oU(e),oV(t,e),oB(t),oF(t,i),o$(t,i),e.on("participantJoined",oG(i)),e.on("participantLeft",oJ(i)),e.on("participantUpdated",oK(i)),e.on("trackPublished",oz(i)),e.on("trackUnpublished",oY(i)),oQ(t,i),oZ(t,i),e.on("callGrantsUpdated",oM(i)),e.on("pinsUpdated",oH(i)),oq(e)];return e.ringing&&n.push(o1(e)),()=>{n.forEach(e=>e())}},o1=e=>{let t={"call.accepted":oA(e),"call.rejected":oj(e)},i=Object.keys(t).map(i=>e.on(i,t[i]));return()=>{i.forEach(e=>e())}};class o2{constructor(){this.elementHandlerMap=new Map,this.observer=null,this.queueSet=new Set,this.setViewport=(e,t)=>(this.observer=new IntersectionObserver(e=>{e.forEach(e=>{let t=this.elementHandlerMap.get(e.target);t?.(e)})},{root:e,...t,threshold:t?.threshold??.35}),this.queueSet.size&&(this.queueSet.forEach(([t,i])=>{e.contains(t)&&(this.observer.observe(t),this.elementHandlerMap.set(t,i))}),this.queueSet.clear()),()=>{this.observer?.disconnect(),this.observer=null,this.elementHandlerMap.clear()}),this.observe=(e,t)=>{let i=[e,t],n=()=>{this.elementHandlerMap.delete(e),this.observer?.unobserve(e),this.queueSet.delete(i)};return this.elementHandlerMap.has(e)||(this.observer?this.observer.root.contains(e)&&(this.elementHandlerMap.set(e,t),this.observer.observe(e)):this.queueSet.add(i)),n}}}let o3={videoTrack:I.UNKNOWN,screenShareTrack:I.UNKNOWN},o4=Symbol("globalOverrideKey");class o6{constructor(e,t){this.viewportTracker=new o2,this.logger=s3(["DynascaleManager"]),this.pendingSubscriptionsUpdate=null,this.videoTrackSubscriptionOverridesSubject=new iR({}),this.videoTrackSubscriptionOverrides$=this.videoTrackSubscriptionOverridesSubject.asObservable(),this.incomingVideoSettings$=this.videoTrackSubscriptionOverrides$.pipe(iS(e=>{let{[o4]:t,...i}=e;return{enabled:t?.enabled!==!1,preferredResolution:t?.enabled?t.dimension:void 0,participants:Object.fromEntries(Object.entries(i).map(([e,t])=>[e,{enabled:t?.enabled!==!1,preferredResolution:t?.enabled?t.dimension:void 0}])),isParticipantVideoEnabled:t=>e[t]?.enabled??e[o4]?.enabled??!0}}),ix(1)),this.setVideoTrackSubscriptionOverrides=(e,t)=>t?ac(this.videoTrackSubscriptionOverridesSubject,i=>({...i,...Object.fromEntries(t.map(t=>[t,e]))})):ac(this.videoTrackSubscriptionOverridesSubject,e?{[o4]:e}:{}),this.applyTrackSubscriptions=(e=x.SLOW)=>{this.pendingSubscriptionsUpdate&&clearTimeout(this.pendingSubscriptionsUpdate);let t=()=>{this.pendingSubscriptionsUpdate=null,this.sfuClient?.updateSubscriptions(this.trackSubscriptions).catch(e=>{this.logger("debug","Failed to update track subscriptions",e)})};e?this.pendingSubscriptionsUpdate=setTimeout(t,e):t()},this.trackElementVisibility=(e,t,i)=>{let n=this.viewportTracker.observe(e,n=>{this.callState.updateParticipant(t,t=>{let r=t.viewportVisibilityState??o3,s=n.isIntersecting||document.fullscreenElement===e?I.VISIBLE:I.INVISIBLE;return{...t,viewportVisibilityState:{...r,[i]:s}}})});return()=>{n(),this.callState.updateParticipant(t,e=>{let t=e.viewportVisibilityState??o3;return{...e,viewportVisibilityState:{...t,[i]:I.UNKNOWN}}})}},this.setViewport=e=>this.viewportTracker.setViewport(e),this.bindVideoElement=(e,t,i)=>{let n,r,s=this.callState.findParticipantBySessionId(t);if(!s)return;let a=(e,n)=>{n&&(0===n.width||0===n.height)&&(this.logger("debug","Ignoring 0x0 dimension",s),n=void 0),this.callState.updateParticipantTracks(i,{[t]:{dimension:n}}),this.applyTrackSubscriptions(e)},o=this.callState.participants$.pipe(iS(e=>e.find(e=>e.sessionId===t)),iO(e=>!!e),iP(),ix({bufferSize:1,refCount:!0})),l=s.isLocalParticipant?null:o.pipe(iS(e=>e.viewportVisibilityState?.[i]),iP()).subscribe(t=>{if(!n){n=t??I.UNKNOWN;return}if(n=t??I.UNKNOWN,t===I.INVISIBLE)return a(x.MEDIUM,void 0);a(x.MEDIUM,{width:e.clientWidth,height:e.clientHeight})}),c=s.isLocalParticipant?null:new ResizeObserver(()=>{let t={width:e.clientWidth,height:e.clientHeight};if(!r){r=t;return}(r.width!==t.width||r.height!==t.height)&&n!==I.INVISIBLE&&(a(Math.max(t.width/r.width,t.height/r.height)>1.2?x.IMMEDIATE:x.MEDIUM,{width:e.clientWidth,height:e.clientHeight}),r=t)});c?.observe(e);let u=s.isLocalParticipant?null:o.pipe(iD("publishedTracks"),iS(e=>"videoTrack"===i?ab(e):aS(e)),iP()).subscribe(t=>{t?a(x.IMMEDIATE,{width:e.clientWidth,height:e.clientHeight}):a(x.FAST,void 0)});e.autoplay=!0,e.playsInline=!0,e.muted=!0;let d=o.pipe(iD("videoTrack"===i?"videoStream":"screenShareStream")).subscribe(t=>{let n="videoTrack"===i?t.videoStream:t.screenShareStream;e.srcObject!==n&&(e.srcObject=n??null,(aq()||aW())&&setTimeout(()=>{e.srcObject=n??null,e.play().catch(e=>{this.logger("warn","Failed to play stream",e)})},25))});return()=>{a(x.FAST,void 0),l?.unsubscribe(),u?.unsubscribe(),d.unsubscribe(),c?.disconnect()}},this.bindAudioElement=(e,t,i)=>{let n=this.callState.findParticipantBySessionId(t);if(!n||n.isLocalParticipant)return;let r=this.callState.participants$.pipe(iS(e=>e.find(e=>e.sessionId===t)),iO(e=>!!e),iP(),ix({bufferSize:1,refCount:!0})),s=r.pipe(iD("screenShareAudioTrack"===i?"screenShareAudioStream":"audioStream")).subscribe(t=>{let n="screenShareAudioTrack"===i?t.screenShareAudioStream:t.audioStream;e.srcObject!==n&&setTimeout(()=>{if(e.srcObject=n??null,e.srcObject){e.play().catch(e=>{this.logger("warn","Failed to play stream",e)});let{selectedDevice:t}=this.speaker.state;t&&"setSinkId"in e&&e.setSinkId(t)}})}),a="setSinkId"in e?this.speaker.state.selectedDevice$.subscribe(t=>{t&&e.setSinkId(t)}):null,o=iE([this.speaker.state.volume$,r.pipe(iD("audioVolume"))]).subscribe(([t,i])=>{e.volume=i.audioVolume??t});return e.autoplay=!0,()=>{a?.unsubscribe(),o.unsubscribe(),s.unsubscribe()}},this.callState=e,this.speaker=t}setSfuClient(e){this.sfuClient=e}get trackSubscriptions(){let e=[];for(let t of this.callState.remoteParticipants){if(t.videoDimension&&ab(t)){let i=this.videoTrackSubscriptionOverrides[t.sessionId]??this.videoTrackSubscriptionOverrides[o4];i?.enabled!==!1&&e.push({userId:t.userId,sessionId:t.sessionId,trackType:y.VIDEO,dimension:i?.dimension??t.videoDimension})}t.screenShareDimension&&aS(t)&&e.push({userId:t.userId,sessionId:t.sessionId,trackType:y.SCREEN_SHARE,dimension:t.screenShareDimension}),aw(t)&&e.push({userId:t.userId,sessionId:t.sessionId,trackType:y.SCREEN_SHARE_AUDIO})}return e}get videoTrackSubscriptionOverrides(){return al(this.videoTrackSubscriptionOverrides$)}}class o5{constructor(){this.permissions=[],this.setPermissions=e=>{this.permissions=e||[]},this.setCallSettings=e=>{this.settings=e},this.hasPermission=e=>this.permissions.includes(e),this.canPublish=e=>{switch(e){case y.AUDIO:return this.hasPermission(i2.SEND_AUDIO);case y.VIDEO:return this.hasPermission(i2.SEND_VIDEO);case y.SCREEN_SHARE:case y.SCREEN_SHARE_AUDIO:return this.hasPermission(i2.SCREENSHARE);case y.UNSPECIFIED:return!1;default:oa(e,"Unknown track type")}},this.canRequest=(e,t=this.settings)=>{if(!t)return!1;let{audio:i,video:n,screensharing:r}=t;switch(e){case i2.SEND_AUDIO:return i.access_request_enabled;case i2.SEND_VIDEO:return n.access_request_enabled;case i2.SCREENSHARE:return r.access_request_enabled;default:return!1}}}}class o9{constructor(e,t={sortParticipantsBy:aD}){this.name=e,this.options=t}}class o8{constructor(e){this.register=e=>{this.callTypes[e.name]=e},this.unregister=e=>{delete this.callTypes[e]},this.get=e=>(this.callTypes[e]||this.register(new o9(e)),this.callTypes[e]),this.callTypes=e.reduce((e,t)=>(e[t.name]=t,e),{})}}let o7=new o8([new o9("default",{sortParticipantsBy:aD}),new o9("development",{sortParticipantsBy:aD}),new o9("livestream",{sortParticipantsBy:aL}),new o9("audio_room",{sortParticipantsBy:aL})]);class le{constructor(e){this.permission=e,this.disposeController=new AbortController,this.wasPrompted=!1,this.listeners=new Set,this.logger=s3(["permissions"]);let t=this.disposeController.signal;this.ready=(async()=>{let i=()=>{this.setState("prompt")};if(!(!sY()&&"undefined"!=typeof navigator&&navigator.permissions?.query))return i();try{let i=await navigator.permissions.query({name:e.queryName});t.aborted||(this.setState(i.state),i.addEventListener("change",()=>this.setState(i.state),{signal:t}))}catch(e){this.logger("debug","Failed to query permission status",e),i()}})()}dispose(){this.state=void 0,this.disposeController.abort()}async getState(){if(await this.ready,!this.state)throw Error("BrowserPermission instance possibly disposed");return this.state}async prompt({forcePrompt:e=!1,throwOnNotAllowed:t=!1}={}){return await ai(`permission-prompt-${this.permission.queryName}`,async()=>{if(await this.getState()!=="prompt"||this.wasPrompted&&!e){let e="granted"===this.state;if(!e&&t)throw Error("Permission was not granted previously, and prompting again is not allowed");return e}try{this.wasPrompted=!0,this.setState("prompting");let e=await navigator.mediaDevices.getUserMedia(this.permission.constraints);return ly(e),this.setState("granted"),!0}catch(e){if(e&&"object"==typeof e&&"name"in e&&("NotAllowedError"===e.name||"SecurityError"===e.name)){if(this.logger("info","Browser permission was not granted",{permission:this.permission}),this.setState("denied"),t)throw e;return!1}throw this.logger("error","Failed to getUserMedia",{error:e,permission:this.permission}),this.setState("prompt"),e}})}listen(e){return this.listeners.add(e),this.state&&e(this.state),()=>this.listeners.delete(e)}asObservable(){return this.getStateObservable().pipe(iS(e=>"denied"!==e))}asStateObservable(){return this.getStateObservable()}getIsPromptingObservable(){return this.getStateObservable().pipe(iS(e=>"prompting"===e))}getStateObservable(){return function e(t,i,n){return n?e(t,i).pipe(ik(n)):new tQ(function(e){var n=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return e.next(1===t.length?t[0]:t)},r=t(n);return tR(i)?function(){return i(n,r)}:void 0})}(e=>this.listen(e),(e,t)=>t())}setState(e){this.state!==e&&(this.state=e,this.listeners.forEach(t=>t(e)))}}let lt=(e,t)=>iy((async()=>{let i=await navigator.mediaDevices.enumerateDevices();return i.some(e=>e.kind===t&&""===e.label)&&await e.prompt()&&(i=await navigator.mediaDevices.enumerateDevices()),i.filter(e=>e.kind===t&&""!==e.label&&"default"!==e.deviceId)})()),li=()=>"undefined"!=typeof document&&"setSinkId"in document.createElement("audio"),ln={audio:{autoGainControl:!0,noiseSuppression:!0,echoCancellation:!0}},lr={video:{width:1280,height:720}},ls=oR(()=>new le({constraints:ln,queryName:"microphone"})),la=oR(()=>new le({constraints:lr,queryName:"camera"})),lo=oR(()=>navigator.mediaDevices.addEventListener?(function e(t,i,n,r){if(tR(n)&&(r=n,n=void 0),r)return e(t,i,n).pipe(ik(r));var s,a,o,l=(0,t_.zs)(tR((s=t).addEventListener)&&tR(s.removeEventListener)?iL.map(function(e){return function(r){return t[e](i,r,n)}}):tR((a=t).addListener)&&tR(a.removeListener)?ij.map(iM(t,i)):tR((o=t).on)&&tR(o.off)?iU.map(iM(t,i)):[],2),c=l[0],u=l[1];if(!c&&ie(t))return iA(function(t){return e(t,i,n)})(ic(t));if(!c)throw TypeError("Invalid event target");return new tQ(function(e){var t=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return e.next(1<t.length?t:t[0])};return c(t),function(){return u(t)}})})(navigator.mediaDevices,"devicechange").pipe(iS(()=>void 0),function(e,t){return void 0===t&&(t=iH),ih(function(e,i){var n=null,r=null,s=null,a=function(){if(n){n.unsubscribe(),n=null;var e=r;r=null,i.next(e)}};function o(){var e=s+500,r=t.now();if(r<e){n=this.schedule(void 0,e-r),i.add(n);return}a()}e.subscribe(ip(i,function(e){r=e,s=t.now(),n||(n=t.schedule(o,500),i.add(n))},function(){a(),i.complete()},void 0,function(){r=n=null}))})}(500)):iy([])),ll=oR(()=>iG(lo(),ls().asObservable()).pipe(iK(void 0),iz(()=>lt(ls(),"audioinput")),ix(1))),lc=oR(()=>iG(lo(),la().asObservable()).pipe(iK(void 0),iz(()=>lt(la(),"videoinput")),ix(1))),lu=oR(()=>iG(lo(),ls().asObservable()).pipe(iK(void 0),iz(()=>lt(ls(),"audiooutput")),ix(1))),ld=0,lh=async(e,t)=>{let i=`navigator.mediaDevices.getUserMedia.${ld++}.`;try{t?.trace(i,e);let n=await navigator.mediaDevices.getUserMedia(e);return t?.trace(`${i}OnSuccess`,a$(n)),aW()&&navigator.mediaDevices.dispatchEvent(new Event("devicechange")),n}catch(e){throw t?.trace(`${i}OnFailure`,e.name),e}};function lp(e){return!!e&&"object"==typeof e&&(!!("name"in e&&"string"==typeof e.name&&["OverconstrainedError","NotFoundError"].includes(e.name)||"message"in e&&"string"==typeof e.message&&e.message.startsWith("OverconstrainedError"))||!1)}let lf=async(e,t)=>{let i={audio:{...ln.audio,...e}};try{return await ls().prompt({throwOnNotAllowed:!0,forcePrompt:!0}),await lh(i,t)}catch(t){if(lp(t)&&e?.deviceId){let{deviceId:n,...r}=e;return s3(["devices"])("warn","Failed to get audio stream, will try again with relaxed constraints",{error:t,constraints:i,relaxedConstraints:r}),lf(r)}throw s3(["devices"])("error","Failed to get audio stream",{error:t,constraints:i}),t}},lm=async(e,t)=>{let i={video:{...lr.video,...e}};try{return await la().prompt({throwOnNotAllowed:!0,forcePrompt:!0}),await lh(i,t)}catch(t){if(lp(t)&&e?.deviceId){let{deviceId:n,...r}=e;return s3(["devices"])("warn","Failed to get video stream, will try again with relaxed constraints",{error:t,constraints:i,relaxedConstraints:r}),lm(r)}throw s3(["devices"])("error","Failed to get video stream",{error:t,constraints:i}),t}},lg=0,lv=async(e,t)=>{let i=`navigator.mediaDevices.getDisplayMedia.${lg++}.`;try{t?.trace(i,e);let n=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:{channelCount:{ideal:2},echoCancellation:!1,autoGainControl:!1,noiseSuppression:!1},systemAudio:"include",...e});return t?.trace(`${i}OnSuccess`,a$(n)),n}catch(e){throw t?.trace(`${i}OnFailure`,e.name),s3(["devices"])("error","Failed to get screen share stream",e),e}},lb="undefined"!=typeof navigator&&void 0!==navigator.mediaDevices?lo().pipe(iK(void 0),iz(()=>navigator.mediaDevices.enumerateDevices()),ix(1)):void 0,ly=e=>{e.active&&(e.getTracks().forEach(e=>{e.stop()}),"function"==typeof e.release&&e.release())},lS=()=>/Mobi/i.test(navigator.userAgent);class lw{constructor(e,t,i){this.stopOnLeave=!0,this.subscriptions=[],this.isTrackStoppedDueToTrackEnd=!1,this.filters=[],this.statusChangeConcurrencyTag=Symbol("statusChangeConcurrencyTag"),this.filterRegistrationConcurrencyTag=Symbol("filterRegistrationConcurrencyTag"),this.dispose=()=>{this.subscriptions.forEach(e=>e())},this.call=e,this.state=t,this.trackType=i,this.logger=s3([`${y[i].toLowerCase()} manager`]),lb&&!sY()&&(this.trackType===y.AUDIO||this.trackType===y.VIDEO)&&this.handleDisconnectedOrReplacedDevices()}listDevices(){return this.getDevices()}get enabled(){return"enabled"===this.state.status}async enable(){this.state.prevStatus=this.state.optimisticStatus,"enabled"!==this.state.optimisticStatus&&(this.state.setPendingStatus("enabled"),await an(this.statusChangeConcurrencyTag,async e=>{try{await this.unmuteStream(),this.state.setStatus("enabled")}finally{e.aborted||this.state.setPendingStatus(this.state.status)}}))}async disable(e=!1){this.state.prevStatus=this.state.optimisticStatus,(e||"disabled"!==this.state.optimisticStatus)&&(this.state.setPendingStatus("disabled"),await an(this.statusChangeConcurrencyTag,async t=>{try{let t=e||"stop-tracks"===this.state.disableMode;await this.muteStream(t),this.state.setStatus("disabled")}finally{t.aborted||this.state.setPendingStatus(this.state.status)}}))}async statusChangeSettled(){await as(this.statusChangeConcurrencyTag)}async resume(){"enabled"===this.state.prevStatus&&"enabled"!==this.state.status&&await this.enable()}async toggle(){return"enabled"===this.state.optimisticStatus?await this.disable():await this.enable()}registerFilter(e){let t={start:e,stop:void 0};return this.call.tracer.trace(`registerFilter.${y[this.trackType]}`,null),{registered:ai(this.filterRegistrationConcurrencyTag,async()=>{await as(this.statusChangeConcurrencyTag),this.filters.push(t),await this.applySettingsToStream()}),unregister:()=>ai(this.filterRegistrationConcurrencyTag,async()=>{await as(this.statusChangeConcurrencyTag),t.stop?.(),this.filters=this.filters.filter(e=>e!==t),await this.applySettingsToStream()})}}setDefaultConstraints(e){this.state.setDefaultConstraints(e)}async select(e){if(sY())throw Error("This method is not supported in React Native. Please visit https://getstream.io/video/docs/reactnative/core/camera-and-microphone/#speaker-management for reference.");let t=this.state.selectedDevice;if(e!==t)try{this.state.setDevice(e),await this.applySettingsToStream()}catch(e){throw this.state.setDevice(t),e}}async applySettingsToStream(){await an(this.statusChangeConcurrencyTag,async()=>{this.enabled&&(await this.muteStream(),await this.unmuteStream())})}publishStream(e){return this.call.publish(e,this.trackType)}stopPublishStream(){return this.call.stopPublish(this.trackType)}getTracks(){return this.state.mediaStream?.getTracks()??[]}async muteStream(e=!0){let t=this.state.mediaStream;t&&(this.logger("debug",`${e?"Stopping":"Disabling"} stream`),this.call.state.callingState===P.JOINED&&await this.stopPublishStream(),this.muteLocalStream(e),this.getTracks().every(e=>"ended"===e.readyState)&&("function"==typeof t.release&&t.release(),this.state.setMediaStream(void 0,void 0),this.filters.forEach(e=>e.stop?.())))}disableTracks(){this.getTracks().forEach(e=>{e.enabled&&(e.enabled=!1)})}enableTracks(){this.getTracks().forEach(e=>{e.enabled||(e.enabled=!0)})}stopTracks(){this.getTracks().forEach(e=>{"live"===e.readyState&&e.stop()})}muteLocalStream(e){this.state.mediaStream&&(e?this.stopTracks():this.disableTracks())}async unmuteStream(){let e,t;this.logger("debug","Starting stream");try{if(this.state.mediaStream&&this.getTracks().every(e=>"live"===e.readyState))e=this.state.mediaStream,this.enableTracks();else{let i={...this.state.defaultConstraints,deviceId:this.state.selectedDevice?{exact:this.state.selectedDevice}:void 0},n=e=>async t=>{if(!e)return t;let i=await e;return t.getTracks().forEach(e=>{let t=e.stop;e.stop=function(){t.call(e),i.getTracks().forEach(t=>{t.kind===e.kind&&t.stop()})}}),i.getTracks().forEach(e=>{let i=()=>{t.getTracks().forEach(t=>{e.kind===t.kind&&(t.stop(),t.dispatchEvent(new Event("ended")))})};e.addEventListener("ended",i),this.subscriptions.push(()=>{e.removeEventListener("ended",i)})}),t};t=this.getStream(i),e=await this.filters.reduce((e,t)=>e.then(e=>{let{stop:i,output:n}=t.start(e);return t.stop=i,n}).then(n(e),t=>(this.logger("warn","Filter failed to start and will be ignored",t),e)),t)}if(this.call.state.callingState===P.JOINED&&await this.publishStream(e),this.state.mediaStream!==e){this.state.setMediaStream(e,await t);let i=async()=>{await this.statusChangeSettled(),this.enabled&&(this.isTrackStoppedDueToTrackEnd=!0,setTimeout(()=>{this.isTrackStoppedDueToTrackEnd=!1},2e3),await this.disable())},n=e=>()=>{lS()&&this.trackType===y.VIDEO&&this.call.notifyTrackMuteState(e,this.trackType).catch(e=>{this.logger("warn","Error while notifying track mute state",e)})};e.getTracks().forEach(e=>{let t=n(!0),r=n(!1);e.addEventListener("mute",t),e.addEventListener("unmute",r),e.addEventListener("ended",i),this.subscriptions.push(()=>{e.removeEventListener("mute",t),e.removeEventListener("unmute",r),e.removeEventListener("ended",i)})})}}catch(e){throw t&&ly(await t),e}}get mediaDeviceKind(){return this.trackType===y.AUDIO?"audioinput":this.trackType===y.VIDEO?"videoinput":""}handleDisconnectedOrReplacedDevices(){this.subscriptions.push(ad(iE([lb.pipe(ih(function(e,t){var i,n=!1;e.subscribe(ip(t,function(e){var r=i;i=e,n&&t.next([r,e]),n=!0}))})),this.state.selectedDevice$]),async([[e,t],i])=>{try{if(!i)return;await this.statusChangeSettled();let n=!1,r=!1,s=this.findDevice(t,i),a=this.findDevice(e,i);!s&&a?n=!0:s&&a&&s.deviceId===a.deviceId&&s.groupId!==a.groupId&&(r=!0),n&&(await this.disable(),await this.select(void 0)),r&&(this.isTrackStoppedDueToTrackEnd&&"disabled"===this.state.status?(await this.enable(),this.isTrackStoppedDueToTrackEnd=!1):await this.applySettingsToStream())}catch(e){this.logger("warn","Unexpected error while handling disconnected or replaced device",e)}}))}findDevice(e,t){let i=this.mediaDeviceKind;return e.find(e=>e.deviceId===t&&e.kind===i)}}class lk{constructor(e="stop-tracks",t){this.disableMode=e,this.statusSubject=new iR(void 0),this.optimisticStatusSubject=new iR(void 0),this.mediaStreamSubject=new iR(void 0),this.selectedDeviceSubject=new iR(void 0),this.defaultConstraintsSubject=new iR(void 0),this.mediaStream$=this.mediaStreamSubject.asObservable(),this.selectedDevice$=this.selectedDeviceSubject.asObservable().pipe(iP()),this.status$=this.statusSubject.asObservable().pipe(iP()),this.optimisticStatus$=this.optimisticStatusSubject.asObservable().pipe(iP()),this.defaultConstraints$=this.defaultConstraintsSubject.asObservable(),this.hasBrowserPermission$=t?t.asObservable().pipe(ix(1)):iY(!0),this.browserPermissionState$=t?t.asStateObservable().pipe(ix(1)):iY("prompt"),this.isPromptingPermission$=t?t.getIsPromptingObservable().pipe(ix(1)):iY(!1)}get status(){return al(this.status$)}get optimisticStatus(){return al(this.optimisticStatus$)}get selectedDevice(){return al(this.selectedDevice$)}get mediaStream(){return al(this.mediaStream$)}setStatus(e){ac(this.statusSubject,e)}setPendingStatus(e){ac(this.optimisticStatusSubject,e)}setMediaStream(e,t){ac(this.mediaStreamSubject,e),t&&this.setDevice(this.getDeviceIdFromStream(t))}setDevice(e){ac(this.selectedDeviceSubject,e)}get defaultConstraints(){return al(this.defaultConstraints$)}setDefaultConstraints(e){ac(this.defaultConstraintsSubject,e)}}class lC extends lk{constructor(){super("stop-tracks",la()),this.directionSubject=new iR(void 0),this.direction$=this.directionSubject.asObservable().pipe(iP())}get direction(){return al(this.direction$)}setDirection(e){ac(this.directionSubject,e)}setMediaStream(e,t){if(super.setMediaStream(e,t),e){let t=sY()?this.direction:e.getVideoTracks()[0]?.getSettings().facingMode==="environment"?"back":"front";this.setDirection(t)}}getDeviceIdFromStream(e){let[t]=e.getVideoTracks();return t?.getSettings().deviceId}}class lT extends lw{constructor(e){super(e,new lC,y.VIDEO),this.targetResolution={width:1280,height:720}}isDirectionSupportedByDevice(){return sY()||lS()}async selectDirection(e){if(!this.isDirectionSupportedByDevice())return void this.logger("warn","Setting direction is not supported on this device");if(this.state.setDirection(e),this.state.setDevice(void 0),sY()){let t=this.getTracks()[0];await t?.applyConstraints({facingMode:"front"===e?"user":"environment"});return}this.getTracks().forEach(e=>e.stop());try{await this.unmuteStream()}catch(e){throw e instanceof Error&&"NotReadableError"===e.name&&(await this.muteStream(),await this.unmuteStream()),e}}async flip(){let e="front"===this.state.direction?"back":"front";await this.selectDirection(e)}async selectTargetResolution(e){if(this.targetResolution.height=e.height,this.targetResolution.width=e.width,"enabled"===this.state.optimisticStatus)try{await this.statusChangeSettled()}catch(e){this.logger("warn","could not apply target resolution",e)}if(this.enabled&&this.state.mediaStream){let[e]=this.state.mediaStream.getVideoTracks();if(!e)return;let{width:t,height:i}=e.getSettings();(t!==this.targetResolution.width||i!==this.targetResolution.height)&&(await this.applySettingsToStream(),this.logger("debug",`${t}x${i} target resolution applied to media stream`))}}async apply(e,t){let i=!!this.call.state.localParticipant?.videoStream,n=this.call.permissionsContext.hasPermission(i2.SEND_AUDIO);if(i||!n)return;await this.statusChangeSettled();let{target_resolution:r,camera_facing:s,camera_default_on:a}=e;if(await this.selectTargetResolution(r),this.state.direction||this.state.selectedDevice||this.state.setDirection("front"===s?"front":"back"),!t)return;let{mediaStream:o}=this.state;this.enabled&&o?await this.publishStream(o):void 0===this.state.status&&a&&await this.enable()}getDevices(){return lc()}getStream(e){return e.width=this.targetResolution.width,e.height=this.targetResolution.height,!e.deviceId&&this.state.direction&&this.isDirectionSupportedByDevice()&&(e.facingMode="front"===this.state.direction?"user":"environment"),lm(e,this.call.tracer)}}class lE extends lk{constructor(e){super(e,ls()),this.speakingWhileMutedSubject=new iR(!1),this.speakingWhileMuted$=this.speakingWhileMutedSubject.asObservable().pipe(iP())}get speakingWhileMuted(){return al(this.speakingWhileMuted$)}setSpeakingWhileMuted(e){ac(this.speakingWhileMutedSubject,e)}getDeviceIdFromStream(e){let[t]=e.getAudioTracks();return t?.getSettings().deviceId}}let l_=(e,t,i={})=>{let{detectionFrequencyInMs:n=500,audioLevelThreshold:r=150,fftSize:s=128,destroyStreamOnStop:a=!0}=i,o=new AudioContext,l=o.createAnalyser();l.fftSize=s;let c=o.createMediaStreamSource(e);c.connect(l);let u=setInterval(()=>{let i=new Uint8Array(l.frequencyBinCount);l.getByteFrequencyData(i);let n=i.some(e=>e>=r),s=i.reduce((e,t)=>e+t,0)/i.length,a=s>r?100:Math.round(s/r*100);e.getAudioTracks()[0]?.enabled?t({isSoundDetected:n,audioLevel:a}):t({isSoundDetected:!1,audioLevel:0})},n);return async function(){clearInterval(u),c.disconnect(),l.disconnect(),"closed"!==o.state&&await o.close(),a&&e.getTracks().forEach(t=>{t.stop(),e.removeTrack(t)})}};class lR{constructor(){this.pc1=new RTCPeerConnection({}),this.pc2=new RTCPeerConnection({})}async start(e){try{this.cleanupAudioStream();let t=await navigator.mediaDevices.getUserMedia({audio:!0});this.audioStream=t,this.pc1.addEventListener("icecandidate",async e=>{await this.pc2.addIceCandidate(e.candidate)}),this.pc2.addEventListener("icecandidate",async e=>{await this.pc1.addIceCandidate(e.candidate)}),this.pc2.addEventListener("track",e=>{e.streams[0].getTracks().forEach(e=>{e._setVolume(0)})}),t.getTracks().forEach(e=>this.pc1.addTrack(e,t));let i=await this.pc1.createOffer({});await this.pc2.setRemoteDescription(i),await this.pc1.setLocalDescription(i);let n=await this.pc2.createAnswer();await this.pc1.setRemoteDescription(n),await this.pc2.setLocalDescription(n);let r=this.onSpeakingDetectedStateChange(e);return()=>{r(),this.stop()}}catch(e){return s3(["RNSpeechDetector"])("error","error handling permissions: ",e),()=>{}}}stop(){this.pc1.close(),this.pc2.close(),this.cleanupAudioStream()}onSpeakingDetectedStateChange(e){let t,i,n=.13,r=!1,s=[],a=setInterval(async()=>{try{let a=await this.pc1.getStats(),o=aF(a).find(e=>"media-source"===e.type&&"audio"===e.kind);if(o){let{audioLevel:a}=o;if(a){s.push(a),s.length>10&&s.shift();let o=s.reduce((e,t)=>e+t,0)/s.length;o<1.1*n?i||(i=setTimeout(()=>{n=Math.min(.9*o,.13)},5e3)):(clearTimeout(i),i=void 0),o>1.5*n&&(r||(r=!0,e({isSoundDetected:!0,audioLevel:a})),clearTimeout(t),t=setTimeout(()=>{r=!1,e({isSoundDetected:!1,audioLevel:0})},500))}}}catch(e){s3(["RNSpeechDetector"])("error","error checking audio level from stats",e)}},100);return()=>{clearInterval(a),clearTimeout(t),clearTimeout(i)}}cleanupAudioStream(){this.audioStream&&(this.audioStream.getTracks().forEach(e=>e.stop()),"function"==typeof this.audioStream.release&&this.audioStream.release())}}class lI extends lw{constructor(e,t="stop-tracks"){super(e,new lE(t),y.AUDIO),this.speakingWhileMutedNotificationEnabled=!0,this.soundDetectorConcurrencyTag=Symbol("soundDetectorConcurrencyTag"),this.subscriptions.push(ah(iE([this.call.state.callingState$,this.call.state.ownCapabilities$,this.state.selectedDevice$,this.state.status$]),async([e,t,i,n])=>{try{if(e===P.LEFT&&await this.stopSpeakingWhileMutedDetection(),e!==P.JOINED||!this.speakingWhileMutedNotificationEnabled)return;t.includes(i2.SEND_AUDIO)&&"disabled"===n?await this.startSpeakingWhileMutedDetection(i):await this.stopSpeakingWhileMutedDetection()}catch(e){this.logger("warn","Could not enable speaking while muted",e)}})),this.subscriptions.push(ad(this.call.state.callingState$,e=>{this.noiseCancellationRegistration&&this.noiseCancellation&&(this.call.state.settings?.audio.noise_cancellation?.mode===i1.AUTO_ON&&e===P.JOINED?this.noiseCancellationRegistration.then(()=>!this.noiseCancellation?.canAutoEnable||this.noiseCancellation.canAutoEnable()).then(e=>{e&&this.noiseCancellation?.enable()}).catch(e=>(this.logger("warn","Failed to enable noise cancellation",e),this.call.notifyNoiseCancellationStopped())):e===P.LEFT&&this.noiseCancellationRegistration.then(()=>this.noiseCancellation?.disable()).catch(e=>{this.logger("warn","Failed to disable noise cancellation",e)}))}))}async enableNoiseCancellation(e){let{ownCapabilities:t,settings:i}=this.call.state;if(!t.includes(i2.ENABLE_NOISE_CANCELLATION))throw Error("Noise cancellation is not available.");let n=i?.audio.noise_cancellation;if(!n||n.mode===i1.DISABLED)throw Error("Noise cancellation is disabled for this call type.");try{if(this.noiseCancellation=e,this.noiseCancellationChangeUnsubscribe=this.noiseCancellation.on("change",e=>{this.call.tracer.trace("noiseCancellation.enabled",e),e?this.call.notifyNoiseCancellationStarting().catch(e=>{this.logger("warn","notifyNoiseCancellationStart failed",e)}):this.call.notifyNoiseCancellationStopped().catch(e=>{this.logger("warn","notifyNoiseCancellationStop failed",e)})}),sY())this.noiseCancellationRegistration=Promise.resolve();else{let t=this.registerFilter(e.toFilter());this.noiseCancellationRegistration=t.registered,this.unregisterNoiseCancellation=t.unregister,await this.noiseCancellationRegistration}if(n.mode===i1.AUTO_ON&&this.call.state.callingState===P.JOINED){let t=!0;e.canAutoEnable&&(t=await e.canAutoEnable()),t&&e.enable()}}catch(e){this.logger("warn","Failed to enable noise cancellation",e),await this.disableNoiseCancellation().catch(e=>{this.logger("warn","Failed to disable noise cancellation",e)})}}async disableNoiseCancellation(){await (this.unregisterNoiseCancellation?.()??Promise.resolve()).then(()=>this.noiseCancellation?.disable()).then(()=>this.noiseCancellationChangeUnsubscribe?.()).catch(e=>{this.logger("warn","Failed to unregister noise cancellation",e)}),await this.call.notifyNoiseCancellationStopped()}async enableSpeakingWhileMutedNotification(){this.speakingWhileMutedNotificationEnabled=!0,"disabled"===this.state.status&&await this.startSpeakingWhileMutedDetection(this.state.selectedDevice)}async disableSpeakingWhileMutedNotification(){this.speakingWhileMutedNotificationEnabled=!1,await this.stopSpeakingWhileMutedDetection()}async apply(e,t){if(!t)return;let i=!!this.call.state.localParticipant?.audioStream,n=this.call.permissionsContext.hasPermission(i2.SEND_AUDIO);if(i||!n)return;await this.statusChangeSettled();let{mediaStream:r}=this.state;this.enabled&&r?await this.publishStream(r):void 0===this.state.status&&e.mic_default_on&&await this.enable()}getDevices(){return ll()}getStream(e){return lf(e,this.call.tracer)}async startSpeakingWhileMutedDetection(e){await ai(this.soundDetectorConcurrencyTag,async()=>{if(await this.stopSpeakingWhileMutedDetection(),sY()){this.rnSpeechDetector=new lR;let e=await this.rnSpeechDetector.start(e=>{this.state.setSpeakingWhileMuted(e.isSoundDetected)});this.soundDetectorCleanup=()=>{e(),this.rnSpeechDetector=void 0}}else{let t=await this.getStream({deviceId:{exact:e}});this.soundDetectorCleanup=l_(t,e=>{this.state.setSpeakingWhileMuted(e.isSoundDetected)})}})}async stopSpeakingWhileMutedDetection(){await ai(this.soundDetectorConcurrencyTag,async()=>{if(!this.soundDetectorCleanup)return;let e=this.soundDetectorCleanup;this.soundDetectorCleanup=void 0,this.state.setSpeakingWhileMuted(!1),await e()})}}class lx extends lk{constructor(){super(...arguments),this.audioEnabledSubject=new iR(!0),this.settingsSubject=new iR(void 0),this.audioEnabled$=this.audioEnabledSubject.asObservable().pipe(iP()),this.settings$=this.settingsSubject.asObservable(),this.getDeviceIdFromStream=e=>{let[t]=e.getTracks();return t?.getSettings().deviceId}}get audioEnabled(){return al(this.audioEnabled$)}setAudioEnabled(e){ac(this.audioEnabledSubject,e)}get settings(){return al(this.settings$)}setSettings(e){ac(this.settingsSubject,e)}}class lP extends lw{constructor(e){super(e,new lx,y.SCREEN_SHARE),this.subscriptions.push(ad(e.state.settings$,e=>{let t=e?.screensharing.target_resolution;t&&this.setDefaultConstraints({video:{width:t.width,height:t.height}})}))}enableScreenShareAudio(){this.state.setAudioEnabled(!0)}async disableScreenShareAudio(){this.state.setAudioEnabled(!1),this.call.publisher?.isPublishing(y.SCREEN_SHARE_AUDIO)&&await this.call.stopPublish(y.SCREEN_SHARE_AUDIO)}getSettings(){return this.state.settings}setSettings(e){this.state.setSettings(e)}getDevices(){return iY([])}getStream(e){return this.state.audioEnabled||(e.audio=!1),lv(e,this.call.tracer)}async stopPublishStream(){return this.call.stopPublish(y.SCREEN_SHARE,y.SCREEN_SHARE_AUDIO)}async select(){throw Error("Not supported")}}class lN{constructor(e){this.selectedDeviceSubject=new iR(""),this.volumeSubject=new iR(1),this.isDeviceSelectionSupported=li(),this.tracer=e,this.selectedDevice$=this.selectedDeviceSubject.asObservable().pipe(iP()),this.volume$=this.volumeSubject.asObservable().pipe(iP())}get selectedDevice(){return al(this.selectedDevice$)}get volume(){return al(this.volume$)}setDevice(e){ac(this.selectedDeviceSubject,e),this.tracer.trace("navigator.mediaDevices.setSinkId",e)}setVolume(e){ac(this.volumeSubject,e)}}class lO{constructor(e){this.subscriptions=[],this.dispose=()=>{this.subscriptions.forEach(e=>e.unsubscribe())},this.call=e,this.state=new lN(e.tracer),lb&&!sY()&&this.subscriptions.push(iE([lb,this.state.selectedDevice$]).subscribe(([e,t])=>{t&&(e.find(e=>e.deviceId===t&&"audiooutput"===e.kind)||this.select(""))}))}listDevices(){if(sY())throw Error("This feature is not supported in React Native. Please visit https://getstream.io/video/docs/reactnative/core/camera-and-microphone/#speaker-management for more details");return lu()}select(e){if(sY())throw Error("This feature is not supported in React Native. Please visit https://getstream.io/video/docs/reactnative/core/camera-and-microphone/#speaker-management for more details");this.state.setDevice(e)}setVolume(e){if(sY())throw Error("This feature is not supported in React Native. Please visit https://getstream.io/video/docs/reactnative/core/camera-and-microphone/#speaker-management for more details");if(e&&(e<0||e>1))throw Error("Volume must be between 0 and 1");this.state.setVolume(e)}setParticipantVolume(e,t){if(sY())throw Error("This feature is not supported in React Native. Please visit https://getstream.io/video/docs/reactnative/core/camera-and-microphone/#speaker-management for more details");if(t&&(t<0||t>1))throw Error("Volume must be between 0 and 1, or undefined");this.call.state.updateParticipant(e,{audioVolume:t})}}class lD{constructor({type:e,id:t,streamClient:i,members:n,ownCapabilities:r,sortParticipantsBy:s,clientStore:a,ringing:o=!1,watching:l=!1}){this.state=new aM,this.permissionsContext=new o5,this.tracer=new on(null),this.dispatcher=new s7,this.sfuClientTag=0,this.reconnectConcurrencyTag=Symbol("reconnectConcurrencyTag"),this.reconnectAttempts=0,this.reconnectStrategy=E.UNSPECIFIED,this.reconnectReason="",this.fastReconnectDeadlineSeconds=0,this.disconnectionTimeoutSeconds=0,this.lastOfflineTimestamp=0,this.trackPublishOrder=[],this.hasJoinedOnce=!1,this.deviceSettingsAppliedOnce=!1,this.initialized=!1,this.joinLeaveConcurrencyTag=Symbol("joinLeaveConcurrencyTag"),this.leaveCallHooks=new Set,this.streamClientEventHandlers=new Map,this.setup=async()=>{await ai(this.joinLeaveConcurrencyTag,async()=>{this.initialized||(this.leaveCallHooks.add(this.on("all",e=>{this.state.updateFromEvent(e)})),this.leaveCallHooks.add(this.on("changePublishOptions",e=>{this.currentPublishOptions=e.publishOptions})),this.leaveCallHooks.add(o0(this,this.dispatcher)),this.registerEffects(),this.registerReconnectHandlers(),this.state.callingState===P.LEFT&&this.state.setCallingState(P.IDLE),this.initialized=!0)})},this.registerEffects=()=>{this.leaveCallHooks.add(ad(this.state.settings$,e=>{e&&this.permissionsContext.setCallSettings(e)})),this.leaveCallHooks.add(ah(this.state.ownCapabilities$,this.handleOwnCapabilitiesUpdated)),this.leaveCallHooks.add(ad(this.state.blockedUserIds$,async e=>{if(!e||0===e.length)return;let t=this.currentUserId;t&&e.includes(t)&&(this.logger("info","Leaving call because of being blocked"),await this.leave({message:"user blocked"}).catch(e=>{this.logger("error","Error leaving call after being blocked",e)}))})),this.leaveCallHooks.add(ad(this.state.session$,e=>{var t;if(!this.ringing)return;let i=this.clientStore.connectedUser?.id;if(!i)return;let n=!!e?.accepted_by[i],r=!!e?.rejected_by[i];(n||r)&&this.cancelAutoDrop(),(n&&this.state.callingState===P.RINGING||r)&&(t=this.joinLeaveConcurrencyTag,!ar.has(t))&&this.leave().catch(()=>{this.logger("error","Could not leave a call that was accepted or rejected elsewhere")})})),this.leaveCallHooks.add(ad(this.ringingSubject,e=>{if(!e)return;let t=this.state.session,i=this.clientStore.connectedUser?.id,n=t?.ended_at,r=this.state.createdBy?.id,s=t?.rejected_by,a=t?.accepted_by,o=!1;n?o=!0:r&&s?s[r]&&(o=!0):i&&s?s[i]&&(o=!0):i&&a&&a[i]&&(o=!0),o?this.state.callingState!==P.IDLE&&this.state.setCallingState(P.IDLE):(this.state.callingState===P.IDLE&&this.state.setCallingState(P.RINGING),this.scheduleAutoDrop(),this.leaveCallHooks.add(o1(this)))}))},this.handleOwnCapabilitiesUpdated=async e=>{if(this.permissionsContext.setPermissions(e),this.publisher){for(let[e,t]of Object.entries({[i2.SEND_AUDIO]:y.AUDIO,[i2.SEND_VIDEO]:y.VIDEO,[i2.SCREENSHARE]:y.SCREEN_SHARE}))if(!this.permissionsContext.hasPermission(e))try{switch(t){case y.AUDIO:this.microphone.enabled&&await this.microphone.disable();break;case y.VIDEO:this.camera.enabled&&await this.camera.disable();break;case y.SCREEN_SHARE:this.screenShare.enabled&&await this.screenShare.disable()}}catch(e){this.logger("error","Can't disable mic/camera/screenshare after revoked permissions",e)}}},this.on=(e,t)=>{if(s8(e))return this.dispatcher.on(e,t);let i=this.streamClient.on(e,e=>{e.call_cid&&e.call_cid===this.cid&&t(e)});return this.streamClientEventHandlers.set(t,i),()=>{this.off(e,t)}},this.off=(e,t)=>{if(s8(e))return this.dispatcher.off(e,t);let i=this.streamClientEventHandlers.get(t);i&&i()},this.leave=async({reject:e,reason:t,message:i}={})=>{await ai(this.joinLeaveConcurrencyTag,async()=>{let n=this.state.callingState;if(n===P.LEFT)throw Error("Cannot leave call that has already been left.");if(n===P.JOINING&&await new Promise(e=>{this.state.callingState$.pipe(iO(e=>e!==P.JOINED,!0)).subscribe(()=>e())}),n===P.RINGING&&!1!==e)if(e)await this.reject(t??"decline");else{let e=this.state.remoteParticipants.length>0;this.isCreatedByMe&&!e&&await this.reject("cancel")}this.statsReporter?.stop(),this.statsReporter=void 0,this.sfuStatsReporter?.flush(),this.sfuStatsReporter?.stop(),this.sfuStatsReporter=void 0,this.subscriber?.dispose(),this.subscriber=void 0,this.publisher?.dispose(),this.publisher=void 0,await this.sfuClient?.leaveAndClose(i??t??"user is leaving the call"),this.sfuClient=void 0,this.dynascaleManager.setSfuClient(void 0),this.state.setCallingState(P.LEFT),this.state.setParticipants([]),this.state.dispose(),this.leaveCallHooks.forEach(e=>e()),this.initialized=!1,this.hasJoinedOnce=!1,this.unifiedSessionId=void 0,this.ringingSubject.next(!1),this.cancelAutoDrop(),this.clientStore.unregisterCall(this),this.camera.dispose(),this.microphone.dispose(),this.screenShare.dispose(),this.speaker.dispose();let r=[];this.camera.stopOnLeave&&r.push(this.camera.disable(!0)),this.microphone.stopOnLeave&&r.push(this.microphone.disable(!0)),this.screenShare.stopOnLeave&&r.push(this.screenShare.disable(!0)),await Promise.all(r)})},this.updateFromRingingEvent=async e=>{await this.setup();let{created_by:t,settings:i}=e.call,n=this.state.members.find(e=>e.user.id===t.id);n?this.state.setMembers([n,...e.members]):this.state.setMembers(e.members),this.state.updateFromCallResponse(e.call),this.watching=!0,this.ringingSubject.next(!0);let r=this.clientStore.calls.filter(e=>e.cid!==this.cid);this.clientStore.setCalls([this,...r]),await this.applyDeviceConfig(i,!1)},this.get=async e=>{await this.setup();let t=await this.streamClient.get(this.streamClientBasePath,e);return this.state.updateFromCallResponse(t.call),this.state.setMembers(t.members),this.state.setOwnCapabilities(t.own_capabilities),e?.ring&&this.ringingSubject.next(!0),this.streamClient._hasConnectionID()&&(this.watching=!0,this.clientStore.registerCall(this)),await this.applyDeviceConfig(t.call.settings,!1),t},this.getOrCreate=async e=>{await this.setup();let t=await this.streamClient.post(this.streamClientBasePath,e);return this.state.updateFromCallResponse(t.call),this.state.setMembers(t.members),this.state.setOwnCapabilities(t.own_capabilities),e?.ring&&this.ringingSubject.next(!0),this.streamClient._hasConnectionID()&&(this.watching=!0,this.clientStore.registerCall(this)),await this.applyDeviceConfig(t.call.settings,!1),t},this.create=async e=>this.getOrCreate(e),this.delete=async(e={})=>this.streamClient.post(`${this.streamClientBasePath}/delete`,e),this.ring=async()=>await this.get({ring:!0}),this.notify=async()=>await this.get({notify:!0}),this.accept=async()=>this.streamClient.post(`${this.streamClientBasePath}/accept`),this.reject=async(e="decline")=>this.streamClient.post(`${this.streamClientBasePath}/reject`,{reason:e}),this.join=async({maxJoinRetries:e=3,...t}={})=>{await this.setup();let i=this.state.callingState;if([P.JOINED,P.JOINING].includes(i))throw Error("Illegal State: call.join() shall be called only once");this.state.setCallingState(P.JOINING),e=Math.max(e,1);for(let n=0;n<e;n++){try{return this.logger("trace",`Joining call (${n})`,this.cid),await this.doJoin(t)}catch(t){if(this.logger("warn",`Failed to join call (${n})`,this.cid),n===e-1)throw this.state.setCallingState(i),t}await sV(sq(n))}},this.doJoin=async e=>{let t=Date.now(),i=this.state.callingState;this.joinCallData=e,this.logger("debug","Starting join flow"),this.state.setCallingState(P.JOINING);let n=this.reconnectStrategy===E.MIGRATE,r=this.reconnectStrategy===E.REJOIN,s=this.reconnectStrategy===E.FAST,a=this.sfuStatsReporter?.options;if(!this.credentials||!a||r||n)try{let t=await this.doJoinRequest(e);this.credentials=t.credentials,a=t.stats_options}catch(e){throw this.state.callingState!==P.OFFLINE&&this.state.setCallingState(i),e}let o=this.sfuClient,l=o?.sessionId,c=!!o?.isHealthy,u=r||n||!c?new oD({logTag:String(++this.sfuClientTag),dispatcher:this.dispatcher,credentials:this.credentials,streamClient:this.streamClient,enableTracing:a.enable_rtc_stats,sessionId:r?void 0:l,onSignalClose:e=>this.handleSfuSignalClose(u,e)}):o;this.sfuClient=u,this.dynascaleManager.setSfuClient(u);let d=await a6();if(o!==u){let[t,n]=await Promise.all([s6("recvonly"),s6("sendonly")]),r=this.reconnectStrategy!==E.UNSPECIFIED,a=r?this.getReconnectDetails(e?.migrating_from,l):void 0,o=r?this.currentPublishOptions||[]:this.getPreferredPublishOptions(),c=r?[]:this.getPreferredSubscribeOptions();try{let{callState:e,fastReconnectDeadlineSeconds:i,publishOptions:r}=await u.join({subscriberSdp:t,publisherSdp:n,clientDetails:d,fastReconnect:s,reconnectDetails:a,preferredPublishOptions:o,preferredSubscribeOptions:c});this.currentPublishOptions=r,this.fastReconnectDeadlineSeconds=i,e&&this.state.updateFromSfuCallState(e,u.sessionId,a)}catch(e){throw this.logger("warn","Join SFU request failed",e),u.close(oD.ERROR_CONNECTION_UNHEALTHY,"Join request failed, connection considered unhealthy"),this.state.setCallingState(i),e}}if(n||this.state.setCallingState(P.JOINED),this.hasJoinedOnce=!0,s)await this.restoreICE(u,{includeSubscriber:!1});else{let e=oC(this.credentials.ice_servers);this.initPublisherAndSubscriber({sfuClient:u,connectionConfig:e,clientDetails:d,statsOptions:a,publishOptions:this.currentPublishOptions||[],closePreviousInstances:!n})}if(r||s||n||this.sfuStatsReporter?.sendConnectionTime((Date.now()-t)/1e3),r&&c){let e=E[this.reconnectStrategy];await o?.leaveAndClose(`Closing previous WS after reconnect with strategy: ${e}`)}else c||o?.close(oD.DISPOSE_OLD_SOCKET,"Closing unhealthy WS after reconnect");!this.deviceSettingsAppliedOnce&&this.state.settings&&(await this.applyDeviceConfig(this.state.settings,!0),this.deviceSettingsAppliedOnce=!0),delete this.joinCallData?.ring,delete this.joinCallData?.notify,this.reconnectStrategy=E.UNSPECIFIED,this.reconnectReason="",this.logger("info",`Joined call ${this.cid}`)},this.getReconnectDetails=(e,t)=>{let i=this.reconnectStrategy,n=i===E.REJOIN;return{strategy:i,announcedTracks:this.publisher?.getAnnouncedTracksForReconnect()||[],subscriptions:this.dynascaleManager.trackSubscriptions,reconnectAttempt:this.reconnectAttempts,fromSfuId:e||"",previousSessionId:n&&t||"",reason:this.reconnectReason}},this.getPreferredPublishOptions=()=>{let{preferredCodec:e,fmtpLine:t,preferredBitrate:i,maxSimulcastLayers:n}=this.clientPublishOptions||{};if(!e&&!i&&!n)return[];let r=e?nw.create({name:e.split("/").pop(),fmtp:t}):void 0,s=[ny.create({trackType:y.VIDEO,codec:r,bitrate:i,maxSpatialLayers:n})],a=this.screenShare.getSettings();return a&&s.push(ny.create({trackType:y.SCREEN_SHARE,fps:a.maxFramerate,bitrate:a.maxBitrate})),s},this.getPreferredSubscribeOptions=()=>{let{subscriberCodec:e,subscriberFmtpLine:t}=this.clientPublishOptions||{};return e&&t?[nv.create({trackType:y.VIDEO,codecs:[{name:e.split("/").pop(),fmtp:t}]})]:[]},this.restoreICE=async(e,t={})=>{let{includeSubscriber:i=!0,includePublisher:n=!0}=t;this.subscriber&&(this.subscriber.setSfuClient(e),i&&await this.subscriber.restartIce()),this.publisher&&(this.publisher.setSfuClient(e),n&&await this.publisher.restartIce())},this.initPublisherAndSubscriber=e=>{let{sfuClient:t,connectionConfig:i,clientDetails:n,statsOptions:r,publishOptions:s,closePreviousInstances:a}=e,{enable_rtc_stats:o}=r;a&&this.subscriber&&this.subscriber.dispose(),this.subscriber=new ow({sfuClient:t,dispatcher:this.dispatcher,state:this.state,connectionConfig:i,logTag:String(this.sfuClientTag),enableTracing:o,onUnrecoverableError:e=>{this.reconnect(E.REJOIN,e).catch(t=>{this.logger("warn",`[Reconnect] Error reconnecting after a subscriber error: ${e}`,t)})}}),this.streamClient.user?.type!=="anonymous"&&(a&&this.publisher&&this.publisher.dispose(),this.publisher=new oS({sfuClient:t,dispatcher:this.dispatcher,state:this.state,connectionConfig:i,publishOptions:s,logTag:String(this.sfuClientTag),enableTracing:o,onUnrecoverableError:e=>{this.reconnect(E.REJOIN,e).catch(t=>{this.logger("warn",`[Reconnect] Error reconnecting after a publisher error: ${e}`,t)})}})),this.statsReporter?.stop(),this.statsReporter=aJ({subscriber:this.subscriber,publisher:this.publisher,state:this.state,datacenter:t.edgeName}),this.tracer.setEnabled(o),this.sfuStatsReporter?.stop(),r?.reporting_interval_ms>0&&(this.unifiedSessionId??(this.unifiedSessionId=t.sessionId),this.sfuStatsReporter=new a5(t,{clientDetails:n,options:r,subscriber:this.subscriber,publisher:this.publisher,microphone:this.microphone,camera:this.camera,state:this.state,tracer:this.tracer,unifiedSessionId:this.unifiedSessionId}),this.sfuStatsReporter.start())},this.doJoinRequest=async e=>{let t=await this.streamClient.getLocationHint(),i={...e,location:t},n=await this.streamClient.post(`${this.streamClientBasePath}/join`,i);return this.state.updateFromCallResponse(n.call),this.state.setMembers(n.members),this.state.setOwnCapabilities(n.own_capabilities),e?.ring&&this.ringingSubject.next(!0),this.reconnectStrategy===E.UNSPECIFIED&&this.ringing&&!this.isCreatedByMe&&await this.accept(),this.streamClient._hasConnectionID()&&(this.watching=!0,this.clientStore.registerCall(this)),n},this.handleSfuSignalClose=(e,t)=>{this.logger("debug","[Reconnect] SFU signal connection closed");let{callingState:i}=this.state;i!==P.JOINING&&i!==P.RECONNECTING&&i!==P.IDLE&&i!==P.LEFT&&(e.isLeaving||e.isClosing||this.reconnect(E.REJOIN,t).catch(e=>{this.logger("warn","[Reconnect] Error reconnecting",e)}))},this.reconnect=async(e,t)=>{if(this.state.callingState!==P.RECONNECTING&&this.state.callingState!==P.MIGRATING&&this.state.callingState!==P.RECONNECTING_FAILED)return ai(this.reconnectConcurrencyTag,async()=>{let i=Date.now();this.reconnectStrategy=e,this.reconnectReason=t;do{if(this.disconnectionTimeoutSeconds>0&&(Date.now()-i)/1e3>this.disconnectionTimeoutSeconds){this.logger("warn","[Reconnect] Stopping reconnection attempts after reaching disconnection timeout"),this.state.setCallingState(P.RECONNECTING_FAILED);return}this.reconnectStrategy!==E.FAST&&this.reconnectAttempts++;let e=E[this.reconnectStrategy];try{switch(await this.networkAvailableTask?.promise,this.logger("info",`[Reconnect] Reconnecting with strategy ${E[this.reconnectStrategy]}`),this.reconnectStrategy){case E.UNSPECIFIED:case E.DISCONNECT:this.logger("debug",`[Reconnect] No-op strategy ${e}`);break;case E.FAST:await this.reconnectFast();break;case E.REJOIN:await this.reconnectRejoin();break;case E.MIGRATE:await this.reconnectMigrate();break;default:oa(this.reconnectStrategy,"Unknown reconnection strategy")}break}catch(t){if(this.state.callingState===P.OFFLINE){this.logger("trace","[Reconnect] Can't reconnect while offline, stopping reconnection attempts");break}if(t instanceof i3&&t.unrecoverable){this.logger("warn","[Reconnect] Can't reconnect due to coordinator unrecoverable error",t),this.state.setCallingState(P.RECONNECTING_FAILED);return}this.logger("warn",`[Reconnect] ${e} (${this.reconnectAttempts}) failed. Attempting with REJOIN`,t),await sV(500),this.reconnectStrategy=E.REJOIN}}while(this.state.callingState!==P.JOINED&&this.state.callingState!==P.RECONNECTING_FAILED&&this.state.callingState!==P.LEFT);this.logger("info","[Reconnect] Reconnection flow finished")})},this.reconnectFast=async()=>{let e=Date.now();this.reconnectStrategy=E.FAST,this.state.setCallingState(P.RECONNECTING),await this.doJoin(this.joinCallData),this.sfuStatsReporter?.sendReconnectionTime(E.FAST,(Date.now()-e)/1e3)},this.reconnectRejoin=async()=>{let e=Date.now();this.reconnectStrategy=E.REJOIN,this.state.setCallingState(P.RECONNECTING),await this.doJoin(this.joinCallData),await this.restorePublishedTracks(),this.restoreSubscribedTracks(),this.sfuStatsReporter?.sendReconnectionTime(E.REJOIN,(Date.now()-e)/1e3)},this.reconnectMigrate=async()=>{let e=Date.now(),t=this.sfuClient;if(!t)throw Error("Cannot migrate without an active SFU client");this.reconnectStrategy=E.MIGRATE,this.state.setCallingState(P.MIGRATING);let i=this.subscriber,n=this.publisher;i?.detachEventHandlers(),n?.detachEventHandlers();let r=oT(t.enterMigration());try{let e=t.edgeName;await this.doJoin({...this.joinCallData,migrating_from:e})}finally{delete this.joinCallData?.migrating_from}await this.restorePublishedTracks(),this.restoreSubscribedTracks();try{await r(),this.state.setCallingState(P.JOINED)}finally{i?.dispose(),n?.dispose(),t.close(oD.NORMAL_CLOSURE,"Migrating away")}this.sfuStatsReporter?.sendReconnectionTime(E.MIGRATE,(Date.now()-e)/1e3)},this.registerReconnectHandlers=()=>{let e=this.on("goAway",()=>{this.reconnect(E.MIGRATE,"goAway").catch(e=>this.logger("warn","[Reconnect] Error reconnecting",e))}),t=this.on("error",e=>{let{reconnectStrategy:t,error:i}=e;t!==E.UNSPECIFIED&&(t===E.DISCONNECT?this.leave({message:"SFU instructed to disconnect"}).catch(e=>{this.logger("warn","Can't leave call after disconnect request",e)}):this.reconnect(t,i?.message||"SFU Error").catch(e=>{this.logger("warn","[Reconnect] Error reconnecting",e)}))}),i=this.streamClient.on("network.changed",e=>{if(this.tracer.trace("network.changed",e),e.online)this.logger("debug","[Reconnect] Going online"),this.sfuClient?.close(oD.DISPOSE_OLD_SOCKET,"Closing WS to reconnect after going online"),this.networkAvailableTask?.resolve(),this.networkAvailableTask=void 0,this.sfuStatsReporter?.start();else{if(this.logger("debug","[Reconnect] Going offline"),!this.hasJoinedOnce)return;this.lastOfflineTimestamp=Date.now();let e=oE();e.promise.then(()=>{let e=E.FAST;this.lastOfflineTimestamp&&(Date.now()-this.lastOfflineTimestamp)/1e3>this.fastReconnectDeadlineSeconds&&(e=E.REJOIN),this.reconnect(e,"Going online").catch(e=>{this.logger("warn","[Reconnect] Error reconnecting after going online",e)})}),this.networkAvailableTask=e,this.sfuStatsReporter?.stop(),this.state.setCallingState(P.OFFLINE)}});this.leaveCallHooks.add(e).add(t).add(i)},this.restorePublishedTracks=async()=>{for(let e of this.trackPublishOrder){let t;switch(e){case y.AUDIO:t=this.microphone.state.mediaStream;break;case y.VIDEO:t=this.camera.state.mediaStream;break;case y.SCREEN_SHARE:t=this.screenShare.state.mediaStream;break;case y.SCREEN_SHARE_AUDIO:case y.UNSPECIFIED:break;default:oa(e,"Unknown track type")}t&&await this.publish(t,e)}},this.restoreSubscribedTracks=()=>{let{remoteParticipants:e}=this.state;e.length<=0||this.dynascaleManager.applyTrackSubscriptions(void 0)},this.publishVideoStream=async e=>{await this.publish(e,y.VIDEO)},this.publishAudioStream=async e=>{await this.publish(e,y.AUDIO)},this.publishScreenShareStream=async e=>{await this.publish(e,y.SCREEN_SHARE)},this.publish=async(e,t)=>{if(!this.sfuClient)throw Error("Call not joined yet.");if(await this.sfuClient.joinTask,!this.permissionsContext.canPublish(t))throw Error(`No permission to publish ${y[t]}`);if(!this.publisher)throw Error("Publisher is not initialized");let[i]=ou(t)?e.getAudioTracks():e.getVideoTracks();if(!i)throw Error(`There is no ${y[t]} track in the stream`);if("ended"===i.readyState)throw Error("Can't publish ended tracks.");oW(this.trackPublishOrder,t),await this.publisher.publish(i,t);let n=[t];if(t===y.SCREEN_SHARE){let[t]=e.getAudioTracks();t&&(oW(this.trackPublishOrder,y.SCREEN_SHARE_AUDIO),await this.publisher.publish(t,y.SCREEN_SHARE_AUDIO),n.push(y.SCREEN_SHARE_AUDIO))}"video"===i.kind&&this.sfuStatsReporter?.scheduleOne(3e3),await this.updateLocalStreamState(e,...n)},this.stopPublish=async(...e)=>{this.sfuClient&&this.publisher&&(this.publisher.stopTracks(...e),await this.updateLocalStreamState(void 0,...e))},this.updateLocalStreamState=async(e,...t)=>{if(!this.sfuClient||!this.sfuClient.sessionId)return;await this.notifyTrackMuteState(!e,...t);let{sessionId:i}=this.sfuClient;for(let n of t){let t=oo(n);t&&this.state.updateParticipant(i,i=>({publishedTracks:e?oW([...i.publishedTracks],n):i.publishedTracks.filter(e=>e!==n),[t]:e}))}},this.updatePublishOptions=e=>{this.logger("warn","[call.updatePublishOptions]: You are manually overriding the publish options for this call. This is not recommended, and it can cause call stability/compatibility issues. Use with caution."),this.state.callingState===P.JOINED&&this.logger("warn","Updating publish options after joining the call does not have an effect"),this.clientPublishOptions={...this.clientPublishOptions,...e}},this.notifyNoiseCancellationStarting=async()=>this.sfuClient?.startNoiseCancellation().catch(e=>{this.logger("warn","Failed to notify start of noise cancellation",e)}),this.notifyNoiseCancellationStopped=async()=>this.sfuClient?.stopNoiseCancellation().catch(e=>{this.logger("warn","Failed to notify stop of noise cancellation",e)}),this.notifyTrackMuteState=async(e,...t)=>{this.sfuClient&&await this.sfuClient.updateMuteStates(t.map(t=>({trackType:t,muted:e})))},this.startReportingStatsFor=e=>this.statsReporter?.startReportingStatsFor(e),this.stopReportingStatsFor=e=>this.statsReporter?.stopReportingStatsFor(e),this.resetReaction=e=>{this.state.updateParticipant(e,{reaction:void 0})},this.setSortParticipantsBy=e=>this.state.setSortParticipantsBy(e),this.sendReaction=async e=>this.streamClient.post(`${this.streamClientBasePath}/reaction`,e),this.blockUser=async e=>this.streamClient.post(`${this.streamClientBasePath}/block`,{user_id:e}),this.unblockUser=async e=>this.streamClient.post(`${this.streamClientBasePath}/unblock`,{user_id:e}),this.muteSelf=e=>{let t=this.currentUserId;if(t)return this.muteUser(t,e)},this.muteOthers=e=>{let t=ol(e);if(!t)return;let i=[];for(let e of this.state.remoteParticipants)e.publishedTracks.includes(t)&&i.push(e.userId);if(i.length>0)return this.muteUser(i,e)},this.muteUser=(e,t)=>this.streamClient.post(`${this.streamClientBasePath}/mute_users`,{user_ids:Array.isArray(e)?e:[e],[t]:!0}),this.muteAllUsers=e=>this.streamClient.post(`${this.streamClientBasePath}/mute_users`,{mute_all_users:!0,[e]:!0}),this.startRecording=async e=>this.streamClient.post(`${this.streamClientBasePath}/start_recording`,e||{}),this.stopRecording=async()=>this.streamClient.post(`${this.streamClientBasePath}/stop_recording`,{}),this.startTranscription=async e=>this.streamClient.post(`${this.streamClientBasePath}/start_transcription`,e),this.stopTranscription=async()=>this.streamClient.post(`${this.streamClientBasePath}/stop_transcription`),this.startClosedCaptions=async e=>{let t=this.state.setCaptioning(!0);try{return await this.streamClient.post(`${this.streamClientBasePath}/start_closed_captions`,e)}catch(e){throw t.rollback(),e}},this.stopClosedCaptions=async e=>{let t=this.state.setCaptioning(!1);try{return await this.streamClient.post(`${this.streamClientBasePath}/stop_closed_captions`,e)}catch(e){throw t.rollback(),e}},this.updateClosedCaptionSettings=e=>{this.state.updateClosedCaptionSettings(e)},this.requestPermissions=async e=>{let{permissions:t}=e;if(!t.every(e=>this.permissionsContext.canRequest(e)))throw Error(`You are not allowed to request permissions: ${t.join(", ")}`);return this.streamClient.post(`${this.streamClientBasePath}/request_permission`,e)},this.grantPermissions=async(e,t)=>this.updateUserPermissions({user_id:e,grant_permissions:t}),this.revokePermissions=async(e,t)=>this.updateUserPermissions({user_id:e,revoke_permissions:t}),this.updateUserPermissions=async e=>this.streamClient.post(`${this.streamClientBasePath}/user_permissions`,e),this.goLive=async(e={},t)=>this.streamClient.post(`${this.streamClientBasePath}/go_live`,e,t),this.stopLive=async(e={})=>this.streamClient.post(`${this.streamClientBasePath}/stop_live`,e),this.startHLS=async()=>this.streamClient.post(`${this.streamClientBasePath}/start_broadcasting`,{}),this.stopHLS=async()=>this.streamClient.post(`${this.streamClientBasePath}/stop_broadcasting`,{}),this.startRTMPBroadcasts=async e=>this.streamClient.post(`${this.streamClientBasePath}/rtmp_broadcasts`,e),this.stopAllRTMPBroadcasts=async()=>this.streamClient.post(`${this.streamClientBasePath}/rtmp_broadcasts/stop`),this.stopRTMPBroadcast=async e=>this.streamClient.post(`${this.streamClientBasePath}/rtmp_broadcasts/${e}/stop`),this.startFrameRecording=async e=>this.streamClient.post(`${this.streamClientBasePath}/start_frame_recording`,e),this.stopFrameRecording=async()=>this.streamClient.post(`${this.streamClientBasePath}/stop_frame_recording`),this.update=async e=>{let t=await this.streamClient.patch(`${this.streamClientBasePath}`,e),{call:i,members:n,own_capabilities:r}=t;return this.state.updateFromCallResponse(i),this.state.setMembers(n),this.state.setOwnCapabilities(r),t},this.endCall=async()=>this.streamClient.post(`${this.streamClientBasePath}/mark_ended`),this.pin=e=>{this.state.updateParticipant(e,{pin:{isLocalPin:!0,pinnedAt:Date.now()}})},this.unpin=e=>{this.state.updateParticipant(e,{pin:void 0})},this.pinForEveryone=async e=>this.streamClient.post(`${this.streamClientBasePath}/pin`,e),this.unpinForEveryone=async e=>this.streamClient.post(`${this.streamClientBasePath}/unpin`,e),this.queryMembers=e=>this.streamClient.post("/call/members",{...e||{},id:this.id,type:this.type}),this.updateCallMembers=async e=>this.streamClient.post(`${this.streamClientBasePath}/members`,e),this.scheduleAutoDrop=()=>{this.cancelAutoDrop();let e=this.state.settings;if(!e||this.state.callingState!==P.RINGING)return;let t=this.isCreatedByMe?e.ring.auto_cancel_timeout_ms:e.ring.incoming_call_timeout_ms;t<=0||(this.dropTimeout=setTimeout(()=>{this.state.callingState===P.RINGING&&this.leave({reject:!0,reason:"timeout",message:`ringing timeout - ${this.isCreatedByMe?"no one accepted":"user didn't interact with incoming call screen"}`}).catch(e=>{this.logger("error","Failed to drop call",e)})},t))},this.cancelAutoDrop=()=>{clearTimeout(this.dropTimeout),this.dropTimeout=void 0},this.queryRecordings=async e=>{let t=this.streamClientBasePath;return e&&(t=`${t}/${e}`),this.streamClient.get(`${t}/recordings`)},this.queryTranscriptions=async()=>this.streamClient.get(`${this.streamClientBasePath}/transcriptions`),this.getCallStats=async e=>{let t=`${this.streamClientBasePath}/stats/${e}`;return this.streamClient.get(t)},this.getCallReport=async(e="")=>{let t=`${this.streamClientBasePath}/report`;return this.streamClient.get(t,""!==e?{session_id:e}:{})},this.submitFeedback=async(e,{reason:t,custom:i}={})=>{let{sdkName:n,sdkVersion:r,...s}=aV(await a6());return this.streamClient.post(`${this.streamClientBasePath}/feedback`,{rating:e,reason:t,user_session_id:this.sfuClient?.sessionId,sdk:n,sdk_version:r,custom:{...i,"x-stream-platform-data":s}})},this.sendCustomEvent=async e=>this.streamClient.post(`${this.streamClientBasePath}/event`,{custom:e}),this.applyDeviceConfig=async(e,t)=>{await this.camera.apply(e.video,t).catch(e=>{this.logger("warn","Camera init failed",e)}),await this.microphone.apply(e.audio,t).catch(e=>{this.logger("warn","Mic init failed",e)})},this.trackElementVisibility=(e,t,i)=>this.dynascaleManager.trackElementVisibility(e,t,i),this.setViewport=e=>this.dynascaleManager.setViewport(e),this.bindVideoElement=(e,t,i)=>{let n=this.dynascaleManager.bindVideoElement(e,t,i);if(n)return this.leaveCallHooks.add(n),()=>{this.leaveCallHooks.delete(n),n()}},this.bindAudioElement=(e,t,i="audioTrack")=>{let n=this.dynascaleManager.bindAudioElement(e,t,i);if(n)return this.leaveCallHooks.add(n),()=>{this.leaveCallHooks.delete(n),n()}},this.bindCallThumbnailElement=(e,t={})=>{let i=()=>{e.src=t.fallbackImageSource||"https://getstream.io/random_svg/?name=x&id=x"},n=ad(this.state.thumbnails$,t=>{if(!t)return;e.addEventListener("error",i);let n=new URL(t.image_url);n.searchParams.set("w",String(e.clientWidth)),n.searchParams.set("h",String(e.clientHeight)),e.src=n.toString()});return()=>{n(),e.removeEventListener("error",i)}},this.setPreferredIncomingVideoResolution=(e,t)=>{this.dynascaleManager.setVideoTrackSubscriptionOverrides(e?{enabled:!0,dimension:e}:void 0,t),this.dynascaleManager.applyTrackSubscriptions()},this.setIncomingVideoEnabled=e=>{this.dynascaleManager.setVideoTrackSubscriptionOverrides(e?void 0:{enabled:!1}),this.dynascaleManager.applyTrackSubscriptions()},this.setDisconnectionTimeout=e=>{this.disconnectionTimeoutSeconds=e},this.type=e,this.id=t,this.cid=`${e}:${t}`,this.ringingSubject=new iR(o),this.watching=l,this.streamClient=i,this.clientStore=a,this.streamClientBasePath=`/call/${this.type}/${this.id}`,this.logger=s3(["Call"]);let c=o7.get(e),u=s||c.options.sortParticipantsBy;u&&this.state.setSortParticipantsBy(u),this.state.setMembers(n||[]),this.state.setOwnCapabilities(r||[]),this.state.setCallingState(o?P.RINGING:P.IDLE),this.camera=new lT(this),this.microphone=new lI(this),this.speaker=new lO(this),this.screenShare=new lP(this),this.dynascaleManager=new o6(this.state,this.speaker)}get ringing(){return al(this.ringingSubject)}get currentUserId(){return this.clientStore.connectedUser?.id}get isCreatedByMe(){return this.state.createdBy?.id===this.currentUserId}}class lA{constructor(e){this._log=(e,t={},i="info")=>{this.client.logger(i,`connection:${e}`,t)},this.setClient=e=>{this.client=e},this._buildUrl=()=>{let e=new URLSearchParams;return e.set("api_key",this.client.key),e.set("stream-auth-type",this.client.getAuthType()),e.set("X-Stream-Client",this.client.getUserAgent()),`${this.client.wsBaseURL}/connect?${e.toString()}`},this.onlineStatusChanged=e=>{"offline"===e.type?(this._log("onlineStatusChanged() - Status changing to offline"),this._setHealth(!1,!0)):"online"===e.type&&(this._log(`onlineStatusChanged() - Status changing to online. isHealthy: ${this.isHealthy}`),this.isHealthy||this._reconnect({interval:10}))},this.onopen=e=>{if(this.wsID!==e)return;let t=this.client.user;if(!t)return void this.client.logger("error","User not set, can't connect to WS");let i=this.client._getToken();if(!i)return void this.client.logger("error","Token not set, can't connect authenticate");let n=JSON.stringify({token:i,user_details:{id:t.id,name:t.name,image:t.image,custom:t.custom}});this._log(`onopen() - Sending auth message ${n}`,{},"trace"),this.ws?.send(n),this._log("onopen() - onopen callback",{wsID:e})},this.onmessage=(e,t)=>{if(this.wsID!==e)return;this._log("onmessage() - onmessage callback",{event:t,wsID:e});let i="string"==typeof t.data?JSON.parse(t.data):null;if(!this.isConnectionOpenResolved&&i&&"connection.error"===i.type&&(this.isConnectionOpenResolved=!0,i.error))return void this.rejectConnectionOpen?.(this._errorFromWSEvent(i,!1));if(this.lastEvent=new Date,i&&("health.check"===i.type||"connection.ok"===i.type)&&this.scheduleNextPing(),i&&"connection.ok"===i.type&&(this.resolveConnectionOpen?.(i),this._setHealth(!0)),i&&"connection.error"===i.type&&i.error){let{code:e}=i.error;this.isHealthy=!1,this.isConnecting=!1,this.consecutiveFailures+=1,e!==sH.TOKEN_EXPIRED||this.client.tokenManager.isStatic()||(clearTimeout(this.connectionCheckTimeoutRef),this._log("connect() - WS failure due to expired token, so going to try to reload token and reconnect"),this._reconnect({refreshToken:!0}))}i&&(i.received_at=new Date,this.client.dispatchEvent(i)),this.scheduleConnectionCheck()},this.onclose=(e,t)=>{if(this.wsID===e)if(this._log("onclose() - onclose callback - "+t.code,{event:t,wsID:e}),t.code===sH.WS_CLOSED_SUCCESS){let e=Error(`WS connection reject with error ${t.reason}`);e.reason=t.reason,e.code=t.code,e.wasClean=t.wasClean,e.target=t.target,this.rejectConnectionOpen?.(e),this._log(`onclose() - WS connection reject with error ${t.reason}`,{event:t})}else this.consecutiveFailures+=1,this.totalFailures+=1,this._setHealth(!1),this.isConnecting=!1,this.rejectConnectionOpen?.(this._errorFromWSEvent(t)),this._log("onclose() - WS connection closed. Calling reconnect ...",{event:t}),this._reconnect()},this.onerror=(e,t)=>{this.wsID===e&&(this.consecutiveFailures+=1,this.totalFailures+=1,this._setHealth(!1),this.isConnecting=!1,this.rejectConnectionOpen?.(Error(`WebSocket error: ${t}`)),this._log("onerror() - WS connection resulted into error",{event:t}),this._reconnect())},this._setHealth=(e,t=!1)=>{if(e!==this.isHealthy){if(this.isHealthy=e,this.isHealthy||t)return void this.client.dispatchEvent({type:"connection.changed",online:this.isHealthy});setTimeout(()=>{this.isHealthy||this.client.dispatchEvent({type:"connection.changed",online:this.isHealthy})},5e3)}},this._errorFromWSEvent=(e,t=!0)=>{let i,n,r;if(void 0!==e.code)i=e.code,r=e.reason,n=0;else{let{error:t}=e;i=t.code,r=t.message,n=t.StatusCode}let s=`WS failed with code: ${i} and reason: ${r}`;this._log(s,{event:e},"warn");let a=Error(s);return a.code=i,a.StatusCode=n,a.isWSFailure=t,a},this._setupConnectionPromise=()=>{this.isConnectionOpenResolved=!1,this.connectionOpenSafe=oT(new Promise((e,t)=>{this.resolveConnectionOpen=e,this.rejectConnectionOpen=t}))},this.scheduleNextPing=()=>{let e=oO();this.healthCheckTimeoutRef&&e.clearTimeout(this.healthCheckTimeoutRef),this.healthCheckTimeoutRef=e.setTimeout(()=>{let e=[{type:"health.check",client_id:this.client.clientID}];try{this.ws?.send(JSON.stringify(e))}catch{}},this.pingInterval)},this.scheduleConnectionCheck=()=>{clearTimeout(this.connectionCheckTimeoutRef),this.connectionCheckTimeoutRef=setTimeout(()=>{let e=new Date;this.lastEvent&&e.getTime()-this.lastEvent.getTime()>this.connectionCheckTimeout&&(this._log("scheduleConnectionCheck - going to reconnect"),this._setHealth(!1),this._reconnect())},this.connectionCheckTimeout)},this.client=e,this.consecutiveFailures=0,this.totalFailures=0,this.isConnecting=!1,this.isDisconnected=!1,this.isConnectionOpenResolved=!1,this.isHealthy=!1,this.wsID=1,this.lastEvent=null,this.pingInterval=25e3,this.connectionCheckTimeout=this.pingInterval+1e4,this.onlineStatusChanged}async connect(e=15e3){if(this.isConnecting)throw Error("You've called connect twice, can only attempt 1 connection at the time");this.isDisconnected=!1;try{let e=await this._connect();this.consecutiveFailures=0,this._log(`connect() - Established ws connection with healthcheck: ${e}`)}catch(e){if(this.isHealthy=!1,this.consecutiveFailures+=1,e.code!==sH.TOKEN_EXPIRED||this.client.tokenManager.isStatic()){if(!e.isWSFailure)throw Error(JSON.stringify({code:e.code,StatusCode:e.StatusCode,message:e.message,isWSFailure:e.isWSFailure}))}else this._log("connect() - WS failure due to expired token, so going to try to reload token and reconnect"),this._reconnect({refreshToken:!0})}return await this._waitForHealthy(e)}async _waitForHealthy(e=15e3){return Promise.race([(async()=>{for(let t=0;t<=e;t+=50)try{return await this.connectionOpen}catch(i){if(t===e)throw Error(JSON.stringify({code:i.code,StatusCode:i.StatusCode,message:i.message,isWSFailure:i.isWSFailure}));await sV(50)}})(),(async()=>{throw await sV(e),this.isConnecting=!1,Error(JSON.stringify({code:"",StatusCode:"",message:"initial WS connection could not be established",isWSFailure:!0}))})()])}disconnect(e){let t;this._log(`disconnect() - Closing the websocket connection for wsID ${this.wsID}`),this.wsID+=1,this.isConnecting=!1,this.isDisconnected=!0,this.healthCheckTimeoutRef&&oO().clearInterval(this.healthCheckTimeoutRef),this.connectionCheckTimeoutRef&&clearInterval(this.connectionCheckTimeoutRef),this.onlineStatusChanged,this.isHealthy=!1;let{ws:i}=this;return i&&i.close&&i.readyState===i.OPEN?(t=new Promise(t=>{let n=e=>{this._log(`disconnect() - resolving isClosedPromise ${e?"with":"without"} close frame`,{event:e}),t()};i.onclose=n,setTimeout(n,null!=e?e:1e3)}),this._log("disconnect() - Manually closed connection by calling client.disconnect()"),i.close(sH.WS_CLOSED_SUCCESS,"Manually closed connection by calling client.disconnect()")):(this._log("disconnect() - ws connection doesn't exist or it is already closed."),t=Promise.resolve()),delete this.ws,t}async _connect(){if(this.isConnecting)return;this.isConnecting=!0;let e=!1;try{this._log("_connect() - waiting for token"),await this.client.tokenManager.tokenReady(),e=!0}catch{}try{e||(this._log("_connect() - tokenProvider failed before, so going to retry"),await this.client.tokenManager.loadToken()),this.client.isConnectionIsPromisePending||this.client._setupConnectionIdPromise(),this._setupConnectionPromise();let t=this._buildUrl();this._log(`_connect() - Connecting to ${t}`);let i=this.client.options.WebSocketImpl??WebSocket;this.ws=new i(t),this.ws.onopen=this.onopen.bind(this,this.wsID),this.ws.onclose=this.onclose.bind(this,this.wsID),this.ws.onerror=this.onerror.bind(this,this.wsID),this.ws.onmessage=this.onmessage.bind(this,this.wsID);let n=await this.connectionOpen;if(this.isConnecting=!1,n)return this.connectionID=n.connection_id,this.client.resolveConnectionId?.(this.connectionID),n}catch(e){throw this.client._setupConnectionIdPromise(),this.isConnecting=!1,this._log("_connect() - Error - ",e),this.client.rejectConnectionId?.(e),e}}async _reconnect(e={}){if(this._log("_reconnect() - Initiating the reconnect"),this.isConnecting||this.isHealthy)return void this._log("_reconnect() - Abort (1) since already connecting or healthy");let t=e.interval;if(t||(t=sq(this.consecutiveFailures)),await sV(t),this.isConnecting||this.isHealthy)return void this._log("_reconnect() - Abort (2) since already connecting or healthy");if(this.isDisconnected)return void this._log("_reconnect() - Abort (3) since disconnect() is called");this._log("_reconnect() - Destroying current WS connection"),this._destroyCurrentWSConnection(),e.refreshToken&&await this.client.tokenManager.loadToken();try{await this._connect(),this._log("_reconnect() - Waiting for recoverCallBack"),this._log("_reconnect() - Finished recoverCallBack"),this.consecutiveFailures=0}catch(e){if(this.isHealthy=!1,this.consecutiveFailures+=1,e.code===sH.TOKEN_EXPIRED&&!this.client.tokenManager.isStatic())return this._log("_reconnect() - WS failure due to expired token, so going to try to reload token and reconnect"),this._reconnect({refreshToken:!0});e.isWSFailure&&(this._log("_reconnect() - WS failure, so going to try to reconnect"),this._reconnect())}this._log("_reconnect() - == END ==")}_destroyCurrentWSConnection(){this.wsID+=1;try{this?.ws?.close()}catch{}}get connectionOpen(){return this.connectionOpenSafe?.()}}let lj=e=>{let t={},i=String.fromCharCode,n=e.length,r,s=0,a,o=0,l,c="";for(r=0;r<64;r++)t["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(r)]=r;for(a=0;a<n;a++)for(s=(s<<6)+t[e.charAt(a)],o+=6;o>=8;)((l=s>>>(o-=8)&255)||a<n-2)&&(c+=i(l));return c};class lL{constructor(e){this.loadTokenPromise=null,this.type="static",this.setTokenOrProvider=async(e,t,i)=>{this.user=t,this.isAnonymous=i,this.validateToken(e),sB(e)&&(this.tokenProvider=e,this.type="provider"),"string"==typeof e&&(this.token=e,this.type="static"),await this.loadToken()},this.reset=()=>{this.token=void 0,this.tokenProvider=void 0,this.type="static",this.user=void 0,this.loadTokenPromise=null},this.validateToken=e=>{if(!this.user||!this.isAnonymous||e){if(!this.secret&&!e)throw Error("User token can not be empty");if("string"!=typeof e&&!sB(e))throw Error("User token should either be a string or a function");if("string"==typeof e){if(this.isAnonymous&&""===e)return;let t=function(e){let t=e.split(".");return 3!==t.length?"":JSON.parse(lj(t[1])).user_id}(e);if(null!=e&&(null==t||""===t||!this.isAnonymous&&t!==this.user.id))throw Error("userToken does not have a user_id or is not matching with user.id")}}},this.tokenReady=()=>this.loadTokenPromise,this.loadToken=()=>(this.loadTokenPromise=new Promise(async(e,t)=>{if("static"===this.type)return e(this.token);if(this.tokenProvider&&"string"!=typeof this.tokenProvider){try{let e=await this.tokenProvider();this.validateToken(e),this.token=e}catch(e){return t(Error(`Call to tokenProvider failed with message: ${e}`))}e(this.token)}}),this.loadTokenPromise),this.getToken=()=>{if(this.token||this.user&&!this.token)return this.token;throw Error("User token is not set. Either client.connectUser wasn't called or client.disconnect was called")},this.isStatic=()=>"static"===this.type,this.secret=e}}let lU=async(e="https://hint.stream-io-video.com/",t=2e3,i=3)=>{let n=s3(["location-hint"]),r=0,s="ERR";do{let i=new AbortController,r=setTimeout(()=>i.abort(),t);try{let t=(await fetch(e,{method:"HEAD",signal:i.signal})).headers.get("x-amz-cf-pop")||"ERR";n("debug",`Location header: ${t}`),s=t.substring(0,3)}catch(t){n("warn",`Failed to get location hint from ${e}`,t),s="ERR"}finally{clearTimeout(r)}}while("ERR"===s&&++r<i);return s};class lM{constructor(e,t){this.listeners={},this.getAuthType=()=>this.anonymous?"anonymous":"jwt",this.setBaseURL=e=>{this.baseURL=e,this.wsBaseURL=this.baseURL.replace("http","ws").replace(":3030",":8800")},this.getLocationHint=async(e,t)=>{let i=await this.locationHint;return i&&"ERR"!==i?i:(this.locationHint=lU(e??this.options.locationHintUrl,t??this.options.locationHintTimeout),this.locationHint)},this._getConnectionID=()=>this.wsConnection?.connectionID,this._hasConnectionID=()=>!!this._getConnectionID(),this.connectUser=async(e,t)=>{if(!e.id)throw Error('The "id" field on the user is missing');if(this.userID===e.id&&this.connectUserTask)return this.logger("warn","Consecutive calls to connectUser is detected, ideally you should only call this function once in your app."),this.connectUserTask;if(this.userID)throw Error("Use client.disconnect() before trying to connect as a different user. connectUser was called twice.");(this.secret||this.node)&&!this.options.allowServerSideConnect&&this.logger("warn","Please do not use connectUser server side. Use our @stream-io/node-sdk instead: https://getstream.io/video/docs/api/"),this.userID=e.id,this.anonymous=!1,await this.tokenManager.setTokenOrProvider(t,e,!1),this._setUser(e),this.connectUserTask=this.openConnection();try{return sK(this.updateNetworkConnectionStatus),await this.connectUserTask}catch(e){throw this.persistUserOnConnectionFailure?await this.closeConnection():await this.disconnectUser(),e}},this._setUser=e=>{this.user=e,this.userID=e.id,this._user={...e}},this.closeConnection=async e=>{await this.wsConnection?.disconnect(e)},this.openConnection=async()=>{if(!this.userID)throw Error("UserWithId is not set on client, use client.connectUser or client.connectAnonymousUser instead");let e=this.wsPromiseSafe?.();if(this.wsConnection?.isConnecting&&e)return this.logger("info","client:openConnection() - connection already in progress"),await e;if(this.wsConnection?.isHealthy&&this._hasConnectionID())return void this.logger("info","client:openConnection() - openConnection called twice, healthy connection already exists");this._setupConnectionIdPromise(),this.clientID=`${this.userID}--${sG()}`;let t=this.connect();return this.wsPromiseSafe=oT(t),await t},this.disconnectUser=async e=>{this.logger("info","client:disconnect() - Disconnecting the client"),delete this.user,delete this._user,delete this.userID,this.anonymous=!1,await this.closeConnection(e),this.updateNetworkConnectionStatus,this.tokenManager.reset(),this.connectionIdPromiseSafe=void 0,this.rejectConnectionId=void 0,this.resolveConnectionId=void 0},this.connectGuestUser=async e=>{this.guestUserCreatePromise=this.doAxiosRequest("post","/guest",{user:e},{publicEndpoint:!0});let t=await this.guestUserCreatePromise;return this.guestUserCreatePromise.finally(()=>this.guestUserCreatePromise=void 0),this.connectUser(t.user,t.access_token)},this.connectAnonymousUser=async(e,t)=>{this.updateNetworkConnectionStatus,this._setupConnectionIdPromise(),this.anonymous=!0,await this.tokenManager.setTokenOrProvider(t,e,!0),this._setUser(e),this.resolveConnectionId?.()},this.on=(e,t)=>(this.listeners[e]||(this.listeners[e]=[]),this.logger("debug",`Adding listener for ${e} event`),this.listeners[e]?.push(t),()=>{this.off(e,t)}),this.off=(e,t)=>{this.listeners[e]||(this.listeners[e]=[]),this.logger("debug",`Removing listener for ${e} event`),this.listeners[e]=this.listeners[e]?.filter(e=>e!==t)},this._setupConnectionIdPromise=()=>{this.connectionIdPromiseSafe=oT(new Promise((e,t)=>{this.resolveConnectionId=e,this.rejectConnectionId=t}))},this._logApiRequest=(e,t,i,n)=>{"trace"===s2()&&this.logger("trace",`client: ${e} - Request - ${t}`,{payload:i,config:n})},this._logApiResponse=(e,t,i)=>{"trace"===s2()&&this.logger("trace",`client:${e} - Response - url: ${t} > status ${i.status}`,{response:i})},this._logApiError=(e,t,i)=>{this.logger("error",`client:${e} - Error - url: ${t}`,{url:t,error:i})},this.doAxiosRequest=async(e,t,i,n={})=>{if(!n.publicEndpoint){await Promise.all([this.tokenManager.tokenReady(),this.guestUserCreatePromise]);try{await this.connectionIdPromise}catch{await this.wsConnection?._waitForHealthy(),await this.connectionIdPromise}}let r=this._enrichAxiosOptions(n);try{let n;switch(this._logApiRequest(e,t,i,r),e){case"get":n=await this.axiosInstance.get(t,r);break;case"delete":n=await this.axiosInstance.delete(t,r);break;case"post":n=await this.axiosInstance.post(t,i,r);break;case"put":n=await this.axiosInstance.put(t,i,r);break;case"patch":n=await this.axiosInstance.patch(t,i,r);break;case"options":n=await this.axiosInstance.options(t,r);break;default:throw Error("Invalid request type")}return this._logApiResponse(e,t,n),this.consecutiveFailures=0,this.handleResponse(n)}catch(s){if(s.client_request_id=r.headers?.["x-client-request-id"],this.consecutiveFailures+=1,s.response){if(this._logApiError(e,t,s.response),s.response.data.code===sH.TOKEN_EXPIRED&&!this.tokenManager.isStatic())return this.consecutiveFailures>1&&await sV(sq(this.consecutiveFailures)),await this.tokenManager.loadToken(),await this.doAxiosRequest(e,t,i,n);return this.handleResponse(s.response)}throw this._logApiError(e,t,s),s}},this.get=(e,t)=>this.doAxiosRequest("get",e,null,{params:t}),this.put=(e,t,i)=>this.doAxiosRequest("put",e,t,{params:i}),this.post=(e,t,i)=>this.doAxiosRequest("post",e,t,{params:i}),this.patch=(e,t,i)=>this.doAxiosRequest("patch",e,t,{params:i}),this.delete=(e,t)=>this.doAxiosRequest("delete",e,null,{params:t}),this.errorFromResponse=e=>{let{data:t,status:i}=e;return new i3({message:`Stream error code ${t.code}: ${t.message}`,code:t.code??null,unrecoverable:t.unrecoverable??null,response:e,status:i})},this.handleResponse=e=>{let t=e.data;if(function(e){return!e.status||e.status<200||300<=e.status}(e))throw this.errorFromResponse(e);return t},this.dispatchEvent=e=>{if(this.logger("debug",`Dispatching event: ${e.type}`,e),this.listeners){for(let t of this.listeners.all||[])t(e);for(let t of this.listeners[e.type]||[])t(e)}},this.connect=async()=>{if(!this.userID||!this._user)throw Error("Call connectUser or connectAnonymousUser before starting the connection");if(!this.wsBaseURL)throw Error("Websocket base url not set");if(!this.clientID)throw Error("clientID is not set");return this.wsConnection=new lA(this),this.logger("info","StreamClient.connect: this.wsConnection.connect()"),await this.wsConnection.connect(this.defaultWSTimeout)},this.getUserAgent=()=>{if(!this.cachedUserAgent){let{clientAppIdentifier:e={}}=this.options,{sdkName:t="js",sdkVersion:i="1.23.2",...n}=e;this.cachedUserAgent=[`stream-video-${t}-v${i}`,...Object.entries(n).map(([e,t])=>`${e}=${t}`),"client_bundle=node-esm"].join("|")}return this.cachedUserAgent},this._enrichAxiosOptions=(e={params:{},headers:{},config:{}})=>{let t=e.publicEndpoint&&!this.user?void 0:this._getToken();return e.headers?.["x-client-request-id"]||(e.headers={...e.headers,"x-client-request-id":sG()}),{params:{user_id:this.userID,connection_id:this._getConnectionID(),api_key:this.key,...e.params},headers:{...t?{Authorization:t}:void 0,"stream-auth-type":e.publicEndpoint&&!this.user?"anonymous":this.getAuthType(),"X-Stream-Client":this.getUserAgent(),...e.headers},...e.config,...this.options.axiosRequestConfig}},this._getToken=()=>this.tokenManager?this.tokenManager.getToken():null,this.updateNetworkConnectionStatus=e=>{"offline"===e.type?(this.logger("debug","device went offline"),this.dispatchEvent({type:"network.changed",online:!1})):"online"===e.type&&(this.logger("debug","device went online"),this.dispatchEvent({type:"network.changed",online:!0}))},this.key=e,this.secret=t?.secret;let i=t||{browser:!1};this.browser=i.browser||!1,this.node=!this.browser,this.browser&&(this.locationHint=lU(t?.locationHintUrl,t?.locationHintTimeout,t?.locationHintMaxAttempts)),this.options={timeout:5e3,withCredentials:!1,...i},this.node&&!this.options.httpsAgent&&(this.options.httpsAgent=new(i0()).Agent({keepAlive:!0,keepAliveMsecs:3e3})),this.setBaseURL(this.options.baseURL||"https://video.stream-io-api.com/video"),this.axiosInstance=tw.A.create({...this.options,baseURL:this.baseURL}),this.wsConnection=null,this.wsPromiseSafe=null,this.connectUserTask=null,this.anonymous=!1,this.persistUserOnConnectionFailure=this.options?.persistUserOnConnectionFailure,this.tokenManager=new lL(this.secret),this.consecutiveFailures=0,this.defaultWSTimeout=this.options.defaultWsTimeout??15e3,this.logger=sB(i.logger)?i.logger:()=>null}get connectionIdPromise(){return this.connectionIdPromiseSafe?.()}get isConnectionIsPromisePending(){return this.connectionIdPromiseSafe?.checkPending()??!1}get wsPromise(){return this.wsPromiseSafe?.()}}let lF=(e,t)=>`${e}/${t.id}`,l$=e=>{let t=e?.clientAppIdentifier||{},i=a2();return i&&(t.sdkName=w[i.type].toLowerCase(),t.sdkVersion=`${i.major}.${i.minor}.${i.patch}`),t},lV=(e,t)=>{let i=l$(t),n=s3(["coordinator"]);return new lM(e,{persistUserOnConnectionFailure:!0,...t,clientAppIdentifier:i,logger:n})},lB=e=>{let{token:t,tokenProvider:i}=e;if(t&&i){let e=!1;return async function(){return e?i():(e=!0,t)}}return t||i};class lH{constructor(e,t){this.effectsRegistered=!1,this.eventHandlersToUnregister=[],this.connectionConcurrencyTag=Symbol("connectionConcurrencyTag"),this.registerClientInstance=(e,t)=>{let i=lF(e,t);lH._instances.has(i)&&this.logger("warn",`A StreamVideoClient already exists for ${t.id}; Prefer using getOrCreateInstance method`),lH._instances.set(i,this)},this.registerEffects=()=>{this.effectsRegistered||(this.eventHandlersToUnregister.push(this.on("connection.changed",e=>{if(!e.online)return;let t=this.writeableStateStore.calls.filter(e=>e.watching).map(e=>e.cid);t.length<=0||(this.logger("info",`Rewatching calls ${t.join(", ")}`),this.queryCalls({watch:!0,filter_conditions:{cid:{$in:t}},sort:[{field:"cid",direction:1}]}).catch(e=>{this.logger("error","Failed to re-watch calls",e)}))})),this.eventHandlersToUnregister.push(this.on("call.created",e=>{let{call:t,members:i}=e;if(this.state.connectedUser?.id===t.created_by.id)return void this.logger("warn","Received `call.created` sent by the current user");this.logger("info",`New call created and registered: ${t.cid}`);let n=new lD({streamClient:this.streamClient,type:t.type,id:t.id,members:i,clientStore:this.writeableStateStore});n.state.updateFromCallResponse(t),this.writeableStateStore.registerCall(n)})),this.eventHandlersToUnregister.push(this.on("call.ring",async e=>{let{call:t,members:i}=e;if(this.state.connectedUser?.id===t.created_by.id)return void this.logger("debug","Received `call.ring` sent by the current user so ignoring the event");let n=this.writeableStateStore.findCall(t.type,t.id);if(n)await n.updateFromRingingEvent(e);else{let e=new lD({streamClient:this.streamClient,type:t.type,id:t.id,members:i,clientStore:this.writeableStateStore,ringing:!0});await e.get()}})),this.effectsRegistered=!0)},this.connectUser=async(e,t)=>{if("anonymous"===e.type)return e.id="!anon",this.connectAnonymousUser(e,t);let i=await ai(this.connectionConcurrencyTag,async()=>{let i=this.streamClient,{onConnectUserError:n,persistUserOnConnectionFailure:r}=i.options,{maxConnectUserRetries:s=5}=i.options;s=Math.max(s,1);let a=[];for(let o=0;o<s;o++)try{return this.logger("trace",`Connecting user (${o})`,e),"guest"===e.type?await i.connectGuestUser(e):await i.connectUser(e,t)}catch(e){if(this.logger("warn",`Failed to connect a user (${o})`,e),a.push(e),o===s-1)throw n?.(e,a),e;r&&await i.disconnectUser(),await sV(sq(o))}});return i?.me&&this.writeableStateStore.setConnectedUser(i.me),this.registerEffects(),i},this.disconnectUser=async e=>{await ai(this.connectionConcurrencyTag,async()=>{let{user:t,key:i}=this.streamClient;t&&(await this.streamClient.disconnectUser(e),t.id&&lH._instances.delete(lF(i,t)),this.eventHandlersToUnregister.forEach(e=>e()),this.eventHandlersToUnregister=[],this.effectsRegistered=!1,this.writeableStateStore.setConnectedUser(void 0))})},this.on=(e,t)=>this.streamClient.on(e,t),this.off=(e,t)=>this.streamClient.off(e,t),this.call=(e,t)=>new lD({streamClient:this.streamClient,id:t,type:e,clientStore:this.writeableStateStore}),this.createGuestUser=async e=>this.streamClient.doAxiosRequest("post","/guest",e,{publicEndpoint:!0}),this.queryCalls=async(e={})=>{let t=await this.streamClient.post("/calls",e),i=[];for(let n of t.calls){let t=new lD({streamClient:this.streamClient,id:n.call.id,type:n.call.type,members:n.members,ownCapabilities:n.own_capabilities,watching:e.watch,clientStore:this.writeableStateStore});t.state.updateFromCallResponse(n.call),await t.applyDeviceConfig(n.call.settings,!1),e.watch&&(await t.setup(),this.writeableStateStore.registerCall(t)),i.push(t)}return{...t,calls:i}},this.queryCallStats=async(e={})=>this.streamClient.post("/call/stats",e),this.queryAggregateCallStats=async(e={})=>this.streamClient.post("/stats",e),this.edges=async()=>this.streamClient.get("/edges"),this.addDevice=async(e,t,i,n,r)=>await this.streamClient.post("/devices",{id:e,push_provider:t,voip_token:r,...null!=n?{user_id:n}:{},...null!=i?{push_provider_name:i}:{}}),this.addVoipDevice=async(e,t,i,n)=>await this.addDevice(e,t,i,n,!0),this.getDevices=async e=>await this.streamClient.get("/devices",e?{user_id:e}:{}),this.removeDevice=async(e,t)=>await this.streamClient.delete("/devices",{id:e,...t?{user_id:t}:{}}),this.onRingingCall=async e=>{let t=this.state.calls.find(t=>t.cid===e&&t.ringing);if(!t){let[i,n]=e.split(":");t=new lD({streamClient:this.streamClient,type:i,id:n,clientStore:this.writeableStateStore,ringing:!0}),await t.get()}return t},this.connectAnonymousUser=async(e,t)=>ai(this.connectionConcurrencyTag,()=>this.streamClient.connectAnonymousUser(e,t));let i="string"==typeof e?e:e.apiKey,n="string"==typeof e?t:e.options;if(n?.enableTimerWorker&&oN(),s0(n?.logger||sQ,n?.logLevel||"warn"),this.logger=s3(["client"]),this.streamClient=lV(i,n),this.writeableStateStore=new af,this.readOnlyStateStore=new am(this.writeableStateStore),"string"!=typeof e&&e.user){let t=e.user;"anonymous"===t.type&&(t.id="!anon"),t.id&&this.registerClientInstance(i,t);let n=lB(e);this.connectUser(t,n).catch(e=>{this.logger("error","Failed to connect",e)})}}static getOrCreateInstance(e){let{apiKey:t,user:i,token:n,tokenProvider:r}=e;if(!i.id&&"anonymous"!==i.type)throw Error("user.id is required for a non-anonymous user");if(!n&&!r&&"anonymous"!==i.type&&"guest"!==i.type)throw Error("tokenProvider or token is required for a authenticated users");return lH._instances.get(lF(t,i))||new lH(e)}get state(){return this.readOnlyStateStore}}lH._instances=new Map;let lq=e=>"string"==typeof e,lW=()=>{let e,t,i=new Promise((i,n)=>{e=i,t=n});return i.resolve=e,i.reject=t,i},lG=e=>null==e?"":""+e,lJ=(e,t,i)=>{e.forEach(e=>{t[e]&&(i[e]=t[e])})},lK=/###/g,lz=e=>e&&e.indexOf("###")>-1?e.replace(lK,"."):e,lY=e=>!e||lq(e),lX=(e,t,i)=>{let n=lq(t)?t.split("."):t,r=0;for(;r<n.length-1;){if(lY(e))return{};let t=lz(n[r]);!e[t]&&i&&(e[t]=new i),e=Object.prototype.hasOwnProperty.call(e,t)?e[t]:{},++r}return lY(e)?{}:{obj:e,k:lz(n[r])}},lZ=(e,t,i)=>{let{obj:n,k:r}=lX(e,t,Object);if(void 0!==n||1===t.length){n[r]=i;return}let s=t[t.length-1],a=t.slice(0,t.length-1),o=lX(e,a,Object);for(;void 0===o.obj&&a.length;)s=`${a[a.length-1]}.${s}`,(o=lX(e,a=a.slice(0,a.length-1),Object))&&o.obj&&void 0!==o.obj[`${o.k}.${s}`]&&(o.obj=void 0);o.obj[`${o.k}.${s}`]=i},lQ=(e,t,i,n)=>{let{obj:r,k:s}=lX(e,t,Object);r[s]=r[s]||[],r[s].push(i)},l0=(e,t)=>{let{obj:i,k:n}=lX(e,t);if(i)return i[n]},l1=(e,t,i)=>{let n=l0(e,i);return void 0!==n?n:l0(t,i)},l2=(e,t,i)=>{for(let n in t)"__proto__"!==n&&"constructor"!==n&&(n in e?lq(e[n])||e[n]instanceof String||lq(t[n])||t[n]instanceof String?i&&(e[n]=t[n]):l2(e[n],t[n],i):e[n]=t[n]);return e},l3=e=>e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var l4={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};let l6=e=>lq(e)?e.replace(/[&<>"'\/]/g,e=>l4[e]):e;class l5{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){let t=this.regExpMap.get(e);if(void 0!==t)return t;let i=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,i),this.regExpQueue.push(e),i}}let l9=[" ",",","?","!",";"],l8=new l5(20),l7=(e,t,i)=>{t=t||"",i=i||"";let n=l9.filter(e=>0>t.indexOf(e)&&0>i.indexOf(e));if(0===n.length)return!0;let r=l8.getRegExp(`(${n.map(e=>"?"===e?"\\?":e).join("|")})`),s=!r.test(e);if(!s){let t=e.indexOf(i);t>0&&!r.test(e.substring(0,t))&&(s=!0)}return s},ce=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";if(!e)return;if(e[t])return e[t];let n=t.split(i),r=e;for(let e=0;e<n.length;){let t;if(!r||"object"!=typeof r)return;let s="";for(let a=e;a<n.length;++a)if(a!==e&&(s+=i),s+=n[a],void 0!==(t=r[s])){if(["string","number","boolean"].indexOf(typeof t)>-1&&a<n.length-1)continue;e+=a-e+1;break}r=t}return r},ct=e=>e&&e.replace("_","-"),ci={type:"logger",log(e){this.output("log",e)},warn(e){this.output("warn",e)},error(e){this.output("error",e)},output(e,t){console&&console[e]&&console[e].apply(console,t)}};class cn{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.init(e,t)}init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||ci,this.options=t,this.debug=t.debug}log(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.forward(t,"log","",!0)}warn(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.forward(t,"warn","",!0)}error(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.forward(t,"error","")}deprecate(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,i,n){return n&&!this.debug?null:(lq(e[0])&&(e[0]=`${i}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new cn(this.logger,{...{prefix:`${this.prefix}:${e}:`},...this.options})}clone(e){return(e=e||this.options).prefix=e.prefix||this.prefix,new cn(this.logger,e)}}var cr=new cn;class cs{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach(e=>{this.observers[e]||(this.observers[e]=new Map);let i=this.observers[e].get(t)||0;this.observers[e].set(t,i+1)}),this}off(e,t){if(this.observers[e]){if(!t)return void delete this.observers[e];this.observers[e].delete(t)}}emit(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];this.observers[e]&&Array.from(this.observers[e].entries()).forEach(e=>{let[t,n]=e;for(let e=0;e<n;e++)t(...i)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(t=>{let[n,r]=t;for(let t=0;t<r;t++)n.apply(n,[e,...i])})}}class ca extends cs{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=e||{},this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),void 0===this.options.ignoreJSONStructure&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){0>this.options.ns.indexOf(e)&&this.options.ns.push(e)}removeNamespaces(e){let t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,i){let n,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=void 0!==r.keySeparator?r.keySeparator:this.options.keySeparator,a=void 0!==r.ignoreJSONStructure?r.ignoreJSONStructure:this.options.ignoreJSONStructure;e.indexOf(".")>-1?n=e.split("."):(n=[e,t],i&&(Array.isArray(i)?n.push(...i):lq(i)&&s?n.push(...i.split(s)):n.push(i)));let o=l0(this.data,n);return(!o&&!t&&!i&&e.indexOf(".")>-1&&(e=n[0],t=n[1],i=n.slice(2).join(".")),!o&&a&&lq(i))?ce(this.data&&this.data[e]&&this.data[e][t],i,s):o}addResource(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{silent:!1},s=void 0!==r.keySeparator?r.keySeparator:this.options.keySeparator,a=[e,t];i&&(a=a.concat(s?i.split(s):i)),e.indexOf(".")>-1&&(a=e.split("."),n=t,t=a[1]),this.addNamespaces(t),lZ(this.data,a,n),r.silent||this.emit("added",e,t,i,n)}addResources(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{silent:!1};for(let n in i)(lq(i[n])||Array.isArray(i[n]))&&this.addResource(e,t,n,i[n],{silent:!0});n.silent||this.emit("added",e,t,i)}addResourceBundle(e,t,i,n,r){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{silent:!1,skipCopy:!1},a=[e,t];e.indexOf(".")>-1&&(a=e.split("."),n=i,i=t,t=a[1]),this.addNamespaces(t);let o=l0(this.data,a)||{};s.skipCopy||(i=JSON.parse(JSON.stringify(i))),n?l2(o,i,r):o={...o,...i},lZ(this.data,a,o),s.silent||this.emit("added",e,t,i)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return void 0!==this.getResource(e,t)}getResourceBundle(e,t){return(t||(t=this.options.defaultNS),"v1"===this.options.compatibilityAPI)?{...this.getResource(e,t)}:this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){let t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find(e=>t[e]&&Object.keys(t[e]).length>0)}toJSON(){return this.data}}var co={processors:{},addPostProcessor(e){this.processors[e.name]=e},handle(e,t,i,n,r){return e.forEach(e=>{this.processors[e]&&(t=this.processors[e].process(t,i,n,r))}),t}};let cl={};class cc extends cs{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),lJ(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),this.logger=cr.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}};if(null==e)return!1;let i=this.resolve(e,t);return i&&void 0!==i.res}extractFromKey(e,t){let i=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===i&&(i=":");let n=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,r=t.ns||this.options.defaultNS||[],s=i&&e.indexOf(i)>-1,a=!this.options.userDefinedKeySeparator&&!t.keySeparator&&!this.options.userDefinedNsSeparator&&!t.nsSeparator&&!l7(e,i,n);if(s&&!a){let t=e.match(this.interpolator.nestingRegexp);if(t&&t.length>0)return{key:e,namespaces:lq(r)?[r]:r};let s=e.split(i);(i!==n||i===n&&this.options.ns.indexOf(s[0])>-1)&&(r=s.shift()),e=s.join(n)}return{key:e,namespaces:lq(r)?[r]:r}}translate(e,t,i){if("object"!=typeof t&&this.options.overloadTranslationOptionHandler&&(t=this.options.overloadTranslationOptionHandler(arguments)),"object"==typeof t&&(t={...t}),t||(t={}),null==e)return"";Array.isArray(e)||(e=[String(e)]);let n=void 0!==t.returnDetails?t.returnDetails:this.options.returnDetails,r=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,{key:s,namespaces:a}=this.extractFromKey(e[e.length-1],t),o=a[a.length-1],l=t.lng||this.language,c=t.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(l&&"cimode"===l.toLowerCase()){if(c){let e=t.nsSeparator||this.options.nsSeparator;return n?{res:`${o}${e}${s}`,usedKey:s,exactUsedKey:s,usedLng:l,usedNS:o,usedParams:this.getUsedParamsDetails(t)}:`${o}${e}${s}`}return n?{res:s,usedKey:s,exactUsedKey:s,usedLng:l,usedNS:o,usedParams:this.getUsedParamsDetails(t)}:s}let u=this.resolve(e,t),d=u&&u.res,h=u&&u.usedKey||s,p=u&&u.exactUsedKey||s,f=Object.prototype.toString.apply(d),m=void 0!==t.joinArrays?t.joinArrays:this.options.joinArrays,g=!this.i18nFormat||this.i18nFormat.handleAsObject,v=!lq(d)&&"boolean"!=typeof d&&"number"!=typeof d;if(g&&d&&v&&0>["[object Number]","[object Function]","[object RegExp]"].indexOf(f)&&!(lq(m)&&Array.isArray(d))){if(!t.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");let e=this.options.returnedObjectHandler?this.options.returnedObjectHandler(h,d,{...t,ns:a}):`key '${s} (${this.language})' returned an object instead of string.`;return n?(u.res=e,u.usedParams=this.getUsedParamsDetails(t),u):e}if(r){let e=Array.isArray(d),i=e?[]:{},n=e?p:h;for(let e in d)if(Object.prototype.hasOwnProperty.call(d,e)){let s=`${n}${r}${e}`;i[e]=this.translate(s,{...t,joinArrays:!1,ns:a}),i[e]===s&&(i[e]=d[e])}d=i}}else if(g&&lq(m)&&Array.isArray(d))(d=d.join(m))&&(d=this.extendTranslation(d,e,t,i));else{let n=!1,a=!1,c=void 0!==t.count&&!lq(t.count),h=cc.hasDefaultValue(t),p=c?this.pluralResolver.getSuffix(l,t.count,t):"",f=t.ordinal&&c?this.pluralResolver.getSuffix(l,t.count,{ordinal:!1}):"",m=c&&!t.ordinal&&0===t.count&&this.pluralResolver.shouldUseIntlApi(),g=m&&t[`defaultValue${this.options.pluralSeparator}zero`]||t[`defaultValue${p}`]||t[`defaultValue${f}`]||t.defaultValue;!this.isValidLookup(d)&&h&&(n=!0,d=g),this.isValidLookup(d)||(a=!0,d=s);let v=(t.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&a?void 0:d,b=h&&g!==d&&this.options.updateMissing;if(a||n||b){if(this.logger.log(b?"updateKey":"missingKey",l,o,s,b?g:d),r){let e=this.resolve(s,{...t,keySeparator:!1});e&&e.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let e=[],i=this.languageUtils.getFallbackCodes(this.options.fallbackLng,t.lng||this.language);if("fallback"===this.options.saveMissingTo&&i&&i[0])for(let t=0;t<i.length;t++)e.push(i[t]);else"all"===this.options.saveMissingTo?e=this.languageUtils.toResolveHierarchy(t.lng||this.language):e.push(t.lng||this.language);let n=(e,i,n)=>{let r=h&&n!==d?n:v;this.options.missingKeyHandler?this.options.missingKeyHandler(e,o,i,r,b,t):this.backendConnector&&this.backendConnector.saveMissing&&this.backendConnector.saveMissing(e,o,i,r,b,t),this.emit("missingKey",e,o,i,d)};this.options.saveMissing&&(this.options.saveMissingPlurals&&c?e.forEach(e=>{let i=this.pluralResolver.getSuffixes(e,t);m&&t[`defaultValue${this.options.pluralSeparator}zero`]&&0>i.indexOf(`${this.options.pluralSeparator}zero`)&&i.push(`${this.options.pluralSeparator}zero`),i.forEach(i=>{n([e],s+i,t[`defaultValue${i}`]||g)})}):n(e,s,g))}d=this.extendTranslation(d,e,t,u,i),a&&d===s&&this.options.appendNamespaceToMissingKey&&(d=`${o}:${s}`),(a||n)&&this.options.parseMissingKeyHandler&&(d="v1"!==this.options.compatibilityAPI?this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${o}:${s}`:s,n?d:void 0):this.options.parseMissingKeyHandler(d))}return n?(u.res=d,u.usedParams=this.getUsedParamsDetails(t),u):d}extendTranslation(e,t,i,n,r){var s=this;if(this.i18nFormat&&this.i18nFormat.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...i},i.lng||this.language||n.usedLng,n.usedNS,n.usedKey,{resolved:n});else if(!i.skipInterpolation){let a;i.interpolation&&this.interpolator.init({...i,...{interpolation:{...this.options.interpolation,...i.interpolation}}});let o=lq(e)&&(i&&i.interpolation&&void 0!==i.interpolation.skipOnVariables?i.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);if(o){let t=e.match(this.interpolator.nestingRegexp);a=t&&t.length}let l=i.replace&&!lq(i.replace)?i.replace:i;if(this.options.interpolation.defaultVariables&&(l={...this.options.interpolation.defaultVariables,...l}),e=this.interpolator.interpolate(e,l,i.lng||this.language||n.usedLng,i),o){let t=e.match(this.interpolator.nestingRegexp);a<(t&&t.length)&&(i.nest=!1)}!i.lng&&"v1"!==this.options.compatibilityAPI&&n&&n.res&&(i.lng=this.language||n.usedLng),!1!==i.nest&&(e=this.interpolator.nest(e,function(){for(var e=arguments.length,n=Array(e),a=0;a<e;a++)n[a]=arguments[a];return r&&r[0]===n[0]&&!i.context?(s.logger.warn(`It seems you are nesting recursively key: ${n[0]} in key: ${t[0]}`),null):s.translate(...n,t)},i)),i.interpolation&&this.interpolator.reset()}let a=i.postProcess||this.options.postProcess,o=lq(a)?[a]:a;return null!=e&&o&&o.length&&!1!==i.applyPostProcessor&&(e=co.handle(o,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...n,usedParams:this.getUsedParamsDetails(i)},...i}:i,this)),e}resolve(e){let t,i,n,r,s,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return lq(e)&&(e=[e]),e.forEach(e=>{if(this.isValidLookup(t))return;let o=this.extractFromKey(e,a),l=o.key;i=l;let c=o.namespaces;this.options.fallbackNS&&(c=c.concat(this.options.fallbackNS));let u=void 0!==a.count&&!lq(a.count),d=u&&!a.ordinal&&0===a.count&&this.pluralResolver.shouldUseIntlApi(),h=void 0!==a.context&&(lq(a.context)||"number"==typeof a.context)&&""!==a.context,p=a.lngs?a.lngs:this.languageUtils.toResolveHierarchy(a.lng||this.language,a.fallbackLng);c.forEach(e=>{this.isValidLookup(t)||(s=e,!cl[`${p[0]}-${e}`]&&this.utils&&this.utils.hasLoadedNamespace&&!this.utils.hasLoadedNamespace(s)&&(cl[`${p[0]}-${e}`]=!0,this.logger.warn(`key "${i}" for languages "${p.join(", ")}" won't get resolved as namespace "${s}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),p.forEach(i=>{let s;if(this.isValidLookup(t))return;r=i;let o=[l];if(this.i18nFormat&&this.i18nFormat.addLookupKeys)this.i18nFormat.addLookupKeys(o,l,i,e,a);else{let e;u&&(e=this.pluralResolver.getSuffix(i,a.count,a));let t=`${this.options.pluralSeparator}zero`,n=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(u&&(o.push(l+e),a.ordinal&&0===e.indexOf(n)&&o.push(l+e.replace(n,this.options.pluralSeparator)),d&&o.push(l+t)),h){let i=`${l}${this.options.contextSeparator}${a.context}`;o.push(i),u&&(o.push(i+e),a.ordinal&&0===e.indexOf(n)&&o.push(i+e.replace(n,this.options.pluralSeparator)),d&&o.push(i+t))}}for(;s=o.pop();)this.isValidLookup(t)||(n=s,t=this.getResource(i,e,s,a))}))})}),{res:t,usedKey:i,exactUsedKey:n,usedLng:r,usedNS:s}}isValidLookup(e){return void 0!==e&&!(!this.options.returnNull&&null===e)&&!(!this.options.returnEmptyString&&""===e)}getResource(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(e,t,i,n):this.resourceStore.getResource(e,t,i,n)}getUsedParamsDetails(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.replace&&!lq(e.replace),i=t?e.replace:e;if(t&&void 0!==e.count&&(i.count=e.count),this.options.interpolation.defaultVariables&&(i={...this.options.interpolation.defaultVariables,...i}),!t)for(let e of(i={...i},["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"]))delete i[e];return i}static hasDefaultValue(e){let t="defaultValue";for(let i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&t===i.substring(0,t.length)&&void 0!==e[i])return!0;return!1}}let cu=e=>e.charAt(0).toUpperCase()+e.slice(1);class cd{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=cr.create("languageUtils")}getScriptPartFromCode(e){if(!(e=ct(e))||0>e.indexOf("-"))return null;let t=e.split("-");return 2===t.length||(t.pop(),"x"===t[t.length-1].toLowerCase())?null:this.formatLanguageCode(t.join("-"))}getLanguagePartFromCode(e){if(!(e=ct(e))||0>e.indexOf("-"))return e;let t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(lq(e)&&e.indexOf("-")>-1){if("undefined"!=typeof Intl&&void 0!==Intl.getCanonicalLocales)try{let t=Intl.getCanonicalLocales(e)[0];if(t&&this.options.lowerCaseLng&&(t=t.toLowerCase()),t)return t}catch(e){}let t=["hans","hant","latn","cyrl","cans","mong","arab"],i=e.split("-");return this.options.lowerCaseLng?i=i.map(e=>e.toLowerCase()):2===i.length?(i[0]=i[0].toLowerCase(),i[1]=i[1].toUpperCase(),t.indexOf(i[1].toLowerCase())>-1&&(i[1]=cu(i[1].toLowerCase()))):3===i.length&&(i[0]=i[0].toLowerCase(),2===i[1].length&&(i[1]=i[1].toUpperCase()),"sgn"!==i[0]&&2===i[2].length&&(i[2]=i[2].toUpperCase()),t.indexOf(i[1].toLowerCase())>-1&&(i[1]=cu(i[1].toLowerCase())),t.indexOf(i[2].toLowerCase())>-1&&(i[2]=cu(i[2].toLowerCase()))),i.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){let t;return e?(e.forEach(e=>{if(t)return;let i=this.formatLanguageCode(e);(!this.options.supportedLngs||this.isSupportedCode(i))&&(t=i)}),!t&&this.options.supportedLngs&&e.forEach(e=>{if(t)return;let i=this.getLanguagePartFromCode(e);if(this.isSupportedCode(i))return t=i;t=this.options.supportedLngs.find(e=>{if(e===i||!(0>e.indexOf("-")&&0>i.indexOf("-"))&&(e.indexOf("-")>0&&0>i.indexOf("-")&&e.substring(0,e.indexOf("-"))===i||0===e.indexOf(i)&&i.length>1))return e})}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t):null}getFallbackCodes(e,t){if(!e)return[];if("function"==typeof e&&(e=e(t)),lq(e)&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let i=e[t];return i||(i=e[this.getScriptPartFromCode(t)]),i||(i=e[this.formatLanguageCode(t)]),i||(i=e[this.getLanguagePartFromCode(t)]),i||(i=e.default),i||[]}toResolveHierarchy(e,t){let i=this.getFallbackCodes(t||this.options.fallbackLng||[],e),n=[],r=e=>{e&&(this.isSupportedCode(e)?n.push(e):this.logger.warn(`rejecting language code not found in supportedLngs: ${e}`))};return lq(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?("languageOnly"!==this.options.load&&r(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&r(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&r(this.getLanguagePartFromCode(e))):lq(e)&&r(this.formatLanguageCode(e)),i.forEach(e=>{0>n.indexOf(e)&&r(this.formatLanguageCode(e))}),n}}let ch=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kk","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],cp={1:e=>Number(e>1),2:e=>Number(1!=e),3:e=>0,4:e=>Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2),5:e=>Number(0==e?0:1==e?1:2==e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5),6:e=>Number(1==e?0:e>=2&&e<=4?1:2),7:e=>Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2),8:e=>Number(1==e?0:2==e?1:8!=e&&11!=e?2:3),9:e=>Number(e>=2),10:e=>Number(1==e?0:2==e?1:e<7?2:e<11?3:4),11:e=>Number(1==e||11==e?0:2==e||12==e?1:e>2&&e<20?2:3),12:e=>Number(e%10!=1||e%100==11),13:e=>Number(0!==e),14:e=>Number(1==e?0:2==e?1:3==e?2:3),15:e=>Number(e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2),16:e=>Number(e%10==1&&e%100!=11?0:0!==e?1:2),17:e=>Number(+(1!=e&&(e%10!=1||e%100==11))),18:e=>Number(0==e?0:1==e?1:2),19:e=>Number(1==e?0:0==e||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3),20:e=>Number(1==e?0:0==e||e%100>0&&e%100<20?1:2),21:e=>Number(e%100==1?1:e%100==2?2:3*(e%100==3||e%100==4)),22:e=>Number(1==e?0:2==e?1:(e<0||e>10)&&e%10==0?2:3)},cf=["v1","v2","v3"],cm=["v4"],cg={zero:0,one:1,two:2,few:3,many:4,other:5},cv=()=>{let e={};return ch.forEach(t=>{t.lngs.forEach(i=>{e[i]={numbers:t.nr,plurals:cp[t.fc]}})}),e};class cb{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.languageUtils=e,this.options=t,this.logger=cr.create("pluralResolver"),(!this.options.compatibilityJSON||cm.includes(this.options.compatibilityJSON))&&("undefined"==typeof Intl||!Intl.PluralRules)&&(this.options.compatibilityJSON="v3",this.logger.error("Your environment seems not to be Intl API compatible, use an Intl.PluralRules polyfill. Will fallback to the compatibilityJSON v3 format handling.")),this.rules=cv(),this.pluralRulesCache={}}addRule(e,t){this.rules[e]=t}clearCache(){this.pluralRulesCache={}}getRule(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.shouldUseIntlApi()){let i,n=ct("dev"===e?"en":e),r=t.ordinal?"ordinal":"cardinal",s=JSON.stringify({cleanedCode:n,type:r});if(s in this.pluralRulesCache)return this.pluralRulesCache[s];try{i=new Intl.PluralRules(n,{type:r})}catch(r){if(!e.match(/-|_/))return;let n=this.languageUtils.getLanguagePartFromCode(e);i=this.getRule(n,t)}return this.pluralRulesCache[s]=i,i}return this.rules[e]||this.rules[this.languageUtils.getLanguagePartFromCode(e)]}needsPlural(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.getRule(e,t);return this.shouldUseIntlApi()?i&&i.resolvedOptions().pluralCategories.length>1:i&&i.numbers.length>1}getPluralFormsOfKey(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.getSuffixes(e,i).map(e=>`${t}${e}`)}getSuffixes(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.getRule(e,t);return i?this.shouldUseIntlApi()?i.resolvedOptions().pluralCategories.sort((e,t)=>cg[e]-cg[t]).map(e=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${e}`):i.numbers.map(i=>this.getSuffix(e,i,t)):[]}getSuffix(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=this.getRule(e,i);return n?this.shouldUseIntlApi()?`${this.options.prepend}${i.ordinal?`ordinal${this.options.prepend}`:""}${n.select(t)}`:this.getSuffixRetroCompatible(n,t):(this.logger.warn(`no plural rule found for: ${e}`),"")}getSuffixRetroCompatible(e,t){let i=e.noAbs?e.plurals(t):e.plurals(Math.abs(t)),n=e.numbers[i];this.options.simplifyPluralSuffix&&2===e.numbers.length&&1===e.numbers[0]&&(2===n?n="plural":1===n&&(n=""));let r=()=>this.options.prepend&&n.toString()?this.options.prepend+n.toString():n.toString();return"v1"===this.options.compatibilityJSON?1===n?"":"number"==typeof n?`_plural_${n.toString()}`:r():"v2"===this.options.compatibilityJSON||this.options.simplifyPluralSuffix&&2===e.numbers.length&&1===e.numbers[0]?r():this.options.prepend&&i.toString()?this.options.prepend+i.toString():i.toString()}shouldUseIntlApi(){return!cf.includes(this.options.compatibilityJSON)}}let cy=function(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:".",r=!(arguments.length>4)||void 0===arguments[4]||arguments[4],s=l1(e,t,i);return!s&&r&&lq(i)&&void 0===(s=ce(e,i,n))&&(s=ce(t,i,n)),s},cS=e=>e.replace(/\$/g,"$$$$");class cw{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger=cr.create("interpolator"),this.options=e,this.format=e.interpolation&&e.interpolation.format||(e=>e),this.init(e)}init(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});let{escape:t,escapeValue:i,useRawValueToEscape:n,prefix:r,prefixEscaped:s,suffix:a,suffixEscaped:o,formatSeparator:l,unescapeSuffix:c,unescapePrefix:u,nestingPrefix:d,nestingPrefixEscaped:h,nestingSuffix:p,nestingSuffixEscaped:f,nestingOptionsSeparator:m,maxReplaces:g,alwaysFormat:v}=e.interpolation;this.escape=void 0!==t?t:l6,this.escapeValue=void 0===i||i,this.useRawValueToEscape=void 0!==n&&n,this.prefix=r?l3(r):s||"{{",this.suffix=a?l3(a):o||"}}",this.formatSeparator=l||",",this.unescapePrefix=c?"":u||"-",this.unescapeSuffix=this.unescapePrefix?"":c||"",this.nestingPrefix=d?l3(d):h||l3("$t("),this.nestingSuffix=p?l3(p):f||l3(")"),this.nestingOptionsSeparator=m||",",this.maxReplaces=g||1e3,this.alwaysFormat=void 0!==v&&v,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){let e=(e,t)=>e&&e.source===t?(e.lastIndex=0,e):RegExp(t,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,t,i,n){let r,s,a,o=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},l=e=>{if(0>e.indexOf(this.formatSeparator)){let r=cy(t,o,e,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(r,void 0,i,{...n,...t,interpolationkey:e}):r}let r=e.split(this.formatSeparator),s=r.shift().trim(),a=r.join(this.formatSeparator).trim();return this.format(cy(t,o,s,this.options.keySeparator,this.options.ignoreJSONStructure),a,i,{...n,...t,interpolationkey:s})};this.resetRegExp();let c=n&&n.missingInterpolationHandler||this.options.missingInterpolationHandler,u=n&&n.interpolation&&void 0!==n.interpolation.skipOnVariables?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:e=>cS(e)},{regex:this.regexp,safeValue:e=>this.escapeValue?cS(this.escape(e)):cS(e)}].forEach(t=>{for(a=0;r=t.regex.exec(e);){let i=r[1].trim();if(void 0===(s=l(i)))if("function"==typeof c){let t=c(e,r,n);s=lq(t)?t:""}else if(n&&Object.prototype.hasOwnProperty.call(n,i))s="";else if(u){s=r[0];continue}else this.logger.warn(`missed to pass in variable ${i} for interpolating ${e}`),s="";else lq(s)||this.useRawValueToEscape||(s=lG(s));let o=t.safeValue(s);if(e=e.replace(r[0],o),u?(t.regex.lastIndex+=s.length,t.regex.lastIndex-=r[0].length):t.regex.lastIndex=0,++a>=this.maxReplaces)break}}),e}nest(e,t){let i,n,r,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=(e,t)=>{let i=this.nestingOptionsSeparator;if(0>e.indexOf(i))return e;let n=e.split(RegExp(`${i}[ ]*{`)),s=`{${n[1]}`;e=n[0];let a=(s=this.interpolate(s,r)).match(/'/g),o=s.match(/"/g);(a&&a.length%2==0&&!o||o.length%2!=0)&&(s=s.replace(/'/g,'"'));try{r=JSON.parse(s),t&&(r={...t,...r})}catch(t){return this.logger.warn(`failed parsing options string in nesting for key ${e}`,t),`${e}${i}${s}`}return r.defaultValue&&r.defaultValue.indexOf(this.prefix)>-1&&delete r.defaultValue,e};for(;i=this.nestingRegexp.exec(e);){let o=[];(r=(r={...s}).replace&&!lq(r.replace)?r.replace:r).applyPostProcessor=!1,delete r.defaultValue;let l=!1;if(-1!==i[0].indexOf(this.formatSeparator)&&!/{.*}/.test(i[1])){let e=i[1].split(this.formatSeparator).map(e=>e.trim());i[1]=e.shift(),o=e,l=!0}if((n=t(a.call(this,i[1].trim(),r),r))&&i[0]===e&&!lq(n))return n;lq(n)||(n=lG(n)),n||(this.logger.warn(`missed to resolve ${i[1]} for nesting ${e}`),n=""),l&&(n=o.reduce((e,t)=>this.format(e,t,s.lng,{...s,interpolationkey:i[1].trim()}),n.trim())),e=e.replace(i[0],n),this.regexp.lastIndex=0}return e}}let ck=e=>{let t=e.toLowerCase().trim(),i={};if(e.indexOf("(")>-1){let n=e.split("(");t=n[0].toLowerCase().trim();let r=n[1].substring(0,n[1].length-1);"currency"===t&&0>r.indexOf(":")?i.currency||(i.currency=r.trim()):"relativetime"===t&&0>r.indexOf(":")?i.range||(i.range=r.trim()):r.split(";").forEach(e=>{if(e){let[t,...n]=e.split(":"),r=n.join(":").trim().replace(/^'+|'+$/g,""),s=t.trim();i[s]||(i[s]=r),"false"===r&&(i[s]=!1),"true"===r&&(i[s]=!0),isNaN(r)||(i[s]=parseInt(r,10))}})}return{formatName:t,formatOptions:i}},cC=e=>{let t={};return(i,n,r)=>{let s=r;r&&r.interpolationkey&&r.formatParams&&r.formatParams[r.interpolationkey]&&r[r.interpolationkey]&&(s={...s,[r.interpolationkey]:void 0});let a=n+JSON.stringify(s),o=t[a];return o||(o=e(ct(n),r),t[a]=o),o(i)}};class cT{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger=cr.create("formatter"),this.options=e,this.formats={number:cC((e,t)=>{let i=new Intl.NumberFormat(e,{...t});return e=>i.format(e)}),currency:cC((e,t)=>{let i=new Intl.NumberFormat(e,{...t,style:"currency"});return e=>i.format(e)}),datetime:cC((e,t)=>{let i=new Intl.DateTimeFormat(e,{...t});return e=>i.format(e)}),relativetime:cC((e,t)=>{let i=new Intl.RelativeTimeFormat(e,{...t});return e=>i.format(e,t.range||"day")}),list:cC((e,t)=>{let i=new Intl.ListFormat(e,{...t});return e=>i.format(e)})},this.init(e)}init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}};this.formatSeparator=t.interpolation.formatSeparator||","}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=cC(t)}format(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=t.split(this.formatSeparator);if(r.length>1&&r[0].indexOf("(")>1&&0>r[0].indexOf(")")&&r.find(e=>e.indexOf(")")>-1)){let e=r.findIndex(e=>e.indexOf(")")>-1);r[0]=[r[0],...r.splice(1,e)].join(this.formatSeparator)}return r.reduce((e,t)=>{let{formatName:r,formatOptions:s}=ck(t);if(this.formats[r]){let t=e;try{let a=n&&n.formatParams&&n.formatParams[n.interpolationkey]||{},o=a.locale||a.lng||n.locale||n.lng||i;t=this.formats[r](e,o,{...s,...n,...a})}catch(e){this.logger.warn(e)}return t}return this.logger.warn(`there was no format function for ${r}`),e},e)}}let cE=(e,t)=>{void 0!==e.pending[t]&&(delete e.pending[t],e.pendingCount--)};class c_ extends cs{constructor(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(),this.backend=e,this.store=t,this.services=i,this.languageUtils=i.languageUtils,this.options=n,this.logger=cr.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=n.maxParallelReads||10,this.readingCalls=0,this.maxRetries=n.maxRetries>=0?n.maxRetries:5,this.retryTimeout=n.retryTimeout>=1?n.retryTimeout:350,this.state={},this.queue=[],this.backend&&this.backend.init&&this.backend.init(i,n.backend,n)}queueLoad(e,t,i,n){let r={},s={},a={},o={};return e.forEach(e=>{let n=!0;t.forEach(t=>{let a=`${e}|${t}`;!i.reload&&this.store.hasResourceBundle(e,t)?this.state[a]=2:this.state[a]<0||(1===this.state[a]?void 0===s[a]&&(s[a]=!0):(this.state[a]=1,n=!1,void 0===s[a]&&(s[a]=!0),void 0===r[a]&&(r[a]=!0),void 0===o[t]&&(o[t]=!0)))}),n||(a[e]=!0)}),(Object.keys(r).length||Object.keys(s).length)&&this.queue.push({pending:s,pendingCount:Object.keys(s).length,loaded:{},errors:[],callback:n}),{toLoad:Object.keys(r),pending:Object.keys(s),toLoadLanguages:Object.keys(a),toLoadNamespaces:Object.keys(o)}}loaded(e,t,i){let n=e.split("|"),r=n[0],s=n[1];t&&this.emit("failedLoading",r,s,t),!t&&i&&this.store.addResourceBundle(r,s,i,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&i&&(this.state[e]=0);let a={};this.queue.forEach(i=>{lQ(i.loaded,[r],s),cE(i,e),t&&i.errors.push(t),0!==i.pendingCount||i.done||(Object.keys(i.loaded).forEach(e=>{a[e]||(a[e]={});let t=i.loaded[e];t.length&&t.forEach(t=>{void 0===a[e][t]&&(a[e][t]=!0)})}),i.done=!0,i.errors.length?i.callback(i.errors):i.callback())}),this.emit("loaded",a),this.queue=this.queue.filter(e=>!e.done)}read(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.retryTimeout,s=arguments.length>5?arguments[5]:void 0;if(!e.length)return s(null,{});if(this.readingCalls>=this.maxParallelReads)return void this.waitingReads.push({lng:e,ns:t,fcName:i,tried:n,wait:r,callback:s});this.readingCalls++;let a=(a,o)=>{if(this.readingCalls--,this.waitingReads.length>0){let e=this.waitingReads.shift();this.read(e.lng,e.ns,e.fcName,e.tried,e.wait,e.callback)}if(a&&o&&n<this.maxRetries)return void setTimeout(()=>{this.read.call(this,e,t,i,n+1,2*r,s)},r);s(a,o)},o=this.backend[i].bind(this.backend);if(2===o.length){try{let i=o(e,t);i&&"function"==typeof i.then?i.then(e=>a(null,e)).catch(a):a(null,i)}catch(e){a(e)}return}return o(e,t,a)}prepareLoading(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),n&&n();lq(e)&&(e=this.languageUtils.toResolveHierarchy(e)),lq(t)&&(t=[t]);let r=this.queueLoad(e,t,i,n);if(!r.toLoad.length)return r.pending.length||n(),null;r.toLoad.forEach(e=>{this.loadOne(e)})}load(e,t,i){this.prepareLoading(e,t,{},i)}reload(e,t,i){this.prepareLoading(e,t,{reload:!0},i)}loadOne(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=e.split("|"),n=i[0],r=i[1];this.read(n,r,"read",void 0,void 0,(i,s)=>{i&&this.logger.warn(`${t}loading namespace ${r} for language ${n} failed`,i),!i&&s&&this.logger.log(`${t}loaded namespace ${r} for language ${n}`,s),this.loaded(e,i,s)})}saveMissing(e,t,i,n,r){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:()=>{};if(this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(t))return void this.logger.warn(`did not save key "${i}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");if(null!=i&&""!==i){if(this.backend&&this.backend.create){let o={...s,isUpdate:r},l=this.backend.create.bind(this.backend);if(l.length<6)try{let r;(r=5===l.length?l(e,t,i,n,o):l(e,t,i,n))&&"function"==typeof r.then?r.then(e=>a(null,e)).catch(a):a(null,r)}catch(e){a(e)}else l(e,t,i,n,a,o)}e&&e[0]&&this.store.addResource(e[0],t,i,n)}}}let cR=()=>({debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:e=>{let t={};if("object"==typeof e[1]&&(t=e[1]),lq(e[1])&&(t.defaultValue=e[1]),lq(e[2])&&(t.tDescription=e[2]),"object"==typeof e[2]||"object"==typeof e[3]){let i=e[3]||e[2];Object.keys(i).forEach(e=>{t[e]=i[e]})}return t},interpolation:{escapeValue:!0,format:e=>e,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}),cI=e=>(lq(e.ns)&&(e.ns=[e.ns]),lq(e.fallbackLng)&&(e.fallbackLng=[e.fallbackLng]),lq(e.fallbackNS)&&(e.fallbackNS=[e.fallbackNS]),e.supportedLngs&&0>e.supportedLngs.indexOf("cimode")&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),e),cx=()=>{},cP=e=>{Object.getOwnPropertyNames(Object.getPrototypeOf(e)).forEach(t=>{"function"==typeof e[t]&&(e[t]=e[t].bind(e))})};class cN extends cs{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(super(),this.options=cI(e),this.services={},this.logger=cr,this.modules={external:[]},cP(this),t&&!this.isInitialized&&!e.isClone){if(!this.options.initImmediate)return this.init(e,t),this;setTimeout(()=>{this.init(e,t)},0)}}init(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,"function"==typeof t&&(i=t,t={}),!t.defaultNS&&!1!==t.defaultNS&&t.ns&&(lq(t.ns)?t.defaultNS=t.ns:0>t.ns.indexOf("translation")&&(t.defaultNS=t.ns[0]));let n=cR();this.options={...n,...this.options,...cI(t)},"v1"!==this.options.compatibilityAPI&&(this.options.interpolation={...n.interpolation,...this.options.interpolation}),void 0!==t.keySeparator&&(this.options.userDefinedKeySeparator=t.keySeparator),void 0!==t.nsSeparator&&(this.options.userDefinedNsSeparator=t.nsSeparator);let r=e=>e?"function"==typeof e?new e:e:null;if(!this.options.isClone){let t;this.modules.logger?cr.init(r(this.modules.logger),this.options):cr.init(null,this.options),this.modules.formatter?t=this.modules.formatter:"undefined"!=typeof Intl&&(t=cT);let i=new cd(this.options);this.store=new ca(this.options.resources,this.options);let s=this.services;s.logger=cr,s.resourceStore=this.store,s.languageUtils=i,s.pluralResolver=new cb(i,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),t&&(!this.options.interpolation.format||this.options.interpolation.format===n.interpolation.format)&&(s.formatter=r(t),s.formatter.init(s,this.options),this.options.interpolation.format=s.formatter.format.bind(s.formatter)),s.interpolator=new cw(this.options),s.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},s.backendConnector=new c_(r(this.modules.backend),s.resourceStore,s,this.options),s.backendConnector.on("*",function(t){for(var i=arguments.length,n=Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];e.emit(t,...n)}),this.modules.languageDetector&&(s.languageDetector=r(this.modules.languageDetector),s.languageDetector.init&&s.languageDetector.init(s,this.options.detection,this.options)),this.modules.i18nFormat&&(s.i18nFormat=r(this.modules.i18nFormat),s.i18nFormat.init&&s.i18nFormat.init(this)),this.translator=new cc(this.services,this.options),this.translator.on("*",function(t){for(var i=arguments.length,n=Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];e.emit(t,...n)}),this.modules.external.forEach(e=>{e.init&&e.init(this)})}if(this.format=this.options.interpolation.format,i||(i=cx),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){let e=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);e.length>0&&"dev"!==e[0]&&(this.options.lng=e[0])}this.services.languageDetector||this.options.lng||this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(t=>{this[t]=function(){return e.store[t](...arguments)}}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(t=>{this[t]=function(){return e.store[t](...arguments),e}});let s=lW(),a=()=>{let e=(e,t)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),s.resolve(t),i(e,t)};if(this.languages&&"v1"!==this.options.compatibilityAPI&&!this.isInitialized)return e(null,this.t.bind(this));this.changeLanguage(this.options.lng,e)};return this.options.resources||!this.options.initImmediate?a():setTimeout(a,0),s}loadResources(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:cx,i=t,n=lq(e)?e:this.language;if("function"==typeof e&&(i=e),!this.options.resources||this.options.partialBundledLanguages){if(n&&"cimode"===n.toLowerCase()&&(!this.options.preload||0===this.options.preload.length))return i();let e=[],t=t=>{t&&"cimode"!==t&&this.services.languageUtils.toResolveHierarchy(t).forEach(t=>{"cimode"!==t&&0>e.indexOf(t)&&e.push(t)})};n?t(n):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(e=>t(e)),this.options.preload&&this.options.preload.forEach(e=>t(e)),this.services.backendConnector.load(e,this.options.ns,e=>{e||this.resolvedLanguage||!this.language||this.setResolvedLanguage(this.language),i(e)})}else i(null)}reloadResources(e,t,i){let n=lW();return"function"==typeof e&&(i=e,e=void 0),"function"==typeof t&&(i=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),i||(i=cx),this.services.backendConnector.reload(e,t,e=>{n.resolve(),i(e)}),n}use(e){if(!e)throw Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&co.addPostProcessor(e),"formatter"===e.type&&(this.modules.formatter=e),"3rdParty"===e.type&&this.modules.external.push(e),this}setResolvedLanguage(e){if(e&&this.languages&&!(["cimode","dev"].indexOf(e)>-1))for(let e=0;e<this.languages.length;e++){let t=this.languages[e];if(!(["cimode","dev"].indexOf(t)>-1)&&this.store.hasLanguageSomeTranslations(t)){this.resolvedLanguage=t;break}}}changeLanguage(e,t){var i=this;this.isLanguageChangingTo=e;let n=lW();this.emit("languageChanging",e);let r=e=>{this.language=e,this.languages=this.services.languageUtils.toResolveHierarchy(e),this.resolvedLanguage=void 0,this.setResolvedLanguage(e)},s=(e,s)=>{s?(r(s),this.translator.changeLanguage(s),this.isLanguageChangingTo=void 0,this.emit("languageChanged",s),this.logger.log("languageChanged",s)):this.isLanguageChangingTo=void 0,n.resolve(function(){return i.t(...arguments)}),t&&t(e,function(){return i.t(...arguments)})},a=t=>{e||t||!this.services.languageDetector||(t=[]);let i=lq(t)?t:this.services.languageUtils.getBestMatchFromCodes(t);i&&(this.language||r(i),this.translator.language||this.translator.changeLanguage(i),this.services.languageDetector&&this.services.languageDetector.cacheUserLanguage&&this.services.languageDetector.cacheUserLanguage(i)),this.loadResources(i,e=>{s(e,i)})};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?0===this.services.languageDetector.detect.length?this.services.languageDetector.detect().then(a):this.services.languageDetector.detect(a):a(e):a(this.services.languageDetector.detect()),n}getFixedT(e,t,i){var n=this;let r=function(e,t){let s,a;if("object"!=typeof t){for(var o=arguments.length,l=Array(o>2?o-2:0),c=2;c<o;c++)l[c-2]=arguments[c];s=n.options.overloadTranslationOptionHandler([e,t].concat(l))}else s={...t};s.lng=s.lng||r.lng,s.lngs=s.lngs||r.lngs,s.ns=s.ns||r.ns,""!==s.keyPrefix&&(s.keyPrefix=s.keyPrefix||i||r.keyPrefix);let u=n.options.keySeparator||".";return a=s.keyPrefix&&Array.isArray(e)?e.map(e=>`${s.keyPrefix}${u}${e}`):s.keyPrefix?`${s.keyPrefix}${u}${e}`:e,n.t(a,s)};return lq(e)?r.lng=e:r.lngs=e,r.ns=t,r.keyPrefix=i,r}t(){return this.translator&&this.translator.translate(...arguments)}exists(){return this.translator&&this.translator.exists(...arguments)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;let i=t.lng||this.resolvedLanguage||this.languages[0],n=!!this.options&&this.options.fallbackLng,r=this.languages[this.languages.length-1];if("cimode"===i.toLowerCase())return!0;let s=(e,t)=>{let i=this.services.backendConnector.state[`${e}|${t}`];return -1===i||0===i||2===i};if(t.precheck){let e=t.precheck(this,s);if(void 0!==e)return e}return!!(this.hasResourceBundle(i,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||s(i,e)&&(!n||s(r,e)))}loadNamespaces(e,t){let i=lW();return this.options.ns?(lq(e)&&(e=[e]),e.forEach(e=>{0>this.options.ns.indexOf(e)&&this.options.ns.push(e)}),this.loadResources(e=>{i.resolve(),t&&t(e)}),i):(t&&t(),Promise.resolve())}loadLanguages(e,t){let i=lW();lq(e)&&(e=[e]);let n=this.options.preload||[],r=e.filter(e=>0>n.indexOf(e)&&this.services.languageUtils.isSupportedCode(e));return r.length?(this.options.preload=n.concat(r),this.loadResources(e=>{i.resolve(),t&&t(e)}),i):(t&&t(),Promise.resolve())}dir(e){return(e||(e=this.resolvedLanguage||(this.languages&&this.languages.length>0?this.languages[0]:this.language)),e)?["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"].indexOf((this.services&&this.services.languageUtils||new cd(cR())).getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr":"rtl"}static createInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return new cN(e,t)}cloneInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:cx,i=e.forkResourceStore;i&&delete e.forkResourceStore;let n={...this.options,...e,isClone:!0},r=new cN(n);return(void 0!==e.debug||void 0!==e.prefix)&&(r.logger=r.logger.clone(e)),["store","services","language"].forEach(e=>{r[e]=this[e]}),r.services={...this.services},r.services.utils={hasLoadedNamespace:r.hasLoadedNamespace.bind(r)},i&&(r.store=new ca(this.store.data,n),r.services.resourceStore=r.store),r.translator=new cc(r.services,n),r.translator.on("*",function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];r.emit(e,...i)}),r.init(n,t),r.translator.options=n,r.translator.backendConnector.services.utils={hasLoadedNamespace:r.hasLoadedNamespace.bind(r)},r}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}let cO=cN.createInstance();cO.createInstance=cN.createInstance,cO.createInstance,cO.dir,cO.init,cO.loadResources,cO.reloadResources,cO.use,cO.changeLanguage,cO.getFixedT,cO.t,cO.exists,cO.setDefaultNamespace,cO.hasLoadedNamespace,cO.loadNamespaces,cO.loadLanguages;let cD=(0,M.createContext)(void 0),cA=()=>(0,M.useContext)(cD),cj="stream-video",cL={debug:!1,currentLanguage:"en",fallbackLanguage:!1},cU=Object.entries({}).reduce((e,[t,i])=>(e[t]={[cj]:i},e),{}),cM=e=>e;class cF{constructor(e={}){this.t=cM,this.init=async()=>{try{this.t=await this.i18nInstance.init()}catch(e){console.error(`Failed to initialize translations: ${JSON.stringify(e)}`)}return this},this.changeLanguage=async(e,t)=>{if(!this._checkIsInitialized())return;let i="undefined"!=typeof window&&window.navigator?window.navigator.language:void 0;await this.i18nInstance.changeLanguage(e||i),t?.(this.currentLanguage)},this.registerTranslationsForLanguage=({lng:e,translations:t})=>{this._checkIsInitialized()&&this.i18nInstance.addResourceBundle(e,cj,t,!0,!0)},this._checkIsInitialized=()=>(this.i18nInstance.isInitialized||console.warn("I18n instance is not initialized. Call yourStreamI18nInstance.init()."),this.i18nInstance.isInitialized);let{debug:t=cL.debug,currentLanguage:i=cL.currentLanguage,fallbackLanguage:n=cL.fallbackLanguage,translationsOverrides:r}=e;this.i18nInstance=cO.createInstance({debug:t,defaultNS:cj,fallbackLng:n,interpolation:{escapeValue:!1},keySeparator:!1,lng:i,nsSeparator:!1,parseMissingKeyHandler:e=>e,resources:cU}),r&&this.i18nInstance.on("initialized",()=>{Object.entries(r).forEach(([e,t])=>{this.registerTranslationsForLanguage({lng:e,translations:t})})})}get currentLanguage(){return this._checkIsInitialized(),this.i18nInstance.language}get isInitialized(){return this.i18nInstance.isInitialized}}let c$=(0,M.createContext)({t:cM}),cV=({children:e,...t})=>{let{i18n:i,t:n}=cB(t);return(0,U.jsx)(c$.Provider,{value:{t:n,i18n:i},children:e})},cB=({i18nInstance:e,language:t,fallbackLanguage:i,translationsOverrides:n})=>{let[r]=(0,M.useState)(()=>e||new cF({currentLanguage:t,fallbackLanguage:i,translationsOverrides:n})),[s,a]=(0,M.useState)(()=>cM);return(0,M.useEffect)(()=>{let{isInitialized:e}=r;if(!e)return void r.init().then(e=>a(()=>e.i18nInstance.t));t&&r?.currentLanguage!==t&&r.changeLanguage(t).catch(e=>{console.log("Error while changing language",e)})},[r,e,t,n]),{i18n:r,t:s}},cH=()=>(0,M.useContext)(c$),cq=(0,M.createContext)(void 0),cW=({children:e,client:t,i18nInstance:i,language:n,translationsOverrides:r})=>(0,U.jsx)(cq.Provider,{value:t,children:(0,U.jsx)(cV,{i18nInstance:i,language:n,translationsOverrides:r,children:e})}),cG=()=>"undefined"!=typeof navigator&&navigator.product?.toLowerCase()==="reactnative",cJ=(e,t)=>{let[i,n]=(0,M.useState)(()=>{try{return ap.getCurrentValue(e)}catch(e){if(void 0===t)throw e;return t}});return(0,M.useEffect)(()=>ap.createSubscription(e,n,e=>{console.log("An error occurred while reading an observable",e),t&&n(t)}),[t,e]),i},cK=Object.freeze([]),cz=()=>{let e=cA();return e?e.state:(console.warn('You are using useCallState() outside a Call context. Please wrap your component in <StreamCall /> and provide a "call" instance.'),new aM)},cY=()=>{let{recording$:e}=cz();return cJ(e)},cX=()=>{let{ownCapabilities$:e}=cz();return cJ(e)};function cZ(e,t){let i=t??e;return{status:e,optimisticStatus:i,isEnabled:"enabled"===e,isMute:"enabled"!==e,optimisticIsMute:"enabled"!==i,isTogglePending:i!==e}}function cQ(e){let t=(0,M.useMemo)(()=>iY(cK),[]),[i,n]=(0,M.useState)(t),r=cJ(i,cK);return{getDevices:()=>(i===t&&n(e.listDevices()),r)}}var c0=Object.freeze({__proto__:null,useAnonymousParticipantCount:()=>{let{anonymousParticipantCount$:e}=cz();return cJ(e)},useCallBlockedUserIds:()=>{let{blockedUserIds$:e}=cz();return cJ(e)},useCallCallingState:()=>{let{callingState$:e}=cz();return cJ(e)},useCallClosedCaptions:()=>{let{closedCaptions$:e}=cz();return cJ(e)},useCallCreatedAt:()=>{let{createdAt$:e}=cz();return cJ(e)},useCallCreatedBy:()=>{let{createdBy$:e}=cz();return cJ(e)},useCallCustomData:()=>{let{custom$:e}=cz();return cJ(e)},useCallEgress:()=>{let{egress$:e}=cz();return cJ(e)},useCallEndedAt:()=>{let{endedAt$:e}=cz();return cJ(e)},useCallEndedBy:()=>{let{endedBy$:e}=cz();return cJ(e)},useCallIngress:()=>{let{ingress$:e}=cz();return cJ(e)},useCallMembers:()=>{let{members$:e}=cz();return cJ(e)},useCallSession:()=>{let{session$:e}=cz();return cJ(e)},useCallSettings:()=>{let{settings$:e}=cz();return cJ(e)},useCallStartedAt:()=>{let{startedAt$:e}=cz();return cJ(e)},useCallStartsAt:()=>{let{startsAt$:e}=cz();return cJ(e)},useCallState:cz,useCallStatsReport:()=>{let{callStatsReport$:e}=cz();return cJ(e)},useCallThumbnail:()=>{let{thumbnails$:e}=cz();return cJ(e)},useCallUpdatedAt:()=>{let{updatedAt$:e}=cz();return cJ(e)},useCameraState:()=>{let{camera:e}=cA(),{state:t}=e,i=cJ(t.direction$),n=cJ(t.mediaStream$),r=cJ(t.selectedDevice$),{getDevices:s}=cQ(e);return{camera:e,direction:i,mediaStream:n,get devices(){return s()},hasBrowserPermission:cJ(t.hasBrowserPermission$),isPromptingPermission:cJ(t.isPromptingPermission$),selectedDevice:r,...cZ(cJ(t.status$),cJ(t.optimisticStatus$))}},useDominantSpeaker:()=>{let{dominantSpeaker$:e}=cz();return cJ(e)},useHasOngoingScreenShare:()=>{let{hasOngoingScreenShare$:e}=cz();return cJ(e)},useHasPermissions:(...e)=>{let t=cX();return e.every(e=>t?.includes(e))},useIncomingVideoSettings:()=>cJ(cA().dynascaleManager.incomingVideoSettings$),useIsCallCaptioningInProgress:()=>{let{captioning$:e}=cz();return cJ(e)},useIsCallHLSBroadcastingInProgress:()=>{let{egress$:e}=cz(),t=cJ(e);return!!t&&t.broadcasting},useIsCallLive:()=>{let{backstage$:e}=cz();return!cJ(e)},useIsCallRecordingInProgress:cY,useIsCallTranscribingInProgress:()=>{let{transcribing$:e}=cz();return cJ(e)},useLocalParticipant:()=>{let{localParticipant$:e}=cz();return cJ(e)},useMicrophoneState:()=>{let{microphone:e}=cA(),{state:t}=e,i=cJ(t.mediaStream$),n=cJ(t.selectedDevice$),{getDevices:r}=cQ(e),s=cJ(t.hasBrowserPermission$);return{microphone:e,mediaStream:i,get devices(){return r()},selectedDevice:n,hasBrowserPermission:s,isPromptingPermission:cJ(t.isPromptingPermission$),isSpeakingWhileMuted:cJ(t.speakingWhileMuted$),...cZ(cJ(t.status$),cJ(t.optimisticStatus$))}},useOwnCapabilities:cX,useParticipantCount:()=>{let{participantCount$:e}=cz();return cJ(e)},useParticipants:({sortBy:e}={})=>{let{participants$:t}=cz(),i=cJ(t);return(0,M.useMemo)(()=>e?[...i].sort(e):i,[i,e])},useRemoteParticipants:()=>{let{remoteParticipants$:e}=cz();return cJ(e)},useScreenShareState:()=>{let{screenShare:e}=cA();return{screenShare:e,mediaStream:cJ(e.state.mediaStream$),...cZ(cJ(e.state.status$),cJ(e.state.optimisticStatus$))}},useSpeakerState:()=>{if(cG())throw Error("This feature is not supported in React Native. Please visit https://getstream.io/video/docs/reactnative/core/camera-and-microphone/#speaker-management for more details");let{speaker:e}=cA(),{getDevices:t}=cQ(e),i=cJ(e.state.selectedDevice$);return{speaker:e,get devices(){return t()},selectedDevice:i,isDeviceSelectionSupported:e.state.isDeviceSelectionSupported}}});let c1=()=>{let e=cA(),t=cY(),[i,n]=(0,M.useState)(!1);return(0,M.useEffect)(()=>{n(e=>!e&&e)},[t]),{toggleCallRecording:(0,M.useCallback)(async()=>{try{n(!0),t?await e?.stopRecording():await e?.startRecording()}catch(e){throw console.error("Failed start recording",e),e}},[e,t]),isAwaitingResponse:i,isCallRecordingInProgress:t}},c2=()=>c0,c3=({canRequestOnly:e,hasPermissionsOnly:t,requiredGrants:i,requireAll:n=!0,children:r})=>{let s=cA(),{useCallSettings:a,useOwnCapabilities:o}=c2(),l=o(),c=a(),u=i[n?"every":"some"](e=>l?.includes(e));if(t)return u?(0,U.jsx)(U.Fragment,{children:r}):null;let d=i.some(e=>s?.permissionsContext.canRequest(e,c));return e?d?(0,U.jsx)(U.Fragment,{children:r}):null:u||d?(0,U.jsx)(U.Fragment,{children:r}):null};function c4(){return"undefined"!=typeof window}function c6(e){return c8(e)?(e.nodeName||"").toLowerCase():"#document"}function c5(e){var t;return(null==e||null==(t=e.ownerDocument)?void 0:t.defaultView)||window}function c9(e){var t;return null==(t=(c8(e)?e.ownerDocument:e.document)||window.document)?void 0:t.documentElement}function c8(e){return!!c4()&&(e instanceof Node||e instanceof c5(e).Node)}function c7(e){return!!c4()&&(e instanceof Element||e instanceof c5(e).Element)}function ue(e){return!!c4()&&(e instanceof HTMLElement||e instanceof c5(e).HTMLElement)}function ut(e){return!!c4()&&"undefined"!=typeof ShadowRoot&&(e instanceof ShadowRoot||e instanceof c5(e).ShadowRoot)}function ui(e){let{overflow:t,overflowX:i,overflowY:n,display:r}=uo(e);return/auto|scroll|overlay|hidden|clip/.test(t+n+i)&&!["inline","contents"].includes(r)}function un(e){return[":popover-open",":modal"].some(t=>{try{return e.matches(t)}catch(e){return!1}})}function ur(e){let t=us(),i=c7(e)?uo(e):e;return["transform","translate","scale","rotate","perspective"].some(e=>!!i[e]&&"none"!==i[e])||!!i.containerType&&"normal"!==i.containerType||!t&&!!i.backdropFilter&&"none"!==i.backdropFilter||!t&&!!i.filter&&"none"!==i.filter||["transform","translate","scale","rotate","perspective","filter"].some(e=>(i.willChange||"").includes(e))||["paint","layout","strict","content"].some(e=>(i.contain||"").includes(e))}function us(){return"undefined"!=typeof CSS&&!!CSS.supports&&CSS.supports("-webkit-backdrop-filter","none")}function ua(e){return["html","body","#document"].includes(c6(e))}function uo(e){return c5(e).getComputedStyle(e)}function ul(e){return c7(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function uc(e){if("html"===c6(e))return e;let t=e.assignedSlot||e.parentNode||ut(e)&&e.host||c9(e);return ut(t)?t.host:t}function uu(e,t,i){var n;void 0===t&&(t=[]),void 0===i&&(i=!0);let r=function e(t){let i=uc(t);return ua(i)?t.ownerDocument?t.ownerDocument.body:t.body:ue(i)&&ui(i)?i:e(i)}(e),s=r===(null==(n=e.ownerDocument)?void 0:n.body),a=c5(r);if(s){let e=ud(a);return t.concat(a,a.visualViewport||[],ui(r)?r:[],e&&i?uu(e):[])}return t.concat(r,uu(r,[],i))}function ud(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}let uh=Math.min,up=Math.max,uf=Math.round,um=Math.floor,ug=e=>({x:e,y:e}),uv={left:"right",right:"left",bottom:"top",top:"bottom"},ub={start:"end",end:"start"};function uy(e,t){return"function"==typeof e?e(t):e}function uS(e){return e.split("-")[0]}function uw(e){return e.split("-")[1]}function uk(e){return"x"===e?"y":"x"}function uC(e){return"y"===e?"height":"width"}function uT(e){return["top","bottom"].includes(uS(e))?"y":"x"}function uE(e){return e.replace(/start|end/g,e=>ub[e])}function u_(e){return e.replace(/left|right|bottom|top/g,e=>uv[e])}function uR(e){return"number"!=typeof e?{top:0,right:0,bottom:0,left:0,...e}:{top:e,right:e,bottom:e,left:e}}function uI(e){let{x:t,y:i,width:n,height:r}=e;return{width:n,height:r,top:i,left:t,right:t+n,bottom:i+r,x:t,y:i}}var ux='input:not([inert]),select:not([inert]),textarea:not([inert]),a[href]:not([inert]),button:not([inert]),[tabindex]:not(slot):not([inert]),audio[controls]:not([inert]),video[controls]:not([inert]),[contenteditable]:not([contenteditable="false"]):not([inert]),details>summary:first-of-type:not([inert]),details:not([inert])',uP="undefined"==typeof Element,uN=uP?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,uO=!uP&&Element.prototype.getRootNode?function(e){var t;return null==e||null==(t=e.getRootNode)?void 0:t.call(e)}:function(e){return null==e?void 0:e.ownerDocument},uD=function e(t,i){void 0===i&&(i=!0);var n,r=null==t||null==(n=t.getAttribute)?void 0:n.call(t,"inert");return""===r||"true"===r||i&&t&&e(t.parentNode)},uA=function(e){var t,i=null==e||null==(t=e.getAttribute)?void 0:t.call(e,"contenteditable");return""===i||"true"===i},uj=function(e,t,i){if(uD(e))return[];var n=Array.prototype.slice.apply(e.querySelectorAll(ux));return t&&uN.call(e,ux)&&n.unshift(e),n=n.filter(i)},uL=function e(t,i,n){for(var r=[],s=Array.from(t);s.length;){var a=s.shift();if(!uD(a,!1))if("SLOT"===a.tagName){var o=a.assignedElements(),l=e(o.length?o:a.children,!0,n);n.flatten?r.push.apply(r,l):r.push({scopeParent:a,candidates:l})}else{uN.call(a,ux)&&n.filter(a)&&(i||!t.includes(a))&&r.push(a);var c=a.shadowRoot||"function"==typeof n.getShadowRoot&&n.getShadowRoot(a),u=!uD(c,!1)&&(!n.shadowRootFilter||n.shadowRootFilter(a));if(c&&u){var d=e(!0===c?a.children:c.children,!0,n);n.flatten?r.push.apply(r,d):r.push({scopeParent:a,candidates:d})}else s.unshift.apply(s,a.children)}}return r},uU=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},uM=function(e){if(!e)throw Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||uA(e))&&!uU(e)?0:e.tabIndex},uF=function(e,t){var i=uM(e);return i<0&&t&&!uU(e)?0:i},u$=function(e,t){return e.tabIndex===t.tabIndex?e.documentOrder-t.documentOrder:e.tabIndex-t.tabIndex},uV=function(e){return"INPUT"===e.tagName},uB=function(e,t){for(var i=0;i<e.length;i++)if(e[i].checked&&e[i].form===t)return e[i]},uH=function(e){if(!e.name)return!0;var t,i=e.form||uO(e),n=function(e){return i.querySelectorAll('input[type="radio"][name="'+e+'"]')};if("undefined"!=typeof window&&void 0!==window.CSS&&"function"==typeof window.CSS.escape)t=n(window.CSS.escape(e.name));else try{t=n(e.name)}catch(e){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",e.message),!1}var r=uB(t,e.form);return!r||r===e},uq=function(e){return uV(e)&&"radio"===e.type&&!uH(e)},uW=function(e){var t,i,n,r,s,a,o,l=e&&uO(e),c=null==(t=l)?void 0:t.host,u=!1;if(l&&l!==e)for(u=!!(null!=(i=c)&&null!=(n=i.ownerDocument)&&n.contains(c)||null!=e&&null!=(r=e.ownerDocument)&&r.contains(e));!u&&c;)u=!!(null!=(a=c=null==(s=l=uO(c))?void 0:s.host)&&null!=(o=a.ownerDocument)&&o.contains(c));return u},uG=function(e){var t=e.getBoundingClientRect(),i=t.width,n=t.height;return 0===i&&0===n},uJ=function(e,t){var i=t.displayCheck,n=t.getShadowRoot;if("hidden"===getComputedStyle(e).visibility)return!0;var r=uN.call(e,"details>summary:first-of-type")?e.parentElement:e;if(uN.call(r,"details:not([open]) *"))return!0;if(i&&"full"!==i&&"legacy-full"!==i){if("non-zero-area"===i)return uG(e)}else{if("function"==typeof n){for(var s=e;e;){var a=e.parentElement,o=uO(e);if(a&&!a.shadowRoot&&!0===n(a))return uG(e);e=e.assignedSlot?e.assignedSlot:a||o===e.ownerDocument?a:o.host}e=s}if(uW(e))return!e.getClientRects().length;if("legacy-full"!==i)return!0}return!1},uK=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var t=e.parentElement;t;){if("FIELDSET"===t.tagName&&t.disabled){for(var i=0;i<t.children.length;i++){var n=t.children.item(i);if("LEGEND"===n.tagName)return!!uN.call(t,"fieldset[disabled] *")||!n.contains(e)}return!0}t=t.parentElement}return!1},uz=function(e,t){return!(t.disabled||uD(t)||uV(t)&&"hidden"===t.type||uJ(t,e)||"DETAILS"===t.tagName&&Array.prototype.slice.apply(t.children).some(function(e){return"SUMMARY"===e.tagName})||uK(t))},uY=function(e,t){return!(uq(t)||0>uM(t))&&!!uz(e,t)},uX=function(e){var t=parseInt(e.getAttribute("tabindex"),10);return!!isNaN(t)||!!(t>=0)},uZ=function e(t){var i=[],n=[];return t.forEach(function(t,r){var s=!!t.scopeParent,a=s?t.scopeParent:t,o=uF(a,s),l=s?e(t.candidates):a;0===o?s?i.push.apply(i,l):i.push(a):n.push({documentOrder:r,tabIndex:o,item:t,isScope:s,content:l})}),n.sort(u$).reduce(function(e,t){return t.isScope?e.push.apply(e,t.content):e.push(t.content),e},[]).concat(i)},uQ=function(e,t){var i;return uZ((t=t||{}).getShadowRoot?uL([e],t.includeContainer,{filter:uY.bind(null,t),flatten:!1,getShadowRoot:t.getShadowRoot,shadowRootFilter:uX}):uj(e,t.includeContainer,uY.bind(null,t)))},u0=function(e,t){var i;return(t=t||{}).getShadowRoot?uL([e],t.includeContainer,{filter:uz.bind(null,t),flatten:!0,getShadowRoot:t.getShadowRoot}):uj(e,t.includeContainer,uz.bind(null,t))},u1=function(e,t){if(t=t||{},!e)throw Error("No node provided");return!1!==uN.call(e,ux)&&uY(t,e)};function u2(){let e=navigator.userAgentData;return null!=e&&e.platform?e.platform:navigator.platform}function u3(){let e=navigator.userAgentData;return e&&Array.isArray(e.brands)?e.brands.map(e=>{let{brand:t,version:i}=e;return t+"/"+i}).join(" "):navigator.userAgent}function u4(){let e=/android/i;return e.test(u2())||e.test(u3())}let u6="data-floating-ui-focusable",u5="ArrowLeft",u9="ArrowRight";function u8(e){let t=e.activeElement;for(;(null==(i=t)||null==(i=i.shadowRoot)?void 0:i.activeElement)!=null;){var i;t=t.shadowRoot.activeElement}return t}function u7(e,t){if(!e||!t)return!1;let i=null==t.getRootNode?void 0:t.getRootNode();if(e.contains(t))return!0;if(i&&ut(i)){let i=t;for(;i;){if(e===i)return!0;i=i.parentNode||i.host}}return!1}function de(e){return"composedPath"in e?e.composedPath()[0]:e.target}function dt(e,t){return null!=t&&("composedPath"in e?e.composedPath().includes(t):null!=e.target&&t.contains(e.target))}function di(e){return(null==e?void 0:e.ownerDocument)||document}function dn(e){return ue(e)&&e.matches("input:not([type='hidden']):not([disabled]),[contenteditable]:not([contenteditable='false']),textarea:not([disabled])")}function dr(e){return!!e&&"combobox"===e.getAttribute("role")&&dn(e)}function ds(e){return e?e.hasAttribute(u6)?e:e.querySelector("["+u6+"]")||e:null}function da(e,t,i){void 0===i&&(i=!0);let n=e.filter(e=>{var i;return e.parentId===t&&(null==(i=e.context)?void 0:i.open)}),r=n;for(;r.length;)r=i?e.filter(e=>{var t;return null==(t=r)?void 0:t.some(t=>{var i;return e.parentId===t.id&&(null==(i=e.context)?void 0:i.open)})}):e,n=n.concat(r);return n}function dl(e,t){var i;let n=[],r=null==(i=e.find(e=>e.id===t))?void 0:i.parentId;for(;r;){let t=e.find(e=>e.id===r);r=null==t?void 0:t.parentId,t&&(n=n.concat(t))}return n}function dc(e){e.preventDefault(),e.stopPropagation()}function du(e){return 0===e.mozInputSource&&!!e.isTrusted||(u4()&&e.pointerType?"click"===e.type&&1===e.buttons:0===e.detail&&!e.pointerType)}function dd(e){return!u3().includes("jsdom/")&&(!u4()&&0===e.width&&0===e.height||u4()&&1===e.width&&1===e.height&&0===e.pressure&&0===e.detail&&"mouse"===e.pointerType||e.width<1&&e.height<1&&0===e.pressure&&0===e.detail&&"touch"===e.pointerType)}function dh(e,t){let i=["mouse","pen"];return t||i.push("",void 0),i.includes(e)}var dp="undefined"!=typeof document?M.useLayoutEffect:M.useEffect;function df(e){let t=M.useRef(e);return dp(()=>{t.current=e}),t}let dm={...F}.useInsertionEffect||(e=>e());function dg(e){let t=M.useRef(()=>{});return dm(()=>{t.current=e}),M.useCallback(function(){for(var e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];return null==t.current?void 0:t.current(...i)},[])}function dv(e,t,i){return Math.floor(e/t)!==i}function db(e,t){return t<0||t>=e.current.length}function dy(e,t){return dw(e,{disabledIndices:t})}function dS(e,t){return dw(e,{decrement:!0,startingIndex:e.current.length,disabledIndices:t})}function dw(e,t){let{startingIndex:i=-1,decrement:n=!1,disabledIndices:r,amount:s=1}=void 0===t?{}:t,a=i;do a+=n?-s:s;while(a>=0&&a<=e.current.length-1&&dk(e,a,r));return a}function dk(e,t,i){if("function"==typeof i)return i(t);if(i)return i.includes(t);let n=e.current[t];return null==n||n.hasAttribute("disabled")||"true"===n.getAttribute("aria-disabled")}let dC=()=>({getShadowRoot:!0,displayCheck:"function"==typeof ResizeObserver&&ResizeObserver.toString().includes("[native code]")?"full":"none"});function dT(e,t){let i=uQ(e,dC()),n=i.length;if(0===n)return;let r=u8(di(e)),s=i.indexOf(r);return i[-1===s?1===t?0:n-1:s+t]}function dE(e){return dT(di(e).body,1)||e}function d_(e){return dT(di(e).body,-1)||e}function dR(e,t){let i=t||e.currentTarget,n=e.relatedTarget;return!n||!u7(i,n)}function dI(e){e.querySelectorAll("[data-tabindex]").forEach(e=>{let t=e.dataset.tabindex;delete e.dataset.tabindex,t?e.setAttribute("tabindex",t):e.removeAttribute("tabindex")})}var dx=i(51215);function dP(e,t,i){let n,{reference:r,floating:s}=e,a=uT(t),o=uk(uT(t)),l=uC(o),c=uS(t),u="y"===a,d=r.x+r.width/2-s.width/2,h=r.y+r.height/2-s.height/2,p=r[l]/2-s[l]/2;switch(c){case"top":n={x:d,y:r.y-s.height};break;case"bottom":n={x:d,y:r.y+r.height};break;case"right":n={x:r.x+r.width,y:h};break;case"left":n={x:r.x-s.width,y:h};break;default:n={x:r.x,y:r.y}}switch(uw(t)){case"start":n[o]-=p*(i&&u?-1:1);break;case"end":n[o]+=p*(i&&u?-1:1)}return n}let dN=async(e,t,i)=>{let{placement:n="bottom",strategy:r="absolute",middleware:s=[],platform:a}=i,o=s.filter(Boolean),l=await (null==a.isRTL?void 0:a.isRTL(t)),c=await a.getElementRects({reference:e,floating:t,strategy:r}),{x:u,y:d}=dP(c,n,l),h=n,p={},f=0;for(let i=0;i<o.length;i++){let{name:s,fn:m}=o[i],{x:g,y:v,data:b,reset:y}=await m({x:u,y:d,initialPlacement:n,placement:h,strategy:r,middlewareData:p,rects:c,platform:a,elements:{reference:e,floating:t}});u=null!=g?g:u,d=null!=v?v:d,p={...p,[s]:{...p[s],...b}},y&&f<=50&&(f++,"object"==typeof y&&(y.placement&&(h=y.placement),y.rects&&(c=!0===y.rects?await a.getElementRects({reference:e,floating:t,strategy:r}):y.rects),{x:u,y:d}=dP(c,h,l)),i=-1)}return{x:u,y:d,placement:h,strategy:r,middlewareData:p}};async function dO(e,t){var i;void 0===t&&(t={});let{x:n,y:r,platform:s,rects:a,elements:o,strategy:l}=e,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:h=!1,padding:p=0}=uy(t,e),f=uR(p),m=o[h?"floating"===d?"reference":"floating":d],g=uI(await s.getClippingRect({element:null==(i=await (null==s.isElement?void 0:s.isElement(m)))||i?m:m.contextElement||await (null==s.getDocumentElement?void 0:s.getDocumentElement(o.floating)),boundary:c,rootBoundary:u,strategy:l})),v="floating"===d?{x:n,y:r,width:a.floating.width,height:a.floating.height}:a.reference,b=await (null==s.getOffsetParent?void 0:s.getOffsetParent(o.floating)),y=await (null==s.isElement?void 0:s.isElement(b))&&await (null==s.getScale?void 0:s.getScale(b))||{x:1,y:1},S=uI(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:o,rect:v,offsetParent:b,strategy:l}):v);return{top:(g.top-S.top+f.top)/y.y,bottom:(S.bottom-g.bottom+f.bottom)/y.y,left:(g.left-S.left+f.left)/y.x,right:(S.right-g.right+f.right)/y.x}}async function dD(e,t){let{placement:i,platform:n,elements:r}=e,s=await (null==n.isRTL?void 0:n.isRTL(r.floating)),a=uS(i),o=uw(i),l="y"===uT(i),c=["left","top"].includes(a)?-1:1,u=s&&l?-1:1,d=uy(t,e),{mainAxis:h,crossAxis:p,alignmentAxis:f}="number"==typeof d?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return o&&"number"==typeof f&&(p="end"===o?-1*f:f),l?{x:p*u,y:h*c}:{x:h*c,y:p*u}}function dA(e){let t=uo(e),i=parseFloat(t.width)||0,n=parseFloat(t.height)||0,r=ue(e),s=r?e.offsetWidth:i,a=r?e.offsetHeight:n,o=uf(i)!==s||uf(n)!==a;return o&&(i=s,n=a),{width:i,height:n,$:o}}function dj(e){return c7(e)?e:e.contextElement}function dL(e){let t=dj(e);if(!ue(t))return ug(1);let i=t.getBoundingClientRect(),{width:n,height:r,$:s}=dA(t),a=(s?uf(i.width):i.width)/n,o=(s?uf(i.height):i.height)/r;return a&&Number.isFinite(a)||(a=1),o&&Number.isFinite(o)||(o=1),{x:a,y:o}}let dU=ug(0);function dM(e){let t=c5(e);return us()&&t.visualViewport?{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}:dU}function dF(e,t,i,n){var r;void 0===t&&(t=!1),void 0===i&&(i=!1);let s=e.getBoundingClientRect(),a=dj(e),o=ug(1);t&&(n?c7(n)&&(o=dL(n)):o=dL(e));let l=(void 0===(r=i)&&(r=!1),n&&(!r||n===c5(a))&&r)?dM(a):ug(0),c=(s.left+l.x)/o.x,u=(s.top+l.y)/o.y,d=s.width/o.x,h=s.height/o.y;if(a){let e=c5(a),t=n&&c7(n)?c5(n):n,i=e,r=ud(i);for(;r&&n&&t!==i;){let e=dL(r),t=r.getBoundingClientRect(),n=uo(r),s=t.left+(r.clientLeft+parseFloat(n.paddingLeft))*e.x,a=t.top+(r.clientTop+parseFloat(n.paddingTop))*e.y;c*=e.x,u*=e.y,d*=e.x,h*=e.y,c+=s,u+=a,r=ud(i=c5(r))}}return uI({width:d,height:h,x:c,y:u})}function d$(e,t){let i=ul(e).scrollLeft;return t?t.left+i:dF(c9(e)).left+i}function dV(e,t,i){void 0===i&&(i=!1);let n=e.getBoundingClientRect();return{x:n.left+t.scrollLeft-(i?0:d$(e,n)),y:n.top+t.scrollTop}}function dB(e,t,i){let n;if("viewport"===t)n=function(e,t){let i=c5(e),n=c9(e),r=i.visualViewport,s=n.clientWidth,a=n.clientHeight,o=0,l=0;if(r){s=r.width,a=r.height;let e=us();(!e||e&&"fixed"===t)&&(o=r.offsetLeft,l=r.offsetTop)}return{width:s,height:a,x:o,y:l}}(e,i);else if("document"===t)n=function(e){let t=c9(e),i=ul(e),n=e.ownerDocument.body,r=up(t.scrollWidth,t.clientWidth,n.scrollWidth,n.clientWidth),s=up(t.scrollHeight,t.clientHeight,n.scrollHeight,n.clientHeight),a=-i.scrollLeft+d$(e),o=-i.scrollTop;return"rtl"===uo(n).direction&&(a+=up(t.clientWidth,n.clientWidth)-r),{width:r,height:s,x:a,y:o}}(c9(e));else if(c7(t))n=function(e,t){let i=dF(e,!0,"fixed"===t),n=i.top+e.clientTop,r=i.left+e.clientLeft,s=ue(e)?dL(e):ug(1),a=e.clientWidth*s.x,o=e.clientHeight*s.y;return{width:a,height:o,x:r*s.x,y:n*s.y}}(t,i);else{let i=dM(e);n={x:t.x-i.x,y:t.y-i.y,width:t.width,height:t.height}}return uI(n)}function dH(e){return"static"===uo(e).position}function dq(e,t){if(!ue(e)||"fixed"===uo(e).position)return null;if(t)return t(e);let i=e.offsetParent;return c9(e)===i&&(i=i.ownerDocument.body),i}function dW(e,t){let i=c5(e);if(un(e))return i;if(!ue(e)){let t=uc(e);for(;t&&!ua(t);){if(c7(t)&&!dH(t))return t;t=uc(t)}return i}let n=dq(e,t);for(;n&&["table","td","th"].includes(c6(n))&&dH(n);)n=dq(n,t);return n&&ua(n)&&dH(n)&&!ur(n)?i:n||function(e){let t=uc(e);for(;ue(t)&&!ua(t);){if(ur(t))return t;if(un(t))break;t=uc(t)}return null}(e)||i}let dG=async function(e){let t=this.getOffsetParent||dW,i=this.getDimensions,n=await i(e.floating);return{reference:function(e,t,i){let n=ue(t),r=c9(t),s="fixed"===i,a=dF(e,!0,s,t),o={scrollLeft:0,scrollTop:0},l=ug(0);if(n||!n&&!s)if(("body"!==c6(t)||ui(r))&&(o=ul(t)),n){let e=dF(t,!0,s,t);l.x=e.x+t.clientLeft,l.y=e.y+t.clientTop}else r&&(l.x=d$(r));s&&!n&&r&&(l.x=d$(r));let c=!r||n||s?ug(0):dV(r,o);return{x:a.left+o.scrollLeft-l.x-c.x,y:a.top+o.scrollTop-l.y-c.y,width:a.width,height:a.height}}(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}},dJ={convertOffsetParentRelativeRectToViewportRelativeRect:function(e){let{elements:t,rect:i,offsetParent:n,strategy:r}=e,s="fixed"===r,a=c9(n),o=!!t&&un(t.floating);if(n===a||o&&s)return i;let l={scrollLeft:0,scrollTop:0},c=ug(1),u=ug(0),d=ue(n);if((d||!d&&!s)&&(("body"!==c6(n)||ui(a))&&(l=ul(n)),ue(n))){let e=dF(n);c=dL(n),u.x=e.x+n.clientLeft,u.y=e.y+n.clientTop}let h=!a||d||s?ug(0):dV(a,l,!0);return{width:i.width*c.x,height:i.height*c.y,x:i.x*c.x-l.scrollLeft*c.x+u.x+h.x,y:i.y*c.y-l.scrollTop*c.y+u.y+h.y}},getDocumentElement:c9,getClippingRect:function(e){let{element:t,boundary:i,rootBoundary:n,strategy:r}=e,s=[..."clippingAncestors"===i?un(t)?[]:function(e,t){let i=t.get(e);if(i)return i;let n=uu(e,[],!1).filter(e=>c7(e)&&"body"!==c6(e)),r=null,s="fixed"===uo(e).position,a=s?uc(e):e;for(;c7(a)&&!ua(a);){let t=uo(a),i=ur(a);i||"fixed"!==t.position||(r=null),(s?!i&&!r:!i&&"static"===t.position&&!!r&&["absolute","fixed"].includes(r.position)||ui(a)&&!i&&function e(t,i){let n=uc(t);return!(n===i||!c7(n)||ua(n))&&("fixed"===uo(n).position||e(n,i))}(e,a))?n=n.filter(e=>e!==a):r=t,a=uc(a)}return t.set(e,n),n}(t,this._c):[].concat(i),n],a=s[0],o=s.reduce((e,i)=>{let n=dB(t,i,r);return e.top=up(n.top,e.top),e.right=uh(n.right,e.right),e.bottom=uh(n.bottom,e.bottom),e.left=up(n.left,e.left),e},dB(t,a,r));return{width:o.right-o.left,height:o.bottom-o.top,x:o.left,y:o.top}},getOffsetParent:dW,getElementRects:dG,getClientRects:function(e){return Array.from(e.getClientRects())},getDimensions:function(e){let{width:t,height:i}=dA(e);return{width:t,height:i}},getScale:dL,isElement:c7,isRTL:function(e){return"rtl"===uo(e).direction}};function dK(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function dz(e,t,i,n){let r;void 0===n&&(n={});let{ancestorScroll:s=!0,ancestorResize:a=!0,elementResize:o="function"==typeof ResizeObserver,layoutShift:l="function"==typeof IntersectionObserver,animationFrame:c=!1}=n,u=dj(e),d=s||a?[...u?uu(u):[],...uu(t)]:[];d.forEach(e=>{s&&e.addEventListener("scroll",i,{passive:!0}),a&&e.addEventListener("resize",i)});let h=u&&l?function(e,t){let i,n=null,r=c9(e);function s(){var e;clearTimeout(i),null==(e=n)||e.disconnect(),n=null}return!function a(o,l){void 0===o&&(o=!1),void 0===l&&(l=1),s();let c=e.getBoundingClientRect(),{left:u,top:d,width:h,height:p}=c;if(o||t(),!h||!p)return;let f=um(d),m=um(r.clientWidth-(u+h)),g={rootMargin:-f+"px "+-m+"px "+-um(r.clientHeight-(d+p))+"px "+-um(u)+"px",threshold:up(0,uh(1,l))||1},v=!0;function b(t){let n=t[0].intersectionRatio;if(n!==l){if(!v)return a();n?a(!1,n):i=setTimeout(()=>{a(!1,1e-7)},1e3)}1!==n||dK(c,e.getBoundingClientRect())||a(),v=!1}try{n=new IntersectionObserver(b,{...g,root:r.ownerDocument})}catch(e){n=new IntersectionObserver(b,g)}n.observe(e)}(!0),s}(u,i):null,p=-1,f=null;o&&(f=new ResizeObserver(e=>{let[n]=e;n&&n.target===u&&f&&(f.unobserve(t),cancelAnimationFrame(p),p=requestAnimationFrame(()=>{var e;null==(e=f)||e.observe(t)})),i()}),u&&!c&&f.observe(u),f.observe(t));let m=c?dF(e):null;return c&&function t(){let n=dF(e);m&&!dK(m,n)&&i(),m=n,r=requestAnimationFrame(t)}(),i(),()=>{var e;d.forEach(e=>{s&&e.removeEventListener("scroll",i),a&&e.removeEventListener("resize",i)}),null==h||h(),null==(e=f)||e.disconnect(),f=null,c&&cancelAnimationFrame(r)}}let dY=e=>({name:"arrow",options:e,async fn(t){let{x:i,y:n,placement:r,rects:s,platform:a,elements:o,middlewareData:l}=t,{element:c,padding:u=0}=uy(e,t)||{};if(null==c)return{};let d=uR(u),h={x:i,y:n},p=uk(uT(r)),f=uC(p),m=await a.getDimensions(c),g="y"===p,v=g?"clientHeight":"clientWidth",b=s.reference[f]+s.reference[p]-h[p]-s.floating[f],y=h[p]-s.reference[p],S=await (null==a.getOffsetParent?void 0:a.getOffsetParent(c)),w=S?S[v]:0;w&&await (null==a.isElement?void 0:a.isElement(S))||(w=o.floating[v]||s.floating[f]);let k=w/2-m[f]/2-1,C=uh(d[g?"top":"left"],k),T=uh(d[g?"bottom":"right"],k),E=w-m[f]-T,_=w/2-m[f]/2+(b/2-y/2),R=up(C,uh(_,E)),I=!l.arrow&&null!=uw(r)&&_!==R&&s.reference[f]/2-(_<C?C:T)-m[f]/2<0,x=I?_<C?_-C:_-E:0;return{[p]:h[p]+x,data:{[p]:R,centerOffset:_-R-x,...I&&{alignmentOffset:x}},reset:I}}}),dX=(e,t,i)=>{let n=new Map,r={platform:dJ,...i},s={...r.platform,_c:n};return dN(e,t,{...r,platform:s})};var dZ="undefined"!=typeof document?M.useLayoutEffect:M.useEffect;function dQ(e,t){let i,n,r;if(e===t)return!0;if(typeof e!=typeof t)return!1;if("function"==typeof e&&e.toString()===t.toString())return!0;if(e&&t&&"object"==typeof e){if(Array.isArray(e)){if((i=e.length)!==t.length)return!1;for(n=i;0!=n--;)if(!dQ(e[n],t[n]))return!1;return!0}if((i=(r=Object.keys(e)).length)!==Object.keys(t).length)return!1;for(n=i;0!=n--;)if(!({}).hasOwnProperty.call(t,r[n]))return!1;for(n=i;0!=n--;){let i=r[n];if(("_owner"!==i||!e.$$typeof)&&!dQ(e[i],t[i]))return!1}return!0}return e!=e&&t!=t}function d0(e){return"undefined"==typeof window?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function d1(e,t){let i=d0(e);return Math.round(t*i)/i}function d2(e){let t=M.useRef(e);return dZ(()=>{t.current=e}),t}let d3=e=>({name:"arrow",options:e,fn(t){let{element:i,padding:n}="function"==typeof e?e(t):e;return i&&({}).hasOwnProperty.call(i,"current")?null!=i.current?dY({element:i.current,padding:n}).fn(t):{}:i?dY({element:i,padding:n}).fn(t):{}}}),d4=(e,t)=>({...function(e){return void 0===e&&(e=0),{name:"offset",options:e,async fn(t){var i,n;let{x:r,y:s,placement:a,middlewareData:o}=t,l=await dD(t,e);return a===(null==(i=o.offset)?void 0:i.placement)&&null!=(n=o.arrow)&&n.alignmentOffset?{}:{x:r+l.x,y:s+l.y,data:{...l,placement:a}}}}}(e),options:[e,t]}),d6=(e,t)=>({...function(e){return void 0===e&&(e={}),{name:"shift",options:e,async fn(t){let{x:i,y:n,placement:r}=t,{mainAxis:s=!0,crossAxis:a=!1,limiter:o={fn:e=>{let{x:t,y:i}=e;return{x:t,y:i}}},...l}=uy(e,t),c={x:i,y:n},u=await dO(t,l),d=uT(uS(r)),h=uk(d),p=c[h],f=c[d];if(s){let e="y"===h?"top":"left",t="y"===h?"bottom":"right",i=p+u[e],n=p-u[t];p=up(i,uh(p,n))}if(a){let e="y"===d?"top":"left",t="y"===d?"bottom":"right",i=f+u[e],n=f-u[t];f=up(i,uh(f,n))}let m=o.fn({...t,[h]:p,[d]:f});return{...m,data:{x:m.x-i,y:m.y-n,enabled:{[h]:s,[d]:a}}}}}}(e),options:[e,t]}),d5=(e,t)=>({...function(e){return void 0===e&&(e={}),{name:"flip",options:e,async fn(t){var i,n,r,s,a,o;let{placement:l,middlewareData:c,rects:u,initialPlacement:d,platform:h,elements:p}=t,{mainAxis:f=!0,crossAxis:m=!0,fallbackPlacements:g,fallbackStrategy:v="bestFit",fallbackAxisSideDirection:b="none",flipAlignment:y=!0,...S}=uy(e,t);if(null!=(i=c.arrow)&&i.alignmentOffset)return{};let w=uS(l),k=uT(d),C=uS(d)===d,T=await (null==h.isRTL?void 0:h.isRTL(p.floating)),E=g||(C||!y?[u_(d)]:function(e){let t=u_(e);return[uE(e),t,uE(t)]}(d)),_="none"!==b;!g&&_&&E.push(...function(e,t,i,n){let r=uw(e),s=function(e,t,i){let n=["left","right"],r=["right","left"];switch(e){case"top":case"bottom":if(i)return t?r:n;return t?n:r;case"left":case"right":return t?["top","bottom"]:["bottom","top"];default:return[]}}(uS(e),"start"===i,n);return r&&(s=s.map(e=>e+"-"+r),t&&(s=s.concat(s.map(uE)))),s}(d,y,b,T));let R=[d,...E],I=await dO(t,S),x=[],P=(null==(n=c.flip)?void 0:n.overflows)||[];if(f&&x.push(I[w]),m){let e=function(e,t,i){void 0===i&&(i=!1);let n=uw(e),r=uk(uT(e)),s=uC(r),a="x"===r?n===(i?"end":"start")?"right":"left":"start"===n?"bottom":"top";return t.reference[s]>t.floating[s]&&(a=u_(a)),[a,u_(a)]}(l,u,T);x.push(I[e[0]],I[e[1]])}if(P=[...P,{placement:l,overflows:x}],!x.every(e=>e<=0)){let e=((null==(r=c.flip)?void 0:r.index)||0)+1,t=R[e];if(t){let i="alignment"===m&&k!==uT(t),n=(null==(a=P[0])?void 0:a.overflows[0])>0;if(!i||n)return{data:{index:e,overflows:P},reset:{placement:t}}}let i=null==(s=P.filter(e=>e.overflows[0]<=0).sort((e,t)=>e.overflows[1]-t.overflows[1])[0])?void 0:s.placement;if(!i)switch(v){case"bestFit":{let e=null==(o=P.filter(e=>{if(_){let t=uT(e.placement);return t===k||"y"===t}return!0}).map(e=>[e.placement,e.overflows.filter(e=>e>0).reduce((e,t)=>e+t,0)]).sort((e,t)=>e[1]-t[1])[0])?void 0:o[0];e&&(i=e);break}case"initialPlacement":i=d}if(l!==i)return{reset:{placement:i}}}return{}}}}(e),options:[e,t]}),d9=(e,t)=>({...function(e){return void 0===e&&(e={}),{name:"size",options:e,async fn(t){var i,n;let r,s,{placement:a,rects:o,platform:l,elements:c}=t,{apply:u=()=>{},...d}=uy(e,t),h=await dO(t,d),p=uS(a),f=uw(a),m="y"===uT(a),{width:g,height:v}=o.floating;"top"===p||"bottom"===p?(r=p,s=f===(await (null==l.isRTL?void 0:l.isRTL(c.floating))?"start":"end")?"left":"right"):(s=p,r="end"===f?"top":"bottom");let b=v-h.top-h.bottom,y=g-h.left-h.right,S=uh(v-h[r],b),w=uh(g-h[s],y),k=!t.middlewareData.shift,C=S,T=w;if(null!=(i=t.middlewareData.shift)&&i.enabled.x&&(T=y),null!=(n=t.middlewareData.shift)&&n.enabled.y&&(C=b),k&&!f){let e=up(h.left,0),t=up(h.right,0),i=up(h.top,0),n=up(h.bottom,0);m?T=g-2*(0!==e||0!==t?e+t:up(h.left,h.right)):C=v-2*(0!==i||0!==n?i+n:up(h.top,h.bottom))}await u({...t,availableWidth:T,availableHeight:C});let E=await l.getDimensions(c.floating);return g!==E.width||v!==E.height?{reset:{rects:!0}}:{}}}}(e),options:[e,t]}),d8=(e,t)=>({...d3(e),options:[e,t]});function d7(e,t){let i=e.compareDocumentPosition(t);return i&Node.DOCUMENT_POSITION_FOLLOWING||i&Node.DOCUMENT_POSITION_CONTAINED_BY?-1:i&Node.DOCUMENT_POSITION_PRECEDING||i&Node.DOCUMENT_POSITION_CONTAINS?1:0}let he=M.createContext({register:()=>{},unregister:()=>{},map:new Map,elementsRef:{current:[]}});function ht(e){let{children:t,elementsRef:i,labelsRef:n}=e,[r,s]=M.useState(()=>new Set),a=M.useCallback(e=>{s(t=>new Set(t).add(e))},[]),o=M.useCallback(e=>{s(t=>{let i=new Set(t);return i.delete(e),i})},[]),l=M.useMemo(()=>{let e=new Map;return Array.from(r.keys()).sort(d7).forEach((t,i)=>{e.set(t,i)}),e},[r]);return(0,U.jsx)(he.Provider,{value:M.useMemo(()=>({register:a,unregister:o,map:l,elementsRef:i,labelsRef:n}),[a,o,l,i,n]),children:t})}let hi="active",hn="selected",hr="ArrowLeft",hs="ArrowRight",ha="ArrowUp",ho="ArrowDown",hl={...F},hc=!1,hu=0,hd=()=>"floating-ui-"+Math.random().toString(36).slice(2,6)+hu++,hh=hl.useId||function(){let[e,t]=M.useState(()=>hc?hd():void 0);return dp(()=>{null==e&&t(hd())},[]),M.useEffect(()=>{hc=!0},[]),e},hp=M.forwardRef(function(e,t){let{context:{placement:i,elements:{floating:n},middlewareData:{arrow:r,shift:s}},width:a=14,height:o=7,tipRadius:l=0,strokeWidth:c=0,staticOffset:u,stroke:d,d:h,style:{transform:p,...f}={},...m}=e,g=hh(),[v,b]=M.useState(!1);if(dp(()=>{n&&"rtl"===uo(n).direction&&b(!0)},[n]),!n)return null;let[y,S]=i.split("-"),w="top"===y||"bottom"===y,k=u;(w&&null!=s&&s.x||!w&&null!=s&&s.y)&&(k=null);let C=2*c,T=C/2,E=a/2*(-(l/8)+1),_=o/2*l/4,R=!!h,I=k&&"end"===S?"bottom":"top",x=k&&"end"===S?"right":"left";k&&v&&(x="end"===S?"left":"right");let P=(null==r?void 0:r.x)!=null?k||r.x:"",N=(null==r?void 0:r.y)!=null?k||r.y:"",O=h||"M0,0 H"+a+(" L"+(a-E))+","+(o-_)+(" Q"+a/2+","+o+" "+E)+","+(o-_)+" Z",D={top:R?"rotate(180deg)":"",left:R?"rotate(90deg)":"rotate(-90deg)",bottom:R?"":"rotate(180deg)",right:R?"rotate(-90deg)":"rotate(90deg)"}[y];return(0,U.jsxs)("svg",{...m,"aria-hidden":!0,ref:t,width:R?a:a+C,height:a,viewBox:"0 0 "+a+" "+(o>a?o:a),style:{position:"absolute",pointerEvents:"none",[x]:P,[I]:N,[y]:w||R?"100%":"calc(100% - "+C/2+"px)",transform:[D,p].filter(e=>!!e).join(" "),...f},children:[C>0&&(0,U.jsx)("path",{clipPath:"url(#"+g+")",fill:"none",stroke:d,strokeWidth:C+ +!h,d:O}),(0,U.jsx)("path",{stroke:C&&!h?m.fill:"none",d:O}),(0,U.jsx)("clipPath",{id:g,children:(0,U.jsx)("rect",{x:-T,y:T*(R?-1:1),width:a+C,height:a})})]})}),hf=M.createContext(null),hm=M.createContext(null),hg=()=>{var e;return(null==(e=M.useContext(hf))?void 0:e.id)||null},hv=()=>M.useContext(hm);function hb(e){return"data-floating-ui-"+e}function hy(e){-1!==e.current&&(clearTimeout(e.current),e.current=-1)}let hS=()=>{},hw=M.createContext({delay:0,initialDelay:0,timeoutMs:0,currentId:null,setCurrentId:hS,setState:hS,isInstantPhase:!1}),hk=0;function hC(e,t){void 0===t&&(t={});let{preventScroll:i=!1,cancelPrevious:n=!0,sync:r=!1}=t;n&&cancelAnimationFrame(hk);let s=()=>null==e?void 0:e.focus({preventScroll:i});r?s():hk=requestAnimationFrame(s)}let hT=new WeakMap,hE=new WeakSet,h_={},hR=0,hI=()=>"undefined"!=typeof HTMLElement&&"inert"in HTMLElement.prototype,hx=e=>e&&(e.host||hx(e.parentNode)),hP=(e,t)=>t.map(t=>{if(e.contains(t))return t;let i=hx(t);return e.contains(i)?i:null}).filter(e=>null!=e);function hN(e,t,i){var n;void 0===t&&(t=!1),void 0===i&&(i=!1);let r=((null==(n=e[0])?void 0:n.ownerDocument)||document).body;return function(e,t,i,n){let r="data-floating-ui-inert",s=n?"inert":i?"aria-hidden":null,a=hP(t,e),o=new Set,l=new Set(a),c=[];h_[r]||(h_[r]=new WeakMap);let u=h_[r];return a.forEach(function e(t){!(!t||o.has(t))&&(o.add(t),t.parentNode&&e(t.parentNode))}),function e(t){!t||l.has(t)||[].forEach.call(t.children,t=>{if("script"!==c6(t))if(o.has(t))e(t);else{let e=s?t.getAttribute(s):null,i=null!==e&&"false"!==e,n=hT.get(t)||0,a=s?n+1:n,o=(u.get(t)||0)+1;hT.set(t,a),u.set(t,o),c.push(t),1===a&&i&&hE.add(t),1===o&&t.setAttribute(r,""),!i&&s&&t.setAttribute(s,"inert"===s?"":"true")}})}(t),o.clear(),hR++,()=>{c.forEach(e=>{let t=hT.get(e)||0,i=s?t-1:t,n=(u.get(e)||0)-1;hT.set(e,i),u.set(e,n),i||(!hE.has(e)&&s&&e.removeAttribute(s),hE.delete(e)),n||e.removeAttribute(r)}),--hR||(hT=new WeakMap,hT=new WeakMap,hE=new WeakSet,h_={})}}(e.concat(Array.from(r.querySelectorAll("[aria-live]"))),r,t,i)}let hO={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"fixed",whiteSpace:"nowrap",width:"1px",top:0,left:0},hD=M.forwardRef(function(e,t){let[i,n]=M.useState();dp(()=>{/apple/i.test(navigator.vendor)&&n("button")},[]);let r={ref:t,tabIndex:0,role:i,"aria-hidden":!i||void 0,[hb("focus-guard")]:"",style:hO};return(0,U.jsx)("span",{...e,...r})}),hA=M.createContext(null),hj=hb("portal");function hL(e){let{children:t,id:i,root:n,preserveTabOrder:r=!0}=e,s=function(e){void 0===e&&(e={});let{id:t,root:i}=e,n=hh(),r=hU(),[s,a]=M.useState(null),o=M.useRef(null);return dp(()=>()=>{null==s||s.remove(),queueMicrotask(()=>{o.current=null})},[s]),dp(()=>{if(!n||o.current)return;let e=t?document.getElementById(t):null;if(!e)return;let i=document.createElement("div");i.id=n,i.setAttribute(hj,""),e.appendChild(i),o.current=i,a(i)},[t,n]),dp(()=>{if(null===i||!n||o.current)return;let e=i||(null==r?void 0:r.portalNode);e&&!c7(e)&&(e=e.current),e=e||document.body;let s=null;t&&((s=document.createElement("div")).id=t,e.appendChild(s));let l=document.createElement("div");l.id=n,l.setAttribute(hj,""),(e=s||e).appendChild(l),o.current=l,a(l)},[t,i,n,r]),s}({id:i,root:n}),[a,o]=M.useState(null),l=M.useRef(null),c=M.useRef(null),u=M.useRef(null),d=M.useRef(null),h=null==a?void 0:a.modal,p=null==a?void 0:a.open,f=!!a&&!a.modal&&a.open&&r&&!!(n||s);return M.useEffect(()=>{if(s&&r&&!h)return s.addEventListener("focusin",e,!0),s.addEventListener("focusout",e,!0),()=>{s.removeEventListener("focusin",e,!0),s.removeEventListener("focusout",e,!0)};function e(e){s&&dR(e)&&("focusin"===e.type?dI:function(e){uQ(e,dC()).forEach(e=>{e.dataset.tabindex=e.getAttribute("tabindex")||"",e.setAttribute("tabindex","-1")})})(s)}},[s,r,h]),M.useEffect(()=>{s&&(p||dI(s))},[p,s]),(0,U.jsxs)(hA.Provider,{value:M.useMemo(()=>({preserveTabOrder:r,beforeOutsideRef:l,afterOutsideRef:c,beforeInsideRef:u,afterInsideRef:d,portalNode:s,setFocusManagerState:o}),[r,s]),children:[f&&s&&(0,U.jsx)(hD,{"data-type":"outside",ref:l,onFocus:e=>{if(dR(e,s)){var t;null==(t=u.current)||t.focus()}else{let e=d_(a?a.domReference:null);null==e||e.focus()}}}),f&&s&&(0,U.jsx)("span",{"aria-owns":s.id,style:hO}),s&&dx.createPortal(t,s),f&&s&&(0,U.jsx)(hD,{"data-type":"outside",ref:c,onFocus:e=>{if(dR(e,s)){var t;null==(t=d.current)||t.focus()}else{let t=dE(a?a.domReference:null);null==t||t.focus(),(null==a?void 0:a.closeOnFocusOut)&&(null==a||a.onOpenChange(!1,e.nativeEvent,"focus-out"))}}})]})}let hU=()=>M.useContext(hA);function hM(e){return M.useMemo(()=>t=>{e.forEach(e=>{e&&(e.current=t)})},e)}let hF=[];function h$(){return hF.slice().reverse().find(e=>e.isConnected)}function hV(e,t){var i;if(!t.current.includes("floating")&&!(null!=(i=e.getAttribute("role"))&&i.includes("dialog")))return;let n=dC(),r=u0(e,n).filter(e=>{let t=e.getAttribute("data-tabindex")||"";return u1(e,n)||e.hasAttribute("data-tabindex")&&!t.startsWith("-")}),s=e.getAttribute("tabindex");t.current.includes("floating")||0===r.length?"0"!==s&&e.setAttribute("tabindex","0"):("-1"!==s||e.hasAttribute("data-tabindex")&&"-1"!==e.getAttribute("data-tabindex"))&&(e.setAttribute("tabindex","-1"),e.setAttribute("data-tabindex","-1"))}let hB=M.forwardRef(function(e,t){return(0,U.jsx)("button",{...e,type:"button",ref:t,tabIndex:-1,style:hO})});function hH(e){let{context:t,children:i,disabled:n=!1,order:r=["content"],guards:s=!0,initialFocus:a=0,returnFocus:o=!0,restoreFocus:l=!1,modal:c=!0,visuallyHiddenDismiss:u=!1,closeOnFocusOut:d=!0,outsideElementsInert:h=!1,getInsideElements:p=()=>[]}=e,{open:f,onOpenChange:m,events:g,dataRef:v,elements:{domReference:b,floating:y}}=t,S=dg(()=>{var e;return null==(e=v.current.floatingContext)?void 0:e.nodeId}),w=dg(p),k="number"==typeof a&&a<0,C=dr(b)&&k,T=hI(),E=!T||s,_=!E||T&&h,R=df(r),I=df(a),x=df(o),P=hv(),N=hU(),O=M.useRef(null),D=M.useRef(null),A=M.useRef(!1),j=M.useRef(!1),L=M.useRef(-1),F=null!=N,$=ds(y),V=dg(function(e){return void 0===e&&(e=$),e?uQ(e,dC()):[]}),B=dg(e=>{let t=V(e);return R.current.map(e=>b&&"reference"===e?b:$&&"floating"===e?$:t).filter(Boolean).flat()});M.useEffect(()=>{if(n||!c)return;function e(e){if("Tab"===e.key){u7($,u8(di($)))&&0===V().length&&!C&&dc(e);let t=B(),i=de(e);"reference"===R.current[0]&&i===b&&(dc(e),e.shiftKey?hC(t[t.length-1]):hC(t[1])),"floating"===R.current[1]&&i===$&&e.shiftKey&&(dc(e),hC(t[0]))}}let t=di($);return t.addEventListener("keydown",e),()=>{t.removeEventListener("keydown",e)}},[n,b,$,c,R,C,V,B]),M.useEffect(()=>{if(!n&&y)return y.addEventListener("focusin",e),()=>{y.removeEventListener("focusin",e)};function e(e){let t=de(e),i=V().indexOf(t);-1!==i&&(L.current=i)}},[n,y,V]),M.useEffect(()=>{if(!n&&d&&y&&ue(b))return b.addEventListener("focusout",t),b.addEventListener("pointerdown",e),y.addEventListener("focusout",t),()=>{b.removeEventListener("focusout",t),b.removeEventListener("pointerdown",e),y.removeEventListener("focusout",t)};function e(){j.current=!0,setTimeout(()=>{j.current=!1})}function t(e){let t=e.relatedTarget,i=e.currentTarget;queueMicrotask(()=>{let n=S(),r=!(u7(b,t)||u7(y,t)||u7(t,y)||u7(null==N?void 0:N.portalNode,t)||null!=t&&t.hasAttribute(hb("focus-guard"))||P&&(da(P.nodesRef.current,n).find(e=>{var i,n;return u7(null==(i=e.context)?void 0:i.elements.floating,t)||u7(null==(n=e.context)?void 0:n.elements.domReference,t)})||dl(P.nodesRef.current,n).find(e=>{var i,n,r;return[null==(i=e.context)?void 0:i.elements.floating,ds(null==(n=e.context)?void 0:n.elements.floating)].includes(t)||(null==(r=e.context)?void 0:r.elements.domReference)===t})));if(i===b&&$&&hV($,R),l&&r&&u8(di($))===di($).body){ue($)&&$.focus();let e=L.current,t=V(),i=t[e]||t[t.length-1]||$;ue(i)&&i.focus()}if(v.current.insideReactTree){v.current.insideReactTree=!1;return}(C||!c)&&t&&r&&!j.current&&t!==h$()&&(A.current=!0,m(!1,e,"focus-out"))})}},[n,b,y,$,c,P,N,m,d,l,V,C,S,R,v]);let H=M.useRef(null),q=M.useRef(null),W=hM([H,null==N?void 0:N.beforeInsideRef]),G=hM([q,null==N?void 0:N.afterInsideRef]);function J(e){return!n&&u&&c?(0,U.jsx)(hB,{ref:"start"===e?O:D,onClick:e=>m(!1,e.nativeEvent),children:"string"==typeof u?u:"Dismiss"}):null}M.useEffect(()=>{var e,t;if(n||!y)return;let i=Array.from((null==N||null==(e=N.portalNode)?void 0:e.querySelectorAll("["+hb("portal")+"]"))||[]),r=P?dl(P.nodesRef.current,S()):[],s=P&&!c?r.map(e=>{var t;return null==(t=e.context)?void 0:t.elements.floating}):[],a=[y,null==(t=r.find(e=>{var t;return dr((null==(t=e.context)?void 0:t.elements.domReference)||null)}))||null==(t=t.context)?void 0:t.elements.domReference,...i,...s,...w(),O.current,D.current,H.current,q.current,null==N?void 0:N.beforeOutsideRef.current,null==N?void 0:N.afterOutsideRef.current,R.current.includes("reference")||C?b:null].filter(e=>null!=e),o=c||C?hN(a,!_,_):hN(a);return()=>{o()}},[n,b,y,c,R,N,C,E,_,P,S,w]),dp(()=>{if(n||!ue($))return;let e=u8(di($));queueMicrotask(()=>{let t=B($),i=I.current,n=("number"==typeof i?t[i]:i.current)||$,r=u7($,e);k||r||!f||hC(n,{preventScroll:n===$})})},[n,f,$,k,B,I]),dp(()=>{var e;if(n||!$)return;let t=di($);function i(e){let{reason:t,event:i,nested:n}=e;if(["hover","safe-polygon"].includes(t)&&"mouseleave"===i.type&&(A.current=!0),"outside-press"===t)if(n)A.current=!1;else if(du(i)||dd(i))A.current=!1;else{let e=!1;document.createElement("div").focus({get preventScroll(){return e=!0,!1}}),e?A.current=!1:A.current=!0}}e=u8(t),hF=hF.filter(e=>e.isConnected),e&&"body"!==c6(e)&&(hF.push(e),hF.length>20&&(hF=hF.slice(-20))),g.on("openchange",i);let r=t.createElement("span");return r.setAttribute("tabindex","-1"),r.setAttribute("aria-hidden","true"),Object.assign(r.style,hO),F&&b&&b.insertAdjacentElement("afterend",r),()=>{g.off("openchange",i);let e=u8(t),n=u7(y,e)||P&&da(P.nodesRef.current,S()).some(t=>{var i;return u7(null==(i=t.context)?void 0:i.elements.floating,e)}),s=function(){if("boolean"==typeof x.current){let e=b||h$();return e&&e.isConnected?e:r}return x.current.current||r}();queueMicrotask(()=>{let i=function(e){let t=dC();return u1(e,t)?e:uQ(e,t)[0]||e}(s);x.current&&!A.current&&ue(i)&&(i===e||e===t.body||n)&&i.focus({preventScroll:!0}),r.remove()})}},[n,y,$,x,v,g,P,F,b,S]),M.useEffect(()=>{queueMicrotask(()=>{A.current=!1})},[n]),dp(()=>{if(!n&&N)return N.setFocusManagerState({modal:c,closeOnFocusOut:d,open:f,onOpenChange:m,domReference:b}),()=>{N.setFocusManagerState(null)}},[n,N,c,f,m,d,b]),dp(()=>{!n&&$&&hV($,R)},[n,$,R]);let K=!n&&E&&(!c||!C)&&(F||c);return(0,U.jsxs)(U.Fragment,{children:[K&&(0,U.jsx)(hD,{"data-type":"inside",ref:W,onFocus:e=>{if(c){let e=B();hC("reference"===r[0]?e[0]:e[e.length-1])}else if(null!=N&&N.preserveTabOrder&&N.portalNode)if(A.current=!1,dR(e,N.portalNode)){let e=dE(b);null==e||e.focus()}else{var t;null==(t=N.beforeOutsideRef.current)||t.focus()}}}),!C&&J("start"),i,J("end"),K&&(0,U.jsx)(hD,{"data-type":"inside",ref:G,onFocus:e=>{if(c)hC(B()[0]);else if(null!=N&&N.preserveTabOrder&&N.portalNode)if(d&&(A.current=!0),dR(e,N.portalNode)){let e=d_(b);null==e||e.focus()}else{var t;null==(t=N.afterOutsideRef.current)||t.focus()}}})]})}let hq=0,hW="--floating-ui-scrollbar-width",hG=()=>{},hJ=M.forwardRef(function(e,t){let{lockScroll:i=!1,...n}=e;return dp(()=>{if(i)return 1==++hq&&(hG=function(){let e=u2(),t=/iP(hone|ad|od)|iOS/.test(e)||"MacIntel"===e&&navigator.maxTouchPoints>1,i=document.body.style,n=Math.round(document.documentElement.getBoundingClientRect().left)+document.documentElement.scrollLeft?"paddingLeft":"paddingRight",r=window.innerWidth-document.documentElement.clientWidth,s=i.left?parseFloat(i.left):window.scrollX,a=i.top?parseFloat(i.top):window.scrollY;if(i.overflow="hidden",i.setProperty(hW,r+"px"),r&&(i[n]=r+"px"),t){var o,l;let e=(null==(o=window.visualViewport)?void 0:o.offsetLeft)||0;Object.assign(i,{position:"fixed",top:-(a-Math.floor((null==(l=window.visualViewport)?void 0:l.offsetTop)||0))+"px",left:-(s-Math.floor(e))+"px",right:"0"})}return()=>{Object.assign(i,{overflow:"",[n]:""}),i.removeProperty(hW),t&&(Object.assign(i,{position:"",top:"",left:"",right:""}),window.scrollTo(s,a))}}()),()=>{0==--hq&&hG()}},[i]),(0,U.jsx)("div",{ref:t,...n,style:{position:"fixed",overflow:"auto",top:0,right:0,bottom:0,left:0,...n.style}})});function hK(e){return ue(e.target)&&"BUTTON"===e.target.tagName}let hz={pointerdown:"onPointerDown",mousedown:"onMouseDown",click:"onClick"},hY={pointerdown:"onPointerDownCapture",mousedown:"onMouseDownCapture",click:"onClickCapture"},hX=e=>{var t,i;return{escapeKey:"boolean"==typeof e?e:null!=(t=null==e?void 0:e.escapeKey)&&t,outsidePress:"boolean"==typeof e?e:null==(i=null==e?void 0:e.outsidePress)||i}};function hZ(e){void 0===e&&(e={});let{nodeId:t}=e,i=function(e){let{open:t=!1,onOpenChange:i,elements:n}=e,r=hh(),s=M.useRef({}),[a]=M.useState(()=>(function(){let e=new Map;return{emit(t,i){var n;null==(n=e.get(t))||n.forEach(e=>e(i))},on(t,i){e.has(t)||e.set(t,new Set),e.get(t).add(i)},off(t,i){var n;null==(n=e.get(t))||n.delete(i)}}})()),o=null!=hg(),[l,c]=M.useState(n.reference),u=dg((e,t,n)=>{s.current.openEvent=e?t:void 0,a.emit("openchange",{open:e,event:t,reason:n,nested:o}),null==i||i(e,t,n)}),d=M.useMemo(()=>({setPositionReference:c}),[]),h=M.useMemo(()=>({reference:l||n.reference||null,floating:n.floating||null,domReference:n.reference}),[l,n.reference,n.floating]);return M.useMemo(()=>({dataRef:s,open:t,onOpenChange:u,elements:h,events:a,floatingId:r,refs:d}),[t,u,h,a,r,d])}({...e,elements:{reference:null,floating:null,...e.elements}}),n=e.rootContext||i,r=n.elements,[s,a]=M.useState(null),[o,l]=M.useState(null),c=(null==r?void 0:r.domReference)||s,u=M.useRef(null),d=hv();dp(()=>{c&&(u.current=c)},[c]);let h=function(e){void 0===e&&(e={});let{placement:t="bottom",strategy:i="absolute",middleware:n=[],platform:r,elements:{reference:s,floating:a}={},transform:o=!0,whileElementsMounted:l,open:c}=e,[u,d]=M.useState({x:0,y:0,strategy:i,placement:t,middlewareData:{},isPositioned:!1}),[h,p]=M.useState(n);dQ(h,n)||p(n);let[f,m]=M.useState(null),[g,v]=M.useState(null),b=M.useCallback(e=>{e!==k.current&&(k.current=e,m(e))},[]),y=M.useCallback(e=>{e!==C.current&&(C.current=e,v(e))},[]),S=s||f,w=a||g,k=M.useRef(null),C=M.useRef(null),T=M.useRef(u),E=null!=l,_=d2(l),R=d2(r),I=d2(c),x=M.useCallback(()=>{if(!k.current||!C.current)return;let e={placement:t,strategy:i,middleware:h};R.current&&(e.platform=R.current),dX(k.current,C.current,e).then(e=>{let t={...e,isPositioned:!1!==I.current};P.current&&!dQ(T.current,t)&&(T.current=t,dx.flushSync(()=>{d(t)}))})},[h,t,i,R,I]);dZ(()=>{!1===c&&T.current.isPositioned&&(T.current.isPositioned=!1,d(e=>({...e,isPositioned:!1})))},[c]);let P=M.useRef(!1);dZ(()=>(P.current=!0,()=>{P.current=!1}),[]),dZ(()=>{if(S&&(k.current=S),w&&(C.current=w),S&&w){if(_.current)return _.current(S,w,x);x()}},[S,w,x,_,E]);let N=M.useMemo(()=>({reference:k,floating:C,setReference:b,setFloating:y}),[b,y]),O=M.useMemo(()=>({reference:S,floating:w}),[S,w]),D=M.useMemo(()=>{let e={position:i,left:0,top:0};if(!O.floating)return e;let t=d1(O.floating,u.x),n=d1(O.floating,u.y);return o?{...e,transform:"translate("+t+"px, "+n+"px)",...d0(O.floating)>=1.5&&{willChange:"transform"}}:{position:i,left:t,top:n}},[i,o,O.floating,u.x,u.y]);return M.useMemo(()=>({...u,update:x,refs:N,elements:O,floatingStyles:D}),[u,x,N,O,D])}({...e,elements:{...r,...o&&{reference:o}}}),p=M.useCallback(e=>{let t=c7(e)?{getBoundingClientRect:()=>e.getBoundingClientRect(),getClientRects:()=>e.getClientRects(),contextElement:e}:e;l(t),h.refs.setReference(t)},[h.refs]),f=M.useCallback(e=>{(c7(e)||null===e)&&(u.current=e,a(e)),(c7(h.refs.reference.current)||null===h.refs.reference.current||null!==e&&!c7(e))&&h.refs.setReference(e)},[h.refs]),m=M.useMemo(()=>({...h.refs,setReference:f,setPositionReference:p,domReference:u}),[h.refs,f,p]),g=M.useMemo(()=>({...h.elements,domReference:c}),[h.elements,c]),v=M.useMemo(()=>({...h,...n,refs:m,elements:g,nodeId:t}),[h,m,g,t,n]);return dp(()=>{n.dataRef.current.floatingContext=v;let e=null==d?void 0:d.nodesRef.current.find(e=>e.id===t);e&&(e.context=v)}),M.useMemo(()=>({...h,context:v,refs:m,elements:g}),[h,m,g,v])}function hQ(e,t,i){let n=new Map,r="item"===i,s=e;if(r&&e){let{[hi]:t,[hn]:i,...n}=e;s=n}return{..."floating"===i&&{tabIndex:-1,"data-floating-ui-focusable":""},...s,...t.map(t=>{let n=t?t[i]:null;return"function"==typeof n?e?n(e):null:n}).concat(e).reduce((e,t)=>(t&&Object.entries(t).forEach(t=>{let[i,s]=t;if(!(r&&[hi,hn].includes(i)))if(0===i.indexOf("on")){if(n.has(i)||n.set(i,[]),"function"==typeof s){var a;null==(a=n.get(i))||a.push(s),e[i]=function(){for(var e,t=arguments.length,r=Array(t),s=0;s<t;s++)r[s]=arguments[s];return null==(e=n.get(i))?void 0:e.map(e=>e(...r)).find(e=>void 0!==e)}}}else e[i]=s}),e),{})}}function h0(e,t,i){switch(e){case"vertical":return t;case"horizontal":return i;default:return t||i}}function h1(e,t){return h0(t,e===ha||e===ho,e===hr||e===hs)}function h2(e,t,i){return h0(t,e===ho,i?e===hr:e===hs)||"Enter"===e||" "===e||""===e}function h3(e,t,i){return h0(t,i?e===hr:e===hs,e===ho)}function h4(e,t,i,n){return"both"===t||"horizontal"===t&&n&&n>1?"Escape"===e:h0(t,i?e===hs:e===hr,e===ha)}let h6=new Map([["select","listbox"],["combobox","listbox"],["label",!1]]);var h5=i(49384);let h9=({participant:e,trackType:t="audioTrack",...i})=>{let n=cA(),[r,s]=(0,M.useState)(null),{userId:a,sessionId:o}=e;return(0,M.useEffect)(()=>{if(!n||!r)return;let e=n.bindAudioElement(r,o,t);return()=>{e?.()}},[n,o,r,t]),(0,U.jsx)("audio",{autoPlay:!0,...i,ref:s,"data-user-id":a,"data-session-id":o,"data-track-type":t})};h9.displayName="Audio";let h8=e=>{let{participants:t,audioProps:i}=e;return(0,U.jsx)(U.Fragment,{children:t.map(e=>{if(e.isLocalParticipant)return null;let{audioStream:t,screenShareAudioStream:n,sessionId:r}=e,s=ay(e)&&t&&(0,U.jsx)(h9,{...i,trackType:"audioTrack",participant:e}),a=aw(e)&&n&&(0,U.jsx)(h9,{...i,trackType:"screenShareAudioTrack",participant:e});return(0,U.jsxs)(M.Fragment,{children:[s,a]},r)})})};h8.displayName="ParticipantsAudio";let h7=(0,M.createContext)(void 0),pe=()=>(0,M.useContext)(h7),pt=({middleware:e=[],placement:t,strategy:i,offset:n=10})=>{let{refs:r,x:s,y:a,update:o,elements:{domReference:l,floating:c},context:u}=hZ({placement:t,strategy:i,middleware:[d4(n),d6(),d5(),d9({padding:10,apply:({availableHeight:e,elements:t})=>{Object.assign(t.floating.style,{maxHeight:`${e}px`})}}),...e]});return(0,M.useEffect)(()=>{if(!l||!c)return;let e=dz(l,c,o);return()=>e()},[l,c,o]),{refs:r,x:s,y:a,domReference:l,floating:c,strategy:i,context:u}},pi=10,pn=(e,t=pi)=>{let[i,n]=(0,M.useState)(null);return(0,M.useEffect)(()=>{if(!e)return;let i=()=>e.scrollHeight>e.clientHeight?e.scrollTop<=t?n("top"):Math.abs(e.scrollHeight-e.scrollTop-e.clientHeight)<=t?n("bottom"):void n("between"):n(null),r=new ResizeObserver(i);return r.observe(e),e.addEventListener("scroll",i),()=>{e.removeEventListener("scroll",i),r.disconnect()}},[e,t]),i},pr=(e,t=pi)=>{let[i,n]=(0,M.useState)(null);return(0,M.useEffect)(()=>{if(!e)return;let i=()=>e.scrollWidth>e.clientWidth?e.scrollLeft<=t?n("start"):Math.abs(e.scrollWidth-e.scrollLeft-e.clientWidth)<=t?n("end"):void n("between"):n(null),r=new ResizeObserver(i);return r.observe(e),e.addEventListener("scroll",i),()=>{e.removeEventListener("scroll",i),r.disconnect()}},[e,t]),i},ps=e=>{let t=cA(),{useHasPermissions:i}=c2(),n=i(e),[r,s]=(0,M.useState)(!1);return(0,M.useEffect)(()=>{n&&s(!1)},[n]),{requestPermission:(0,M.useCallback)(async()=>{if(n)return!0;let i=!!t?.permissionsContext.canRequest(e);if(r||!i)return!1;s(!0);try{await t?.requestPermissions({permissions:[e]})}catch(e){throw s(!1),Error(`requestPermission failed: ${e}`)}return!1},[t,n,r,e]),hasPermission:n,canRequestPermission:!!t?.permissionsContext.canRequest(e),isAwaitingPermission:r}};function pa(e,t){let{t:i}=cH();return(0,M.useMemo)(()=>{let n=null,r=null,s=e.map((e,i)=>{let s=e.deviceId===t,a={deviceId:e.deviceId,label:e.label,isSelected:s};return s&&(n=a,r=i),a});if(null===n||null===r){let e={deviceId:"default",label:i("Default"),isSelected:!0};n=e,r=0,s.unshift(e)}return{deviceList:s,selectedDeviceInfo:n,selectedIndex:r}},[e,t,i])}!function(e){e.PORTAL="portal",e.MENU="menu"}(N||(N={}));let po=(0,M.createContext)({}),pl=()=>(0,M.useContext)(po),pc=({children:e,refs:t})=>{let i=(0,M.useMemo)(()=>`str-video-portal-${Math.random().toString(36).substring(2,9)}`,[]);return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)("div",{id:i,className:"str-video__portal"}),(0,U.jsx)(hJ,{children:(0,U.jsx)(hL,{id:i,children:(0,U.jsx)("div",{className:"str-video__portal-content",ref:t.setFloating,children:e})})})]})},pu=({ToggleButton:e,placement:t="top-start",strategy:i="absolute",offset:n,visualType:r=N.MENU,children:s,onToggle:a})=>{let[o,l]=(0,M.useState)(!1),c=(0,M.useRef)(a);c.current=a;let{floating:u,domReference:d,refs:h,x:p,y:f}=pt({placement:t,strategy:i,offset:n});return(0,M.useEffect)(()=>{let e=d?.ownerDocument,t=e=>{!u&&d?.contains(e.target)?(l(!0),c.current?.(!0)):u&&!u?.contains(e.target)&&(l(!1),c.current?.(!1))},i=e=>{!e.key||"escape"!==e.key.toLowerCase()||e.altKey||e.ctrlKey||(l(!1),c.current?.(!1))};return e?.addEventListener("click",t,{capture:!0}),e?.addEventListener("keydown",i),()=>{e?.removeEventListener("click",t,{capture:!0}),e?.removeEventListener("keydown",i)}},[u,d]),(0,U.jsxs)(U.Fragment,{children:[o&&(0,U.jsx)(po.Provider,{value:{close:()=>l(!1)},children:r===N.PORTAL?(0,U.jsx)(pc,{refs:h,children:s}):r===N.MENU?(0,U.jsx)("div",{className:"str-video__menu-container",ref:h.setFloating,style:{position:i,top:f??0,left:p??0,overflowY:"auto"},role:"menu",children:s}):null}),(0,U.jsx)(e,{menuShown:o,ref:h.setReference})]})},pd=({children:e,onItemClick:t})=>{let i=(0,M.useRef)(null);return(0,U.jsx)("ul",{className:"str-video__generic-menu",ref:i,onClick:e=>{t&&e.target!==i.current&&i.current?.contains(e.target)&&t(e)},children:e})},ph=({children:e,...t})=>(0,U.jsx)("li",{className:"str-video__generic-menu--item",children:(0,U.jsx)("button",{...t,children:e})}),pp=({className:e,icon:t})=>(0,U.jsx)("span",{className:(0,h5.A)("str-video__icon",t&&`str-video__icon--${t}`,e)});function pf(e){let[t,i]=(0,M.useState)(document.pictureInPictureElement===e);return!e&&t&&i(!1),(0,M.useEffect)(()=>{if(!e)return;let t=()=>{i(document.pictureInPictureElement===e)};return e.addEventListener("enterpictureinpicture",t),e.addEventListener("leavepictureinpicture",t),()=>{e.removeEventListener("enterpictureinpicture",t),e.removeEventListener("leavepictureinpicture",t)}},[e]),t}let pm=()=>{let{participant:e,participantViewElement:t,videoElement:i}=pe(),[n,r]=(0,M.useState)(!!document.fullscreenElement),s=cA(),a=pf(i??void 0),{t:o}=cH(),{pin:l,sessionId:c,userId:u}=e,d=ay(e),h=ab(e),p=aS(e),f=aw(e),m=e=>()=>{s?.updateUserPermissions({user_id:u,grant_permissions:[e]})},g=e=>()=>{s?.updateUserPermissions({user_id:u,revoke_permissions:[e]})};(0,M.useEffect)(()=>{let e=()=>{r(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),()=>{document.removeEventListener("fullscreenchange",e)}},[]);let{close:v}=pl()||{};return(0,U.jsxs)(pd,{onItemClick:v,children:[(0,U.jsxs)(ph,{onClick:()=>{l?s?.unpin(c):s?.pin(c)},disabled:l&&!l.isLocalPin,children:[(0,U.jsx)(pp,{icon:"pin"}),o(l?"Unpin":"Pin")]}),(0,U.jsxs)(c3,{requiredGrants:[i2.PIN_FOR_EVERYONE],children:[(0,U.jsxs)(ph,{onClick:()=>{s?.pinForEveryone({user_id:u,session_id:c}).catch(e=>{console.error(`Failed to pin participant ${u}`,e)})},disabled:l&&!l.isLocalPin,children:[(0,U.jsx)(pp,{icon:"pin"}),o("Pin for everyone")]}),(0,U.jsxs)(ph,{onClick:()=>{s?.unpinForEveryone({user_id:u,session_id:c}).catch(e=>{console.error(`Failed to unpin participant ${u}`,e)})},disabled:!l||l.isLocalPin,children:[(0,U.jsx)(pp,{icon:"pin"}),o("Unpin for everyone")]})]}),(0,U.jsx)(c3,{requiredGrants:[i2.BLOCK_USERS],children:(0,U.jsxs)(ph,{onClick:()=>s?.blockUser(u),children:[(0,U.jsx)(pp,{icon:"not-allowed"}),o("Block")]})}),(0,U.jsxs)(c3,{requiredGrants:[i2.MUTE_USERS],children:[h&&(0,U.jsxs)(ph,{onClick:()=>s?.muteUser(u,"video"),children:[(0,U.jsx)(pp,{icon:"camera-off-outline"}),o("Turn off video")]}),p&&(0,U.jsxs)(ph,{onClick:()=>s?.muteUser(u,"screenshare"),children:[(0,U.jsx)(pp,{icon:"screen-share-off"}),o("Turn off screen share")]}),d&&(0,U.jsxs)(ph,{onClick:()=>s?.muteUser(u,"audio"),children:[(0,U.jsx)(pp,{icon:"no-audio"}),o("Mute audio")]}),f&&(0,U.jsxs)(ph,{onClick:()=>s?.muteUser(u,"screenshare_audio"),children:[(0,U.jsx)(pp,{icon:"no-audio"}),o("Mute screen share audio")]})]}),t&&void 0!==t.requestFullscreen&&(0,U.jsx)(ph,{onClick:()=>n?document.exitFullscreen().catch(console.error):t?.requestFullscreen().catch(console.error),children:o("{{ direction }} fullscreen",{direction:o(n?"Leave":"Enter")})}),i&&document.pictureInPictureEnabled&&(0,U.jsx)(ph,{onClick:()=>i&&!a?i.requestPictureInPicture().catch(console.error):document.exitPictureInPicture().catch(console.error),children:o("{{ direction }} picture-in-picture",{direction:o(a?"Leave":"Enter")})}),(0,U.jsxs)(c3,{requiredGrants:[i2.UPDATE_CALL_PERMISSIONS],children:[(0,U.jsx)(ph,{onClick:m(i2.SEND_AUDIO),children:o("Allow audio")}),(0,U.jsx)(ph,{onClick:m(i2.SEND_VIDEO),children:o("Allow video")}),(0,U.jsx)(ph,{onClick:m(i2.SCREENSHARE),children:o("Allow screen sharing")}),(0,U.jsx)(ph,{onClick:g(i2.SEND_AUDIO),children:o("Disable audio")}),(0,U.jsx)(ph,{onClick:g(i2.SEND_VIDEO),children:o("Disable video")}),(0,U.jsx)(ph,{onClick:g(i2.SCREENSHARE),children:o("Disable screen sharing")})]})]})},pg=e=>null!==e&&!(0,M.isValidElement)(e),pv=(e,t)=>{if(e){if("function"==typeof e)return e(t);e.current=t}};(0,M.forwardRef)(function({stream:e,...t},i){let[n,r]=(0,M.useState)(null);return(0,M.useEffect)(()=>{if(n&&e&&e!==n.srcObject)return n.srcObject=e,(aG.isSafari()||aG.isFirefox())&&setTimeout(()=>{n.srcObject=e,n.play().catch(e=>{console.error("Failed to play stream",e)})},0),()=>{n.pause(),n.srcObject=null}},[e,n]),(0,U.jsx)("video",{autoPlay:!0,playsInline:!0,...t,ref:e=>{pv(i,e),r(e)}})});let pb=(0,M.forwardRef)(function({participant:e,style:t,children:i},n){let[r,s]=(0,M.useState)(!1),a=e.name||e.userId;return(0,U.jsxs)("div",{className:"str-video__video-placeholder",style:t,ref:n,children:[(!e.image||r)&&(a?(0,U.jsx)(py,{name:a}):(0,U.jsx)("div",{className:"str-video__video-placeholder__no-video-label",children:i})),e.image&&!r&&(0,U.jsx)("img",{onError:()=>s(!0),alt:a,className:"str-video__video-placeholder__avatar",src:e.image})]})}),py=e=>{let{name:t}=e,i=t.split(" ").slice(0,2).map(e=>e[0]).join("");return(0,U.jsx)("div",{className:"str-video__video-placeholder__initials-fallback",children:i})},pS=(0,M.forwardRef)(function(e,t){let{t:i}=cH();return(0,U.jsx)(pb,{ref:t,...e,children:i("Video is disabled")})}),pw=(0,M.forwardRef)(function(e,t){let{t:i}=cH();return(0,U.jsx)(pb,{ref:t,...e,children:i("Video is playing in a popup")})}),pk=({enabled:e=!0,mirror:t,trackType:i,participant:n,className:r,VideoPlaceholder:s=pS,PictureInPicturePlaceholder:a=pw,refs:o,...l})=>{let{sessionId:c,videoStream:u,screenShareStream:d,viewportVisibilityState:h,isLocalParticipant:p,userId:f}=n,m=cA(),[g,v]=(0,M.useState)(null),[b,y]=(0,M.useState)(!0),[S,w]=(0,M.useState)(!0),k=pf(g??void 0),C="videoTrack"===i?u:"screenShareTrack"===i?d:void 0;if((0,M.useLayoutEffect)(()=>{if(!m||!g||"none"===i)return;let e=m.bindVideoElement(g,c,i);return()=>{e?.()}},[m,i,c,g]),(0,M.useEffect)(()=>{if(!C||!g)return;let[e]=C.getVideoTracks();if(!e)return;let t=()=>{y(g.paused);let{width:t=0,height:i=0}=e.getSettings();w(t>=i)};return y(g.paused),g.addEventListener("play",t),g.addEventListener("pause",t),e.addEventListener("unmute",t),()=>{g.removeEventListener("play",t),g.removeEventListener("pause",t),e.removeEventListener("unmute",t),y(!0)}},[C,g]),!m)return null;let T="videoTrack"===i?ab(n):"screenShareTrack"===i&&aS(n),E="none"===i||h?.[i]===I.INVISIBLE,_=!e||!T||E,R=void 0===t?p&&"videoTrack"===i:t,x="screenShareTrack"===i;return(0,U.jsxs)(U.Fragment,{children:[!_&&(0,U.jsx)("video",{...l,className:(0,h5.A)("str-video__video",r,{"str-video__video--not-playing":b,"str-video__video--tall":!S,"str-video__video--mirror":R,"str-video__video--screen-share":x}),"data-user-id":f,"data-session-id":c,ref:e=>{v(e),o?.setVideoElement?.(e)}}),k&&a&&(0,U.jsx)(a,{style:{position:"absolute"},participant:n}),(_||b)&&s&&(0,U.jsx)(s,{style:{position:"absolute"},participant:n,ref:o?.setVideoPlaceholderElement})]})};pk.displayName="Video";let pC=({trackedElement:e,dynascaleManager:t,sessionId:i,trackType:n})=>{let r=cA(),s=t??r?.dynascaleManager;(0,M.useEffect)(()=>{if(!e||!s||!r||"none"===n)return;let t=s.trackElementVisibility(e,i,n);return()=>{t()}},[e,s,r,i,n])};(0,M.createContext)(void 0);let pT=(0,M.forwardRef)(function(e,t){let{icon:i,enabled:n,variant:r,onClick:s,className:a,...o}=e;return(0,U.jsx)("button",{className:(0,h5.A)("str-video__call-controls__button",a,{[`str-video__call-controls__button--variant-${r}`]:r,"str-video__call-controls__button--enabled":n}),onClick:e=>{e.preventDefault(),s?.(e)},ref:t,...o,children:(0,U.jsx)(pp,{icon:i})})}),pE=(0,M.forwardRef)(function({disabled:e,caption:t,children:i,className:n,active:r,Menu:s,menuPlacement:a,menuOffset:o,title:l,ToggleMenuButton:c=p_,variant:u,onClick:d,onMenuToggle:h,...p},f){return(0,U.jsxs)("div",{className:(0,h5.A)("str-video__composite-button",n,{"str-video__composite-button--caption":t,"str-video__composite-button--menu":s}),title:l,ref:f,children:[(0,U.jsxs)("div",{className:(0,h5.A)("str-video__composite-button__button-group",{"str-video__composite-button__button-group--active":r,"str-video__composite-button__button-group--active-primary":r&&"primary"===u,"str-video__composite-button__button-group--active-secondary":r&&"secondary"===u,"str-video__composite-button__button-group--disabled":e}),children:[(0,U.jsx)("button",{type:"button",className:"str-video__composite-button__button",onClick:e=>{e.preventDefault(),d?.(e)},disabled:e,...p,children:i}),s&&(0,U.jsx)(pu,{offset:o,placement:a,ToggleButton:c,onToggle:h,children:pg(s)?(0,U.jsx)(s,{}):s})]}),t&&(0,U.jsx)("div",{className:"str-video__composite-button__caption",children:t})]})}),p_=(0,M.forwardRef)(function({menuShown:e},t){return(0,U.jsx)(pT,{className:(0,h5.A)("str-video__menu-toggle-button",{"str-video__menu-toggle-button--active":e}),icon:e?"caret-down":"caret-up",ref:t})}),pR=e=>{let{isVisible:t,message:i,children:n,visibilityTimeout:r,resetIsVisible:s,placement:a="top",iconClassName:o="str-video__notification__icon",close:l}=e,{refs:c,x:u,y:d,strategy:h}=pt({placement:a,strategy:"absolute"});return(0,M.useEffect)(()=>{if(!t||!r||!s)return;let e=setTimeout(()=>{s()},r);return()=>clearTimeout(e)},[t,s,r]),(0,U.jsxs)("div",{ref:c.setReference,children:[t&&(0,U.jsxs)("div",{className:"str-video__notification",ref:c.setFloating,style:{position:h,top:d??0,left:u??0,overflowY:"auto"},children:[o&&(0,U.jsx)("i",{className:o}),(0,U.jsx)("span",{className:"str-video__notification__message",children:i}),l?(0,U.jsx)("i",{className:"str-video__icon str-video__icon--close str-video__notification__close",onClick:l}):null]}),n]})},pI=e=>{let{permission:t,isAwaitingApproval:i,messageApproved:n,messageAwaitingApproval:r,messageRevoked:s,visibilityTimeout:a=3500,children:o}=e,{useHasPermissions:l}=c2(),c=l(t),u=(0,M.useRef)(c),[d,h]=(0,M.useState)();(0,M.useEffect)(()=>{c&&!u.current?(h("granted"),u.current=!0):!c&&u.current&&(h("revoked"),u.current=!1)},[c]);let p=(0,M.useCallback)(()=>h(void 0),[]);return i?(0,U.jsx)(pR,{isVisible:i&&!c,message:r,children:o}):(0,U.jsx)(pR,{isVisible:!!d,visibilityTimeout:a,resetIsVisible:p,message:"granted"===d?n:s,children:o})},px=({children:e,text:t,placement:i})=>{let{useMicrophoneState:n}=c2(),{isSpeakingWhileMuted:r}=n(),{t:s}=cH(),a=t??s("You are muted. Unmute to speak.");return(0,U.jsx)(pR,{message:a,isVisible:r,placement:i||"top-start",children:e})},pP=({className:e,type:t="spinner",text:i,tooltip:n})=>(0,U.jsxs)("div",{className:(0,h5.A)("str-video__loading-indicator",e),title:n,children:[(0,U.jsx)("div",{className:(0,h5.A)("str-video__loading-indicator__icon",t)}),i&&(0,U.jsx)("p",{className:"str-video__loading-indicator-text",children:i})]}),pN=({children:e,referenceElement:t,tooltipClassName:i,tooltipPlacement:n="top",visible:r=!1})=>{let s=(0,M.useRef)(null),{refs:a,x:o,y:l,strategy:c,context:u}=pt({placement:n,strategy:"absolute",middleware:[d8({element:s})]});return((0,M.useEffect)(()=>{a.setReference(t)},[t,a]),r)?(0,U.jsxs)("div",{className:(0,h5.A)("str-video__tooltip",i),ref:a.setFloating,style:{position:c,top:l??0,left:o??0},children:[(0,U.jsx)(hp,{ref:s,context:u,fill:"var(--str-video__tooltip--background-color)"}),e]}):null},pO=({onMouseEnter:e,onMouseLeave:t}={})=>{let[i,n]=(0,M.useState)(!1);return{handleMouseEnter:(0,M.useCallback)(t=>{n(!0),e?.(t)},[e]),handleMouseLeave:(0,M.useCallback)(e=>{n(!1),t?.(e)},[t]),tooltipVisible:i}},pD=({title:e,tooltipClassName:t,tooltipPlacement:i,tooltipDisabled:n,...r})=>{let{handleMouseEnter:s,handleMouseLeave:a,tooltipVisible:o}=pO(),[l,c]=(0,M.useState)(null);return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(pN,{referenceElement:l,visible:!n&&!!e&&o,tooltipClassName:t,tooltipPlacement:i,children:e||""}),(0,U.jsx)("div",{ref:c,onMouseEnter:s,onMouseLeave:a,...r})]})};(0,M.forwardRef)(function(e,t){return(0,U.jsx)(pE,{ref:t,active:!0,variant:"secondary","data-testid":"recording-stop-button",children:(0,U.jsx)(pp,{icon:"recording-off"})})});let pA=({caption:e})=>{let{t}=cH(),{toggleCallRecording:i,isAwaitingResponse:n,isCallRecordingInProgress:r}=c1(),s=e??t("Record call");return n&&(s=t(r?"Waiting for recording to stop...":"Waiting for recording to start...")),(0,U.jsx)(c3,{requiredGrants:[i2.START_RECORD_CALL,i2.STOP_RECORD_CALL],children:(0,U.jsx)(pE,{active:r,caption:e,variant:"secondary","data-testid":r?"recording-stop-button":"recording-start-button",title:s,onClick:n?void 0:i,children:n?(0,U.jsx)(pP,{}):(0,U.jsx)(pp,{icon:r?"recording-on":"recording-off"})})})},pj={":like:":"\uD83D\uDC4D",":raise-hand:":"",":fireworks:":"\uD83C\uDF89",":dislike:":"\uD83D\uDC4E",":heart:":"",":smile:":"\uD83D\uDE00"},pL=({participant:{reaction:e,sessionId:t},hideAfterTimeoutInMs:i=5500,emojiReactionMap:n=pj})=>{let r=cA();if((0,M.useEffect)(()=>{if(!r||!e)return;let n=setTimeout(()=>{r.resetReaction(t)},i);return()=>{clearTimeout(n)}},[r,i,e,t]),!e)return null;let{emoji_code:s}=e;return(0,U.jsx)("div",{className:"str-video__reaction",children:(0,U.jsx)("span",{className:"str-video__reaction__emoji",children:s&&n[s]})})},pU=[{type:"reaction",emoji_code:":like:"},{type:"raised-hand",emoji_code:":raise-hand:"},{type:"reaction",emoji_code:":fireworks:"},{type:"reaction",emoji_code:":dislike:"},{type:"reaction",emoji_code:":heart:"},{type:"reaction",emoji_code:":smile:"}],pM=({reactions:e=pU})=>(0,U.jsx)(c3,{requiredGrants:[i2.CREATE_REACTION],children:(0,U.jsx)(pu,{placement:"top",ToggleButton:pF,visualType:N.MENU,children:(0,U.jsx)(p$,{reactions:e})})}),pF=(0,M.forwardRef)(function({menuShown:e},t){let{t:i}=cH();return(0,U.jsx)(pD,{title:i("Reactions"),tooltipDisabled:e,children:(0,U.jsx)(pE,{ref:t,active:e,variant:"primary",children:(0,U.jsx)(pp,{icon:"reactions"})})})}),p$=({reactions:e,layout:t="horizontal"})=>{let i=cA(),{close:n}=pl();return(0,U.jsx)("div",{className:(0,h5.A)("str-video__reactions-menu",{"str-video__reactions-menu--horizontal":"horizontal"===t,"str-video__reactions-menu--vertical":"vertical"===t}),children:e.map(e=>(0,U.jsx)("button",{type:"button",className:"str-video__reactions-menu__button",onClick:()=>{i?.sendReaction(e),n?.()},children:e.emoji_code&&pj[e.emoji_code]},e.emoji_code))})},pV=(e,t)=>{let i=s3(["react-sdk"]);return async()=>{try{await t()}catch(t){if(e.onError)return void e.onError(t);!function(e){return e instanceof DOMException&&"NotAllowedError"===e.name}(t)&&i("error","Call control handler failed",t)}}},pB=e=>{let{t}=cH(),{caption:i}=e,{useHasOngoingScreenShare:n,useScreenShareState:r,useCallSettings:s}=c2(),a=n(),{hasPermission:o,requestPermission:l,isAwaitingPermission:c}=ps(i2.SCREENSHARE),u=s(),d=u?.screensharing.enabled,{screenShare:h,optimisticIsMute:p}=r(),f=!p,m=!f&&(a||!1===d),g=pV(e,async()=>{o?await h.toggle():await l()});return(0,U.jsx)(c3,{requiredGrants:[i2.SCREENSHARE],children:(0,U.jsx)(pI,{permission:i2.SCREENSHARE,isAwaitingApproval:c,messageApproved:t("You can now share your screen."),messageAwaitingApproval:t("Awaiting for an approval to share screen."),messageRevoked:t("You can no longer share your screen."),children:(0,U.jsx)(pD,{title:i??t("Share screen"),children:(0,U.jsx)(pE,{active:a||f,caption:i,variant:"primary","data-testid":a?"screen-share-stop-button":"screen-share-start-button",disabled:m,onClick:g,children:(0,U.jsx)(pp,{icon:a?"screen-share-on":"screen-share-off"})})})})})},pH=(0,M.createContext)({}),pq=e=>{let{children:t,icon:i,defaultSelectedLabel:n,defaultSelectedIndex:r,handleSelect:s}=e,[a,o]=(0,M.useState)(!1),[l,c]=(0,M.useState)(null),[u,d]=(0,M.useState)(r),[h,p]=(0,M.useState)(n),{refs:f,context:m}=hZ({placement:"bottom-start",open:a,onOpenChange:o,whileElementsMounted:dz,middleware:[d5()]}),g=(0,M.useRef)([]),v=(0,M.useRef)([]),b=(0,M.useCallback)(e=>{d(e),s(e||0),o(!1),null!==e&&p(v.current[e])},[s]),y=function(e,t){let{open:i,onOpenChange:n,elements:r,floatingId:s}=e,{listRef:a,activeIndex:o,onNavigate:l=()=>{},enabled:c=!0,selectedIndex:u=null,allowEscape:d=!1,loop:h=!1,nested:p=!1,rtl:f=!1,virtual:m=!1,focusItemOnOpen:g="auto",focusItemOnHover:v=!0,openOnArrowKeyDown:b=!0,disabledIndices:y,orientation:S="vertical",parentOrientation:w,cols:k=1,scrollItemIntoView:C=!0,virtualItemRef:T,itemSizes:E,dense:_=!1}=t,R=df(ds(r.floating)),I=hg(),x=hv();dp(()=>{e.dataRef.current.orientation=S},[e,S]);let P=dg(()=>{l(-1===D.current?null:D.current)}),N=dr(r.domReference),O=M.useRef(g),D=M.useRef(null!=u?u:-1),A=M.useRef(null),j=M.useRef(!0),L=M.useRef(P),U=M.useRef(!!r.floating),F=M.useRef(i),$=M.useRef(!1),V=M.useRef(!1),B=df(y),H=df(i),q=df(C),W=df(u),[G,J]=M.useState(),[K,z]=M.useState(),Y=dg(()=>{function e(e){if(m){var t;null!=(t=e.id)&&t.endsWith("-fui-option")&&(e.id=s+"-"+Math.random().toString(16).slice(2,10)),J(e.id),null==x||x.events.emit("virtualfocus",e),T&&(T.current=e)}else hC(e,{sync:$.current,preventScroll:!0})}let t=a.current[D.current],i=V.current;t&&e(t),($.current?e=>e():requestAnimationFrame)(()=>{let n=a.current[D.current]||t;if(!n)return;t||e(n);let r=q.current;r&&Z&&(i||!j.current)&&(null==n.scrollIntoView||n.scrollIntoView("boolean"==typeof r?{block:"nearest",inline:"nearest"}:r))})});dp(()=>{c&&(i&&r.floating?O.current&&null!=u&&(V.current=!0,D.current=u,P()):U.current&&(D.current=-1,L.current()))},[c,i,r.floating,u,P]),dp(()=>{if(c&&i&&r.floating)if(null==o){if($.current=!1,null!=W.current)return;if(U.current&&(D.current=-1,Y()),(!F.current||!U.current)&&O.current&&(null!=A.current||!0===O.current&&null==A.current)){let e=0,t=()=>{null==a.current[0]?(e<2&&(e?requestAnimationFrame:queueMicrotask)(t),e++):(D.current=null==A.current||h2(A.current,S,f)||p?dy(a,B.current):dS(a,B.current),A.current=null,P())};t()}}else db(a,o)||(D.current=o,Y(),V.current=!1)},[c,i,r.floating,o,W,p,a,S,f,P,Y,B]),dp(()=>{var e;if(!c||r.floating||!x||m||!U.current)return;let t=x.nodesRef.current,i=null==(e=t.find(e=>e.id===I))||null==(e=e.context)?void 0:e.elements.floating,n=u8(di(r.floating)),s=t.some(e=>e.context&&u7(e.context.elements.floating,n));i&&!s&&j.current&&i.focus({preventScroll:!0})},[c,r.floating,x,I,m]),dp(()=>{if(c&&x&&m&&!I)return x.events.on("virtualfocus",e),()=>{x.events.off("virtualfocus",e)};function e(e){z(e.id),T&&(T.current=e)}},[c,x,m,I,T]),dp(()=>{L.current=P,F.current=i,U.current=!!r.floating}),dp(()=>{i||(A.current=null,O.current=g)},[i,g]);let X=null!=o,Z=M.useMemo(()=>{function e(e){if(!H.current)return;let t=a.current.indexOf(e);-1!==t&&D.current!==t&&(D.current=t,P())}return{onFocus(t){let{currentTarget:i}=t;$.current=!0,e(i)},onClick:e=>{let{currentTarget:t}=e;return t.focus({preventScroll:!0})},...v&&{onMouseMove(t){let{currentTarget:i}=t;$.current=!0,V.current=!1,e(i)},onPointerLeave(e){let{pointerType:t}=e;if(j.current&&"touch"!==t&&($.current=!0,D.current=-1,P(),!m)){var i;null==(i=R.current)||i.focus({preventScroll:!0})}}}}},[H,R,v,a,P,m]),Q=M.useCallback(()=>{var e;return null!=w?w:null==x||null==(e=x.nodesRef.current.find(e=>e.id===I))||null==(e=e.context)||null==(e=e.dataRef)?void 0:e.current.orientation},[I,x,w]),ee=dg(e=>{if(j.current=!1,$.current=!0,229===e.which||!H.current&&e.currentTarget===R.current)return;if(p&&h4(e.key,S,f,k)){h1(e.key,Q())||dc(e),n(!1,e.nativeEvent,"list-navigation"),ue(r.domReference)&&(m?null==x||x.events.emit("virtualfocus",r.domReference):r.domReference.focus());return}let t=D.current,s=dy(a,y),o=dS(a,y);if(N||("Home"===e.key&&(dc(e),D.current=s,P()),"End"===e.key&&(dc(e),D.current=o,P())),k>1){var l;let t=E||Array.from({length:a.current.length},()=>({width:1,height:1})),i=function(e,t,i){let n=[],r=0;return e.forEach((e,s)=>{let{width:a,height:o}=e,l=!1;for(i&&(r=0);!l;){let e=[];for(let i=0;i<a;i++)for(let n=0;n<o;n++)e.push(r+i+n*t);r%t+a<=t&&e.every(e=>null==n[e])?(e.forEach(e=>{n[e]=s}),l=!0):r++}}),[...n]}(t,k,_),n=i.findIndex(e=>null!=e&&!dk(a,e,y)),r=i.reduce((e,t,i)=>null==t||dk(a,t,y)?e:i,-1),c=i[function(e,t){let{event:i,orientation:n,loop:r,rtl:s,cols:a,disabledIndices:o,minIndex:l,maxIndex:c,prevIndex:u,stopEvent:d=!1}=t,h=u;if("ArrowUp"===i.key){if(d&&dc(i),-1===u)h=c;else if(h=dw(e,{startingIndex:h,amount:a,decrement:!0,disabledIndices:o}),r&&(u-a<l||h<0)){let e=u%a,t=c%a,i=c-(t-e);h=t===e?c:t>e?i:i-a}db(e,h)&&(h=u)}if("ArrowDown"===i.key&&(d&&dc(i),-1===u?h=l:(h=dw(e,{startingIndex:u,amount:a,disabledIndices:o}),r&&u+a>c&&(h=dw(e,{startingIndex:u%a-a,amount:a,disabledIndices:o}))),db(e,h)&&(h=u)),"both"===n){let t=um(u/a);i.key===(s?u5:u9)&&(d&&dc(i),u%a!=a-1?(h=dw(e,{startingIndex:u,disabledIndices:o}),r&&dv(h,a,t)&&(h=dw(e,{startingIndex:u-u%a-1,disabledIndices:o}))):r&&(h=dw(e,{startingIndex:u-u%a-1,disabledIndices:o})),dv(h,a,t)&&(h=u)),i.key===(s?u9:u5)&&(d&&dc(i),u%a!=0?(h=dw(e,{startingIndex:u,decrement:!0,disabledIndices:o}),r&&dv(h,a,t)&&(h=dw(e,{startingIndex:u+(a-u%a),decrement:!0,disabledIndices:o}))):r&&(h=dw(e,{startingIndex:u+(a-u%a),decrement:!0,disabledIndices:o})),dv(h,a,t)&&(h=u));let n=um(c/a)===t;db(e,h)&&(h=r&&n?i.key===(s?u9:u5)?c:dw(e,{startingIndex:u-u%a-1,disabledIndices:o}):u)}return h}({current:i.map(e=>null!=e?a.current[e]:null)},{event:e,orientation:S,loop:h,rtl:f,cols:k,disabledIndices:(l=[...("function"!=typeof y?y:null)||a.current.map((e,t)=>dk(a,t,y)?t:void 0),void 0],i.flatMap((e,t)=>l.includes(e)?[t]:[])),minIndex:n,maxIndex:r,prevIndex:function(e,t,i,n,r){if(-1===e)return -1;let s=i.indexOf(e),a=t[e];switch(r){case"tl":return s;case"tr":if(!a)return s;return s+a.width-1;case"bl":if(!a)return s;return s+(a.height-1)*n;case"br":return i.lastIndexOf(e)}}(D.current>o?s:D.current,t,i,k,e.key===ho?"bl":e.key===(f?hr:hs)?"tr":"tl"),stopEvent:!0})];if(null!=c&&(D.current=c,P()),"both"===S)return}if(h1(e.key,S)){if(dc(e),i&&!m&&u8(e.currentTarget.ownerDocument)===e.currentTarget){D.current=h2(e.key,S,f)?s:o,P();return}h2(e.key,S,f)?h?D.current=t>=o?d&&t!==a.current.length?-1:s:dw(a,{startingIndex:t,disabledIndices:y}):D.current=Math.min(o,dw(a,{startingIndex:t,disabledIndices:y})):h?D.current=t<=s?d&&-1!==t?a.current.length:o:dw(a,{startingIndex:t,decrement:!0,disabledIndices:y}):D.current=Math.max(s,dw(a,{startingIndex:t,decrement:!0,disabledIndices:y})),db(a,D.current)&&(D.current=-1),P()}}),et=M.useMemo(()=>m&&i&&X&&{"aria-activedescendant":K||G},[m,i,X,K,G]),ei=M.useMemo(()=>({"aria-orientation":"both"===S?void 0:S,...!N?et:{},onKeyDown:ee,onPointerMove(){j.current=!0}}),[et,ee,S,N]),en=M.useMemo(()=>{function e(e){"auto"===g&&du(e.nativeEvent)&&(O.current=!0)}function t(e){O.current=g,"auto"===g&&dd(e.nativeEvent)&&(O.current=!0)}return{...et,onKeyDown(e){j.current=!1;let t=e.key.startsWith("Arrow"),r=["Home","End"].includes(e.key),s=h3(e.key,S,f),o=h4(e.key,S,f,k),l=h3(e.key,Q(),f),c=h1(e.key,S),d=(p?l:c)||"Enter"===e.key||""===e.key.trim();if(m&&i){var h,g,v,y,w;let i,n,l=null==x?void 0:x.nodesRef.current.find(e=>null==e.parentId),u=x&&l?(h=x.nodesRef.current,g=l.id,n=-1,!function e(t,r){r>n&&(i=t,n=r),da(h,t).forEach(t=>{e(t.id,r+1)})}(g,0),h.find(e=>e.id===i)):null;if((t||r)&&u&&T){let t=new KeyboardEvent("keydown",{key:e.key,bubbles:!0});if(s||o){let i=(null==(v=u.context)?void 0:v.elements.domReference)===e.currentTarget,n=o&&!i?null==(y=u.context)?void 0:y.elements.domReference:s?a.current.find(e=>(null==e?void 0:e.id)===G):null;n&&(dc(e),n.dispatchEvent(t),z(void 0))}if((c||r)&&u.context&&u.context.open&&u.parentId&&e.currentTarget!==u.context.elements.domReference){dc(e),null==(w=u.context.elements.domReference)||w.dispatchEvent(t);return}}return ee(e)}if(i||b||!t){if(d){let t=h1(e.key,Q());A.current=p&&t?null:e.key}if(p){l&&(dc(e),i?(D.current=dy(a,B.current),P()):n(!0,e.nativeEvent,"list-navigation"));return}c&&(null!=u&&(D.current=u),dc(e),!i&&b?n(!0,e.nativeEvent,"list-navigation"):ee(e),i&&P())}},onFocus(){i&&!m&&(D.current=-1,P())},onPointerDown:t,onPointerEnter:t,onMouseDown:e,onClick:e}},[G,et,k,ee,B,g,a,p,P,n,i,b,S,Q,f,u,x,m,T]);return M.useMemo(()=>c?{reference:en,floating:ei,item:Z}:{},[c,en,ei,Z])}(m,{listRef:g,activeIndex:l,selectedIndex:u,onNavigate:c}),S=function(e,t){var i;let{open:n,dataRef:r}=e,{listRef:s,activeIndex:a,onMatch:o,onTypingChange:l,enabled:c=!0,findMatch:u=null,resetMs:d=750,ignoreKeys:h=[],selectedIndex:p=null}=t,f=M.useRef(-1),m=M.useRef(""),g=M.useRef(null!=(i=null!=p?p:a)?i:-1),v=M.useRef(null),b=dg(o),y=dg(l),S=df(u),w=df(h);dp(()=>{n&&(hy(f),v.current=null,m.current="")},[n]),dp(()=>{if(n&&""===m.current){var e;g.current=null!=(e=null!=p?p:a)?e:-1}},[n,p,a]);let k=dg(e=>{e?r.current.typing||(r.current.typing=e,y(e)):r.current.typing&&(r.current.typing=e,y(e))}),C=dg(e=>{function t(e,t,i){let n=S.current?S.current(t,i):t.find(e=>(null==e?void 0:e.toLocaleLowerCase().indexOf(i.toLocaleLowerCase()))===0);return n?e.indexOf(n):-1}let i=s.current;if(m.current.length>0&&" "!==m.current[0]&&(-1===t(i,i,m.current)?k(!1):" "===e.key&&dc(e)),null==i||w.current.includes(e.key)||1!==e.key.length||e.ctrlKey||e.metaKey||e.altKey)return;n&&" "!==e.key&&(dc(e),k(!0)),i.every(e=>{var t,i;return!e||(null==(t=e[0])?void 0:t.toLocaleLowerCase())!==(null==(i=e[1])?void 0:i.toLocaleLowerCase())})&&m.current===e.key&&(m.current="",g.current=v.current),m.current+=e.key,hy(f),f.current=window.setTimeout(()=>{m.current="",g.current=v.current,k(!1)},d);let r=g.current,a=t(i,[...i.slice((r||0)+1),...i.slice(0,(r||0)+1)],m.current);-1!==a?(b(a),v.current=a):" "!==e.key&&(m.current="",k(!1))}),T=M.useMemo(()=>({onKeyDown:C}),[C]),E=M.useMemo(()=>({onKeyDown:C,onKeyUp(e){" "===e.key&&k(!1)}}),[C,k]);return M.useMemo(()=>c?{reference:T,floating:E}:{},[c,T,E])}(m,{listRef:v,activeIndex:l,selectedIndex:u,onMatch:e=>{a?c(e):b(e)}}),w=function(e,t){void 0===t&&(t={});let{open:i,onOpenChange:n,dataRef:r,elements:{domReference:s}}=e,{enabled:a=!0,event:o="click",toggle:l=!0,ignoreMouse:c=!1,keyboardHandlers:u=!0,stickIfOpen:d=!0}=t,h=M.useRef(),p=M.useRef(!1),f=M.useMemo(()=>({onPointerDown(e){h.current=e.pointerType},onMouseDown(e){let t=h.current;0===e.button&&"click"!==o&&(dh(t,!0)&&c||(i&&l&&(!r.current.openEvent||!d||"mousedown"===r.current.openEvent.type)?n(!1,e.nativeEvent,"click"):(e.preventDefault(),n(!0,e.nativeEvent,"click"))))},onClick(e){let t=h.current;if("mousedown"===o&&h.current){h.current=void 0;return}dh(t,!0)&&c||(i&&l&&(!r.current.openEvent||!d||"click"===r.current.openEvent.type)?n(!1,e.nativeEvent,"click"):n(!0,e.nativeEvent,"click"))},onKeyDown(e){h.current=void 0,!(e.defaultPrevented||!u||hK(e))&&(" "!==e.key||dn(s)||(e.preventDefault(),p.current=!0),ue(e.target)&&"A"===e.target.tagName||"Enter"!==e.key||(i&&l?n(!1,e.nativeEvent,"click"):n(!0,e.nativeEvent,"click")))},onKeyUp(e){!(e.defaultPrevented||!u||hK(e)||dn(s))&&" "===e.key&&p.current&&(p.current=!1,i&&l?n(!1,e.nativeEvent,"click"):n(!0,e.nativeEvent,"click"))}}),[r,s,o,c,u,n,i,d,l]);return M.useMemo(()=>a?{reference:f}:{},[a,f])}(m),{getReferenceProps:k,getFloatingProps:C,getItemProps:T}=function(e){void 0===e&&(e=[]);let t=e.map(e=>null==e?void 0:e.reference),i=e.map(e=>null==e?void 0:e.floating),n=e.map(e=>null==e?void 0:e.item),r=M.useCallback(t=>hQ(t,e,"reference"),t),s=M.useCallback(t=>hQ(t,e,"floating"),i),a=M.useCallback(t=>hQ(t,e,"item"),n);return M.useMemo(()=>({getReferenceProps:r,getFloatingProps:s,getItemProps:a}),[r,s,a])}([y,S,w,function(e,t){void 0===t&&(t={});let{open:i,onOpenChange:n,elements:r,dataRef:s}=e,{enabled:a=!0,escapeKey:o=!0,outsidePress:l=!0,outsidePressEvent:c="pointerdown",referencePress:u=!1,referencePressEvent:d="pointerdown",ancestorScroll:h=!1,bubbles:p,capture:f}=t,m=hv(),g=dg("function"==typeof l?l:()=>!1),v="function"==typeof l?g:l,b=M.useRef(!1),{escapeKey:y,outsidePress:S}=hX(p),{escapeKey:w,outsidePress:k}=hX(f),C=M.useRef(!1),T=M.useRef(-1),E=dg(e=>{var t;if(!i||!a||!o||"Escape"!==e.key||C.current)return;let r=null==(t=s.current.floatingContext)?void 0:t.nodeId,l=m?da(m.nodesRef.current,r):[];if(!y&&(e.stopPropagation(),l.length>0)){let e=!0;if(l.forEach(t=>{var i;if(null!=(i=t.context)&&i.open&&!t.context.dataRef.current.__escapeKeyBubbles){e=!1;return}}),!e)return}n(!1,"nativeEvent"in e?e.nativeEvent:e,"escape-key")}),_=dg(e=>{var t;let i=()=>{var t;E(e),null==(t=de(e))||t.removeEventListener("keydown",i)};null==(t=de(e))||t.addEventListener("keydown",i)}),R=dg(e=>{var t;let i=s.current.insideReactTree;s.current.insideReactTree=!1;let a=b.current;if(b.current=!1,"click"===c&&a||i||"function"==typeof v&&!v(e))return;let o=de(e),l="["+hb("inert")+"]",u=di(r.floating).querySelectorAll(l),d=c7(o)?o:null;for(;d&&!ua(d);){let e=uc(d);if(ua(e)||!c7(e))break;d=e}if(u.length&&c7(o)&&!o.matches("html,body")&&!u7(o,r.floating)&&Array.from(u).every(e=>!u7(d,e)))return;if(ue(o)&&P){let t=ua(o),i=uo(o),n=/auto|scroll/,r=t||n.test(i.overflowX),s=t||n.test(i.overflowY),a=r&&o.clientWidth>0&&o.scrollWidth>o.clientWidth,l=s&&o.clientHeight>0&&o.scrollHeight>o.clientHeight,c="rtl"===i.direction,u=l&&(c?e.offsetX<=o.offsetWidth-o.clientWidth:e.offsetX>o.clientWidth),d=a&&e.offsetY>o.clientHeight;if(u||d)return}let h=null==(t=s.current.floatingContext)?void 0:t.nodeId,p=m&&da(m.nodesRef.current,h).some(t=>{var i;return dt(e,null==(i=t.context)?void 0:i.elements.floating)});if(dt(e,r.floating)||dt(e,r.domReference)||p)return;let f=m?da(m.nodesRef.current,h):[];if(f.length>0){let e=!0;if(f.forEach(t=>{var i;if(null!=(i=t.context)&&i.open&&!t.context.dataRef.current.__outsidePressBubbles){e=!1;return}}),!e)return}n(!1,e,"outside-press")}),I=dg(e=>{var t;let i=()=>{var t;R(e),null==(t=de(e))||t.removeEventListener(c,i)};null==(t=de(e))||t.addEventListener(c,i)});M.useEffect(()=>{if(!i||!a)return;s.current.__escapeKeyBubbles=y,s.current.__outsidePressBubbles=S;let e=-1;function t(e){n(!1,e,"ancestor-scroll")}function l(){window.clearTimeout(e),C.current=!0}function u(){e=window.setTimeout(()=>{C.current=!1},5*!!us())}let d=di(r.floating);o&&(d.addEventListener("keydown",w?_:E,w),d.addEventListener("compositionstart",l),d.addEventListener("compositionend",u)),v&&d.addEventListener(c,k?I:R,k);let p=[];return h&&(c7(r.domReference)&&(p=uu(r.domReference)),c7(r.floating)&&(p=p.concat(uu(r.floating))),!c7(r.reference)&&r.reference&&r.reference.contextElement&&(p=p.concat(uu(r.reference.contextElement)))),(p=p.filter(e=>{var t;return e!==(null==(t=d.defaultView)?void 0:t.visualViewport)})).forEach(e=>{e.addEventListener("scroll",t,{passive:!0})}),()=>{o&&(d.removeEventListener("keydown",w?_:E,w),d.removeEventListener("compositionstart",l),d.removeEventListener("compositionend",u)),v&&d.removeEventListener(c,k?I:R,k),p.forEach(e=>{e.removeEventListener("scroll",t)}),window.clearTimeout(e)}},[s,r,o,v,c,i,n,h,a,y,S,E,w,_,R,k,I]),M.useEffect(()=>{s.current.insideReactTree=!1},[s,v,c]);let x=M.useMemo(()=>({onKeyDown:E,...u&&{[hz[d]]:e=>{n(!1,e.nativeEvent,"reference-press")},..."click"!==d&&{onClick(e){n(!1,e.nativeEvent,"reference-press")}}}}),[E,n,u,d]),P=M.useMemo(()=>({onKeyDown:E,onMouseDown(){b.current=!0},onMouseUp(){b.current=!0},[hY[c]]:()=>{s.current.insideReactTree=!0},onBlurCapture(){hy(T),s.current.insideReactTree=!0,T.current=window.setTimeout(()=>{s.current.insideReactTree=!1})}}),[E,c,s]);return M.useMemo(()=>a?{reference:x,floating:P}:{},[a,x,P])}(m),function(e,t){var i,n;void 0===t&&(t={});let{open:r,elements:s,floatingId:a}=e,{enabled:o=!0,role:l="dialog"}=t,c=hh(),u=(null==(i=s.domReference)?void 0:i.id)||c,d=M.useMemo(()=>{var e;return(null==(e=ds(s.floating))?void 0:e.id)||a},[s.floating,a]),h=null!=(n=h6.get(l))?n:l,p=null!=hg(),f=M.useMemo(()=>"tooltip"===h||"label"===l?{["aria-"+("label"===l?"labelledby":"describedby")]:r?d:void 0}:{"aria-expanded":r?"true":"false","aria-haspopup":"alertdialog"===h?"dialog":h,"aria-controls":r?d:void 0,..."listbox"===h&&{role:"combobox"},..."menu"===h&&{id:u},..."menu"===h&&p&&{role:"menuitem"},..."select"===l&&{"aria-autocomplete":"none"},..."combobox"===l&&{"aria-autocomplete":"list"}},[h,d,p,r,u,l]),m=M.useMemo(()=>{let e={id:d,...h&&{role:h}};return"tooltip"===h||"label"===l?e:{...e,..."menu"===h&&{"aria-labelledby":u}}},[h,d,u,l]),g=M.useCallback(e=>{let{active:t,selected:i}=e,n={role:"option",...t&&{id:d+"-fui-option"}};switch(l){case"select":return{...n,"aria-selected":t&&i};case"combobox":return{...n,"aria-selected":i}}return{}},[d,l]);return M.useMemo(()=>o?{reference:f,floating:m,item:g}:{},[o,f,m,g])}(m,{role:"listbox"})]),E=(0,M.useMemo)(()=>({activeIndex:l,selectedIndex:u,getItemProps:T,handleSelect:b}),[l,u,T,b]);return(0,U.jsxs)("div",{className:"str-video__dropdown",children:[(0,U.jsxs)("div",{className:"str-video__dropdown-selected",ref:f.setReference,tabIndex:0,...k(),children:[(0,U.jsxs)("label",{className:"str-video__dropdown-selected__label",children:[i&&(0,U.jsx)(pp,{className:"str-video__dropdown-selected__icon",icon:i}),h]}),(0,U.jsx)(pp,{className:"str-video__dropdown-selected__chevron",icon:a?"chevron-up":"chevron-down"})]}),(0,U.jsx)(pH.Provider,{value:E,children:a&&(0,U.jsx)(hH,{context:m,modal:!1,children:(0,U.jsx)("div",{className:"str-video__dropdown-list",ref:f.setFloating,...C(),children:(0,U.jsx)(ht,{elementsRef:g,labelsRef:v,children:t})})})})]})},pW=e=>{let{selected:t,label:i,icon:n}=e,{getItemProps:r,handleSelect:s}=(0,M.useContext)(pH),{ref:a,index:o}=function(e){void 0===e&&(e={});let{label:t}=e,{register:i,unregister:n,map:r,elementsRef:s,labelsRef:a}=M.useContext(he),[o,l]=M.useState(null),c=M.useRef(null),u=M.useCallback(e=>{if(c.current=e,null!==o&&(s.current[o]=e,a)){var i;let n=void 0!==t;a.current[o]=n?t:null!=(i=null==e?void 0:e.textContent)?i:null}},[o,s,a,t]);return dp(()=>{let e=c.current;if(e)return i(e),()=>{n(e)}},[i,n]),dp(()=>{let e=c.current?r.get(c.current):null;null!=e&&l(e)},[r]),M.useMemo(()=>({ref:u,index:null==o?-1:o}),[o,u])}();return(0,U.jsxs)("div",{className:(0,h5.A)("str-video__dropdown-option",{"str-video__dropdown-option--selected":t}),ref:a,...r({onClick:()=>s(o)}),children:[n&&(0,U.jsx)(pp,{className:"str-video__dropdown-icon",icon:n}),(0,U.jsx)("span",{className:"str-video__dropdown-label",children:i})]})},pG=e=>{let{children:t,icon:i,handleSelect:n,defaultSelectedLabel:r,defaultSelectedIndex:s}=e;return(0,U.jsx)(pq,{icon:i,handleSelect:n,defaultSelectedIndex:s,defaultSelectedLabel:r,children:t})},pJ=({disabled:e,id:t,label:i,onChange:n,name:r,selected:s,defaultChecked:a,value:o})=>(0,U.jsxs)("label",{className:(0,h5.A)("str-video__device-settings__option",{"str-video__device-settings__option--selected":s,"str-video__device-settings__option--disabled":e}),htmlFor:t,children:[(0,U.jsx)("input",{type:"radio",name:r,onChange:n,value:o,id:t,checked:s,defaultChecked:a,disabled:e}),i]}),pK=e=>{let{devices:t=[],selectedDeviceId:i,title:n,type:r,onChange:s}=e,{close:a}=pl(),{deviceList:o}=pa(t,i);return(0,U.jsxs)("div",{className:"str-video__device-settings__device-kind",children:[n&&(0,U.jsx)("div",{className:"str-video__device-settings__device-selector-title",children:n}),o.map(e=>(0,U.jsx)(pJ,{id:`${r}--${e.deviceId}`,value:e.deviceId,label:e.label,onChange:e=>{let t=e.target.value;"default"!==t&&s?.(t),a?.()},name:r,selected:e.isSelected},e.deviceId))]})},pz=e=>{let{devices:t=[],selectedDeviceId:i,title:n,onChange:r,icon:s}=e,{deviceList:a,selectedDeviceInfo:o,selectedIndex:l}=pa(t,i),c=(0,M.useCallback)(e=>{let t=a[e].deviceId;"default"!==t&&r?.(t)},[a,r]);return(0,U.jsxs)("div",{className:"str-video__device-settings__device-kind",children:[(0,U.jsx)("div",{className:"str-video__device-settings__device-selector-title",children:n}),(0,U.jsx)(pG,{icon:s,defaultSelectedIndex:l,defaultSelectedLabel:o.label,handleSelect:c,children:a.map(e=>(0,U.jsx)(pW,{icon:s,label:e.label,selected:e.isSelected},e.deviceId))})]})},pY=e=>{let{visualType:t="list",icon:i,...n}=e;return"list"===t?(0,U.jsx)(pK,{...n}):(0,U.jsx)(pz,{...n,icon:i})},pX=({title:e,visualType:t})=>{let{useMicrophoneState:i}=c2(),{microphone:n,selectedDevice:r,devices:s}=i();return(0,U.jsx)(pY,{devices:s||[],selectedDeviceId:r,type:"audioinput",onChange:async e=>{await n.select(e)},title:e,visualType:t,icon:"mic"})},pZ=({title:e,visualType:t})=>{let{useCameraState:i}=c2(),{camera:n,devices:r,selectedDevice:s}=i();return(0,U.jsx)(pY,{devices:r||[],type:"videoinput",selectedDeviceId:s,onChange:async e=>{await n.select(e)},title:e,visualType:t,icon:"camera"})};(0,M.forwardRef)(function({menuShown:e},t){let{t:i}=cH();return(0,U.jsx)(pT,{className:(0,h5.A)("str-video__device-settings__button",{"str-video__device-settings__button--active":e}),title:i("Toggle device menu"),icon:"device-settings",ref:t})});let pQ=e=>{let{t}=cH(),{caption:i,Menu:n=(0,U.jsx)(pX,{visualType:"list"}),menuPlacement:r="top",onMenuToggle:s,...a}=e,{hasPermission:o,requestPermission:l,isAwaitingPermission:c}=ps(i2.SEND_AUDIO),{useMicrophoneState:u}=c2(),{microphone:d,optimisticIsMute:h,hasBrowserPermission:p,isPromptingPermission:f}=u(),[m,g]=(0,M.useState)(!1),v=pV(e,async()=>{o?await d.toggle():await l()});return(0,U.jsx)(c3,{requiredGrants:[i2.SEND_AUDIO],children:(0,U.jsx)(pI,{permission:i2.SEND_AUDIO,isAwaitingApproval:c,messageApproved:t("You can now speak."),messageAwaitingApproval:t("Awaiting for an approval to speak."),messageRevoked:t("You can no longer speak."),children:(0,U.jsx)(pD,{title:o?p?i??t("Mic"):t("Check your browser mic permissions"):t("You have no permission to share your audio"),tooltipDisabled:m,children:(0,U.jsxs)(pE,{active:h,caption:i,variant:"secondary",disabled:!p||!o,"data-testid":h?"audio-unmute-button":"audio-mute-button",onClick:v,Menu:n,menuPlacement:r,menuOffset:16,...a,onMenuToggle:e=>{g(e),s?.(e)},children:[(0,U.jsx)(pp,{icon:h?"mic-off":"mic"}),(!p||!o)&&(0,U.jsx)("span",{className:"str-video__no-media-permission",children:"!"}),f&&(0,U.jsx)("span",{className:"str-video__pending-permission",title:t("Waiting for permission"),children:"?"})]})})})})},p0=e=>{let{t}=cH(),{caption:i,Menu:n=(0,U.jsx)(pZ,{visualType:"list"}),menuPlacement:r="top",onMenuToggle:s,...a}=e,{hasPermission:o,requestPermission:l,isAwaitingPermission:c}=ps(i2.SEND_VIDEO),{useCameraState:u,useCallSettings:d}=c2(),{camera:h,optimisticIsMute:p,hasBrowserPermission:f,isPromptingPermission:m}=u(),g=d(),v=g?.video.enabled,[b,y]=(0,M.useState)(!1),S=pV(e,async()=>{o?await h.toggle():await l()});return(0,U.jsx)(c3,{requiredGrants:[i2.SEND_VIDEO],children:(0,U.jsx)(pI,{permission:i2.SEND_VIDEO,isAwaitingApproval:c,messageApproved:t("You can now share your video."),messageAwaitingApproval:t("Awaiting for an approval to share your video."),messageRevoked:t("You can no longer share your video."),children:(0,U.jsx)(pD,{title:o?f?v?i||t("Video"):t("Video publishing is disabled by the system"):t("Check your browser video permissions"):t("You have no permission to share your video"),tooltipDisabled:b,children:(0,U.jsxs)(pE,{active:p,caption:i,variant:"secondary",disabled:!f||!o||!v,"data-testid":p?"video-unmute-button":"video-mute-button",onClick:S,Menu:n,menuPlacement:r,menuOffset:16,...a,onMenuToggle:e=>{y(e),s?.(e)},children:[(0,U.jsx)(pp,{icon:p?"camera-off":"camera"}),(!f||!o||!v)&&(0,U.jsx)("span",{className:"str-video__no-media-permission",children:"!"}),m&&(0,U.jsx)("span",{className:"str-video__pending-permission",title:t("Waiting for permission"),children:"?"})]})})})})};(0,M.forwardRef)(function({menuShown:e},t){let{t:i}=cH();return(0,U.jsx)(pD,{title:i("Leave call"),tooltipDisabled:e,children:(0,U.jsx)(pT,{icon:e?"close":"call-end",variant:e?"active":"danger","data-testid":"leave-call-button",ref:t})})});let p1=({disabled:e,caption:t,onClick:i,onLeave:n})=>{let r=cA(),{t:s}=cH(),a=(0,M.useCallback)(async e=>{i?i(e):r&&(await r.leave(),n?.())},[i,n,r]);return(0,U.jsx)(pT,{disabled:e,icon:"call-end",variant:"danger",title:t??s("Leave call"),"data-testid":"cancel-call-button",onClick:a})},p2=({onLeave:e})=>(0,U.jsxs)("div",{className:"str-video__call-controls",children:[(0,U.jsx)(c3,{requiredGrants:[i2.SEND_AUDIO],children:(0,U.jsx)(px,{children:(0,U.jsx)(pQ,{})})}),(0,U.jsx)(c3,{requiredGrants:[i2.SEND_VIDEO],children:(0,U.jsx)(p0,{})}),(0,U.jsx)(c3,{requiredGrants:[i2.CREATE_REACTION],children:(0,U.jsx)(pM,{})}),(0,U.jsx)(c3,{requiredGrants:[i2.SCREENSHARE],children:(0,U.jsx)(pB,{})}),(0,U.jsx)(c3,{requiredGrants:[i2.START_RECORD_CALL,i2.STOP_RECORD_CALL],children:(0,U.jsx)(pA,{})}),(0,U.jsx)(p1,{onLeave:e})]});(0,M.lazy)(()=>i.e(321).then(i.bind(i,48321))),function(e){e.GOOD="Good",e.OK="Ok",e.BAD="Bad"}(O||(O={})),(0,M.forwardRef)(function(e,t){let{t:i}=cH(),{caption:n,menuShown:r}=e;return(0,U.jsx)(pE,{ref:t,active:r,caption:n,title:n||i("Statistics"),"data-testid":"stats-button",children:(0,U.jsx)(pp,{icon:"stats"})})}),(0,M.forwardRef)(function(e,t){return(0,U.jsx)(pT,{enabled:e.menuShown,icon:"ellipsis",ref:t})}),(0,M.forwardRef)(function(e,t){return(0,U.jsx)(pT,{enabled:e.menuShown,icon:"filter",ref:t})}),(0,M.createContext)(null),P.JOINING,P.RINGING,P.MIGRATING,P.RECONNECTING,P.RECONNECTING_FAILED,P.OFFLINE,P.IDLE,P.UNKNOWN,P.JOINED,P.LEFT,(0,M.forwardRef)(function(e,t){let{permissionRequests:i,handleUpdatePermission:n,...r}=e,{t:s}=cH();return(0,U.jsx)("div",{className:"str-video__permission-requests-list",ref:t,...r,children:i.map((e,t)=>{let{user:i,permissions:r}=e;return(0,U.jsx)(M.Fragment,{children:r.map(t=>(0,U.jsxs)("div",{className:"str-video__permission-request",children:[(0,U.jsx)("div",{className:"str-video__permission-request__message",children:p4(i.name||i.id,t,s)}),(0,U.jsx)(p3,{className:"str-video__permission-request__button--allow",type:"button",onClick:n(e,"grant"),children:s("Allow")}),(0,U.jsx)(p3,{className:"str-video__permission-request__button--reject",type:"button",onClick:n(e,"revoke"),children:s("Revoke")}),(0,U.jsx)(p3,{className:"str-video__permission-request__button--reject",type:"button",onClick:n(e,"dismiss"),children:s("Dismiss")})]},t))},`${i.id}/${t}`)})})});let p3=e=>{let{className:t,...i}=e;return(0,U.jsx)("button",{className:(0,h5.A)("str-video__permission-request__button",t),...i})},p4=(e,t,i)=>{switch(t){case i2.SEND_AUDIO:return i("{{ userName }} is requesting to speak",{userName:e});case i2.SEND_VIDEO:return i("{{ userName }} is requesting to share their camera",{userName:e});case i2.SCREENSHARE:return i("{{ userName }} is requesting to present their screen",{userName:e});default:return i("{{ userName }} is requesting permission: {{ permission }}",{userName:e,permission:t})}},p6=({as:e="div",className:t,children:i,...n})=>(0,U.jsx)(e,{...n,className:(0,h5.A)("str-video",t),children:i}),p5=(0,M.forwardRef)(function(e,t){return(0,U.jsx)(pT,{enabled:e.menuShown,icon:"ellipsis",ref:t})}),p9=()=>{let e=cA(),{t}=cH();return(0,U.jsxs)("div",{className:"str-video__screen-share-overlay",children:[(0,U.jsx)(pp,{icon:"screen-share-off"}),(0,U.jsx)("span",{className:"str-video__screen-share-overlay__title",children:t("You are presenting your screen")}),(0,U.jsxs)("button",{onClick:()=>{e?.screenShare.disable()},className:"str-video__screen-share-overlay__button",children:[(0,U.jsx)(pp,{icon:"close"})," ",t("Stop Screen Sharing")]})]})},p8=({indicatorsVisible:e=!0,menuPlacement:t="bottom-start",showMenuButton:i=!0,ParticipantActionsContextMenu:n=pm})=>{let{participant:r,trackType:s}=pe(),a=aS(r);return r.isLocalParticipant&&a&&"screenShareTrack"===s?(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(p9,{}),(0,U.jsx)(p7,{indicatorsVisible:e})]}):(0,U.jsxs)(U.Fragment,{children:[i&&(0,U.jsx)(pu,{strategy:"fixed",placement:t,ToggleButton:p5,children:(0,U.jsx)(n,{})}),(0,U.jsx)(pL,{participant:r}),(0,U.jsx)(p7,{indicatorsVisible:e})]})},p7=({indicatorsVisible:e=!0})=>{let{participant:t}=pe(),{isLocalParticipant:i,connectionQuality:n,pin:r,sessionId:s,name:a,userId:o}=t,l=cA(),{t:c}=cH(),u=!!n&&nY.ConnectionQuality[n].toLowerCase(),d=ay(t),h=ab(t),p=!!r&&r.isLocalPin;return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)("div",{className:"str-video__participant-details",children:(0,U.jsxs)("span",{className:"str-video__participant-details__name",children:[a||o,e&&!d&&(0,U.jsx)("span",{className:"str-video__participant-details__name--audio-muted"}),e&&!h&&(0,U.jsx)("span",{className:"str-video__participant-details__name--video-muted"}),e&&p&&(0,U.jsx)("span",{title:c("Unpin"),onClick:()=>l?.unpin(s),className:"str-video__participant-details__name--pinned"}),e&&(0,U.jsx)(fe,{})]})}),e&&(0,U.jsx)(pR,{isVisible:i&&n===nY.ConnectionQuality.POOR,message:c("Poor connection quality"),children:u&&(0,U.jsx)("span",{className:(0,h5.A)("str-video__participant-details__connection-quality",`str-video__participant-details__connection-quality--${u}`),title:u})})]})},fe=()=>{let{participant:e}=pe(),{isSpeaking:t,isDominantSpeaker:i}=e;return(0,U.jsxs)("span",{className:(0,h5.A)("str-video__speech-indicator",t&&"str-video__speech-indicator--speaking",i&&"str-video__speech-indicator--dominant"),children:[(0,U.jsx)("span",{className:"str-video__speech-indicator__bar"}),(0,U.jsx)("span",{className:"str-video__speech-indicator__bar"}),(0,U.jsx)("span",{className:"str-video__speech-indicator__bar"})]})},ft=(0,M.forwardRef)(function({participant:e,trackType:t="videoTrack",mirror:i,muteAudio:n,refs:{setVideoElement:r,setVideoPlaceholderElement:s}={},className:a,VideoPlaceholder:o,PictureInPicturePlaceholder:l,ParticipantViewUI:c=p8},u){let{isLocalParticipant:d,isSpeaking:h,isDominantSpeaker:p,sessionId:f}=e,m=ay(e),g=ab(e),v=aw(e),[b,y]=(0,M.useState)(null),[S,w]=(0,M.useState)(null),[k,C]=(0,M.useState)(null);pC({sessionId:f,trackedElement:b,trackType:t});let{useIncomingVideoSettings:T}=c2(),{isParticipantVideoEnabled:E}=T(),_=(0,M.useMemo)(()=>({participant:e,participantViewElement:b,videoElement:S,videoPlaceholderElement:k,trackType:t}),[S,k,e,b,t]),R=(0,M.useMemo)(()=>({setVideoElement:e=>{r?.(e),w(e)},setVideoPlaceholderElement:e=>{s?.(e),C(e)}}),[r,s]);return(0,U.jsx)("div",{"data-testid":"participant-view",ref:e=>{pv(u,e),y(e)},className:(0,h5.A)("str-video__participant-view",p&&"str-video__participant-view--dominant-speaker",h&&"str-video__participant-view--speaking",!g&&"str-video__participant-view--no-video",!m&&"str-video__participant-view--no-audio",a),children:(0,U.jsxs)(h7.Provider,{value:_,children:[!d&&!n&&(0,U.jsxs)(U.Fragment,{children:[m&&(0,U.jsx)(h9,{participant:e,trackType:"audioTrack"}),v&&(0,U.jsx)(h9,{participant:e,trackType:"screenShareAudioTrack"})]}),(0,U.jsx)(pk,{VideoPlaceholder:o,PictureInPicturePlaceholder:l,participant:e,trackType:t,refs:R,enabled:d||"videoTrack"!==t||E(e.sessionId),mirror:i,autoPlay:!0}),pg(c)?(0,U.jsx)(c,{}):c]})})});ft.displayName="ParticipantView";let fi=e=>{let{call:t,children:i}=e;return(0,U.jsx)(cD.Provider,{value:t,children:i})};fi.displayName="StreamCall";let fn={en:{Joining:"Joining",Mic:"Mic","No internet connection":"No internet connection","Re-connecting":"Re-connecting",Ringing:"Ringing","Screen Share":"Screen Share","Select a Camera":"Select a Camera","Select a Mic":"Select a Mic","Select Speakers":"Select Speakers",Speakers:"Speakers",Video:"Video","You are muted. Unmute to speak.":"You are muted. Unmute to speak.",Live:"Live","Livestream starts soon":"Livestream starts soon","Livestream starts at {{ startsAt }}":"Livestream starts at {{ startsAt, datetime }}","{{ count }} participants joined early_one":"{{ count }} participant joined early","{{ count }} participants joined early_other":"{{ count }} participants joined early","You can now speak.":"You can now speak.","Awaiting for an approval to speak.":"Awaiting for an approval to speak.","You can no longer speak.":"You can no longer speak.","You can now share your video.":"You can now share your video.","Awaiting for an approval to share your video.":"Awaiting for an approval to share your video.","You can no longer share your video.":"You can no longer share your video.","Waiting for recording to stop...":"Waiting for recording to stop...","Waiting for recording to start...":"Waiting for recording to start...","Record call":"Record call",Reactions:"Reactions",Statistics:"Statistics","You can now share your screen.":"You can now share your screen.","Awaiting for an approval to share screen.":"Awaiting for an approval to share screen.","You can no longer share your screen.":"You can no longer share your screen.","Share screen":"Share screen","Incoming Call...":"Incoming Call...","Calling...":"Calling...","Mute All":"Mute All",Invite:"Invite",Join:"Join",You:"You",Me:"Me",Unknown:"Unknown","Toggle device menu":"Toggle device menu",Default:"Default","Call Recordings":"Call Recordings",Refresh:"Refresh","Check your browser video permissions":"Check your browser video permissions","Video publishing is disabled by the system":"Video publishing is disabled by the system","You have no permission to share your video":"You have no permission to share your video","You have no permission to share your audio":"You have no permission to share your audio","You are presenting your screen":"You are presenting your screen","Stop Screen Sharing":"Stop Screen Sharing",Allow:"Allow",Revoke:"Revoke",Dismiss:"Dismiss","Microphone on":"Microphone on","Microphone off":"Microphone off","Camera on":"Camera on","Camera off":"Camera off","No camera found":"No camera found","Video is disabled":"Video is disabled",Pinned:"Pinned",Unpin:"Unpin",Pin:"Pin","Pin for everyone":"Pin for everyone","Unpin for everyone":"Unpin for everyone",Block:"Block","Turn off video":"Turn off video","Turn off screen share":"Turn off screen share","Mute audio":"Mute audio","Mute screen share audio":"Mute screen share audio","Allow audio":"Allow audio","Allow video":"Allow video","Allow screen sharing":"Allow screen sharing","Disable audio":"Disable audio","Disable video":"Disable video","Disable screen sharing":"Disable screen sharing",Enter:"Enter",Leave:"Leave","Leave call":"Leave call","End call for all":"End call for all","{{ direction }} fullscreen":"{{ direction }} fullscreen","{{ direction }} picture-in-picture":"{{ direction }} picture-in-picture","Dominant Speaker":"Dominant Speaker","Poor connection quality":"Poor connection quality. Please check your internet connection.",Participants:"Participants",Anonymous:", and ({{ count }}) anonymous","No participants found":"No participants found","Participants ({{ numberOfParticipants }})":"Participants ({{ numberOfParticipants }})","{{ userName }} is sharing their screen":"{{ userName }} is sharing their screen","{{ userName }} is requesting to speak":"{{ userName }} is requesting to speak","{{ userName }} is requesting to share their camera":"{{ userName }} is requesting to share their camera","{{ userName }} is requesting to present their screen":"{{ userName }} is requesting to present their screen","{{ userName }} is requesting permission: {{ permission }}":"{{ userName }} is requesting permission: {{ permission }}"}},fr=e=>(0,U.jsx)(cW,{translationsOverrides:fn,...e});fr.displayName="StreamVideo";let fs=({excludeLocalParticipant:e=!1,filterParticipants:t})=>{let{useParticipants:i,useRemoteParticipants:n}=c2(),r=i(),s=n();return(0,M.useMemo)(()=>{let i=e?s:r;return t?fa(i,t):i},[r,s,e,t])},fa=(e,t)=>{let i="function"==typeof t?t:e=>(function e(t,i){return"$and"in i?i.$and.every(i=>e(t,i)):"$or"in i?i.$or.some(i=>e(t,i)):"$not"in i?!e(t,i.$not):function(e,t){let i=!0;for(let n of Object.keys(t)){let r=t[n],s=r&&"object"==typeof r,a=e[n];if(s&&"$eq"in r?i&&(i=r.$eq===a):s&&"$neq"in r?i&&(i=r.$neq!==a):s&&"$in"in r?i&&(i=r.$in.includes(a)):s&&"$contains"in r?Array.isArray(a)?i&&(i=a.includes(r.$contains)):i=!1:i&&(i=r===a),!i)return!1}return!0}(t,i)})({userId:e.userId,isSpeaking:e.isSpeaking,isDominantSpeaker:e.isDominantSpeaker,name:e.name,roles:e.roles,isPinned:ak(e),hasVideo:ab(e),hasAudio:ay(e)},t);return e.filter(i)},fo=(e,t)=>{(0,M.useEffect)(()=>{if(e)return t?e.setSortParticipantsBy(ag(aE,fc)):e.setSortParticipantsBy(aA),()=>{fl(e)}},[e,t])},fl=e=>{let t=o7.get(e.type);e.setSortParticipantsBy(t.options.sortParticipantsBy||aD)},fc=(e,t)=>e.isLocalParticipant?1:t.isLocalParticipant?-1:0,fu=()=>{let{useIsCallLive:e,useCallSession:t}=c2(),i=e(),n=t(),[r,s]=(0,M.useState)(()=>{if(!n||!n.live_started_at)return 0;let e=new Date(n.live_started_at);return Math.floor((new Date().getTime()-e.getTime())/1e3)});return(0,M.useEffect)(()=>{if(!i)return;let e=setInterval(()=>{s(e=>e+1)},1e3);return()=>{clearInterval(e)}},[i]),r},fd=()=>{let{participantViewElement:e}=pe(),[t,i]=(0,M.useState)(!1);return(0,M.useCallback)(()=>{t?document.exitFullscreen().then(()=>{i(!1)}):e?.requestFullscreen().then(()=>{i(!0)})},[t,e])},fh=e=>{let t=Math.floor(e/86400),i=Math.floor(e/3600),n=Math.floor(e%3600/60),r=e%60;return`${t?t+" ":""}${i?i+":":""}${n<10?"0":""}${n}:${r<10?"0":""}${r}`},fp=(e,t,i)=>{let[n,r]=(0,M.useState)({vertical:"number"==typeof i?i:null,horizontal:"number"==typeof i?i:null});return(0,M.useEffect)(()=>{if(!t||!e||"number"==typeof i||void 0===i)return;let n=null,s=null,a=new ResizeObserver((i,a)=>{if(i.length>1){let e=t.firstChild;e&&(s=e.clientHeight,n=e.clientWidth,a.unobserve(t))}if(null===s||null===n)return;let o=Math.floor(e.clientHeight/s),l=Math.floor(e.clientWidth/n);r(e=>e.vertical!==o||e.horizontal!==l?{vertical:o,horizontal:l}:e)});return a.observe(e),a.observe(t),()=>{a.disconnect()}},[t,i,e]),n},ff=()=>(0,U.jsx)(p8,{menuPlacement:"top-end"}),fm=({ParticipantViewUIBar:e=ff,ParticipantViewUISpotlight:t=p8,VideoPlaceholder:i,PictureInPicturePlaceholder:n,participantsBarPosition:r="bottom",participantsBarLimit:s,mirrorLocalParticipantVideo:a=!0,excludeLocalParticipant:o=!1,filterParticipants:l,pageArrowsVisible:c=!0,muted:u})=>{let d=cA(),{useParticipants:h,useRemoteParticipants:p}=c2(),f=h(),m=p(),[g,...v]=fs({excludeLocalParticipant:o,filterParticipants:l}),[b,y]=(0,M.useState)(null),[S,w]=(0,M.useState)(null),[k,C]=(0,M.useState)(null),T=g&&aS(g),E=fp(k,S,s),_="left"===r||"right"===r,R="top"===r||"bottom"===r;(0,M.useEffect)(()=>{if(!b||!d)return;let e=d.setViewport(b);return()=>e()},[b,d]),fo(d,2===f.length);let I=v,x=_?E.vertical:E.horizontal;void 0!==s&&null!==x&&(I=v.slice(0,x-!!T));let P=!!a&&void 0;if(!d)return null;let N=r&&(I.length>0||T);return(0,U.jsxs)("div",{className:"str-video__speaker-layout__wrapper",children:[!u&&(0,U.jsx)(h8,{participants:m}),(0,U.jsxs)("div",{className:(0,h5.A)("str-video__speaker-layout",r&&`str-video__speaker-layout--variant-${r}`),children:[(0,U.jsx)("div",{className:"str-video__speaker-layout__spotlight",children:g&&(0,U.jsx)(ft,{participant:g,muteAudio:!0,mirror:P,trackType:T?"screenShareTrack":"videoTrack",ParticipantViewUI:t,VideoPlaceholder:i,PictureInPicturePlaceholder:n})}),N&&(0,U.jsxs)("div",{ref:C,className:"str-video__speaker-layout__participants-bar-buttons-wrapper",children:[(0,U.jsx)("div",{className:"str-video__speaker-layout__participants-bar-wrapper",ref:y,children:(0,U.jsxs)("div",{ref:w,className:"str-video__speaker-layout__participants-bar",children:[T&&(0,U.jsx)("div",{className:"str-video__speaker-layout__participant-tile",children:(0,U.jsx)(ft,{participant:g,ParticipantViewUI:e,VideoPlaceholder:i,PictureInPicturePlaceholder:n,mirror:P,muteAudio:!0})},g.sessionId),I.map(t=>(0,U.jsx)("div",{className:"str-video__speaker-layout__participant-tile",children:(0,U.jsx)(ft,{participant:t,ParticipantViewUI:e,VideoPlaceholder:i,PictureInPicturePlaceholder:n,mirror:P,muteAudio:!0})},t.sessionId))]})}),c&&_&&(0,U.jsx)(fv,{scrollWrapper:b}),c&&R&&(0,U.jsx)(fg,{scrollWrapper:b})]})]})]})};fm.displayName="SpeakerLayout";let fg=({scrollWrapper:e})=>{let t=pr(e);return(0,U.jsxs)(U.Fragment,{children:[t&&"start"!==t&&(0,U.jsx)(pT,{onClick:()=>{e?.scrollBy({left:-150,behavior:"smooth"})},icon:"caret-left",className:"str-video__speaker-layout__participants-bar--button-left"}),t&&"end"!==t&&(0,U.jsx)(pT,{onClick:()=>{e?.scrollBy({left:150,behavior:"smooth"})},icon:"caret-right",className:"str-video__speaker-layout__participants-bar--button-right"})]})},fv=({scrollWrapper:e})=>{let t=pn(e);return(0,U.jsxs)(U.Fragment,{children:[t&&"top"!==t&&(0,U.jsx)(pT,{onClick:()=>{e?.scrollBy({top:-150,behavior:"smooth"})},icon:"caret-up",className:"str-video__speaker-layout__participants-bar--button-top"}),t&&"bottom"!==t&&(0,U.jsx)(pT,{onClick:()=>{e?.scrollBy({top:150,behavior:"smooth"})},icon:"caret-down",className:"str-video__speaker-layout__participants-bar--button-bottom"})]})},[fb,fy,fS]="1.18.1".split(".");a0={type:nY.SdkType.REACT,major:fb,minor:fy,patch:fS};var fw=i(37590),fk=i(74810);function fC(){(0,$.useParams)().id;let e=(0,$.useRouter)(),[t,i]=(0,M.useState)(null),[n,r]=(0,M.useState)(null),[s,a]=(0,M.useState)(!0),[o,l]=(0,M.useState)(null),{data:c,status:u}=(0,V.useSession)();return(c?.user,"loading"===u||s)?(0,U.jsx)(fk.A,{}):(0,U.jsx)("div",{className:"h-screen w-screen bg-black relative overflow-hidden",children:t&&n?(0,U.jsx)(fr,{client:t,children:(0,U.jsx)(fi,{call:n,children:(0,U.jsx)(fT,{})})}):(0,U.jsx)("div",{className:"h-full flex items-center justify-center text-white",children:(0,U.jsxs)("div",{className:"text-center",children:[(0,U.jsx)("div",{className:"loading loading-spinner loading-lg mb-4"}),(0,U.jsx)("p",{className:"text-lg",children:"Could not initialize call"}),(0,U.jsx)("p",{className:"text-sm opacity-70 mb-4",children:"Please refresh or try again later"}),(0,U.jsx)("button",{onClick:()=>e.push("/"),className:"btn btn-outline btn-sm",children:"Go Back Home"})]})})})}i(68265);let fT=()=>{let{useCallCallingState:e}=c2(),t=e(),i=(0,$.useRouter)();return((0,M.useEffect)(()=>{t===P.LEFT&&(console.log("\uD83D\uDCDE Call ended, redirecting home..."),fw.Ay.success("Call ended"),i.push("/"))},[t,i]),t===P.LEFT)?(0,U.jsx)("div",{className:"h-screen flex items-center justify-center bg-base-100",children:(0,U.jsxs)("div",{className:"text-center",children:[(0,U.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Call Ended"}),(0,U.jsx)("p",{className:"text-base-content opacity-70 mb-4",children:"Redirecting you back..."}),(0,U.jsx)("div",{className:"loading loading-spinner loading-lg"})]})}):(0,U.jsx)(p6,{className:"h-full",children:(0,U.jsxs)("div",{className:"relative h-full",children:[(0,U.jsx)(fm,{}),(0,U.jsx)("div",{className:"absolute bottom-6 left-1/2 transform -translate-x-1/2 z-10",children:(0,U.jsx)(p2,{})})]})})}},10699:(e,t,i)=>{Promise.resolve().then(i.bind(i,5190))},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12412:e=>{"use strict";e.exports=require("assert")},13147:(e,t,i)=>{var n=i(94339),r=/%[sdv%]/g,s=function(e){var t=1,i=arguments,n=i.length;return e.replace(r,function(e){if(t>=n)return e;var r=i[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(r);case"%d":return Number(r);case"%v":return""}})},a=function(e,t,i){var n=[e+"="+(t.format instanceof Function?t.format(t.push?i:i[t.name]):t.format)];if(t.names)for(var r=0;r<t.names.length;r+=1){var a=t.names[r];t.name?n.push(i[t.name][a]):n.push(i[t.names[r]])}else n.push(i[t.name]);return s.apply(null,n)},o=["v","o","s","i","u","e","p","c","b","t","r","z","a"],l=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var i=t.outerOrder||o,r=t.innerOrder||l,s=[];return i.forEach(function(t){n[t].forEach(function(i){i.name in e&&null!=e[i.name]?s.push(a(t,i,e)):i.push in e&&null!=e[i.push]&&e[i.push].forEach(function(e){s.push(a(t,i,e))})})}),e.media.forEach(function(e){s.push(a("m",n.m[0],e)),r.forEach(function(t){n[t].forEach(function(i){i.name in e&&null!=e[i.name]?s.push(a(t,i,e)):i.push in e&&null!=e[i.push]&&e[i.push].forEach(function(e){s.push(a(t,i,e))})})})}),s.join("\r\n")+"\r\n"}},13755:(e,t,i)=>{var n=function(e){return String(Number(e))===e?Number(e):e},r=function(e,t,i,r){if(r&&!i)t[r]=n(e[1]);else for(var s=0;s<i.length;s+=1)null!=e[s+1]&&(t[i[s]]=n(e[s+1]))},s=function(e,t,i){var n=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:n&&!t[e.name]&&(t[e.name]={});var s=e.push?{}:n?t[e.name]:t;r(i.match(e.reg),s,e.names,e.name),e.push&&t[e.push].push(s)},a=i(94339),o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},i=[],n=t;return e.split(/(\r\n|\r|\n)/).filter(o).forEach(function(e){var t=e[0],r=e.slice(2);"m"===t&&(i.push({rtp:[],fmtp:[]}),n=i[i.length-1]);for(var o=0;o<(a[t]||[]).length;o+=1){var l=a[t][o];if(l.reg.test(r))return s(l,n,r)}}),t.media=i,t};var l=function(e,t){var i=t.split(/=(.+)/,2);return 2===i.length?e[i[0]]=n(i[1]):1===i.length&&t.length>1&&(e[i[0]]=void 0),e};t.parseParams=function(e){return e.split(/;\s?/).reduce(l,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],i=e.split(" ").map(n),r=0;r<i.length;r+=3)t.push({component:i[r],ip:i[r+1],port:i[r+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(l,{})})},t.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,i=!1;return"~"!==e[0]?t=n(e):(t=n(e.substring(1,e.length)),i=!0),{scid:t,paused:i}})})}},18567:function(e,t,i){var n;!function(r,s){"use strict";var a="function",o="undefined",l="object",c="string",u="major",d="model",h="name",p="type",f="vendor",m="version",g="architecture",v="console",b="mobile",y="tablet",S="smarttv",w="wearable",k="embedded",C="Amazon",T="Apple",E="ASUS",_="BlackBerry",R="Browser",I="Chrome",x="Firefox",P="Google",N="Huawei",O="Microsoft",D="Motorola",A="Opera",j="Samsung",L="Sharp",U="Sony",M="Xiaomi",F="Zebra",$="Facebook",V="Chromium OS",B="Mac OS",H=" Browser",q=function(e,t){var i={};for(var n in e)t[n]&&t[n].length%2==0?i[n]=t[n].concat(e[n]):i[n]=e[n];return i},W=function(e){for(var t={},i=0;i<e.length;i++)t[e[i].toUpperCase()]=e[i];return t},G=function(e,t){return typeof e===c&&-1!==J(t).indexOf(J(e))},J=function(e){return e.toLowerCase()},K=function(e,t){if(typeof e===c)return e=e.replace(/^\s\s*/,""),typeof t===o?e:e.substring(0,500)},z=function(e,t){for(var i,n,r,o,c,u,d=0;d<t.length&&!c;){var h=t[d],p=t[d+1];for(i=n=0;i<h.length&&!c&&h[i];)if(c=h[i++].exec(e))for(r=0;r<p.length;r++)u=c[++n],typeof(o=p[r])===l&&o.length>0?2===o.length?typeof o[1]==a?this[o[0]]=o[1].call(this,u):this[o[0]]=o[1]:3===o.length?typeof o[1]!==a||o[1].exec&&o[1].test?this[o[0]]=u?u.replace(o[1],o[2]):void 0:this[o[0]]=u?o[1].call(this,u,o[2]):void 0:4===o.length&&(this[o[0]]=u?o[3].call(this,u.replace(o[1],o[2])):s):this[o]=u||s;d+=2}},Y=function(e,t){for(var i in t)if(typeof t[i]===l&&t[i].length>0){for(var n=0;n<t[i].length;n++)if(G(t[i][n],e))return"?"===i?s:i}else if(G(t[i],e))return"?"===i?s:i;return t.hasOwnProperty("*")?t["*"]:e},X={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Z={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[m,[h,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[m,[h,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[h,m],[/opios[\/ ]+([\w\.]+)/i],[m,[h,A+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[m,[h,A+" GX"]],[/\bopr\/([\w\.]+)/i],[m,[h,A]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[m,[h,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[m,[h,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[h,m],[/quark(?:pc)?\/([-\w\.]+)/i],[m,[h,"Quark"]],[/\bddg\/([\w\.]+)/i],[m,[h,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[m,[h,"UC"+R]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[m,[h,"WeChat"]],[/konqueror\/([\w\.]+)/i],[m,[h,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[m,[h,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[m,[h,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[m,[h,"Smart Lenovo "+R]],[/(avast|avg)\/([\w\.]+)/i],[[h,/(.+)/,"$1 Secure "+R],m],[/\bfocus\/([\w\.]+)/i],[m,[h,x+" Focus"]],[/\bopt\/([\w\.]+)/i],[m,[h,A+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[m,[h,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[m,[h,"Dolphin"]],[/coast\/([\w\.]+)/i],[m,[h,A+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[m,[h,"MIUI"+H]],[/fxios\/([\w\.-]+)/i],[m,[h,x]],[/\bqihoobrowser\/?([\w\.]*)/i],[m,[h,"360"]],[/\b(qq)\/([\w\.]+)/i],[[h,/(.+)/,"$1Browser"],m],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[h,/(.+)/,"$1"+H],m],[/samsungbrowser\/([\w\.]+)/i],[m,[h,j+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[m,[h,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[h,"Sogou Mobile"],m],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[h,m],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[h],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[m,h],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[h,$],m],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[h,m],[/\bgsa\/([\w\.]+) .*safari\//i],[m,[h,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[m,[h,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[m,[h,I+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[h,I+" WebView"],m],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[m,[h,"Android "+R]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[h,m],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[m,[h,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[m,h],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[h,[m,Y,{"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[h,m],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[h,"Netscape"],m],[/(wolvic|librewolf)\/([\w\.]+)/i],[h,m],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[m,[h,x+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[h,[m,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[h,[m,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[g,"amd64"]],[/(ia32(?=;))/i],[[g,J]],[/((?:i[346]|x)86)[;\)]/i],[[g,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[g,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[g,"armhf"]],[/windows (ce|mobile); ppc;/i],[[g,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[g,/ower/,"",J]],[/(sun4\w)[;\)]/i],[[g,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[g,J]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[d,[f,j],[p,y]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[d,[f,j],[p,b]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[d,[f,T],[p,b]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[d,[f,T],[p,y]],[/(macintosh);/i],[d,[f,T]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[d,[f,L],[p,b]],[/(?:honor)([-\w ]+)[;\)]/i],[d,[f,"Honor"],[p,b]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[d,[f,N],[p,y]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[d,[f,N],[p,b]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[d,/_/g," "],[f,M],[p,b]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[d,/_/g," "],[f,M],[p,y]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[d,[f,"OPPO"],[p,b]],[/\b(opd2\d{3}a?) bui/i],[d,[f,"OPPO"],[p,y]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[d,[f,"Vivo"],[p,b]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[d,[f,"Realme"],[p,b]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[d,[f,D],[p,b]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[d,[f,D],[p,y]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[d,[f,"LG"],[p,y]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[d,[f,"LG"],[p,b]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[d,[f,"Lenovo"],[p,y]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[d,/_/g," "],[f,"Nokia"],[p,b]],[/(pixel c)\b/i],[d,[f,P],[p,y]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[d,[f,P],[p,b]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[d,[f,U],[p,b]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[d,"Xperia Tablet"],[f,U],[p,y]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[d,[f,"OnePlus"],[p,b]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[d,[f,C],[p,y]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[d,/(.+)/g,"Fire Phone $1"],[f,C],[p,b]],[/(playbook);[-\w\),; ]+(rim)/i],[d,f,[p,y]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[d,[f,_],[p,b]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[d,[f,E],[p,y]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[d,[f,E],[p,b]],[/(nexus 9)/i],[d,[f,"HTC"],[p,y]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[f,[d,/_/g," "],[p,b]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[d,[f,"TCL"],[p,y]],[/(itel) ((\w+))/i],[[f,J],d,[p,Y,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[d,[f,"Acer"],[p,y]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[d,[f,"Meizu"],[p,b]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[d,[f,"Ulefone"],[p,b]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[d,[f,"Energizer"],[p,b]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[d,[f,"Cat"],[p,b]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[d,[f,"Smartfren"],[p,b]],[/droid.+; (a(?:015|06[35]|142p?))/i],[d,[f,"Nothing"],[p,b]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[f,d,[p,b]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[f,d,[p,y]],[/(surface duo)/i],[d,[f,O],[p,y]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[d,[f,"Fairphone"],[p,b]],[/(u304aa)/i],[d,[f,"AT&T"],[p,b]],[/\bsie-(\w*)/i],[d,[f,"Siemens"],[p,b]],[/\b(rct\w+) b/i],[d,[f,"RCA"],[p,y]],[/\b(venue[\d ]{2,7}) b/i],[d,[f,"Dell"],[p,y]],[/\b(q(?:mv|ta)\w+) b/i],[d,[f,"Verizon"],[p,y]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[d,[f,"Barnes & Noble"],[p,y]],[/\b(tm\d{3}\w+) b/i],[d,[f,"NuVision"],[p,y]],[/\b(k88) b/i],[d,[f,"ZTE"],[p,y]],[/\b(nx\d{3}j) b/i],[d,[f,"ZTE"],[p,b]],[/\b(gen\d{3}) b.+49h/i],[d,[f,"Swiss"],[p,b]],[/\b(zur\d{3}) b/i],[d,[f,"Swiss"],[p,y]],[/\b((zeki)?tb.*\b) b/i],[d,[f,"Zeki"],[p,y]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[f,"Dragon Touch"],d,[p,y]],[/\b(ns-?\w{0,9}) b/i],[d,[f,"Insignia"],[p,y]],[/\b((nxa|next)-?\w{0,9}) b/i],[d,[f,"NextBook"],[p,y]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[f,"Voice"],d,[p,b]],[/\b(lvtel\-)?(v1[12]) b/i],[[f,"LvTel"],d,[p,b]],[/\b(ph-1) /i],[d,[f,"Essential"],[p,b]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[d,[f,"Envizen"],[p,y]],[/\b(trio[-\w\. ]+) b/i],[d,[f,"MachSpeed"],[p,y]],[/\btu_(1491) b/i],[d,[f,"Rotor"],[p,y]],[/(shield[\w ]+) b/i],[d,[f,"Nvidia"],[p,y]],[/(sprint) (\w+)/i],[f,d,[p,b]],[/(kin\.[onetw]{3})/i],[[d,/\./g," "],[f,O],[p,b]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[d,[f,F],[p,y]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[d,[f,F],[p,b]],[/smart-tv.+(samsung)/i],[f,[p,S]],[/hbbtv.+maple;(\d+)/i],[[d,/^/,"SmartTV"],[f,j],[p,S]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[f,"LG"],[p,S]],[/(apple) ?tv/i],[f,[d,T+" TV"],[p,S]],[/crkey/i],[[d,I+"cast"],[f,P],[p,S]],[/droid.+aft(\w+)( bui|\))/i],[d,[f,C],[p,S]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[d,[f,L],[p,S]],[/(bravia[\w ]+)( bui|\))/i],[d,[f,U],[p,S]],[/(mitv-\w{5}) bui/i],[d,[f,M],[p,S]],[/Hbbtv.*(technisat) (.*);/i],[f,d,[p,S]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[f,K],[d,K],[p,S]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[p,S]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[f,d,[p,v]],[/droid.+; (shield) bui/i],[d,[f,"Nvidia"],[p,v]],[/(playstation [345portablevi]+)/i],[d,[f,U],[p,v]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[d,[f,O],[p,v]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[d,[f,j],[p,w]],[/((pebble))app/i],[f,d,[p,w]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[d,[f,T],[p,w]],[/droid.+; (glass) \d/i],[d,[f,P],[p,w]],[/droid.+; (wt63?0{2,3})\)/i],[d,[f,F],[p,w]],[/droid.+; (glass) \d/i],[d,[f,P],[p,w]],[/(pico) (4|neo3(?: link|pro)?)/i],[f,d,[p,w]],[/; (quest( \d| pro)?)/i],[d,[f,$],[p,w]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[f,[p,k]],[/(aeobc)\b/i],[d,[f,C],[p,k]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[d,[p,b]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[d,[p,y]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[p,y]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[p,b]],[/(android[-\w\. ]{0,9});.+buil/i],[d,[f,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[m,[h,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[h,m],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[m,[h,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[h,m],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[m,h]],os:[[/microsoft (windows) (vista|xp)/i],[h,m],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[h,[m,Y,X]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[m,Y,X],[h,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[m,/_/g,"."],[h,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[h,B],[m,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[m,h],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[h,m],[/\(bb(10);/i],[m,[h,_]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[m,[h,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[m,[h,x+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[m,[h,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[m,[h,"watchOS"]],[/crkey\/([\d\.]+)/i],[m,[h,I+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[h,V],m],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[h,m],[/(sunos) ?([\w\.\d]*)/i],[[h,"Solaris"],m],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[h,m]]},Q=function(e,t){if(typeof e===l&&(t=e,e=s),!(this instanceof Q))return new Q(e,t).getResult();var i=typeof r!==o&&r.navigator?r.navigator:s,n=e||(i&&i.userAgent?i.userAgent:""),v=i&&i.userAgentData?i.userAgentData:s,S=t?q(Z,t):Z,w=i&&i.userAgent==n;return this.getBrowser=function(){var e,t={};return t[h]=s,t[m]=s,z.call(t,n,S.browser),t[u]=typeof(e=t[m])===c?e.replace(/[^\d\.]/g,"").split(".")[0]:s,w&&i&&i.brave&&typeof i.brave.isBrave==a&&(t[h]="Brave"),t},this.getCPU=function(){var e={};return e[g]=s,z.call(e,n,S.cpu),e},this.getDevice=function(){var e={};return e[f]=s,e[d]=s,e[p]=s,z.call(e,n,S.device),w&&!e[p]&&v&&v.mobile&&(e[p]=b),w&&"Macintosh"==e[d]&&i&&typeof i.standalone!==o&&i.maxTouchPoints&&i.maxTouchPoints>2&&(e[d]="iPad",e[p]=y),e},this.getEngine=function(){var e={};return e[h]=s,e[m]=s,z.call(e,n,S.engine),e},this.getOS=function(){var e={};return e[h]=s,e[m]=s,z.call(e,n,S.os),w&&!e[h]&&v&&v.platform&&"Unknown"!=v.platform&&(e[h]=v.platform.replace(/chrome os/i,V).replace(/macos/i,B)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return n},this.setUA=function(e){return n=typeof e===c&&e.length>500?K(e,500):e,this},this.setUA(n),this};Q.VERSION="1.0.40",Q.BROWSER=W([h,m,u]),Q.CPU=W([g]),Q.DEVICE=W([d,f,p,v,b,S,y,w,k]),Q.ENGINE=Q.OS=W([h,m]),typeof t!==o?(e.exports&&(t=e.exports=Q),t.UAParser=Q):i.amdO?s===(n=(function(){return Q}).call(t,i,t,e))||(e.exports=n):typeof r!==o&&(r.UAParser=Q);var ee=typeof r!==o&&(r.jQuery||r.Zepto);if(ee&&!ee.ua){var et=new Q;ee.ua=et.getResult(),ee.ua.get=function(){return et.getUA()},ee.ua.set=function(e){et.setUA(e);var t=et.getResult();for(var i in t)ee.ua[i]=t[i]}}}("object"==typeof window?window:this)},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},21820:e=>{"use strict";e.exports=require("os")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34514:(e,t,i)=>{var n=i(13755);i(13147),i(94339),t.qg=n.parse,n.parseParams,n.parseFmtpConfig,n.parsePayloads,n.parseRemoteCandidates,n.parseImageAttributes,n.parseSimulcastStreamList},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},62529:(e,t,i)=>{"use strict";i.r(t),i.d(t,{GlobalError:()=>a.a,__next_app__:()=>d,pages:()=>u,routeModule:()=>h,tree:()=>c});var n=i(65239),r=i(48088),s=i(88170),a=i.n(s),o=i(30893),l={};for(let e in o)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);i.d(t,l);let c={children:["",{children:["(protected)",{children:["call",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(i.bind(i,5190)),"C:\\Users\\Bruce Vo\\Documents\\project\\linguex\\Streaming_Platform\\frontend\\app\\(protected)\\call\\[id]\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(i.bind(i,96612)),"C:\\Users\\Bruce Vo\\Documents\\project\\linguex\\Streaming_Platform\\frontend\\app\\(protected)\\layout.tsx"],"not-found":[()=>Promise.resolve().then(i.t.bind(i,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(i.t.bind(i,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(i.t.bind(i,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(i.bind(i,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(i.bind(i,58014)),"C:\\Users\\Bruce Vo\\Documents\\project\\linguex\\Streaming_Platform\\frontend\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(i.t.bind(i,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(i.t.bind(i,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(i.t.bind(i,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(i.bind(i,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,u=["C:\\Users\\Bruce Vo\\Documents\\project\\linguex\\Streaming_Platform\\frontend\\app\\(protected)\\call\\[id]\\page.tsx"],d={require:i,loadChunk:()=>Promise.resolve()},h=new n.AppPageRouteModule({definition:{kind:r.RouteKind.APP_PAGE,page:"/(protected)/call/[id]/page",pathname:"/call/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},68265:()=>{},74075:e=>{"use strict";e.exports=require("zlib")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},83997:e=>{"use strict";e.exports=require("tty")},93667:(e,t,i)=>{Promise.resolve().then(i.bind(i,5765))},94082:e=>{"use strict";let t={};t.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map(e=>e.trim())},t.splitSections=function(e){return e.split("\nm=").map((e,t)=>(t>0?"m="+e:e).trim()+"\r\n")},t.getDescription=function(e){let i=t.splitSections(e);return i&&i[0]},t.getMediaSections=function(e){let i=t.splitSections(e);return i.shift(),i},t.matchPrefix=function(e,i){return t.splitLines(e).filter(e=>0===e.indexOf(i))},t.parseCandidate=function(e){let t,i={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case"raddr":i.relatedAddress=t[e+1];break;case"rport":i.relatedPort=parseInt(t[e+1],10);break;case"tcptype":i.tcpType=t[e+1];break;case"ufrag":i.ufrag=t[e+1],i.usernameFragment=t[e+1];break;default:void 0===i[t[e]]&&(i[t[e]]=t[e+1])}return i},t.writeCandidate=function(e){let t=[];t.push(e.foundation);let i=e.component;"rtp"===i?t.push(1):"rtcp"===i?t.push(2):t.push(i),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);let n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" "),i={payloadType:parseInt(t.shift(),10)};return i.name=(t=t[0].split("/"))[0],i.clockRate=parseInt(t[1],10),i.channels=3===t.length?parseInt(t[2],10):1,i.numChannels=i.channels,i},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);let i=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==i?"/"+i:"")+"\r\n"},t.parseExtmap=function(e){let t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){let t,i={},n=e.substring(e.indexOf(" ")+1).split(";");for(let e=0;e<n.length;e++)i[(t=n[e].trim().split("="))[0].trim()]=t[1];return i},t.writeFmtp=function(e){let t="",i=e.payloadType;if(void 0!==e.preferredPayloadType&&(i=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){let n=[];Object.keys(e.parameters).forEach(t=>{void 0!==e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)}),t+="a=fmtp:"+i+" "+n.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){let t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",i=e.payloadType;return void 0!==e.preferredPayloadType&&(i=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(e=>{t+="a=rtcp-fb:"+i+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},t.parseSsrcMedia=function(e){let t=e.indexOf(" "),i={ssrc:parseInt(e.substring(7,t),10)},n=e.indexOf(":",t);return n>-1?(i.attribute=e.substring(t+1,n),i.value=e.substring(n+1)):i.attribute=e.substring(t+1),i},t.parseSsrcGroup=function(e){let t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(e=>parseInt(e,10))}},t.getMid=function(e){let i=t.matchPrefix(e,"a=mid:")[0];if(i)return i.substring(6)},t.parseFingerprint=function(e){let t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,i){return{role:"auto",fingerprints:t.matchPrefix(e+i,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let i="a=setup:"+t+"\r\n";return e.fingerprints.forEach(e=>{i+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),i},t.parseCryptoLine=function(e){let t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;let t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,i){return t.matchPrefix(e+i,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,i){let n=t.matchPrefix(e+i,"a=ice-ufrag:")[0],r=t.matchPrefix(e+i,"a=ice-pwd:")[0];return n&&r?{usernameFragment:n.substring(12),password:r.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){let i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=t.splitLines(e)[0].split(" ");i.profile=n[2];for(let r=3;r<n.length;r++){let s=n[r],a=t.matchPrefix(e,"a=rtpmap:"+s+" ")[0];if(a){let n=t.parseRtpMap(a),r=t.matchPrefix(e,"a=fmtp:"+s+" ");switch(n.parameters=r.length?t.parseFmtp(r[0]):{},n.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+s+" ").map(t.parseRtcpFb),i.codecs.push(n),n.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(n.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach(e=>{i.headerExtensions.push(t.parseExtmap(e))});let r=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return i.codecs.forEach(e=>{r.forEach(t=>{e.rtcpFeedback.find(e=>e.type===t.type&&e.parameter===t.parameter)||e.rtcpFeedback.push(t)})}),i},t.writeRtpDescription=function(e,i){let n="";n+="m="+e+" ",n+=i.codecs.length>0?"9":"0",n+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",n+=i.codecs.map(e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",i.codecs.forEach(e=>{n+=t.writeRtpMap(e),n+=t.writeFmtp(e),n+=t.writeRtcpFb(e)});let r=0;return i.codecs.forEach(e=>{e.maxptime>r&&(r=e.maxptime)}),r>0&&(n+="a=maxptime:"+r+"\r\n"),i.headerExtensions&&i.headerExtensions.forEach(e=>{n+=t.writeExtmap(e)}),n},t.parseRtpEncodingParameters=function(e){let i,n=[],r=t.parseRtpParameters(e),s=-1!==r.fecMechanisms.indexOf("RED"),a=-1!==r.fecMechanisms.indexOf("ULPFEC"),o=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute),l=o.length>0&&o[0].ssrc,c=t.matchPrefix(e,"a=ssrc-group:FID").map(e=>e.substring(17).split(" ").map(e=>parseInt(e,10)));c.length>0&&c[0].length>1&&c[0][0]===l&&(i=c[0][1]),r.codecs.forEach(e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:l,codecPayloadType:parseInt(e.parameters.apt,10)};l&&i&&(t.rtx={ssrc:i}),n.push(t),s&&((t=JSON.parse(JSON.stringify(t))).fec={ssrc:l,mechanism:a?"red+ulpfec":"red"},n.push(t))}}),0===n.length&&l&&n.push({ssrc:l});let u=t.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substring(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substring(5),10)*.95-16e3:void 0,n.forEach(e=>{e.maxBitrate=u})),n},t.parseRtcpParameters=function(e){let i={},n=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute)[0];n&&(i.cname=n.value,i.ssrc=n.ssrc);let r=t.matchPrefix(e,"a=rtcp-rsize");return i.reducedSize=r.length>0,i.compound=0===r.length,i.mux=t.matchPrefix(e,"a=rtcp-mux").length>0,i},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let i,n=t.matchPrefix(e,"a=msid:");if(1===n.length)return{stream:(i=n[0].substring(7).split(" "))[0],track:i[1]};let r=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"msid"===e.attribute);if(r.length>0)return{stream:(i=r[0].value.split(" "))[0],track:i[1]}},t.parseSctpDescription=function(e){let i,n=t.parseMLine(e),r=t.matchPrefix(e,"a=max-message-size:");r.length>0&&(i=parseInt(r[0].substring(19),10)),isNaN(i)&&(i=65536);let s=t.matchPrefix(e,"a=sctp-port:");if(s.length>0)return{port:parseInt(s[0].substring(12),10),protocol:n.fmt,maxMessageSize:i};let a=t.matchPrefix(e,"a=sctpmap:");if(a.length>0){let e=a[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:i}}},t.writeSctpDescription=function(e,t){let i=[];return i="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&i.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),i.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,i,n){return"v=0\r\no="+(n||"thisisadapterortc")+" "+(e||t.generateSessionId())+" "+(void 0!==i?i:2)+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,i){let n=t.splitLines(e);for(let e=0;e<n.length;e++)switch(n[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[e].substring(2)}return i?t.getDirection(i):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){let i=t.splitLines(e)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},t.parseOLine=function(e){let i=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;let i=t.splitLines(e);for(let e=0;e<i.length;e++)if(i[e].length<2||"="!==i[e].charAt(1))return!1;return!0},e.exports=t},94339:e=>{var t=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=(null!=e.raddr?" raddr %s rport %d":"%v%v")+(null!=e.tcptype?" tcptype %s":"%v"),null!=e.generation&&(t+=" generation %d"),t+=(null!=e["network-id"]?" network-id %d":"%v")+(null!=e["network-cost"]?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+((null!=e.id?"id=%s %s":"%v%s")+(null!=e.mediaClockValue?"=%s":"")+(null!=e.rateNumerator?" rate=%s":"")+(null!=e.rateDenominator?"/%s":""))}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(t).forEach(function(e){t[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},94735:e=>{"use strict";e.exports=require("events")}};var t=require("../../../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),n=t.X(0,[243,297,797,560,36],()=>i(62529));module.exports=n})();