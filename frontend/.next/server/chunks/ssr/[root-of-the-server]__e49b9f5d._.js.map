{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 39, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Bruce%20Vo/Documents/project/Streaming_Platform-1/Streaming_Platform/frontend/contexts/AuthContext.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { createContext, useContext, useEffect, useState, ReactNode, useCallback } from 'react';\r\nimport { useSession, signOut as nextAuthSignOut } from \"next-auth/react\";\r\nimport { useRouter } from 'next/navigation';\r\n\r\ninterface User {\r\n    _id: string;\r\n    fullName: string;\r\n    email: string;\r\n    profilePic: string;\r\n    isOnboarded: boolean;\r\n    bio: string;\r\n    nativeLanguage: string;\r\n    learningLanguage: string;\r\n    location: string;\r\n}\r\n\r\ninterface AuthContextType {\r\n    user: User | null;\r\n    token: string | null;\r\n    login: (userData: User, token: string) => void;\r\n    logout: () => void;\r\n    updateUser: (userData: User) => void;\r\n    isLoading: boolean;\r\n    authMethod: 'oauth' | 'credentials' | null;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\r\n\r\nexport function AuthProvider({ children }: { children: ReactNode }) {\r\n    const { data: session, status } = useSession();\r\n    const router = useRouter();\r\n    \r\n    const [user, setUser] = useState<User | null>(null);\r\n    const [token, setToken] = useState<string | null>(null);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [authMethod, setAuthMethod] = useState<'oauth' | 'credentials' | null>(null);\r\n\r\n    // H√†m helper ƒë·ªÉ fetch user data t·ª´ backend\r\n    const fetchUserData = useCallback(async (accessToken: string) => {\r\n        try {\r\n            const response = await fetch(`${process.env.NEXT_PUBLIC_API_URL}/auth/me`, {\r\n                headers: {\r\n                    'Authorization': `Bearer ${accessToken}`\r\n                }\r\n            });\r\n\r\n            if (response.ok) {\r\n                const data = await response.json();\r\n                return data.user;\r\n            }\r\n            return null;\r\n        } catch (error) {\r\n            console.error('Error fetching user data:', error);\r\n            return null;\r\n        }\r\n    }, []);\r\n\r\n    // Effect ƒë·ªÉ x·ª≠ l√Ω authentication\r\n    useEffect(() => {\r\n        const initAuth = async () => {\r\n            // ƒêang load NextAuth session\r\n            if (status === 'loading') {\r\n                return;\r\n            }\r\n\r\n            // N·∫øu c√≥ NextAuth session (OAuth login)\r\n            if (session?.user && session?.accessToken) {\r\n                console.log('üîê NextAuth session detected');\r\n                \r\n                // Fetch full user data t·ª´ backend\r\n                const fullUserData = await fetchUserData(session.accessToken);\r\n                \r\n                if (fullUserData) {\r\n                    const userData: User = {\r\n                        _id: fullUserData._id,\r\n                        email: fullUserData.email,\r\n                        fullName: fullUserData.fullName,\r\n                        profilePic: fullUserData.profilePic,\r\n                        isOnboarded: fullUserData.isOnboarded,\r\n                        bio: fullUserData.bio || '',\r\n                        nativeLanguage: fullUserData.nativeLanguage || '',\r\n                        learningLanguage: fullUserData.learningLanguage || '',\r\n                        location: fullUserData.location || ''\r\n                    };\r\n\r\n                    setUser(userData);\r\n                    setToken(session.accessToken);\r\n                    setAuthMethod('oauth');\r\n                    \r\n                    // Kh√¥ng l∆∞u v√†o localStorage cho OAuth\r\n                    // NextAuth t·ª± qu·∫£n l√Ω session\r\n                }\r\n            } \r\n            // N·∫øu kh√¥ng c√≥ NextAuth session, check localStorage (credentials login)\r\n            else {\r\n                console.log('üîë Checking localStorage for credentials auth');\r\n                \r\n                const savedToken = localStorage.getItem('auth_token');\r\n                const savedUser = localStorage.getItem('auth_user');\r\n\r\n                if (savedToken && savedUser) {\r\n                    try {\r\n                        // Verify token v·ªõi backend\r\n                        const userData = await fetchUserData(savedToken);\r\n                        \r\n                        if (userData) {\r\n                            setUser(userData);\r\n                            setToken(savedToken);\r\n                            setAuthMethod('credentials');\r\n                        } else {\r\n                            // Token invalid, clear localStorage\r\n                            localStorage.removeItem('auth_token');\r\n                            localStorage.removeItem('auth_user');\r\n                        }\r\n                    } catch (error) {\r\n                        console.error('Error validating saved token:', error);\r\n                        localStorage.removeItem('auth_token');\r\n                        localStorage.removeItem('auth_user');\r\n                    }\r\n                }\r\n            }\r\n\r\n            setIsLoading(false);\r\n        };\r\n\r\n        initAuth();\r\n    }, [session, status, fetchUserData]);\r\n\r\n    // Login function cho credentials\r\n    const login = useCallback((userData: User, token: string) => {\r\n        console.log('üîê Credentials login');\r\n        setUser(userData);\r\n        setToken(token);\r\n        setAuthMethod('credentials');\r\n        \r\n        // Ch·ªâ l∆∞u localStorage cho credentials auth\r\n        localStorage.setItem('auth_token', token);\r\n        localStorage.setItem('auth_user', JSON.stringify(userData));\r\n    }, []);\r\n\r\n    // Unified logout function\r\n    const logout = useCallback(async () => {\r\n        console.log('üö™ Logging out...');\r\n        \r\n        // Clear local state\r\n        setUser(null);\r\n        setToken(null);\r\n        setAuthMethod(null);\r\n        \r\n        // Clear localStorage\r\n        localStorage.removeItem('auth_token');\r\n        localStorage.removeItem('auth_user');\r\n        \r\n        // If using OAuth, sign out from NextAuth\r\n        if (authMethod === 'oauth') {\r\n            await nextAuthSignOut({ redirect: false });\r\n        }\r\n        \r\n        // Redirect to sign-in\r\n        router.push('/sign-in');\r\n    }, [authMethod, router]);\r\n\r\n    // Update user function\r\n    const updateUser = useCallback((userData: User) => {\r\n        console.log('üîÑ Updating user data');\r\n        setUser(userData);\r\n        \r\n        // Only update localStorage if using credentials auth\r\n        if (authMethod === 'credentials') {\r\n            localStorage.setItem('auth_user', JSON.stringify(userData));\r\n        }\r\n    }, [authMethod]);\r\n\r\n    // Debug logs\r\n    useEffect(() => {\r\n        console.log('üîç Auth State:', {\r\n            user: user?._id,\r\n            hasToken: !!token,\r\n            authMethod,\r\n            isLoading,\r\n            nextAuthStatus: status\r\n        });\r\n    }, [user, token, authMethod, isLoading, status]);\r\n\r\n    return (\r\n        <AuthContext.Provider value={{ \r\n            user, \r\n            token, \r\n            login, \r\n            logout, \r\n            updateUser, \r\n            isLoading,\r\n            authMethod \r\n        }}>\r\n            {children}\r\n        </AuthContext.Provider>\r\n    );\r\n}\r\n\r\nexport function useAuth() {\r\n    const context = useContext(AuthContext);\r\n    if (context === undefined) {\r\n        throw new Error('useAuth must be used within an AuthProvider');\r\n    }\r\n    return context;\r\n}"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAJA;;;;;AA4BA,MAAM,4BAAc,CAAA,GAAA,qMAAA,CAAA,gBAAa,AAAD,EAA+B;AAExD,SAAS,aAAa,EAAE,QAAQ,EAA2B;IAC9D,MAAM,EAAE,MAAM,OAAO,EAAE,MAAM,EAAE,GAAG,CAAA,GAAA,8IAAA,CAAA,aAAU,AAAD;IAC3C,MAAM,SAAS,CAAA,GAAA,kIAAA,CAAA,YAAS,AAAD;IAEvB,MAAM,CAAC,MAAM,QAAQ,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAe;IAC9C,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAiB;IAClD,MAAM,CAAC,WAAW,aAAa,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAC3C,MAAM,CAAC,YAAY,cAAc,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAkC;IAE7E,2CAA2C;IAC3C,MAAM,gBAAgB,CAAA,GAAA,qMAAA,CAAA,cAAW,AAAD,EAAE,OAAO;QACrC,IAAI;YACA,MAAM,WAAW,MAAM,MAAM,iEAAmC,QAAQ,CAAC,EAAE;gBACvE,SAAS;oBACL,iBAAiB,CAAC,OAAO,EAAE,aAAa;gBAC5C;YACJ;YAEA,IAAI,SAAS,EAAE,EAAE;gBACb,MAAM,OAAO,MAAM,SAAS,IAAI;gBAChC,OAAO,KAAK,IAAI;YACpB;YACA,OAAO;QACX,EAAE,OAAO,OAAO;YACZ,QAAQ,KAAK,CAAC,6BAA6B;YAC3C,OAAO;QACX;IACJ,GAAG,EAAE;IAEL,iCAAiC;IACjC,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACN,MAAM,WAAW;YACb,6BAA6B;YAC7B,IAAI,WAAW,WAAW;gBACtB;YACJ;YAEA,wCAAwC;YACxC,IAAI,SAAS,QAAQ,SAAS,aAAa;gBACvC,QAAQ,GAAG,CAAC;gBAEZ,kCAAkC;gBAClC,MAAM,eAAe,MAAM,cAAc,QAAQ,WAAW;gBAE5D,IAAI,cAAc;oBACd,MAAM,WAAiB;wBACnB,KAAK,aAAa,GAAG;wBACrB,OAAO,aAAa,KAAK;wBACzB,UAAU,aAAa,QAAQ;wBAC/B,YAAY,aAAa,UAAU;wBACnC,aAAa,aAAa,WAAW;wBACrC,KAAK,aAAa,GAAG,IAAI;wBACzB,gBAAgB,aAAa,cAAc,IAAI;wBAC/C,kBAAkB,aAAa,gBAAgB,IAAI;wBACnD,UAAU,aAAa,QAAQ,IAAI;oBACvC;oBAEA,QAAQ;oBACR,SAAS,QAAQ,WAAW;oBAC5B,cAAc;gBAEd,uCAAuC;gBACvC,8BAA8B;gBAClC;YACJ,OAEK;gBACD,QAAQ,GAAG,CAAC;gBAEZ,MAAM,aAAa,aAAa,OAAO,CAAC;gBACxC,MAAM,YAAY,aAAa,OAAO,CAAC;gBAEvC,IAAI,cAAc,WAAW;oBACzB,IAAI;wBACA,2BAA2B;wBAC3B,MAAM,WAAW,MAAM,cAAc;wBAErC,IAAI,UAAU;4BACV,QAAQ;4BACR,SAAS;4BACT,cAAc;wBAClB,OAAO;4BACH,oCAAoC;4BACpC,aAAa,UAAU,CAAC;4BACxB,aAAa,UAAU,CAAC;wBAC5B;oBACJ,EAAE,OAAO,OAAO;wBACZ,QAAQ,KAAK,CAAC,iCAAiC;wBAC/C,aAAa,UAAU,CAAC;wBACxB,aAAa,UAAU,CAAC;oBAC5B;gBACJ;YACJ;YAEA,aAAa;QACjB;QAEA;IACJ,GAAG;QAAC;QAAS;QAAQ;KAAc;IAEnC,iCAAiC;IACjC,MAAM,QAAQ,CAAA,GAAA,qMAAA,CAAA,cAAW,AAAD,EAAE,CAAC,UAAgB;QACvC,QAAQ,GAAG,CAAC;QACZ,QAAQ;QACR,SAAS;QACT,cAAc;QAEd,4CAA4C;QAC5C,aAAa,OAAO,CAAC,cAAc;QACnC,aAAa,OAAO,CAAC,aAAa,KAAK,SAAS,CAAC;IACrD,GAAG,EAAE;IAEL,0BAA0B;IAC1B,MAAM,SAAS,CAAA,GAAA,qMAAA,CAAA,cAAW,AAAD,EAAE;QACvB,QAAQ,GAAG,CAAC;QAEZ,oBAAoB;QACpB,QAAQ;QACR,SAAS;QACT,cAAc;QAEd,qBAAqB;QACrB,aAAa,UAAU,CAAC;QACxB,aAAa,UAAU,CAAC;QAExB,yCAAyC;QACzC,IAAI,eAAe,SAAS;YACxB,MAAM,CAAA,GAAA,8IAAA,CAAA,UAAe,AAAD,EAAE;gBAAE,UAAU;YAAM;QAC5C;QAEA,sBAAsB;QACtB,OAAO,IAAI,CAAC;IAChB,GAAG;QAAC;QAAY;KAAO;IAEvB,uBAAuB;IACvB,MAAM,aAAa,CAAA,GAAA,qMAAA,CAAA,cAAW,AAAD,EAAE,CAAC;QAC5B,QAAQ,GAAG,CAAC;QACZ,QAAQ;QAER,qDAAqD;QACrD,IAAI,eAAe,eAAe;YAC9B,aAAa,OAAO,CAAC,aAAa,KAAK,SAAS,CAAC;QACrD;IACJ,GAAG;QAAC;KAAW;IAEf,aAAa;IACb,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACN,QAAQ,GAAG,CAAC,kBAAkB;YAC1B,MAAM,MAAM;YACZ,UAAU,CAAC,CAAC;YACZ;YACA;YACA,gBAAgB;QACpB;IACJ,GAAG;QAAC;QAAM;QAAO;QAAY;QAAW;KAAO;IAE/C,qBACI,8OAAC,YAAY,QAAQ;QAAC,OAAO;YACzB;YACA;YACA;YACA;YACA;YACA;YACA;QACJ;kBACK;;;;;;AAGb;AAEO,SAAS;IACZ,MAAM,UAAU,CAAA,GAAA,qMAAA,CAAA,aAAU,AAAD,EAAE;IAC3B,IAAI,YAAY,WAAW;QACvB,MAAM,IAAI,MAAM;IACpB;IACA,OAAO;AACX","debugId":null}},
    {"offset": {"line": 229, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Bruce%20Vo/Documents/project/Streaming_Platform-1/Streaming_Platform/frontend/contexts/ThemeContext.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { createContext, useContext, useEffect, useState, ReactNode } from 'react';\r\n\r\ninterface ThemeContextType {\r\n    theme: string;\r\n    setTheme: (theme: string) => void;\r\n}\r\n\r\nconst ThemeContext = createContext<ThemeContextType | undefined>(undefined);\r\n\r\nexport function ThemeProvider({ children }: { children: ReactNode }) {\r\n    const [theme, setThemeState] = useState('dark'); // default theme\r\n    const [mounted, setMounted] = useState(false);\r\n\r\n    // Load theme from localStorage on mount\r\n    useEffect(() => {\r\n        const savedTheme = localStorage.getItem('streamify-theme') || 'dark';\r\n        setThemeState(savedTheme);\r\n        document.documentElement.setAttribute('data-theme', savedTheme);\r\n        setMounted(true);\r\n    }, []);\r\n\r\n    const setTheme = (newTheme: string) => {\r\n        setThemeState(newTheme);\r\n        localStorage.setItem('streamify-theme', newTheme);\r\n        document.documentElement.setAttribute('data-theme', newTheme);\r\n    };\r\n\r\n    // Don't render until mounted to avoid hydration mismatch\r\n    if (!mounted) {\r\n        return <>{children}</>;\r\n    }\r\n\r\n    return (\r\n        <ThemeContext.Provider value={{ theme, setTheme }}>\r\n            {children}\r\n        </ThemeContext.Provider>\r\n    );\r\n}\r\n\r\nexport function useTheme() {\r\n    const context = useContext(ThemeContext);\r\n    if (context === undefined) {\r\n        throw new Error('useTheme must be used within a ThemeProvider');\r\n    }\r\n    return context;\r\n}"],"names":[],"mappings":";;;;;AAEA;AAFA;;;AASA,MAAM,6BAAe,CAAA,GAAA,qMAAA,CAAA,gBAAa,AAAD,EAAgC;AAE1D,SAAS,cAAc,EAAE,QAAQ,EAA2B;IAC/D,MAAM,CAAC,OAAO,cAAc,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE,SAAS,gBAAgB;IACjE,MAAM,CAAC,SAAS,WAAW,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAEvC,wCAAwC;IACxC,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACN,MAAM,aAAa,aAAa,OAAO,CAAC,sBAAsB;QAC9D,cAAc;QACd,SAAS,eAAe,CAAC,YAAY,CAAC,cAAc;QACpD,WAAW;IACf,GAAG,EAAE;IAEL,MAAM,WAAW,CAAC;QACd,cAAc;QACd,aAAa,OAAO,CAAC,mBAAmB;QACxC,SAAS,eAAe,CAAC,YAAY,CAAC,cAAc;IACxD;IAEA,yDAAyD;IACzD,IAAI,CAAC,SAAS;QACV,qBAAO;sBAAG;;IACd;IAEA,qBACI,8OAAC,aAAa,QAAQ;QAAC,OAAO;YAAE;YAAO;QAAS;kBAC3C;;;;;;AAGb;AAEO,SAAS;IACZ,MAAM,UAAU,CAAA,GAAA,qMAAA,CAAA,aAAU,AAAD,EAAE;IAC3B,IAAI,YAAY,WAAW;QACvB,MAAM,IAAI,MAAM;IACpB;IACA,OAAO;AACX","debugId":null}},
    {"offset": {"line": 285, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Bruce%20Vo/Documents/project/Streaming_Platform-1/Streaming_Platform/frontend/components/ToasterProvider.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { Toaster } from \"react-hot-toast\";\r\n\r\nexport function ToasterProvider() {\r\n    return <Toaster />;\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AAFA;;;AAIO,SAAS;IACZ,qBAAO,8OAAC,uJAAA,CAAA,UAAO;;;;;AACnB","debugId":null}},
    {"offset": {"line": 306, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Bruce%20Vo/Documents/project/Streaming_Platform-1/Streaming_Platform/frontend/providers/SessionProvider.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { SessionProvider } from \"next-auth/react\"\r\n\r\nexport default function NextAuthSessionProvider({\r\n    children,\r\n}: {\r\n    children: React.ReactNode\r\n}) {\r\n    return <SessionProvider>{children}</SessionProvider>\r\n}"],"names":[],"mappings":";;;;AAEA;AAFA;;;AAIe,SAAS,wBAAwB,EAC5C,QAAQ,EAGX;IACG,qBAAO,8OAAC,8IAAA,CAAA,kBAAe;kBAAE;;;;;;AAC7B","debugId":null}}]
}